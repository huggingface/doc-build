<meta charset="utf-8" /><meta http-equiv="content-security-policy" content=""><meta name="hf:doc:metadata" content="{&quot;local&quot;:&quot;thun-luyn-mt-m-hnh-ngn-ng-nhn-qu-t-u&quot;,&quot;sections&quot;:[{&quot;local&quot;:&quot;thu-thp-d-liu&quot;,&quot;title&quot;:&quot;Thu th·∫≠p d·ªØ li·ªáu&quot;},{&quot;local&quot;:&quot;chun-b-tp-d-liu&quot;,&quot;title&quot;:&quot;Chu·∫©n b·ªã t·∫≠p d·ªØ li·ªáu&quot;},{&quot;local&quot;:&quot;khi-to-m-hnh-mi&quot;,&quot;title&quot;:&quot;Kh·ªüi t·∫°o m√¥ h√¨nh m·ªõi&quot;},{&quot;local&quot;:&quot;to-m-vi-mt-pipeline&quot;,&quot;title&quot;:&quot;T·∫°o m√£ v·ªõi m·ªôt pipeline&quot;},{&quot;local&quot;:&quot;hun-luyn-vi-accelerate&quot;,&quot;title&quot;:&quot;Hu·∫•n luy·ªán v·ªõi ü§ó Accelerate&quot;}],&quot;title&quot;:&quot;THu·∫•n luy·ªán m·ªôt m√¥ h√¨nh ng√¥n ng·ªØ nh√¢n qu·∫£ t·ª´ ƒë·∫ßu&quot;}" data-svelte="svelte-1phssyn">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/assets/pages/__layout.svelte-hf-doc-builder.css">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/start-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/chunks/vendor-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/chunks/paths-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/pages/__layout.svelte-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/pages/chapter7/6.mdx-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/chunks/Tip-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/chunks/Youtube-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/chunks/IconCopyLink-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/chunks/CodeBlock-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/chunks/DocNotebookDropdown-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/vi/_app/chunks/FrameworkSwitchCourse-hf-doc-builder.js"> 





<div class="bg-white leading-none border border-gray-100 rounded-lg flex p-0.5 w-56 text-sm mb-4"><a class="flex justify-center flex-1 py-1.5 px-2.5 focus:outline-none !no-underline rounded-l bg-red-50 dark:bg-transparent text-red-600" href="?fw=pt"><svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><defs><clipPath id="a"><rect x="3.05" y="0.5" width="25.73" height="31" fill="none"></rect></clipPath></defs><g clip-path="url(#a)"><path d="M24.94,9.51a12.81,12.81,0,0,1,0,18.16,12.68,12.68,0,0,1-18,0,12.81,12.81,0,0,1,0-18.16l9-9V5l-.84.83-6,6a9.58,9.58,0,1,0,13.55,0ZM20.44,9a1.68,1.68,0,1,1,1.67-1.67A1.68,1.68,0,0,1,20.44,9Z" fill="#ee4c2c"></path></g></svg>
			Pytorch
		</a><a class="flex justify-center flex-1 py-1.5 px-2.5 focus:outline-none !no-underline rounded-r text-gray-500 filter grayscale" href="?fw=tf"><svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="0.94em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 274"><path d="M145.726 42.065v42.07l72.861 42.07v-42.07l-72.86-42.07zM0 84.135v42.07l36.43 21.03V105.17L0 84.135zm109.291 21.035l-36.43 21.034v126.2l36.43 21.035v-84.135l36.435 21.035v-42.07l-36.435-21.034V105.17z" fill="#E55B2D"></path><path d="M145.726 42.065L36.43 105.17v42.065l72.861-42.065v42.065l36.435-21.03v-84.14zM255.022 63.1l-36.435 21.035v42.07l36.435-21.035V63.1zm-72.865 84.135l-36.43 21.035v42.07l36.43-21.036v-42.07zm-36.43 63.104l-36.436-21.035v84.135l36.435-21.035V210.34z" fill="#ED8E24"></path><path d="M145.726 0L0 84.135l36.43 21.035l109.296-63.105l72.861 42.07L255.022 63.1L145.726 0zm0 126.204l-36.435 21.03l36.435 21.036l36.43-21.035l-36.43-21.03z" fill="#F8BF3C"></path></svg>
			TensorFlow
		</a></div>
<h1 class="relative group"><a id="thun-luyn-mt-m-hnh-ngn-ng-nhn-qu-t-u" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#thun-luyn-mt-m-hnh-ngn-ng-nhn-qu-t-u"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>THu·∫•n luy·ªán m·ªôt m√¥ h√¨nh ng√¥n ng·ªØ nh√¢n qu·∫£ t·ª´ ƒë·∫ßu
	</span></h1>



<div class="flex space-x-1 absolute z-10 right-0 top-0">
	<a href="https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter7/section6_pt.ipynb" target="_blank"><img alt="Open In Colab" class="!m-0" src="https://colab.research.google.com/assets/colab-badge.svg"></a>
	<a href="https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter7/section6_pt.ipynb" target="_blank"><img alt="Open In Studio Lab" class="!m-0" src="https://studiolab.sagemaker.aws/studiolab.svg"></a></div>
<p>Cho ƒë·∫øn th·ªùi ƒëi·ªÉm hi·ªán t·∫°i, ch√∫ng ta ch·ªß y·∫øu s·ª≠ d·ª•ng c√°c m√¥ h√¨nh ƒë∆∞·ª£c hu·∫•n luy·ªán tr∆∞·ªõc v√† tinh ch·ªânh ch√∫ng cho c√°c tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng m·ªõi b·∫±ng c√°ch s·ª≠ d·ª•ng l·∫°i c√°c tr·ªçng s·ªë t·ª´ hu·∫•n luy·ªán tr∆∞·ªõc. Nh∆∞ ch√∫ng ta ƒë√£ th·∫•y trong <a href="/course/chapter1">Ch∆∞∆°ng 1</a>, ƒëi·ªÅu n√†y th∆∞·ªùng ƒë∆∞·ª£c g·ªçi l√† <em>transfer learning</em> hay <em>h·ªçc chuy·ªÉn giao</em>, v√† ƒë√≥ l√† m·ªôt chi·∫øn l∆∞·ª£c r·∫•t th√†nh c√¥ng ƒë·ªÉ √°p d·ª•ng c√°c m√¥ h√¨nh Transformer cho h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng trong th·∫ø gi·ªõi th·ª±c n∆°i d·ªØ li·ªáu ƒë∆∞·ª£c g·∫Øn nh√£n l√† th∆∞a th·ªõt. Trong ch∆∞∆°ng n√†y, ch√∫ng ta s·∫Ω th·ª±c hi·ªán m·ªôt c√°ch ti·∫øp c·∫≠n kh√°c v√† hu·∫•n luy·ªán m·ªôt m√¥ h√¨nh ho√†n to√†n m·ªõi t·ª´ ƒë·∫ßu. ƒê√¢y l√† m·ªôt c√°ch ti·∫øp c·∫≠n t·ªët ƒë·ªÉ th·ª±c hi·ªán n·∫øu b·∫°n c√≥ nhi·ªÅu d·ªØ li·ªáu v√† n√≥ r·∫•t kh√°c v·ªõi d·ªØ li·ªáu hu·∫•n luy·ªán tr∆∞·ªõc ƒë∆∞·ª£c s·ª≠ d·ª•ng cho c√°c m√¥ h√¨nh c√≥ s·∫µn. Tuy nhi√™n, n√≥ c≈©ng ƒë√≤i h·ªèi nhi·ªÅu t√†i nguy√™n m√°y t√≠nh h∆°n ƒë√°ng k·ªÉ ƒë·ªÉ hu·∫•n luy·ªán tr∆∞·ªõc m·ªôt m√¥ h√¨nh ng√¥n ng·ªØ h∆°n l√† ch·ªâ ƒë·ªÉ tinh ch·ªânh m√¥ h√¨nh hi·ªán c√≥. C√°c v√≠ d·ª• c√≥ th·ªÉ c√≥ √Ω nghƒ©a khi hu·∫•n luy·ªán m·ªôt m√¥ h√¨nh m·ªõi bao g·ªìm c√°c t·∫≠p d·ªØ li·ªáu bao g·ªìm c√°c n·ªët nh·∫°c, tr√¨nh t·ª± ph√¢n t·ª≠ nh∆∞ DNA ho·∫∑c ng√¥n ng·ªØ l·∫≠p tr√¨nh. C√¥ng c·ª• th·ª© hai g·∫ßn ƒë√¢y ƒë√£ ƒë·∫°t ƒë∆∞·ª£c s·ª©c h√∫t nh·ªù c√°c c√¥ng c·ª• nh∆∞ TabNine v√† GitHub‚Äôs Copilot, ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi m√¥ h√¨nh Codex c·ªßa OpenAI, c√≥ th·ªÉ t·∫°o ra c√°c chu·ªói m√£ d√†i. T√°c v·ª• t·∫°o vƒÉn b·∫£n n√†y ƒë∆∞·ª£c gi·∫£i quy·∫øt t·ªët nh·∫•t v·ªõi c√°c m√¥ h√¨nh ng√¥n ng·ªØ t·ª± ƒë·ªông h·ªìi quy ho·∫∑c nh√¢n qu·∫£ nh∆∞ GPT-2.</p>
<p>Trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω x√¢y d·ª±ng m·ªôt phi√™n b·∫£n thu nh·ªè c·ªßa m√¥ h√¨nh t·∫°o m√£: ch√∫ng ta s·∫Ω t·∫≠p trung v√†o c√°c ho√†n th√†nh m·ªôt d√≤ng thay v√¨ c√°c h√†m ho·∫∑c l·ªõp ƒë·∫ßy ƒë·ªß, s·ª≠ d·ª•ng m·ªôt t·∫≠p h·ª£p con m√£ Python. Khi l√†m vi·ªác v·ªõi d·ªØ li·ªáu b·∫±ng Python, b·∫°n th∆∞·ªùng xuy√™n ti·∫øp x√∫c v·ªõi b·ªô khoa h·ªçc d·ªØ li·ªáu Python, bao g·ªìm c√°c th∆∞ vi·ªán <code>matplotlib</code>, <code>seaborn</code>, <code>pandas</code> v√† <code>scikit-learn</code>. Khi s·ª≠ d·ª•ng ch√∫ng, th√¥ng th∆∞·ªùng c·∫ßn ph·∫£i tra c·ª©u c√°c l·ªánh c·ª• th·ªÉ, v√¨ v·∫≠y s·∫Ω r·∫•t tuy·ªát n·∫øu ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng m·ªôt m√¥ h√¨nh ƒë·ªÉ ho√†n th√†nh c√°c l·ªánh g·ªçi n√†y cho ch√∫ng ta.</p>
<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/Vpjb1lu0MDk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Trong <a href="/course/chapter6">Ch∆∞∆°ng 6</a>, ch√∫ng ta ƒë√£ t·∫°o m·ªôt tr√¨nh tokenize hi·ªáu qu·∫£ ƒë·ªÉ x·ª≠ l√Ω m√£ ngu·ªìn Python, nh∆∞ng nh·ªØng g√¨ ch√∫ng ta v·∫´n c·∫ßn l√† m·ªôt t·∫≠p d·ªØ li·ªáu quy m√¥ l·ªõn ƒë·ªÉ hu·∫•n luy·ªán tr∆∞·ªõc m·ªôt m√¥ h√¨nh. ·ªû ƒë√¢y, ch√∫ng ta s·∫Ω √°p d·ª•ng tokenizer cho m·ªôt kho l∆∞u tr·ªØ m√£ Python c√≥ ngu·ªìn g·ªëc t·ª´ kho l∆∞u tr·ªØ GitHub. Sau ƒë√≥, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng API <code>Trainer</code> v√† ü§ó Accelerate ƒë·ªÉ hu·∫•n luy·ªán m√¥ h√¨nh. Ch√∫ng ta h√£y ƒëi ƒë·∫øn ƒë√≥!</p>
<iframe src="https://hf.space/gradioiframe/course-demos/codeparrot-ds/+" frameborder="0" height="300" title="Gradio app" class="block dark:hidden container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>
<p>ƒê√¢y th·ª±c s·ª± c√°ch m√¥ h√¨nh ƒë√£ ƒë∆∞·ª£c hu·∫•n luy·ªán v√† t·∫£i l√™n Hub b·∫±ng c√°ch s·ª≠ d·ª•ng m√£ ƒë∆∞·ª£c hi·ªÉn th·ªã trong ph·∫ßn n√†y. B·∫°n c√≥ th·ªÉ t√¨m th·∫•y n√≥ <a href="https://huggingface.co/huggingface-course/codeparrot-ds?text=plt.imshow%28" rel="nofollow">t·∫°i ƒë√¢y</a>. L∆∞u √Ω r·∫±ng v√¨ c√≥ m·ªôt s·ªë ng·∫´u nhi√™n x·∫£y ra trong qu√° tr√¨nh t·∫°o vƒÉn b·∫£n, b·∫°n c√≥ th·ªÉ s·∫Ω nh·∫≠n ƒë∆∞·ª£c m·ªôt k·∫øt qu·∫£ h∆°i kh√°c.</p>
<h2 class="relative group"><a id="thu-thp-d-liu" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#thu-thp-d-liu"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>Thu th·∫≠p d·ªØ li·ªáu
	</span></h2>

<p>M√£ Python c√≥ s·∫µn r·∫•t nhi·ªÅu t·ª´ c√°c kho m√£ nh∆∞ GitHub, m√† ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o t·∫≠p d·ªØ li·ªáu b·∫±ng c√°ch ƒë√†o m·ªçi kho l∆∞u tr·ªØ Python. ƒê√¢y l√† ph∆∞∆°ng ph√°p ƒë∆∞·ª£c th·ª±c hi·ªán trong <a href="https://learning.oreilly.com/library/view/natural-language-processing/9781098103231/" rel="nofollow">s√°ch gi√°o khoa v·ªÅ Transformers</a> ƒë·ªÉ hu·∫•n luy·ªán tr∆∞·ªõc m·ªôt m√¥ h√¨nh GPT-2 l·ªõn. S·ª≠ d·ª•ng k·∫øt xu·∫•t GitHub kho·∫£ng 180 GB ch·ª©a kho·∫£ng 20 tri·ªáu t·ªáp Python c√≥ t√™n l√† <code>codeparrot</code>, c√°c t√°c gi·∫£ ƒë√£ x√¢y d·ª±ng m·ªôt t·∫≠p d·ªØ li·ªáu m√† sau ƒë√≥ h·ªç chia s·∫ª tr√™n <a href="https://huggingface.co/datasets/transformersbook/codeparrot" rel="nofollow">Hugging Face Hub</a> .</p>
<p>Tuy nhi√™n, vi·ªác hu·∫•n luy·ªán tr√™n to√†n b·ªô ng·ªØ li·ªáu n√†y t·ªën nhi·ªÅu th·ªùi gian v√† t√≠nh to√°n, v√† ch√∫ng ta ch·ªâ c·∫ßn t·∫≠p con c·ªßa t·∫≠p d·ªØ li·ªáu li√™n quan ƒë·∫øn ngƒÉn x·∫øp khoa h·ªçc d·ªØ li·ªáu Python. V√¨ v·∫≠y, h√£y b·∫Øt ƒë·∫ßu b·∫±ng c√°ch l·ªçc t·∫≠p d·ªØ li·ªáu <code>codeparrot</code> cho t·∫•t c·∫£ c√°c t·ªáp bao g·ªìm b·∫•t k·ª≥ th∆∞ vi·ªán n√†o trong ngƒÉn x·∫øp n√†y. Do k√≠ch th∆∞·ªõc c·ªßa t·∫≠p d·ªØ li·ªáu, ch√∫ng ta mu·ªën tr√°nh t·∫£i n√≥ xu·ªëng; thay v√†o ƒë√≥, ta s·∫Ω s·ª≠ d·ª•ng t√≠nh nƒÉng ph√°t tr·ª±c tuy·∫øn ƒë·ªÉ l·ªçc n√≥ m·ªôt c√°ch nhanh ch√≥ng. ƒê·ªÉ gi√∫p ch√∫ng ta l·ªçc c√°c m·∫´u m√£ b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c th∆∞ vi·ªán ƒë√£ ƒë·ªÅ c·∫≠p tr∆∞·ªõc ƒë√≥, ta s·∫Ω s·ª≠ d·ª•ng h√†m sau:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">any_keyword_in_string</span>(<span class="hljs-params">string, keywords</span>):
    <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> keywords:
        <span class="hljs-keyword">if</span> keyword <span class="hljs-keyword">in</span> string:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><!-- HTML_TAG_END --></pre></div>
<p>H√£y ki·ªÉm tra n√≥ tr√™n hai v√≠ d·ª•:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->filters = [<span class="hljs-string">&quot;pandas&quot;</span>, <span class="hljs-string">&quot;sklearn&quot;</span>, <span class="hljs-string">&quot;matplotlib&quot;</span>, <span class="hljs-string">&quot;seaborn&quot;</span>]
example_1 = <span class="hljs-string">&quot;import numpy as np&quot;</span>
example_2 = <span class="hljs-string">&quot;import pandas as pd&quot;</span>

<span class="hljs-built_in">print</span>(
    any_keyword_in_string(example_1, filters), any_keyword_in_string(example_2, filters)
)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-literal">False</span> <span class="hljs-literal">True</span><!-- HTML_TAG_END --></pre></div>
<p>Ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng ƒëi·ªÅu n√†y ƒë·ªÉ t·∫°o m·ªôt h√†m s·∫Ω truy·ªÅn tr·ª±c tuy·∫øn t·∫≠p d·ªØ li·ªáu v√† l·ªçc c√°c ph·∫ßn t·ª≠ ta mu·ªën:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict
<span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm
<span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> Dataset


<span class="hljs-keyword">def</span> <span class="hljs-title function_">filter_streaming_dataset</span>(<span class="hljs-params">dataset, filters</span>):
    filtered_dict = defaultdict(<span class="hljs-built_in">list</span>)
    total = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> sample <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">iter</span>(dataset)):
        total += <span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> any_keyword_in_string(sample[<span class="hljs-string">&quot;content&quot;</span>], filters):
            <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> sample.items():
                filtered_dict[k].append(v)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">{<span class="hljs-built_in">len</span>(filtered_dict[<span class="hljs-string">&#x27;content&#x27;</span>])/total:<span class="hljs-number">.2</span>%}</span> of data after filtering.&quot;</span>)
    <span class="hljs-keyword">return</span> Dataset.from_dict(filtered_dict)<!-- HTML_TAG_END --></pre></div>
<p>Sau ƒë√≥, ch√∫ng ta c√≥ th·ªÉ ch·ªâ c·∫ßn √°p d·ª•ng ch·ª©c nƒÉng n√†y cho t·∫≠p d·ªØ li·ªáu ph√°t tr·ª±c tuy·∫øn:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-comment"># √î n√†y s·∫Ω m·∫•t r·∫•t nhi·ªÅu th·ªùi gian ƒë·ªÉ th·ª±c thi, v√¨ v·∫≠y b·∫°n n√™n b·ªè qua v√† chuy·ªÉn ƒë·∫øn</span>
<span class="hljs-comment"># c√°i ti·∫øp theo!</span>
<span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset

split = <span class="hljs-string">&quot;train&quot;</span>  <span class="hljs-comment"># &quot;valid&quot;</span>
filters = [<span class="hljs-string">&quot;pandas&quot;</span>, <span class="hljs-string">&quot;sklearn&quot;</span>, <span class="hljs-string">&quot;matplotlib&quot;</span>, <span class="hljs-string">&quot;seaborn&quot;</span>]

data = load_dataset(<span class="hljs-string">f&quot;transformersbook/codeparrot-<span class="hljs-subst">{split}</span>&quot;</span>, split=split, streaming=<span class="hljs-literal">True</span>)
filtered_data = filter_streaming_dataset(data, filters)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-number">3.26</span>% of data after filtering.<!-- HTML_TAG_END --></pre></div>
<p>ƒêi·ªÅu n√†y ƒë·ªÉ l·∫°i cho ch√∫ng ta kho·∫£ng 3% t·∫≠p d·ªØ li·ªáu ban ƒë·∫ßu, v·∫´n c√≤n kh√° l·ªõn - t·∫≠p d·ªØ li·ªáu k·∫øt qu·∫£ l√† 6GB v√† bao g·ªìm 600,000 t·∫≠p l·ªánh Python!</p>
<p>Vi·ªác l·ªçc to√†n b·ªô t·∫≠p d·ªØ li·ªáu c√≥ th·ªÉ m·∫•t 2-3 gi·ªù t√πy thu·ªôc v√†o m√°y v√† bƒÉng th√¥ng c·ªßa b·∫°n. N·∫øu b·∫°n kh√¥ng mu·ªën t·ª± m√¨nh tr·∫£i qua qu√° tr√¨nh k√©o d√†i n√†y, ch√∫ng ta cung c·∫•p t·∫≠p d·ªØ li·ªáu ƒë√£ l·ªçc tr√™n Hub ƒë·ªÉ b·∫°n t·∫£i xu·ªëng:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset, DatasetDict

ds_train = load_dataset(<span class="hljs-string">&quot;huggingface-course/codeparrot-ds-train&quot;</span>, split=<span class="hljs-string">&quot;train&quot;</span>)
ds_valid = load_dataset(<span class="hljs-string">&quot;huggingface-course/codeparrot-ds-valid&quot;</span>, split=<span class="hljs-string">&quot;validation&quot;</span>)

raw_datasets = DatasetDict(
    {
        <span class="hljs-string">&quot;train&quot;</span>: ds_train,  <span class="hljs-comment"># .shuffle().select(range(50000)),</span>
        <span class="hljs-string">&quot;valid&quot;</span>: ds_valid,  <span class="hljs-comment"># .shuffle().select(range(500))</span>
    }
)

raw_datasets<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;repo_name&#x27;</span>, <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;copies&#x27;</span>, <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>, <span class="hljs-string">&#x27;license&#x27;</span>],
        num_rows: <span class="hljs-number">606720</span>
    })
    valid: Dataset({
        features: [<span class="hljs-string">&#x27;repo_name&#x27;</span>, <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;copies&#x27;</span>, <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>, <span class="hljs-string">&#x27;license&#x27;</span>],
        num_rows: <span class="hljs-number">3322</span>
    })
})<!-- HTML_TAG_END --></pre></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>Vi·ªác hu·∫•n luy·ªán tr∆∞·ªõc m√¥ h√¨nh ng√¥n ng·ªØ s·∫Ω m·∫•t m·ªôt l√∫c. Ch√∫ng t√¥i khuy√™n b·∫°n tr∆∞·ªõc ti√™n n√™n ch·∫°y v√≤ng l·∫∑p hu·∫•n luy·ªán tr√™n m·ªôt m·∫´u d·ªØ li·ªáu b·∫±ng c√°ch b·ªè ch√∫ th√≠ch hai d√≤ng m·ªôt ph·∫ßn ·ªü tr√™n v√† ƒë·∫£m b·∫£o r·∫±ng qu√° tr√¨nh hu·∫•n luy·ªán ho√†n t·∫•t th√†nh c√¥ng v√† c√°c m√¥ h√¨nh ƒë∆∞·ª£c l∆∞u tr·ªØ. Kh√¥ng c√≥ g√¨ kh√≥ ch·ªãu h∆°n l√† m·ªôt l·∫ßn ch·∫°y hu·∫•n luy·ªán kh√¥ng th√†nh c√¥ng ·ªü b∆∞·ªõc cu·ªëi c√πng v√¨ b·∫°n qu√™n t·∫°o m·ªôt th∆∞ m·ª•c ho·∫∑c v√¨ c√≥ l·ªói ƒë√°nh m√°y ·ªü cu·ªëi v√≤ng l·∫∑p hu·∫•n luy·ªán!</p></div>
<p>H√£y xem m·ªôt v√≠ d·ª• t·ª´ t·∫≠p d·ªØ li·ªáu. Ch√∫ng ta s·∫Ω ch·ªâ hi·ªÉn th·ªã 200 k√Ω t·ª± ƒë·∫ßu ti√™n c·ªßa m·ªói tr∆∞·ªùng:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">0</span>]:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">{key.upper()}</span>: <span class="hljs-subst">{raw_datasets[<span class="hljs-string">&#x27;train&#x27;</span>][<span class="hljs-number">0</span>][key][:<span class="hljs-number">200</span>]}</span>&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;REPO_NAME: kmike/scikit-learn&#x27;</span>
<span class="hljs-string">&#x27;PATH: sklearn/utils/__init__.py&#x27;</span>
<span class="hljs-string">&#x27;COPIES: 3&#x27;</span>
<span class="hljs-string">&#x27;SIZE: 10094&#x27;</span>
<span class="hljs-string">&#x27;&#x27;&#x27;CONTENT: &quot;&quot;&quot;
The :mod:`sklearn.utils` module includes various utilites.
&quot;&quot;&quot;

from collections import Sequence

import numpy as np
from scipy.sparse import issparse
import warnings

from .murmurhash import murm
LICENSE: bsd-3-clause&#x27;&#x27;&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>Ch√∫ng ta c√≥ th·ªÉ th·∫•y r·∫±ng tr∆∞·ªùng <code>content</code> ch·ª©a m√£ m√† ch√∫ng ta mu·ªën m√¥ h√¨nh c·ªßa m√¨nh hu·∫•n luy·ªán. B√¢y gi·ªù ch√∫ng ta ƒë√£ c√≥ m·ªôt t·∫≠p d·ªØ li·ªáu, ch√∫ng ta c·∫ßn chu·∫©n b·ªã c√°c vƒÉn b·∫£n ƒë·ªÉ ch√∫ng c√≥ ƒë·ªãnh d·∫°ng ph√π h·ª£p ƒë·ªÉ hu·∫•n luy·ªán tr∆∞·ªõc.</p>
<h2 class="relative group"><a id="chun-b-tp-d-liu" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#chun-b-tp-d-liu"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>Chu·∫©n b·ªã t·∫≠p d·ªØ li·ªáu
	</span></h2>

<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/ma1TrR7gE7I" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>B∆∞·ªõc ƒë·∫ßu ti√™n s·∫Ω l√† tokenize d·ªØ li·ªáu ƒë·ªÉ ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng n√≥ ƒë·ªÉ hu·∫•n luy·ªán. V√¨ m·ª•c ti√™u c·ªßa ch√∫ng ta ch·ªß y·∫øu l√† t·ª± ƒë·ªông ho√†n th√†nh c√°c l·ªánh g·ªçi h√†m ng·∫Øn, ch√∫ng ta c√≥ th·ªÉ gi·ªØ k√≠ch th∆∞·ªõc ng·ªØ c·∫£nh t∆∞∆°ng ƒë·ªëi nh·ªè. ƒêi·ªÅu n√†y c√≥ l·ª£i √≠ch l√† ch√∫ng ta c√≥ th·ªÉ hu·∫•n luy·ªán m√¥ h√¨nh nhanh h∆°n nhi·ªÅu v√† n√≥ c·∫ßn √≠t b·ªô nh·ªõ h∆°n ƒë√°ng k·ªÉ. N·∫øu ƒëi·ªÅu quan tr·ªçng l√† ·ª©ng d·ª•ng c·ªßa b·∫°n ph·∫£i c√≥ nhi·ªÅu ng·ªØ c·∫£nh h∆°n (v√≠ d·ª•: n·∫øu b·∫°n mu·ªën m√¥ h√¨nh vi·∫øt c√°c b√†i ki·ªÉm tra ƒë∆°n v·ªã d·ª±a tr√™n t·ªáp c√≥ ƒë·ªãnh nghƒ©a h√†m), h√£y ƒë·∫£m b·∫£o b·∫°n tƒÉng con s·ªë ƒë√≥, nh∆∞ng c≈©ng l∆∞u √Ω r·∫±ng ƒëi·ªÅu n√†y ƒëi k√®m v·ªõi b·ªô nh·ªõ GPU l·ªõn h∆°n. Hi·ªán t·∫°i, h√£y s·ª≠a k√≠ch th∆∞·ªõc ng·ªØ c·∫£nh ·ªü 128 token, tr√°i ng∆∞·ª£c v·ªõi 1,024 ho·∫∑c 2,048 ƒë∆∞·ª£c s·ª≠ d·ª•ng trong GPT-2 ho·∫∑c GPT-3, t∆∞∆°ng ·ª©ng.</p>
<p>H·∫ßu h·∫øt c√°c t√†i li·ªáu ch·ª©a nhi·ªÅu h∆°n 128 token, v√¨ v·∫≠y ch·ªâ c·∫ßn c·∫Øt b·ªõt ƒë·∫ßu v√†o ƒë·∫øn ƒë·ªô d√†i t·ªëi ƒëa s·∫Ω lo·∫°i b·ªè m·ªôt ph·∫ßn l·ªõn t·∫≠p d·ªØ li·ªáu c·ªßa m√¨nh. Thay v√†o ƒë√≥, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng t√πy ch·ªçn <code>return_overflowing_tokens</code> ƒë·ªÉ token to√†n b·ªô ƒë·∫ßu v√†o v√† chia n√≥ th√†nh nhi·ªÅu ph·∫ßn, nh∆∞ ch√∫ng ta ƒë√£ l√†m trong <a href="/course/chapter6/4">Ch∆∞∆°ng 6</a>. Ch√∫ng ta c≈©ng s·∫Ω s·ª≠ d·ª•ng t√πy ch·ªçn <code>return_length</code> ƒë·ªÉ t·ª± ƒë·ªông tr·∫£ v·ªÅ ƒë·ªô d√†i c·ªßa m·ªói ƒëo·∫°n ƒë∆∞·ª£c t·∫°o. Th∆∞·ªùng th√¨ ph·∫ßn cu·ªëi c√πng s·∫Ω nh·ªè h∆°n k√≠ch th∆∞·ªõc ng·ªØ c·∫£nh v√† ch√∫ng ta s·∫Ω lo·∫°i b·ªè nh·ªØng ph·∫ßn n√†y ƒë·ªÉ tr√°nh c√°c v·∫•n ƒë·ªÅ v·ªÅ ph·∫ßn ƒë·ªám; ch√∫ng ta kh√¥ng th·ª±c s·ª± c·∫ßn ch√∫ng v√¨ d√π sao ch√∫ng ta c≈©ng c√≥ nhi·ªÅu d·ªØ li·ªáu.</p>
<div class="flex justify-center"><img class="block dark:hidden" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/chunking_texts.svg" alt="Chunking a large texts in several pieces.">
  <img class="hidden dark:block" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/chunking_texts-dark.svg" alt="Chunking a large texts in several pieces."></div>
<p>H√£y xem ch√≠nh x√°c c√°ch th·ª©c ho·∫°t ƒë·ªông c·ªßa ƒëi·ªÅu n√†y b·∫±ng c√°ch xem hai v√≠ d·ª• ƒë·∫ßu ti√™n:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer

context_length = <span class="hljs-number">128</span>
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;huggingface-course/code-search-net-tokenizer&quot;</span>)

outputs = tokenizer(
    raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][:<span class="hljs-number">2</span>][<span class="hljs-string">&quot;content&quot;</span>],
    truncation=<span class="hljs-literal">True</span>,
    max_length=context_length,
    return_overflowing_tokens=<span class="hljs-literal">True</span>,
    return_length=<span class="hljs-literal">True</span>,
)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Input IDs length: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(outputs[<span class="hljs-string">&#x27;input_ids&#x27;</span>])}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Input chunk lengths: <span class="hljs-subst">{(outputs[<span class="hljs-string">&#x27;length&#x27;</span>])}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Chunk mapping: <span class="hljs-subst">{outputs[<span class="hljs-string">&#x27;overflow_to_sample_mapping&#x27;</span>]}</span>&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->Input IDs length: <span class="hljs-number">34</span>
Input chunk lengths: [<span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">117</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">41</span>]
Chunk mapping: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]<!-- HTML_TAG_END --></pre></div>
<p>Ch√∫ng ta c√≥ th·ªÉ th·∫•y r·∫±ng ch√∫ng ta nh·∫≠n ƒë∆∞·ª£c t·ªïng c·ªông 34 ph√¢n ƒëo·∫°n t·ª´ hai v√≠ d·ª• ƒë√≥. Nh√¨n v√†o ƒë·ªô d√†i ph√¢n ƒëo·∫°n, ch√∫ng ta c√≥ th·ªÉ th·∫•y r·∫±ng c√°c ƒëo·∫°n ·ªü cu·ªëi c·∫£ hai t√†i li·ªáu c√≥ √≠t h∆°n 128 token (t∆∞∆°ng ·ª©ng l√† 117 v√† 41). Ch√∫ng ch·ªâ ƒë·∫°i di·ªán cho m·ªôt ph·∫ßn nh·ªè trong t·ªïng s·ªë c√°c kh·ªëi m√† ch√∫ng ta c√≥, v√¨ v·∫≠y ch√∫ng ta c√≥ th·ªÉ v·ª©t ch√∫ng ƒëi m·ªôt c√°ch an to√†n. V·ªõi tr∆∞·ªùng <code>overflow_to_sample_mapping</code>, ch√∫ng ta c≈©ng c√≥ th·ªÉ t·∫°o l·∫°i c√°c ph·∫ßn thu·ªôc v·ªÅ m·∫´u ƒë·∫ßu v√†o n√†o.</p>
<p>V·ªõi thao t√°c n√†y, ch√∫ng ta ƒëang s·ª≠ d·ª•ng m·ªôt t√≠nh nƒÉng ti·ªán d·ª•ng c·ªßa h√†m <code>Dataset.map()</code> trong ü§ó Datasets, ƒë√≥ l√† n√≥ kh√¥ng y√™u c·∫ßu √°nh x·∫° 1-1; nh∆∞ ch√∫ng ta ƒë√£ th·∫•y trong <a href="/course/chapter7/3">ph·∫ßn 3</a>, ch√∫ng ta c√≥ th·ªÉ t·∫°o c√°c l√¥ c√≥ nhi·ªÅu ph·∫ßn t·ª≠ h∆°n ho·∫∑c √≠t h∆°n l√¥ ƒë·∫ßu v√†o. ƒêi·ªÅu n√†y r·∫•t h·ªØu √≠ch khi th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông nh∆∞ tƒÉng d·ªØ li·ªáu ho·∫∑c l·ªçc d·ªØ li·ªáu l√†m thay ƒë·ªïi s·ªë l∆∞·ª£ng ph·∫ßn t·ª≠. Trong tr∆∞·ªùng h·ª£p c·ªßa ch√∫ng ta, khi tokenize m·ªói ph·∫ßn t·ª≠ th√†nh c√°c ph·∫ßn c√≥ k√≠ch th∆∞·ªõc ng·ªØ c·∫£nh ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh, ch√∫ng ta t·∫°o nhi·ªÅu m·∫´u t·ª´ m·ªói t√†i li·ªáu. Ch√∫ng ta ch·ªâ c·∫ßn ƒë·∫£m b·∫£o x√≥a c√°c c·ªôt hi·ªán c√≥, v√¨ ch√∫ng c√≥ k√≠ch th∆∞·ªõc xung ƒë·ªôt. N·∫øu ch√∫ng ta mu·ªën gi·ªØ ch√∫ng, ch√∫ng ta c√≥ th·ªÉ l·∫∑p l·∫°i ch√∫ng m·ªôt c√°ch th√≠ch h·ª£p v√† tr·∫£ l·∫°i ch√∫ng trong l·ªánh g·ªçi <code>Dataset.map()</code>:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize</span>(<span class="hljs-params">element</span>):
    outputs = tokenizer(
        element[<span class="hljs-string">&quot;content&quot;</span>],
        truncation=<span class="hljs-literal">True</span>,
        max_length=context_length,
        return_overflowing_tokens=<span class="hljs-literal">True</span>,
        return_length=<span class="hljs-literal">True</span>,
    )
    input_batch = []
    <span class="hljs-keyword">for</span> length, input_ids <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(outputs[<span class="hljs-string">&quot;length&quot;</span>], outputs[<span class="hljs-string">&quot;input_ids&quot;</span>]):
        <span class="hljs-keyword">if</span> length == context_length:
            input_batch.append(input_ids)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;input_ids&quot;</span>: input_batch}


tokenized_datasets = raw_datasets.<span class="hljs-built_in">map</span>(
    tokenize, batched=<span class="hljs-literal">True</span>, remove_columns=raw_datasets[<span class="hljs-string">&quot;train&quot;</span>].column_names
)
tokenized_datasets<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;input_ids&#x27;</span>],
        num_rows: <span class="hljs-number">16702061</span>
    })
    valid: Dataset({
        features: [<span class="hljs-string">&#x27;input_ids&#x27;</span>],
        num_rows: <span class="hljs-number">93164</span>
    })
})<!-- HTML_TAG_END --></pre></div>
<p>Hi·ªán ch√∫ng ta c√≥ 16,7 tri·ªáu v√≠ d·ª• v·ªõi 128 token m·ªói v√≠ d·ª•, t∆∞∆°ng ·ª©ng v·ªõi t·ªïng c·ªông kho·∫£ng 2,1 t·ª∑ token. ƒê·ªÉ tham kh·∫£o, c√°c m√¥ h√¨nh GPT-3 v√† Codex c·ªßa OpenAI ƒë∆∞·ª£c hu·∫•n luy·ªán tr√™n 300 v√† 100 t·ª∑ token t∆∞∆°ng ·ª©ng, trong ƒë√≥ c√°c m√¥ h√¨nh Codex ƒë∆∞·ª£c kh·ªüi t·∫°o t·ª´ c√°c checkpoint GPT-3. M·ª•c ti√™u c·ªßa ch√∫ng ta trong ph·∫ßn n√†y kh√¥ng ph·∫£i l√† c·∫°nh tranh v·ªõi c√°c m√¥ h√¨nh n√†y, c√≥ th·ªÉ t·∫°o ra c√°c vƒÉn b·∫£n d√†i, m·∫°ch l·∫°c, m√† l√† t·∫°o ra m·ªôt phi√™n b·∫£n thu nh·ªè cung c·∫•p ch·ª©c nƒÉng t·ª± ƒë·ªông ho√†n th√†nh nhanh ch√≥ng cho c√°c nh√† khoa h·ªçc d·ªØ li·ªáu.</p>
<p>B√¢y gi·ªù ch√∫ng ta ƒë√£ c√≥ t·∫≠p d·ªØ li·ªáu s·∫µn s√†ng, h√£y thi·∫øt l·∫≠p m√¥ h√¨nh!</p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>‚úèÔ∏è <strong>Th·ª≠ nghi·ªám th√¥i!</strong> Lo·∫°i b·ªè t·∫•t c·∫£ c√°c ph·∫ßn nh·ªè h∆°n k√≠ch th∆∞·ªõc ng·ªØ c·∫£nh kh√¥ng ph·∫£i l√† v·∫•n ƒë·ªÅ l·ªõn ·ªü ƒë√¢y v√¨ ch√∫ng ta ƒëang s·ª≠ d·ª•ng c√°c c·ª≠a s·ªï ng·ªØ c·∫£nh nh·ªè. Khi b·∫°n tƒÉng k√≠ch th∆∞·ªõc ng·ªØ c·∫£nh (ho·∫∑c n·∫øu b·∫°n c√≥ m·ªôt kho t√†i li·ªáu ng·∫Øn), ph·∫ßn nh·ªè c√°c ph·∫ßn b·ªã v·ª©t b·ªè c≈©ng s·∫Ω tƒÉng l√™n. M·ªôt c√°ch hi·ªáu qu·∫£ h∆°n ƒë·ªÉ chu·∫©n b·ªã d·ªØ li·ªáu l√† k·∫øt h·ª£p t·∫•t c·∫£ c√°c m·∫´u ƒë∆∞·ª£c tokenize trong m·ªôt l√¥ v·ªõi token <code>eos_token_id</code> ·ªü gi·ªØa, v√† sau ƒë√≥ th·ª±c hi·ªán ph√¢n ƒëo·∫°n tr√™n c√°c chu·ªói ƒë∆∞·ª£c n·ªëi. Nh∆∞ m·ªôt b√†i t·∫≠p, h√£y s·ª≠a ƒë·ªïi h√†m <code>tokenize()</code> ƒë·ªÉ s·ª≠ d·ª•ng c√°ch ti·∫øp c·∫≠n ƒë√≥. L∆∞u √Ω r·∫±ng b·∫°n s·∫Ω mu·ªën ƒë·∫∑t <code>truncation=False</code> v√† x√≥a c√°c tham s·ªë kh√°c kh·ªèi tokenizer ƒë·ªÉ nh·∫≠n ƒë∆∞·ª£c chu·ªói ƒë·∫ßy ƒë·ªß c·ªßa token ID.</p></div>
<h2 class="relative group"><a id="khi-to-m-hnh-mi" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#khi-to-m-hnh-mi"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>Kh·ªüi t·∫°o m√¥ h√¨nh m·ªõi
	</span></h2>

<p>B∆∞·ªõc ƒë·∫ßu ti√™n c·ªßa ch√∫ng ta l√† kh·ªüi ch·∫°y m·ªõi m√¥ h√¨nh GPT-2. Ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng c√πng m·ªôt c·∫•u h√¨nh cho m√¥ h√¨nh c·ªßa m√¨nh nh∆∞ cho m√¥ h√¨nh GPT-2 nh·ªè, v√¨ v·∫≠y ch√∫ng ta t·∫£i c·∫•u h√¨nh ƒë·ªãnh s·∫µn, ƒë·∫£m b·∫£o r·∫±ng k√≠ch th∆∞·ªõc tokenizer kh·ªõp v·ªõi k√≠ch th∆∞·ªõc t·ª´ v·ª±ng c·ªßa m√¥ h√¨nh v√† chuy·ªÉn <code>bos</code> v√† <code>eos</code> (b·∫Øt ƒë·∫ßu v√† cu·ªëi chu·ªói) token ID:</p>
<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, GPT2LMHeadModel, AutoConfig

config = AutoConfig.from_pretrained(
    <span class="hljs-string">&quot;gpt2&quot;</span>,
    vocab_size=<span class="hljs-built_in">len</span>(tokenizer),
    n_ctx=context_length,
    bos_token_id=tokenizer.bos_token_id,
    eos_token_id=tokenizer.eos_token_id,
)<!-- HTML_TAG_END --></pre></div>
<p>V·ªõi c·∫•u h√¨nh ƒë√≥, ch√∫ng ta c√≥ th·ªÉ t·∫£i m·ªôt m√¥ h√¨nh m·ªõi. L∆∞u √Ω r·∫±ng ƒë√¢y l√† l·∫ßn ƒë·∫ßu ti√™n ch√∫ng ta kh√¥ng s·ª≠ d·ª•ng h√†m <code>from_pretrained()</code>, v√¨ ch√∫ng ta th·ª±c s·ª± ƒëang kh·ªüi t·∫°o m·ªôt m√¥ h√¨nh c·ªßa ch√≠nh ch√∫ng ta:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->model = GPT2LMHeadModel(config)
model_size = <span class="hljs-built_in">sum</span>(t.numel() <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> model.parameters())
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;GPT-2 size: <span class="hljs-subst">{model_size/<span class="hljs-number">1000</span>**<span class="hljs-number">2</span>:<span class="hljs-number">.1</span>f}</span>M parameters&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->GPT-<span class="hljs-number">2</span> size: <span class="hljs-number">124.2</span>M parameters<!-- HTML_TAG_END --></pre></div>
<p>M√¥ h√¨nh c·ªßa ch√∫ng ta c√≥ 124 tri·ªáu th√¥ng s·ªë m√† ta s·∫Ω ph·∫£i ƒëi·ªÅu ch·ªânh. Tr∆∞·ªõc khi c√≥ th·ªÉ b·∫Øt ƒë·∫ßu hu·∫•n luy·ªán, ch√∫ng ta c·∫ßn thi·∫øt l·∫≠p m·ªôt b·ªô ƒë·ªëi chi·∫øu d·ªØ li·ªáu s·∫Ω ƒë·∫£m nh·∫≠n vi·ªác t·∫°o c√°c l√¥. Ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng tr√¨nh c·∫Øt gh√©p <code>DataCollatorForLanguageModeling</code>, ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·∫∑c bi·ªát cho m√¥ h√¨nh ng√¥n ng·ªØ (nh∆∞ t√™n g·ªçi g·ª£i √Ω m·ªôt c√°ch tinh t·∫ø). B√™n c·∫°nh vi·ªác x·∫øp ch·ªìng v√† ƒë·ªám c√°c l√¥, n√≥ c≈©ng ƒë·∫£m nh·∫≠n vi·ªác t·∫°o c√°c nh√£n c·ªßa m√¥ h√¨nh ng√¥n ng·ªØ - trong m√¥ h√¨nh ng√¥n ng·ªØ nh√¢n qu·∫£, c√°c ƒë·∫ßu v√†o c≈©ng ƒë√≥ng vai tr√≤ l√† nh√£n (ch·ªâ ƒë∆∞·ª£c d·ªãch chuy·ªÉn b·ªüi m·ªôt ph·∫ßn t·ª≠) v√† tr√¨nh ƒë·ªëi chi·∫øu d·ªØ li·ªáu n√†y t·∫°o ch√∫ng nhanh ch√≥ng trong qu√° tr√¨nh hu·∫•n luy·ªán, v√¨ v·∫≠y ch√∫ng t√¥i ta kh√¥ng c·∫ßn sao ch√©p <code>input_ids</code>.</p>
<p>L∆∞u √Ω r·∫±ng <code>DataCollatorForLanguageModeling</code> h·ªó tr·ª£ c·∫£ m√¥ h√¨nh h√≥a ng√¥n ng·ªØ b·ªã ·∫©n ƒëi (MLM) v√† m√¥ h√¨nh ng√¥n ng·ªØ nh√¢n qu·∫£ (CLM). Theo m·∫∑c ƒë·ªãnh, n√≥ chu·∫©n b·ªã d·ªØ li·ªáu cho MLM, nh∆∞ng ch√∫ng ta c√≥ th·ªÉ chuy·ªÉn sang CLM b·∫±ng c√°ch ƒë·∫∑t ƒë·ªëi s·ªë <code>mlm=False</code>:</p>
<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> DataCollatorForLanguageModeling

tokenizer.pad_token = tokenizer.eos_token
data_collator = DataCollatorForLanguageModeling(tokenizer, mlm=<span class="hljs-literal">False</span>)<!-- HTML_TAG_END --></pre></div>
<p>H√£y xem m·ªôt v√≠ d·ª•:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->out = data_collator([tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>][i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)])
<span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> out:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">{key}</span> shape: <span class="hljs-subst">{out[key].shape}</span>&quot;</span>)<!-- HTML_TAG_END --></pre></div>
<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->input_ids shape: torch.Size([<span class="hljs-number">5</span>, <span class="hljs-number">128</span>])
attention_mask shape: torch.Size([<span class="hljs-number">5</span>, <span class="hljs-number">128</span>])
labels shape: torch.Size([<span class="hljs-number">5</span>, <span class="hljs-number">128</span>])<!-- HTML_TAG_END --></pre></div>
<p>Ch√∫ng ta c√≥ th·ªÉ th·∫•y r·∫±ng c√°c v√≠ d·ª• ƒë√£ ƒë∆∞·ª£c x·∫øp ch·ªìng l√™n nhau v√† t·∫•t c·∫£ c√°c tensor c√≥ c√πng h√¨nh d·∫°ng.</p>



<div class="course-tip course-tip-orange bg-gradient-to-br dark:bg-gradient-to-r before:border-orange-500 dark:before:border-orange-800 from-orange-50 dark:from-gray-900 to-white dark:to-gray-950 border border-orange-50 text-orange-700 dark:text-gray-400"><p>‚ö†Ô∏è Vi·ªác d·ªãch chuy·ªÉn c√°c ƒë·∫ßu v√†o v√† nh√£n ƒë·ªÉ cƒÉn ch·ªânh ch√∫ng x·∫£y ra b√™n trong m√¥ h√¨nh, do ƒë√≥, b·ªô ƒë·ªëi chi·∫øu d·ªØ li·ªáu ch·ªâ c·∫ßn sao ch√©p c√°c ƒë·∫ßu v√†o ƒë·ªÉ t·∫°o nh√£n.</p></div>
<p>B√¢y gi·ªù ch√∫ng ta c√≥ m·ªçi th·ª© ƒë·ªÉ th·ª±c s·ª± hu·∫•n luy·ªán m√¥ h√¨nh c·ªßa m√¨nh - ƒë√≥ kh√¥ng ph·∫£i l√† qu√° nhi·ªÅu c√¥ng vi·ªác! Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu luy·ªán t·∫≠p, ch√∫ng ta n√™n ƒëƒÉng nh·∫≠p v√†o Hugging Face. N·∫øu b·∫°n ƒëang l√†m vi·ªác trong notebook, b·∫°n c√≥ th·ªÉ l√†m nh∆∞ v·∫≠y v·ªõi h√†m ti·ªán √≠ch sau:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> notebook_login

notebook_login()<!-- HTML_TAG_END --></pre></div>
<p>Thao t√°c n√†y s·∫Ω hi·ªÉn th·ªã m·ªôt ti·ªán √≠ch m√† b·∫°n c√≥ th·ªÉ nh·∫≠p th√¥ng tin ƒëƒÉng nh·∫≠p Hugging Face c·ªßa m√¨nh.</p>
<p>N·∫øu b·∫°n kh√¥ng l√†m vi·ªác trong notebook, ch·ªâ c·∫ßn nh·∫≠p d√≤ng sau v√†o thi·∫øt b·ªã ƒë·∫ßu cu·ªëi c·ªßa b·∫°n:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->huggingface-cli login<!-- HTML_TAG_END --></pre></div>
<p>T·∫•t c·∫£ nh·ªØng g√¨ c√≤n l·∫°i c·∫ßn l√†m l√† c·∫•u h√¨nh c√°c tham s·ªë hu·∫•n luy·ªán v√† k√≠ch ho·∫°t <code>Trainer</code>. Ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng l·ªãch tr√¨nh t·ªëc ƒë·ªô h·ªçc cosine v·ªõi m·ªôt s·ªë l·∫ßn kh·ªüi ƒë·ªông v√† k√≠ch th∆∞·ªõc l√¥ hi·ªáu qu·∫£ l√† 256 (<code>per_device_train_batch_size</code> * <code>gradient_accumulation_steps</code>). T√≠ch l≈©y gradient ƒë∆∞·ª£c s·ª≠ d·ª•ng khi m·ªôt lo·∫°t l√¥ duy nh·∫•t kh√¥ng v·ª´a v·ªõi b·ªô nh·ªõ v√† d·∫ßn d·∫ßn t√≠ch l≈©y gradient th√¥ng qua m·ªôt s·ªë l·∫ßn truy·ªÅn xu√¥i/ng∆∞·ª£c. Ch√∫ng ta s·∫Ω th·∫•y ƒëi·ªÅu n√†y ho·∫°t ƒë·ªông khi ch√∫ng ta t·∫°o v√≤ng hu·∫•n luy·ªán v·ªõi ü§ó Accelerate.</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Trainer, TrainingArguments

args = TrainingArguments(
    output_dir=<span class="hljs-string">&quot;codeparrot-ds&quot;</span>,
    per_device_train_batch_size=<span class="hljs-number">32</span>,
    per_device_eval_batch_size=<span class="hljs-number">32</span>,
    evaluation_strategy=<span class="hljs-string">&quot;steps&quot;</span>,
    eval_steps=<span class="hljs-number">5_000</span>,
    logging_steps=<span class="hljs-number">5_000</span>,
    gradient_accumulation_steps=<span class="hljs-number">8</span>,
    num_train_epochs=<span class="hljs-number">1</span>,
    weight_decay=<span class="hljs-number">0.1</span>,
    warmup_steps=<span class="hljs-number">1_000</span>,
    lr_scheduler_type=<span class="hljs-string">&quot;cosine&quot;</span>,
    learning_rate=<span class="hljs-number">5e-4</span>,
    save_steps=<span class="hljs-number">5_000</span>,
    fp16=<span class="hljs-literal">True</span>,
    push_to_hub=<span class="hljs-literal">True</span>,
)

trainer = Trainer(
    model=model,
    tokenizer=tokenizer,
    args=args,
    data_collator=data_collator,
    train_dataset=tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>],
    eval_dataset=tokenized_datasets[<span class="hljs-string">&quot;valid&quot;</span>],
)<!-- HTML_TAG_END --></pre></div>
<p>B√¢y gi·ªù ch√∫ng ta c√≥ th·ªÉ kh·ªüi ƒë·ªông <code>Trainer</code> v√† ƒë·ª£i qu√° tr√¨nh hu·∫•n luy·ªán k·∫øt th√∫c. T√πy thu·ªôc v√†o vi·ªác b·∫°n ch·∫°y n√≥ tr√™n to√†n b·ªô hay m·ªôt t·∫≠p h·ª£p con c·ªßa b·ªô hu·∫•n luy·ªán, t∆∞∆°ng ·ª©ng s·∫Ω m·∫•t 20 ho·∫∑c 2 gi·ªù, v√¨ v·∫≠y h√£y l·∫•y m·ªôt √≠t c√† ph√™ v√† m·ªôt cu·ªën s√°ch hay ƒë·ªÉ ƒë·ªçc!</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->trainer.train()<!-- HTML_TAG_END --></pre></div>
<p>Sau khi qu√° tr√¨nh hu·∫•n luy·ªán ho√†n t·∫•t, ch√∫ng ta c√≥ th·ªÉ ƒë·∫©y m√¥ h√¨nh v√† tr√¨nh tokenizer v√†o Hub:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->trainer.push_to_hub()<!-- HTML_TAG_END --></pre></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>‚úèÔ∏è <strong>Th·ª≠ nghi·ªám th√¥i!</strong> Ch·ªâ m·∫•t kho·∫£ng 30 d√≤ng m√£ ngo√†i <code>TrainingArguments</code> ƒë·ªÉ t·ª´ vƒÉn b·∫£n th√¥ ƒë·∫øn hu·∫•n luy·ªán GPT-2. H√£y d√πng th·ª≠ v·ªõi t·∫≠p d·ªØ li·ªáu c·ªßa ri√™ng b·∫°n v√† xem li·ªáu b·∫°n c√≥ th·ªÉ ƒë·∫°t ƒë∆∞·ª£c k·∫øt qu·∫£ t·ªët hay kh√¥ng!</p></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>üí° N·∫øu b·∫°n c√≥ quy·ªÅn truy c·∫≠p v√†o m·ªôt m√°y c√≥ nhi·ªÅu GPU, h√£y th·ª≠ ch·∫°y m√£ ·ªü ƒë√≥. <code>Trainer</code> t·ª± ƒë·ªông qu·∫£n l√Ω nhi·ªÅu m√°y v√† ƒëi·ªÅu n√†y c√≥ th·ªÉ tƒÉng t·ªëc qu√° tr√¨nh hu·∫•n luy·ªán l√™n r·∫•t nhi·ªÅu.</p></div>
<h2 class="relative group"><a id="to-m-vi-mt-pipeline" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#to-m-vi-mt-pipeline"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>T·∫°o m√£ v·ªõi m·ªôt pipeline
	</span></h2>

<p>B√¢y gi·ªù l√† th·ªùi ƒëi·ªÉm c·ªßa s·ª± th·∫≠t: ch√∫ng ta h√£y xem m√¥ h√¨nh ƒë∆∞·ª£c hu·∫•n luy·ªán th·ª±c s·ª± ho·∫°t ƒë·ªông t·ªët nh∆∞ th·∫ø n√†o! Ch√∫ng ta c√≥ th·ªÉ th·∫•y trong nh·∫≠t k√Ω r·∫±ng m·∫•t m√°t ƒë√£ gi·∫£m ƒë·ªÅu ƒë·∫∑n, nh∆∞ng ƒë·ªÉ ƒë∆∞a m√¥ h√¨nh v√†o th·ª≠ nghi·ªám, ch√∫ng ta h√£y xem n√≥ ho·∫°t ƒë·ªông t·ªët nh∆∞ th·∫ø n√†o tr√™n m·ªôt s·ªë l·ªùi nh·∫Øc. ƒê·ªÉ l√†m ƒëi·ªÅu ƒë√≥, ch√∫ng ta s·∫Ω bao b·ªçc m√¥ h√¨nh trong m·ªôt <code>pipeline</code> t·∫°o vƒÉn b·∫£n v√† ch√∫ng ta s·∫Ω ƒë∆∞a n√≥ v√†o GPU cho c√°c th·∫ø h·ªá nhanh n·∫øu c√≥ s·∫µn:</p>
<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span>) <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> torch.device(<span class="hljs-string">&quot;cpu&quot;</span>)
pipe = pipeline(
    <span class="hljs-string">&quot;text-generation&quot;</span>, model=<span class="hljs-string">&quot;huggingface-course/codeparrot-ds&quot;</span>, device=device
)<!-- HTML_TAG_END --></pre></div>
<p>H√£y b·∫Øt ƒë·∫ßu v·ªõi t√°c v·ª• ƒë∆°n gi·∫£n l√† t·∫°o m·ªôt bi·ªÉu ƒë·ªì ph√¢n t√°n:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->txt = <span class="hljs-string">&quot;&quot;&quot;\
# create some data
x = np.random.randn(100)
y = np.random.randn(100)

# create scatter plot with x, y
&quot;&quot;&quot;</span>
<span class="hljs-built_in">print</span>(pipe(txt, num_return_sequences=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;generated_text&quot;</span>])<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-comment"># create some data</span>
x = np.random.randn(<span class="hljs-number">100</span>)
y = np.random.randn(<span class="hljs-number">100</span>)

<span class="hljs-comment"># create scatter plot with x, y</span>
plt.scatter(x, y)

<span class="hljs-comment"># create scatter</span><!-- HTML_TAG_END --></pre></div>
<p>K·∫øt qu·∫£ c√≥ v·∫ª ch√≠nh x√°c. N√≥ c≈©ng ho·∫°t ƒë·ªông v·ªõi <code>pandas</code>? H√£y xem li·ªáu ch√∫ng ta c√≥ th·ªÉ t·∫°o m·ªôt <code>DataFrame</code> t·ª´ hai m·∫£ng kh√¥ng:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->txt = <span class="hljs-string">&quot;&quot;&quot;\
# create some data
x = np.random.randn(100)
y = np.random.randn(100)

# create dataframe from x and y
&quot;&quot;&quot;</span>
<span class="hljs-built_in">print</span>(pipe(txt, num_return_sequences=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;generated_text&quot;</span>])<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-comment"># create some data</span>
x = np.random.randn(<span class="hljs-number">100</span>)
y = np.random.randn(<span class="hljs-number">100</span>)

<span class="hljs-comment"># create dataframe from x and y</span>
df = pd.DataFrame({<span class="hljs-string">&#x27;x&#x27;</span>: x, <span class="hljs-string">&#x27;y&#x27;</span>: y})
df.insert(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;x&#x27;</span>, x)
<span class="hljs-keyword">for</span><!-- HTML_TAG_END --></pre></div>
<p>Th·∫≠t tuy·ªát, ƒë√≥ l√† c√¢u tr·∫£ l·ªùi ch√≠nh x√°c - m·∫∑c d√π sau ƒë√≥ n√≥ l·∫°i ch√®n th√™m c·ªôt <code>x</code>. V√¨ s·ªë l∆∞·ª£ng token ƒë∆∞·ª£c t·∫°o c√≥ gi·ªõi h·∫°n, v√≤ng l·∫∑p <code>for</code> sau ƒë√¢y s·∫Ω b·ªã c·∫Øt. H√£y xem li·ªáu ch√∫ng ta c√≥ th·ªÉ l√†m ƒëi·ªÅu g√¨ ƒë√≥ ph·ª©c t·∫°p h∆°n m·ªôt ch√∫t v√† ƒë·ªÉ m√¥ h√¨nh gi√∫p ch√∫ng ta s·ª≠ d·ª•ng ho·∫°t ƒë·ªông <code>groupby</code>:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->txt = <span class="hljs-string">&quot;&quot;&quot;\
# dataframe with profession, income and name
df = pd.DataFrame({&#x27;profession&#x27;: x, &#x27;income&#x27;:y, &#x27;name&#x27;: z})

# calculate the mean income per profession
&quot;&quot;&quot;</span>
<span class="hljs-built_in">print</span>(pipe(txt, num_return_sequences=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;generated_text&quot;</span>])<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-comment"># dataframe with profession, income and name</span>
df = pd.DataFrame({<span class="hljs-string">&#x27;profession&#x27;</span>: x, <span class="hljs-string">&#x27;income&#x27;</span>:y, <span class="hljs-string">&#x27;name&#x27;</span>: z})

<span class="hljs-comment"># calculate the mean income per profession</span>
profession = df.groupby([<span class="hljs-string">&#x27;profession&#x27;</span>]).mean()

<span class="hljs-comment"># compute the</span><!-- HTML_TAG_END --></pre></div>
<p>Kh√¥ng t·ªá; ƒë√≥ l√† c√°ch l√†m ƒë√∫ng. Cu·ªëi c√πng, h√£y xem li·ªáu ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng n√≥ cho <code>scikit-learn</code> v√† thi·∫øt l·∫≠p m√¥ h√¨nh Random Forest hay kh√¥ng:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->txt = <span class="hljs-string">&quot;&quot;&quot;
# import random forest regressor from scikit-learn
from sklearn.ensemble import RandomForestRegressor

# fit random forest model with 300 estimators on X, y:
&quot;&quot;&quot;</span>
<span class="hljs-built_in">print</span>(pipe(txt, num_return_sequences=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;generated_text&quot;</span>])<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-comment"># import random forest regressor from scikit-learn</span>
<span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestRegressor

<span class="hljs-comment"># fit random forest model with 300 estimators on X, y:</span>
rf = RandomForestRegressor(n_estimators=<span class="hljs-number">300</span>, random_state=random_state, max_depth=<span class="hljs-number">3</span>)
rf.fit(X, y)
rf<!-- HTML_TAG_END --></pre></div>
<p>Nh√¨n v√†o m·ªôt v√†i v√≠ d·ª• n√†y, c√≥ v·∫ª nh∆∞ m√¥ h√¨nh ƒë√£ h·ªçc ƒë∆∞·ª£c m·ªôt s·ªë c√∫ ph√°p c·ªßa b·ªô khoa h·ªçc d·ªØ li·ªáu Python (t·∫•t nhi√™n, ch√∫ng t√¥i s·∫Ω c·∫ßn ƒë√°nh gi√° k·ªπ l∆∞·ª°ng h∆°n tr∆∞·ªõc khi tri·ªÉn khai m√¥ h√¨nh trong th·∫ø gi·ªõi th·ª±c). Tuy nhi√™n, ƒë√¥i khi n√≥ ƒë√≤i h·ªèi ph·∫£i t√πy ch·ªânh nhi·ªÅu h∆°n vi·ªác hu·∫•n luy·ªán m√¥ h√¨nh ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c hi·ªáu su·∫•t c·∫ßn thi·∫øt cho m·ªôt tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng nh·∫•t ƒë·ªãnh. V√≠ d·ª•: ƒëi·ªÅu g√¨ s·∫Ω x·∫£y ra n·∫øu ch√∫ng ta mu·ªën c·∫≠p nh·∫≠t ƒë·ªông k√≠ch th∆∞·ªõc l√¥ ho·∫∑c c√≥ m·ªôt v√≤ng l·∫∑p hu·∫•n luy·ªán c√≥ ƒëi·ªÅu ki·ªán ƒë·ªÉ b·ªè qua c√°c v√≠ d·ª• x·∫•u m·ªôt c√°ch nhanh ch√≥ng? M·ªôt t√πy ch·ªçn s·∫Ω l√† ph√¢n l·ªõp <code>Trainer</code> v√† th√™m c√°c thay ƒë·ªïi c·∫ßn thi·∫øt, nh∆∞ng ƒë√¥i khi vi·ªác vi·∫øt v√≤ng l·∫∑p hu·∫•n luy·ªán t·ª´ ƒë·∫ßu s·∫Ω ƒë∆°n gi·∫£n h∆°n. ƒê√≥ l√† l√∫c ü§ó Accelerate xu·∫•t hi·ªán.</p>
<h2 class="relative group"><a id="hun-luyn-vi-accelerate" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#hun-luyn-vi-accelerate"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>Hu·∫•n luy·ªán v·ªõi ü§ó Accelerate
	</span></h2>

<p>Ch√∫ng ta ƒë√£ th·∫•y c√°ch hu·∫•n luy·ªán m·ªôt m√¥ h√¨nh v·ªõi <code>Trainer</code>, c√≥ th·ªÉ cho ph√©p m·ªôt s·ªë t√πy ch·ªânh. Tuy nhi√™n, ƒë√¥i khi ch√∫ng ta mu·ªën to√†n quy·ªÅn ki·ªÉm so√°t v√≤ng l·∫∑p hu·∫•n luy·ªán ho·∫∑c ch√∫ng ta mu·ªën th·ª±c hi·ªán m·ªôt s·ªë thay ƒë·ªïi k·ª≥ l·∫°. Trong tr∆∞·ªùng h·ª£p n√†y ü§ó Accelerate l√† m·ªôt l·ª±a ch·ªçn tuy·ªát v·ªùi v√† trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω xem x√©t c√°c b∆∞·ªõc s·ª≠ d·ª•ng n√≥ ƒë·ªÉ hu·∫•n luy·ªán m√¥ h√¨nh c·ªßa m√¨nh. ƒê·ªÉ l√†m cho m·ªçi th·ª© th√∫ v·ªã h∆°n, ch√∫ng ta c≈©ng s·∫Ω th√™m m·ªôt s·ªë ƒëi·ªÅu ch·ªânh v√†o v√≤ng l·∫∑p hu·∫•n luy·ªán.</p>
<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/Hm8_PgVTFuc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>V√¨ ch√∫ng ta ch·ªß y·∫øu quan t√¢m ƒë·∫øn t√≠nh nƒÉng t·ª± ƒë·ªông ho√†n th√†nh h·ª£p l√Ω cho c√°c th∆∞ vi·ªán khoa h·ªçc d·ªØ li·ªáu, n√™n vi·ªác ƒë∆∞a ra nhi·ªÅu tr·ªçng s·ªë h∆°n cho c√°c m·∫´u hu·∫•n luy·ªán s·ª≠ d·ª•ng nhi·ªÅu h∆°n c√°c th∆∞ vi·ªán n√†y. Ch√∫ng ta c√≥ th·ªÉ d·ªÖ d√†ng x√°c ƒë·ªãnh nh·ªØng v√≠ d·ª• n√†y th√¥ng qua vi·ªác s·ª≠ d·ª•ng c√°c t·ª´ kh√≥a nh∆∞ <code>plt</code>, <code>pd</code>, <code>sk</code>, <code>fit</code> v√† <code>predict</code>, l√† nh·ªØng t√™n nh·∫≠p th∆∞·ªùng g·∫∑p nh·∫•t cho <code>matplotlib.pyplot</code>, <code>pandas</code>, v√† <code>sklearn</code> c≈©ng nh∆∞ c√°c h√†nh vi sau ƒë√≥. N·∫øu ch√∫ng ƒë∆∞·ª£c bi·ªÉu di·ªÖn d∆∞·ªõi d·∫°ng m·ªôt token duy nh·∫•t, ch√∫ng ta c√≥ th·ªÉ d·ªÖ d√†ng ki·ªÉm tra xem ch√∫ng c√≥ xu·∫•t hi·ªán trong chu·ªói ƒë·∫ßu v√†o hay kh√¥ng. C√°c token c√≥ th·ªÉ c√≥ ti·ªÅn t·ªë kho·∫£ng tr·∫Øng, v√¨ v·∫≠y ch√∫ng ta c≈©ng s·∫Ω ki·ªÉm tra c√°c phi√™n b·∫£n ƒë√≥ trong t·ª´ v·ª±ng b·ªô tokenizer. ƒê·ªÉ x√°c minh r·∫±ng n√≥ ho·∫°t ƒë·ªông, ch√∫ng ta s·∫Ω th√™m m·ªôt token ki·ªÉm th·ª≠ s·∫Ω ƒë∆∞·ª£c chia th√†nh nhi·ªÅu token:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->keytoken_ids = []
<span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> [
    <span class="hljs-string">&quot;plt&quot;</span>,
    <span class="hljs-string">&quot;pd&quot;</span>,
    <span class="hljs-string">&quot;sk&quot;</span>,
    <span class="hljs-string">&quot;fit&quot;</span>,
    <span class="hljs-string">&quot;predict&quot;</span>,
    <span class="hljs-string">&quot; plt&quot;</span>,
    <span class="hljs-string">&quot; pd&quot;</span>,
    <span class="hljs-string">&quot; sk&quot;</span>,
    <span class="hljs-string">&quot; fit&quot;</span>,
    <span class="hljs-string">&quot; predict&quot;</span>,
    <span class="hljs-string">&quot;testtest&quot;</span>,
]:
    ids = tokenizer([keyword]).input_ids[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ids) == <span class="hljs-number">1</span>:
        keytoken_ids.append(ids[<span class="hljs-number">0</span>])
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Keyword has not single token: <span class="hljs-subst">{keyword}</span>&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;Keyword has not single token: testtest&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>Tuy·ªát v·ªùi, ƒëi·ªÅu ƒë√≥ c√≥ v·∫ª ho·∫°t ƒë·ªông t·ªët! B√¢y gi·ªù ch√∫ng ta c√≥ th·ªÉ vi·∫øt m·ªôt h√†m m·∫•t m√°t t√πy ch·ªânh l·∫•y chu·ªói ƒë·∫ßu v√†o, logits v√† token kh√≥a m√† ch√∫ng ta v·ª´a ch·ªçn l√†m ƒë·∫ßu v√†o. Tr∆∞·ªõc ti√™n, ch√∫ng ta c·∫ßn cƒÉn ch·ªânh logits v√† ƒë·∫ßu v√†o: chu·ªói ƒë·∫ßu v√†o ƒë∆∞·ª£c d·ªãch chuy·ªÉn m·ªôt ƒë∆°n v·ªã sang b√™n ph·∫£i t·∫°o th√†nh c√°c nh√£n, v√¨ token ti·∫øp theo l√† nh√£n cho token hi·ªán t·∫°i. Ch√∫ng ta c√≥ th·ªÉ ƒë·∫°t ƒë∆∞·ª£c ƒëi·ªÅu n√†y b·∫±ng c√°ch b·∫Øt ƒë·∫ßu c√°c nh√£n t·ª´ token th·ª© hai c·ªßa chu·ªói ƒë·∫ßu v√†o, v√¨ d√π sao th√¨ m√¥ h√¨nh c≈©ng kh√¥ng ƒë∆∞a ra d·ª± ƒëo√°n cho token ƒë·∫ßu ti√™n. Sau ƒë√≥, ch√∫ng ta c·∫Øt logit cu·ªëi c√πng, v√¨ ch√∫ng ta kh√¥ng c√≥ nh√£n cho token theo tr√¨nh t·ª± ƒë·∫ßu v√†o ƒë·∫ßy ƒë·ªß. Nh·ªù ƒë√≥, ch√∫ng ta c√≥ th·ªÉ t√≠nh to√°n s·ª± m·∫•t m√°t tr√™n m·ªói m·∫´u v√† ƒë·∫øm s·ªë l·∫ßn xu·∫•t hi·ªán c·ªßa t·∫•t c·∫£ c√°c t·ª´ kh√≥a trong m·ªói m·∫´u. Cu·ªëi c√πng, ch√∫ng ta t√≠nh gi√° tr·ªã trung b√¨nh c√≥ tr·ªçng s·ªë tr√™n t·∫•t c·∫£ c√°c m·∫´u b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c l·∫ßn xu·∫•t hi·ªán d∆∞·ªõi d·∫°ng tr·ªçng s·ªë. V√¨ ch√∫ng ta kh√¥ng mu·ªën lo·∫°i b·ªè t·∫•t c·∫£ c√°c m·∫´u kh√¥ng c√≥ t·ª´ kh√≥a, ch√∫ng ta th√™m 1 v√†o c√°c tr·ªçng s·ªë:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> CrossEntropyLoss
<span class="hljs-keyword">import</span> torch


<span class="hljs-keyword">def</span> <span class="hljs-title function_">keytoken_weighted_loss</span>(<span class="hljs-params">inputs, logits, keytoken_ids, alpha=<span class="hljs-number">1.0</span></span>):
    <span class="hljs-comment"># D·ªãch chuy·ªÉn ƒë·ªÉ token &lt; n d·ª± ƒëo√°n n</span>
    shift_labels = inputs[..., <span class="hljs-number">1</span>:].contiguous()
    shift_logits = logits[..., :-<span class="hljs-number">1</span>, :].contiguous()
    <span class="hljs-comment"># T√≠nh ƒë·ªô m·∫•t m√°t t·ª´ng token</span>
    loss_fct = CrossEntropyLoss(reduce=<span class="hljs-literal">False</span>)
    loss = loss_fct(shift_logits.view(-<span class="hljs-number">1</span>, shift_logits.size(-<span class="hljs-number">1</span>)), shift_labels.view(-<span class="hljs-number">1</span>))
    <span class="hljs-comment"># Thay ƒë·ªïi k√≠ch th∆∞·ªõc v√† m·∫•t m√°t trung b√¨nh tr√™n m·ªói m·∫´u</span>
    loss_per_sample = loss.view(shift_logits.size(<span class="hljs-number">0</span>), shift_logits.size(<span class="hljs-number">1</span>)).mean(axis=<span class="hljs-number">1</span>)
    <span class="hljs-comment"># T√≠nh to√°n v√† chia t·ª∑ tr·ªçng</span>
    weights = torch.stack([(inputs == kt).<span class="hljs-built_in">float</span>() <span class="hljs-keyword">for</span> kt <span class="hljs-keyword">in</span> keytoken_ids]).<span class="hljs-built_in">sum</span>(
        axis=[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>]
    )
    weights = alpha * (<span class="hljs-number">1.0</span> + weights)
    <span class="hljs-comment"># T√≠nh gi√° tr·ªã trung b√¨nh c√≥ tr·ªçng s·ªë</span>
    weighted_loss = (loss_per_sample * weights).mean()
    <span class="hljs-keyword">return</span> weighted_loss<!-- HTML_TAG_END --></pre></div>
<p>Tr∆∞·ªõc khi c√≥ th·ªÉ b·∫Øt ƒë·∫ßu hu·∫•n luy·ªán v·ªõi h√†m m·∫•t m√°t m·ªõi tuy·ªát v·ªùi n√†y, ch√∫ng ta c·∫ßn chu·∫©n b·ªã m·ªôt s·ªë th·ª©:</p>
<ul><li>Ch√∫ng ta c·∫ßn b·ªô ghi d·ªØ li·ªáu ƒë·ªÉ t·∫£i d·ªØ li·ªáu theo l√¥.</li>
<li>Ch√∫ng ta c·∫ßn thi·∫øt l·∫≠p c√°c th√¥ng s·ªë ph√¢n r√£ tr·ªçng s·ªë.</li>
<li>Theo th·ªùi gian, ch√∫ng ta mu·ªën ƒë√°nh gi√°, v√¨ v·∫≠y s·∫Ω h·ª£p l√Ω khi bao m√£ ƒë√°nh gi√° trong m·ªôt h√†m.</li></ul>
<p>H√£y b·∫Øt ƒë·∫ßu v·ªõi b·ªô d·ªØ li·ªáu. Ch√∫ng ta ch·ªâ c·∫ßn ƒë·∫∑t ƒë·ªãnh d·∫°ng c·ªßa t·∫≠p d·ªØ li·ªáu th√†nh <code>&quot;torch&quot;</code>, v√† sau ƒë√≥ c√≥ th·ªÉ chuy·ªÉn n√≥ ƒë·∫øn PyTorch <code>DataLoader</code> v·ªõi k√≠ch th∆∞·ªõc l√¥ th√≠ch h·ª£p:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> torch.utils.data.dataloader <span class="hljs-keyword">import</span> DataLoader

tokenized_dataset.set_format(<span class="hljs-string">&quot;torch&quot;</span>)
train_dataloader = DataLoader(tokenized_dataset[<span class="hljs-string">&quot;train&quot;</span>], batch_size=<span class="hljs-number">32</span>, shuffle=<span class="hljs-literal">True</span>)
eval_dataloader = DataLoader(tokenized_dataset[<span class="hljs-string">&quot;valid&quot;</span>], batch_size=<span class="hljs-number">32</span>)<!-- HTML_TAG_END --></pre></div>
<p>Ti·∫øp theo, ch√∫ng ta nh√≥m c√°c tham s·ªë ƒë·ªÉ tr√¨nh t·ªëi ∆∞u h√≥a bi·∫øt nh·ªØng th√¥ng s·ªë n√†o s·∫Ω b·ªã gi·∫£m tr·ªçng s·ªë b·ªï sung. Th√¥ng th∆∞·ªùng, t·∫•t c·∫£ c√°c ƒëi·ªÅu kho·∫£n thi√™n v·ªã v√† tr·ªçng s·ªë LayerNorm ƒë·ªÅu ƒë∆∞·ª£c mi·ªÖn tr·ª´; ƒë√¢y l√† c√°ch ch√∫ng ta c√≥ th·ªÉ l√†m ƒëi·ªÅu n√†y:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->weight_decay = <span class="hljs-number">0.1</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_grouped_params</span>(<span class="hljs-params">model, no_decay=[<span class="hljs-string">&quot;bias&quot;</span>, <span class="hljs-string">&quot;LayerNorm.weight&quot;</span>]</span>):
    params_with_wd, params_without_wd = [], []
    <span class="hljs-keyword">for</span> n, p <span class="hljs-keyword">in</span> model.named_parameters():
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(nd <span class="hljs-keyword">in</span> n <span class="hljs-keyword">for</span> nd <span class="hljs-keyword">in</span> no_decay):
            params_without_wd.append(p)
        <span class="hljs-keyword">else</span>:
            params_with_wd.append(p)
    <span class="hljs-keyword">return</span> [
        {<span class="hljs-string">&quot;params&quot;</span>: params_with_wd, <span class="hljs-string">&quot;weight_decay&quot;</span>: weight_decay},
        {<span class="hljs-string">&quot;params&quot;</span>: params_without_wd, <span class="hljs-string">&quot;weight_decay&quot;</span>: <span class="hljs-number">0.0</span>},
    ]<!-- HTML_TAG_END --></pre></div>
<p>V√¨ ch√∫ng ta mu·ªën ƒë√°nh gi√° m√¥ h√¨nh th∆∞·ªùng xuy√™n tr√™n b·ªô x√°c nh·∫≠n trong qu√° tr√¨nh hu·∫•n luy·ªán, ch√∫ng ta h√£y vi·∫øt m·ªôt h√†m cho ƒëi·ªÅu ƒë√≥. N√≥ ch·ªâ ch·∫°y qua b·ªô d·ªØ li·ªáu ƒë√°nh gi√° v√† t·∫≠p h·ª£p t·∫•t c·∫£ c√°c m·∫•t m√°t qua c√°c quy tr√¨nh:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate</span>():
    model.<span class="hljs-built_in">eval</span>()
    losses = []
    <span class="hljs-keyword">for</span> step, batch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(eval_dataloader):
        <span class="hljs-keyword">with</span> torch.no_grad():
            outputs = model(batch[<span class="hljs-string">&quot;input_ids&quot;</span>], labels=batch[<span class="hljs-string">&quot;input_ids&quot;</span>])

        losses.append(accelerator.gather(outputs.loss))
    loss = torch.mean(torch.cat(losses))
    <span class="hljs-keyword">try</span>:
        perplexity = torch.exp(loss)
    <span class="hljs-keyword">except</span> OverflowError:
        perplexity = <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)
    <span class="hljs-keyword">return</span> loss.item(), perplexity.item()<!-- HTML_TAG_END --></pre></div>
<p>V·ªõi h√†m <code>evaluate()</code>, ch√∫ng ta c√≥ th·ªÉ b√°o c√°o m·∫•t m√°t v√† <a href="/course/chapter7/3">perplexity</a> theo kho·∫£ng th·ªùi gian ƒë·ªÅu ƒë·∫∑n. Ti·∫øp theo, ch√∫ng ta x√°c ƒë·ªãnh l·∫°i m√¥ h√¨nh c·ªßa m√¨nh ƒë·ªÉ ƒë·∫£m b·∫£o ch√∫ng ta hu·∫•n luy·ªán l·∫°i t·ª´ ƒë·∫ßu:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->model = GPT2LMHeadModel(config)<!-- HTML_TAG_END --></pre></div>
<p>Sau ƒë√≥, ch√∫ng ta c√≥ th·ªÉ x√°c ƒë·ªãnh tr√¨nh t·ªëi ∆∞u h√≥a c·ªßa m√¨nh, s·ª≠ d·ª•ng h√†m t·ª´ tr∆∞·ªõc ƒë·ªÉ ph√¢n chia c√°c tham s·ªë cho ph√¢n r√£ tr·ªçng s·ªë:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> AdamW

optimizer = AdamW(get_grouped_params(model), lr=<span class="hljs-number">5e-4</span>)<!-- HTML_TAG_END --></pre></div>
<p>B√¢y gi·ªù, h√£y chu·∫©n b·ªã m√¥ h√¨nh, tr√¨nh t·ªëi ∆∞u h√≥a v√† b·ªô ghi d·ªØ li·ªáu ƒë·ªÉ ch√∫ng ta c√≥ th·ªÉ b·∫Øt ƒë·∫ßu hu·∫•n luy·ªán:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> accelerate <span class="hljs-keyword">import</span> Accelerator

accelerator = Accelerator(fp16=<span class="hljs-literal">True</span>)

model, optimizer, train_dataloader, eval_dataloader = accelerator.prepare(
    model, optimizer, train_dataloader, eval_dataloader
)<!-- HTML_TAG_END --></pre></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>üö® N·∫øu b·∫°n ƒëang hu·∫•n luy·ªán tr√™n TPU, b·∫°n s·∫Ω c·∫ßn chuy·ªÉn t·∫•t c·∫£ m√£ b·∫Øt ƒë·∫ßu t·ª´ √¥ ·ªü tr√™n v√†o m·ªôt h√†m hu·∫•n luy·ªán chuy√™n d·ª•ng. Xem <a href="/course/chapter3">Chapter 3</a> ƒë·ªÉ bi·∫øt th√™m chi ti·∫øt.</p></div>
<p>B√¢y gi·ªù, ch√∫ng ta ƒë√£ g·ª≠i <code>train_dataloader</code> c·ªßa m√¨nh t·ªõi <code>accelerator.prepare()</code>, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªô d√†i c·ªßa n√≥ ƒë·ªÉ t√≠nh s·ªë b∆∞·ªõc hu·∫•n luy·ªán. H√£y nh·ªõ r·∫±ng ch√∫ng ta ph·∫£i lu√¥n l√†m ƒëi·ªÅu n√†y sau khi chu·∫©n b·ªã dataloader, v√¨ ph∆∞∆°ng th·ª©c ƒë√≥ s·∫Ω thay ƒë·ªïi ƒë·ªô d√†i c·ªßa n√≥. Ch√∫ng ta s·ª≠ d·ª•ng m·ªôt l·ªãch tr√¨nh tuy·∫øn t√≠nh c·ªï ƒëi·ªÉn t·ª´ t·ªëc ƒë·ªô h·ªçc ƒë·∫øn 0:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> get_scheduler

num_train_epochs = <span class="hljs-number">1</span>
num_update_steps_per_epoch = <span class="hljs-built_in">len</span>(train_dataloader)
num_training_steps = num_train_epochs * num_update_steps_per_epoch

lr_scheduler = get_scheduler(
    name=<span class="hljs-string">&quot;linear&quot;</span>,
    optimizer=optimizer,
    num_warmup_steps=<span class="hljs-number">1_000</span>,
    num_training_steps=num_training_steps,
)<!-- HTML_TAG_END --></pre></div>
<p>Cu·ªëi c√πng, ƒë·ªÉ ƒë·∫©y m√¥ h√¨nh l√™n Hub, ch√∫ng ta s·∫Ω c·∫ßn t·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng <code>Repository</code> trong m·ªôt th∆∞ m·ª•c ƒëang l√†m vi·ªác. Tr∆∞·ªõc ti√™n, h√£y ƒëƒÉng nh·∫≠p v√†o Hugging Face Hub, n·∫øu b·∫°n ch∆∞a ƒëƒÉng nh·∫≠p. Ch√∫ng ta s·∫Ω x√°c ƒë·ªãnh t√™n kho l∆∞u tr·ªØ t·ª´ ID m√¥ h√¨nh m√† ta mu·ªën cung c·∫•p cho m√¥ h√¨nh c·ªßa m√¨nh (vui l√≤ng thay th·∫ø <code>repo_name</code> b·∫±ng s·ª± l·ª±a ch·ªçn c·ªßa ri√™ng b·∫°n; n√≥ ch·ªâ c·∫ßn ch·ª©a t√™n ng∆∞·ªùi d√πng c·ªßa b·∫°n, ƒë√≥ l√† nh·ªØng g√¨ h√†m <code>get_full_repo_name()</code> th·ª±c hi·ªán ):</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> Repository, get_full_repo_name

model_name = <span class="hljs-string">&quot;codeparrot-ds-accelerate&quot;</span>
repo_name = get_full_repo_name(model_name)
repo_name<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;sgugger/codeparrot-ds-accelerate&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>Sau ƒë√≥, ch√∫ng ta c√≥ th·ªÉ sao ch√©p kho l∆∞u tr·ªØ ƒë√≥ trong m·ªôt th∆∞ m·ª•c c·ª•c b·ªô. N·∫øu n√≥ ƒë√£ t·ªìn t·∫°i, th∆∞ m·ª•c c·ª•c b·ªô n√†y ph·∫£i l√† b·∫£n sao hi·ªán c√≥ c·ªßa kho l∆∞u tr·ªØ m√† ch√∫ng ta ƒëang l√†m vi·ªác:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->output_dir = <span class="hljs-string">&quot;codeparrot-ds-accelerate&quot;</span>
repo = Repository(output_dir, clone_from=repo_name)<!-- HTML_TAG_END --></pre></div>
<p>B√¢y gi·ªù ch√∫ng ta c√≥ th·ªÉ t·∫£i l√™n b·∫•t c·ª© th·ª© g√¨ ch√∫ng ta l∆∞u trong <code>output_dir</code> b·∫±ng c√°ch g·ªçi ph∆∞∆°ng th·ª©c <code>repo.push_to_hub()</code>. ƒêi·ªÅu n√†y s·∫Ω gi√∫p ch√∫ng ta t·∫£i l√™n c√°c m√¥ h√¨nh trung gian ·ªü cu·ªëi m·ªói epoch.</p>
<p>Tr∆∞·ªõc khi hu·∫•n luy·ªán, h√£y ch·∫°y th·ª≠ nhanh ƒë·ªÉ xem ch·ª©c nƒÉng ƒë√°nh gi√° c√≥ ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng kh√¥ng:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->evaluate()<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->(<span class="hljs-number">10.934126853942871</span>, <span class="hljs-number">56057.14453125</span>)<!-- HTML_TAG_END --></pre></div>
<p>ƒê√≥ l√† nh·ªØng gi√° tr·ªã r·∫•t cao v·ªÅ m·ª©c m·∫•t m√°t v√† perplexity, nh∆∞ng ƒëi·ªÅu ƒë√≥ kh√¥ng ƒë√°ng ng·∫°c nhi√™n v√¨ ch√∫ng ta ch∆∞a hu·∫•n luy·ªán m√¥ h√¨nh. C√πng v·ªõi ƒë√≥, ch√∫ng ta ƒë√£ chu·∫©n b·ªã m·ªçi th·ª© ƒë·ªÉ vi·∫øt ph·∫ßn c·ªët l√µi c·ªßa k·ªãch b·∫£n hu·∫•n luy·ªán: v√≤ng l·∫∑p hu·∫•n luy·ªán. Trong v√≤ng l·∫∑p hu·∫•n luy·ªán, ch√∫ng ta l·∫∑p qua dataloader v√† truy·ªÅn c√°c l√¥ v√†o m√¥ h√¨nh. V·ªõi nh·∫≠t k√Ω, sau ƒë√≥ ch√∫ng ta c√≥ th·ªÉ ƒë√°nh gi√° h√†m m·∫•t m√°t t√πy ch·ªânh c·ªßa m√¨nh. Ch√∫ng ta chia t·ª∑ l·ªá m·∫•t m√°t theo s·ªë b∆∞·ªõc t√≠ch l≈©y gradient ƒë·ªÉ kh√¥ng t·∫°o ra m·∫•t m√°t l·ªõn h∆°n khi t·ªïng h·ª£p nhi·ªÅu b∆∞·ªõc h∆°n. Tr∆∞·ªõc khi t·ªëi ∆∞u h√≥a, ch√∫ng ta c≈©ng c·∫Øt c√°c gradient ƒë·ªÉ h·ªôi t·ª• t·ªët h∆°n. Cu·ªëi c√πng, c·ª© sau v√†i b∆∞·ªõc, ch√∫ng ta ƒë√°nh gi√° m√¥ h√¨nh tr√™n t·∫≠p h·ª£p ƒë√°nh gi√° v·ªõi h√†m <code>eval()</code> m·ªõi c·ªßa m√¨nh:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> tqdm.notebook <span class="hljs-keyword">import</span> tqdm

gradient_accumulation_steps = <span class="hljs-number">8</span>
eval_steps = <span class="hljs-number">5_000</span>

model.train()
completed_steps = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_train_epochs):
    <span class="hljs-keyword">for</span> step, batch <span class="hljs-keyword">in</span> tqdm(
        <span class="hljs-built_in">enumerate</span>(train_dataloader, start=<span class="hljs-number">1</span>), total=num_training_steps
    ):
        logits = model(batch[<span class="hljs-string">&quot;input_ids&quot;</span>]).logits
        loss = keytoken_weighted_loss(batch[<span class="hljs-string">&quot;input_ids&quot;</span>], logits, keytoken_ids)
        <span class="hljs-keyword">if</span> step % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>:
            accelerator.<span class="hljs-built_in">print</span>(
                {
                    <span class="hljs-string">&quot;lr&quot;</span>: get_lr(),
                    <span class="hljs-string">&quot;samples&quot;</span>: step * samples_per_step,
                    <span class="hljs-string">&quot;steps&quot;</span>: completed_steps,
                    <span class="hljs-string">&quot;loss/train&quot;</span>: loss.item() * gradient_accumulation_steps,
                }
            )
        loss = loss / gradient_accumulation_steps
        accelerator.backward(loss)
        <span class="hljs-keyword">if</span> step % gradient_accumulation_steps == <span class="hljs-number">0</span>:
            accelerator.clip_grad_norm_(model.parameters(), <span class="hljs-number">1.0</span>)
            optimizer.step()
            lr_scheduler.step()
            optimizer.zero_grad()
            completed_steps += <span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> (step % (eval_steps * gradient_accumulation_steps)) == <span class="hljs-number">0</span>:
            eval_loss, perplexity = evaluate()
            accelerator.<span class="hljs-built_in">print</span>({<span class="hljs-string">&quot;loss/eval&quot;</span>: eval_loss, <span class="hljs-string">&quot;perplexity&quot;</span>: perplexity})
            model.train()
            accelerator.wait_for_everyone()
            unwrapped_model = accelerator.unwrap_model(model)
            unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)
            <span class="hljs-keyword">if</span> accelerator.is_main_process:
                tokenizer.save_pretrained(output_dir)
                repo.push_to_hub(
                    commit_message=<span class="hljs-string">f&quot;Training in progress step <span class="hljs-subst">{step}</span>&quot;</span>, blocking=<span class="hljs-literal">False</span>
                )<!-- HTML_TAG_END --></pre></div>
<p>V·∫≠y l√† xong - b√¢y gi·ªù b·∫°n c√≥ v√≤ng hu·∫•n luy·ªán t√πy ch·ªânh c·ªßa ri√™ng m√¨nh cho c√°c m√¥ h√¨nh ng√¥n ng·ªØ nh√¢n qu·∫£ ch·∫≥ng h·∫°n nh∆∞ GPT-2 m√† b·∫°n c√≥ th·ªÉ t√πy ch·ªânh th√™m theo nhu c·∫ßu c·ªßa m√¨nh.</p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>‚úèÔ∏è <strong>Th·ª≠ nghi·ªám th√¥i!</strong> Ho·∫∑c t·∫°o h√†m m·∫•t t√πy ch·ªânh c·ªßa ri√™ng b·∫°n ph√π h·ª£p v·ªõi tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng c·ªßa b·∫°n ho·∫∑c th√™m m·ªôt b∆∞·ªõc t√πy ch·ªânh kh√°c v√†o v√≤ng l·∫∑p hu·∫•n luy·ªán.</p></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>‚úèÔ∏è <strong>Th·ª≠ nghi·ªám th√¥i!</strong> Khi ch·∫°y c√°c th·ª≠ nghi·ªám hu·∫•n luy·ªán d√†i, b·∫°n n√™n ghi l·∫°i c√°c ch·ªâ s·ªë quan tr·ªçng b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c c√¥ng c·ª• nh∆∞ TensorBoard ho·∫∑c Weights &amp; Biases. Th√™m ghi nh·∫≠t k√Ω th√≠ch h·ª£p v√†o v√≤ng l·∫∑p hu·∫•n luy·ªán ƒë·ªÉ b·∫°n lu√¥n c√≥ th·ªÉ ki·ªÉm tra qu√° tr√¨nh hu·∫•n luy·ªán di·ªÖn ra nh∆∞ th·∫ø n√†o.</p></div>


		<script type="module" data-hydrate="3jt6j6">
		import { start } from "/docs/course/main/vi/_app/start-hf-doc-builder.js";
		start({
			target: document.querySelector('[data-hydrate="3jt6j6"]').parentNode,
			paths: {"base":"/docs/course/main/vi","assets":"/docs/course/main/vi"},
			session: {},
			route: false,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/docs/course/main/vi/_app/pages/__layout.svelte-hf-doc-builder.js"),
						import("/docs/course/main/vi/_app/pages/chapter7/6.mdx-hf-doc-builder.js")
				],
				params: {}
			}
		});
	</script>
