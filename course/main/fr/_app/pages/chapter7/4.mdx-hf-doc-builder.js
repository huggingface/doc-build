import{S as dh,i as ch,s as mh,e as r,t as a,k as d,c as l,a as o,h as n,d as t,m as c,b as _,g as i,G as s,w as E,x as j,y as k,q as b,o as $,B as w,M as fh,N as Ho,p as Nr,v as hh,n as Mr,L as oh}from"../../chunks/vendor-hf-doc-builder.js";import{T as Cn}from"../../chunks/Tip-hf-doc-builder.js";import{Y as xu}from"../../chunks/Youtube-hf-doc-builder.js";import{I as Ft}from"../../chunks/IconCopyLink-hf-doc-builder.js";import{C as H}from"../../chunks/CodeBlock-hf-doc-builder.js";import{C as ph}from"../../chunks/CourseFloatingBanner-hf-doc-builder.js";import{F as _h}from"../../chunks/FrameworkSwitchCourse-hf-doc-builder.js";function vh(ee){let u,q;return u=new ph({props:{chapter:7,classNames:"absolute z-10 right-0 top-0",notebooks:[{label:"Google Colab",value:"https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/fr/chapter7/section4_tf.ipynb"},{label:"Aws Studio",value:"https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/fr/chapter7/section4_tf.ipynb"}]}}),{c(){E(u.$$.fragment)},l(h){j(u.$$.fragment,h)},m(h,x){k(u,h,x),q=!0},i(h){q||(b(u.$$.fragment,h),q=!0)},o(h){$(u.$$.fragment,h),q=!1},d(h){w(u,h)}}}function bh(ee){let u,q;return u=new ph({props:{chapter:7,classNames:"absolute z-10 right-0 top-0",notebooks:[{label:"Google Colab",value:"https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/fr/chapter7/section4_pt.ipynb"},{label:"Aws Studio",value:"https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/fr/chapter7/section4_pt.ipynb"}]}}),{c(){E(u.$$.fragment)},l(h){j(u.$$.fragment,h)},m(h,x){k(u,h,x),q=!0},i(h){q||(b(u.$$.fragment,h),q=!0)},o(h){$(u.$$.fragment,h),q=!1},d(h){w(u,h)}}}function $h(ee){let u,q,h,x,A,v,D,S;return{c(){u=r("p"),q=a("\u270F\uFE0F "),h=r("strong"),x=a("A votre tour !"),A=a(" Un autre mot anglais souvent utilis\xE9 en fran\xE7ais est \xAB "),v=r("em"),D=a("email"),S=a(" \xBB. Trouvez le premier \xE9chantillon dans l\u2019\xE9chantillon d\u2019entra\xEEnement qui utilise ce mot. Comment est-il traduit ? Comment le mod\xE8le pr\xE9-entra\xEEn\xE9 traduit-il cette m\xEAme phrase ?")},l(z){u=l(z,"P",{});var P=o(u);q=n(P,"\u270F\uFE0F "),h=l(P,"STRONG",{});var I=o(h);x=n(I,"A votre tour !"),I.forEach(t),A=n(P," Un autre mot anglais souvent utilis\xE9 en fran\xE7ais est \xAB "),v=l(P,"EM",{});var C=o(v);D=n(C,"email"),C.forEach(t),S=n(P," \xBB. Trouvez le premier \xE9chantillon dans l\u2019\xE9chantillon d\u2019entra\xEEnement qui utilise ce mot. Comment est-il traduit ? Comment le mod\xE8le pr\xE9-entra\xEEn\xE9 traduit-il cette m\xEAme phrase ?"),P.forEach(t)},m(z,P){i(z,u,P),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S)},d(z){z&&t(u)}}}function gh(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K;return{c(){u=r("p"),q=a("\u{1F4A1} Si vous utilisez un "),h=r("em"),x=a("tokenizer"),A=a(" multilingue tel que mBART, mBART-50 ou M2M100, vous devrez d\xE9finir les codes de langue de vos entr\xE9es et cibles dans le "),v=r("em"),D=a("tokenizer"),S=a(" en d\xE9finissant "),z=r("code"),P=a("tokenizer.src_lang"),I=a(" et "),C=r("code"),y=a("tokenizer.tgt_lang"),K=a(" aux bonnes valeurs.")},l(U){u=l(U,"P",{});var O=o(u);q=n(O,"\u{1F4A1} Si vous utilisez un "),h=l(O,"EM",{});var Z=o(h);x=n(Z,"tokenizer"),Z.forEach(t),A=n(O," multilingue tel que mBART, mBART-50 ou M2M100, vous devrez d\xE9finir les codes de langue de vos entr\xE9es et cibles dans le "),v=l(O,"EM",{});var L=o(v);D=n(L,"tokenizer"),L.forEach(t),S=n(O," en d\xE9finissant "),z=l(O,"CODE",{});var G=o(z);P=n(G,"tokenizer.src_lang"),G.forEach(t),I=n(O," et "),C=l(O,"CODE",{});var J=o(C);y=n(J,"tokenizer.tgt_lang"),J.forEach(t),K=n(O," aux bonnes valeurs."),O.forEach(t)},m(U,O){i(U,u,O),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S),s(u,z),s(z,P),s(u,I),s(u,C),s(C,y),s(u,K)},d(U){U&&t(u)}}}function qh(ee){let u,q,h,x,A,v,D,S,z,P,I;return{c(){u=r("p"),q=a("\u{1F4A1} Si vous utilisez un mod\xE8le T5 (plus pr\xE9cis\xE9ment, un des "),h=r("em"),x=a("checkpoints"),A=d(),v=r("code"),D=a("t5-xxx"),S=a("), le mod\xE8le s\u2019attendra \xE0 ce que les entr\xE9es aient un pr\xE9fixe indiquant la t\xE2che \xE0 accomplir, comme "),z=r("code"),P=a("translate: English to French:"),I=a(".")},l(C){u=l(C,"P",{});var y=o(u);q=n(y,"\u{1F4A1} Si vous utilisez un mod\xE8le T5 (plus pr\xE9cis\xE9ment, un des "),h=l(y,"EM",{});var K=o(h);x=n(K,"checkpoints"),K.forEach(t),A=c(y),v=l(y,"CODE",{});var U=o(v);D=n(U,"t5-xxx"),U.forEach(t),S=n(y,"), le mod\xE8le s\u2019attendra \xE0 ce que les entr\xE9es aient un pr\xE9fixe indiquant la t\xE2che \xE0 accomplir, comme "),z=l(y,"CODE",{});var O=o(z);P=n(O,"translate: English to French:"),O.forEach(t),I=n(y,"."),y.forEach(t)},m(C,y){i(C,u,y),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S),s(u,z),s(z,P),s(u,I)},d(C){C&&t(u)}}}function Eh(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se,T,F,Q;return{c(){u=r("p"),q=a("\u26A0\uFE0F Nous ne faisons pas attention au masque d\u2019attention des cibles car le mod\xE8le ne s\u2019y attend pas. Au lieu de cela, les \xE9tiquettes correspondant \xE0 un "),h=r("em"),x=a("token"),A=a(" de "),v=r("em"),D=a("padding"),S=a(" doivent \xEAtre mises \xE0 "),z=r("code"),P=a("-100"),I=a(" afin qu\u2019elles soient ignor\xE9es dans le calcul de la perte. Cela sera fait par notre assembleur de donn\xE9es plus tard puisque nous appliquons le "),C=r("em"),y=a("padding"),K=a(" dynamique, mais si vous utilisez le "),U=r("em"),O=a("padding"),Z=a(" ici, vous devriez adapter la fonction de pr\xE9traitement pour mettre toutes les \xE9tiquettes qui correspondent au "),L=r("em"),G=a("token"),J=a(" de "),B=r("em"),N=a("padding"),se=a(" \xE0 "),T=r("code"),F=a("-100"),Q=a(".")},l(W){u=l(W,"P",{});var M=o(u);q=n(M,"\u26A0\uFE0F Nous ne faisons pas attention au masque d\u2019attention des cibles car le mod\xE8le ne s\u2019y attend pas. Au lieu de cela, les \xE9tiquettes correspondant \xE0 un "),h=l(M,"EM",{});var re=o(h);x=n(re,"token"),re.forEach(t),A=n(M," de "),v=l(M,"EM",{});var ae=o(v);D=n(ae,"padding"),ae.forEach(t),S=n(M," doivent \xEAtre mises \xE0 "),z=l(M,"CODE",{});var te=o(z);P=n(te,"-100"),te.forEach(t),I=n(M," afin qu\u2019elles soient ignor\xE9es dans le calcul de la perte. Cela sera fait par notre assembleur de donn\xE9es plus tard puisque nous appliquons le "),C=l(M,"EM",{});var de=o(C);y=n(de,"padding"),de.forEach(t),K=n(M," dynamique, mais si vous utilisez le "),U=l(M,"EM",{});var ne=o(U);O=n(ne,"padding"),ne.forEach(t),Z=n(M," ici, vous devriez adapter la fonction de pr\xE9traitement pour mettre toutes les \xE9tiquettes qui correspondent au "),L=l(M,"EM",{});var pe=o(L);G=n(pe,"token"),pe.forEach(t),J=n(M," de "),B=l(M,"EM",{});var ue=o(B);N=n(ue,"padding"),ue.forEach(t),se=n(M," \xE0 "),T=l(M,"CODE",{});var ve=o(T);F=n(ve,"-100"),ve.forEach(t),Q=n(M,"."),M.forEach(t)},m(W,M){i(W,u,M),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S),s(u,z),s(z,P),s(u,I),s(u,C),s(C,y),s(u,K),s(u,U),s(U,O),s(u,Z),s(u,L),s(L,G),s(u,J),s(u,B),s(B,N),s(u,se),s(u,T),s(T,F),s(u,Q)},d(W){W&&t(u)}}}function jh(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se;return x=new Ft({}),J=new H({props:{code:`from transformers import TFAutoModelForSeq2SeqLM

model = TFAutoModelForSeq2SeqLM.from_pretrained(model_checkpoint, from_pt=True)`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> TFAutoModelForSeq2SeqLM

model = TFAutoModelForSeq2SeqLM.from_pretrained(model_checkpoint, from_pt=<span class="hljs-literal">True</span>)`}}),N=new Cn({props:{warning:!1,$$slots:{default:[wh]},$$scope:{ctx:ee}}}),{c(){u=r("h2"),q=r("a"),h=r("span"),E(x.$$.fragment),A=d(),v=r("span"),D=r("i"),S=a("Finetuner"),z=a(" du mod\xE8le avec Keras"),P=d(),I=r("p"),C=a("Tout d\u2019abord, nous avons besoin d\u2019un mod\xE8le \xE0 "),y=r("em"),K=a("finetuner"),U=a(". Nous allons utiliser l\u2019API habituelle "),O=r("code"),Z=a("AutoModel"),L=a(" :"),G=d(),E(J.$$.fragment),B=d(),E(N.$$.fragment),this.h()},l(T){u=l(T,"H2",{class:!0});var F=o(u);q=l(F,"A",{id:!0,class:!0,href:!0});var Q=o(q);h=l(Q,"SPAN",{});var W=o(h);j(x.$$.fragment,W),W.forEach(t),Q.forEach(t),A=c(F),v=l(F,"SPAN",{});var M=o(v);D=l(M,"I",{});var re=o(D);S=n(re,"Finetuner"),re.forEach(t),z=n(M," du mod\xE8le avec Keras"),M.forEach(t),F.forEach(t),P=c(T),I=l(T,"P",{});var ae=o(I);C=n(ae,"Tout d\u2019abord, nous avons besoin d\u2019un mod\xE8le \xE0 "),y=l(ae,"EM",{});var te=o(y);K=n(te,"finetuner"),te.forEach(t),U=n(ae,". Nous allons utiliser l\u2019API habituelle "),O=l(ae,"CODE",{});var de=o(O);Z=n(de,"AutoModel"),de.forEach(t),L=n(ae," :"),ae.forEach(t),G=c(T),j(J.$$.fragment,T),B=c(T),j(N.$$.fragment,T),this.h()},h(){_(q,"id","ifinetuneri-du-modle-avec-keras"),_(q,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(q,"href","#ifinetuneri-du-modle-avec-keras"),_(u,"class","relative group")},m(T,F){i(T,u,F),s(u,q),s(q,h),k(x,h,null),s(u,A),s(u,v),s(v,D),s(D,S),s(v,z),i(T,P,F),i(T,I,F),s(I,C),s(I,y),s(y,K),s(I,U),s(I,O),s(O,Z),s(I,L),i(T,G,F),k(J,T,F),i(T,B,F),k(N,T,F),se=!0},i(T){se||(b(x.$$.fragment,T),b(J.$$.fragment,T),b(N.$$.fragment,T),se=!0)},o(T){$(x.$$.fragment,T),$(J.$$.fragment,T),$(N.$$.fragment,T),se=!1},d(T){T&&t(u),w(x),T&&t(P),T&&t(I),T&&t(G),w(J,T),T&&t(B),w(N,T)}}}function kh(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se,T,F,Q,W,M,re,ae,te,de,ne,pe,ue,ve,be,$e,he;return x=new Ft({}),$e=new H({props:{code:`from transformers import AutoModelForSeq2SeqLM

model = AutoModelForSeq2SeqLM.from_pretrained(model_checkpoint)`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSeq2SeqLM

model = AutoModelForSeq2SeqLM.from_pretrained(model_checkpoint)`}}),{c(){u=r("h2"),q=r("a"),h=r("span"),E(x.$$.fragment),A=d(),v=r("span"),D=r("i"),S=a("Finetuner"),z=a(" le mod\xE8le avec l'API "),P=r("code"),I=a("Trainer"),C=d(),y=r("p"),K=a("Le code actuel utilisant "),U=r("code"),O=a("Trainer"),Z=a(" sera le m\xEAme que pr\xE9c\xE9demment, avec juste un petit changement : nous utilisons ici "),L=r("a"),G=r("code"),J=a("Seq2SeqTrainer"),B=a(" qui est une sous-classe de "),N=r("code"),se=a("Trainer"),T=a(" qui nous permet de traiter correctement l\u2019\xE9valuation, en utilisant la m\xE9thode "),F=r("code"),Q=a("generate()"),W=a(" pour pr\xE9dire les sorties \xE0 partir des entr\xE9es. Nous y reviendrons plus en d\xE9tail lorsque nous parlerons du calcul de la m\xE9trique."),M=d(),re=r("p"),ae=a("Tout d\u2019abord, nous avons besoin d\u2019un mod\xE8le \xE0 "),te=r("em"),de=a("finetuner"),ne=a(". Nous allons utiliser l\u2019API habituelle "),pe=r("code"),ue=a("AutoModel"),ve=a(" :"),be=d(),E($e.$$.fragment),this.h()},l(Y){u=l(Y,"H2",{class:!0});var ce=o(u);q=l(ce,"A",{id:!0,class:!0,href:!0});var me=o(q);h=l(me,"SPAN",{});var V=o(h);j(x.$$.fragment,V),V.forEach(t),me.forEach(t),A=c(ce),v=l(ce,"SPAN",{});var Ae=o(v);D=l(Ae,"I",{});var ge=o(D);S=n(ge,"Finetuner"),ge.forEach(t),z=n(Ae," le mod\xE8le avec l'API "),P=l(Ae,"CODE",{});var Qe=o(P);I=n(Qe,"Trainer"),Qe.forEach(t),Ae.forEach(t),ce.forEach(t),C=c(Y),y=l(Y,"P",{});var Ee=o(y);K=n(Ee,"Le code actuel utilisant "),U=l(Ee,"CODE",{});var fe=o(U);O=n(fe,"Trainer"),fe.forEach(t),Z=n(Ee," sera le m\xEAme que pr\xE9c\xE9demment, avec juste un petit changement : nous utilisons ici "),L=l(Ee,"A",{href:!0,rel:!0});var Le=o(L);G=l(Le,"CODE",{});var le=o(G);J=n(le,"Seq2SeqTrainer"),le.forEach(t),Le.forEach(t),B=n(Ee," qui est une sous-classe de "),N=l(Ee,"CODE",{});var Oe=o(N);se=n(Oe,"Trainer"),Oe.forEach(t),T=n(Ee," qui nous permet de traiter correctement l\u2019\xE9valuation, en utilisant la m\xE9thode "),F=l(Ee,"CODE",{});var oe=o(F);Q=n(oe,"generate()"),oe.forEach(t),W=n(Ee," pour pr\xE9dire les sorties \xE0 partir des entr\xE9es. Nous y reviendrons plus en d\xE9tail lorsque nous parlerons du calcul de la m\xE9trique."),Ee.forEach(t),M=c(Y),re=l(Y,"P",{});var ze=o(re);ae=n(ze,"Tout d\u2019abord, nous avons besoin d\u2019un mod\xE8le \xE0 "),te=l(ze,"EM",{});var ye=o(te);de=n(ye,"finetuner"),ye.forEach(t),ne=n(ze,". Nous allons utiliser l\u2019API habituelle "),pe=l(ze,"CODE",{});var De=o(pe);ue=n(De,"AutoModel"),De.forEach(t),ve=n(ze," :"),ze.forEach(t),be=c(Y),j($e.$$.fragment,Y),this.h()},h(){_(q,"id","ifinetuneri-le-modle-avec-lapi-trainer"),_(q,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(q,"href","#ifinetuneri-le-modle-avec-lapi-trainer"),_(u,"class","relative group"),_(L,"href","https://huggingface.co/transformers/main_classes/trainer.html#seq2seqtrainer"),_(L,"rel","nofollow")},m(Y,ce){i(Y,u,ce),s(u,q),s(q,h),k(x,h,null),s(u,A),s(u,v),s(v,D),s(D,S),s(v,z),s(v,P),s(P,I),i(Y,C,ce),i(Y,y,ce),s(y,K),s(y,U),s(U,O),s(y,Z),s(y,L),s(L,G),s(G,J),s(y,B),s(y,N),s(N,se),s(y,T),s(y,F),s(F,Q),s(y,W),i(Y,M,ce),i(Y,re,ce),s(re,ae),s(re,te),s(te,de),s(re,ne),s(re,pe),s(pe,ue),s(re,ve),i(Y,be,ce),k($e,Y,ce),he=!0},i(Y){he||(b(x.$$.fragment,Y),b($e.$$.fragment,Y),he=!0)},o(Y){$(x.$$.fragment,Y),$($e.$$.fragment,Y),he=!1},d(Y){Y&&t(u),w(x),Y&&t(C),Y&&t(y),Y&&t(M),Y&&t(re),Y&&t(be),w($e,Y)}}}function wh(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se;return{c(){u=r("p"),q=a("\u{1F4A1} Le "),h=r("em"),x=a("checkpoint"),A=d(),v=r("code"),D=a("Helsinki-NLP/opus-mt-en-fr"),S=a(" ne dispose que de poids PyTorch, vous aurez donc une erreur si vous essayez de charger le mod\xE8le sans utiliser l\u2019argument "),z=r("code"),P=a("from_pt=True"),I=a(" dans la m\xE9thode "),C=r("code"),y=a("from_pretrained()"),K=a(". Lorsque vous sp\xE9cifiez "),U=r("code"),O=a("from_pt=True"),Z=a(", la biblioth\xE8que t\xE9l\xE9chargera et convertira automatiquement les poids PyTorch pour vous. Comme vous pouvez le constater, c\u2019est tr\xE8s simple de passer d\u2019un "),L=r("em"),G=a("framework"),J=a(" \xE0 l\u2019autre dans \u{1F917} "),B=r("em"),N=a("Transformers"),se=a(" !")},l(T){u=l(T,"P",{});var F=o(u);q=n(F,"\u{1F4A1} Le "),h=l(F,"EM",{});var Q=o(h);x=n(Q,"checkpoint"),Q.forEach(t),A=c(F),v=l(F,"CODE",{});var W=o(v);D=n(W,"Helsinki-NLP/opus-mt-en-fr"),W.forEach(t),S=n(F," ne dispose que de poids PyTorch, vous aurez donc une erreur si vous essayez de charger le mod\xE8le sans utiliser l\u2019argument "),z=l(F,"CODE",{});var M=o(z);P=n(M,"from_pt=True"),M.forEach(t),I=n(F," dans la m\xE9thode "),C=l(F,"CODE",{});var re=o(C);y=n(re,"from_pretrained()"),re.forEach(t),K=n(F,". Lorsque vous sp\xE9cifiez "),U=l(F,"CODE",{});var ae=o(U);O=n(ae,"from_pt=True"),ae.forEach(t),Z=n(F,", la biblioth\xE8que t\xE9l\xE9chargera et convertira automatiquement les poids PyTorch pour vous. Comme vous pouvez le constater, c\u2019est tr\xE8s simple de passer d\u2019un "),L=l(F,"EM",{});var te=o(L);G=n(te,"framework"),te.forEach(t),J=n(F," \xE0 l\u2019autre dans \u{1F917} "),B=l(F,"EM",{});var de=o(B);N=n(de,"Transformers"),de.forEach(t),se=n(F," !"),F.forEach(t)},m(T,F){i(T,u,F),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S),s(u,z),s(z,P),s(u,I),s(u,C),s(C,y),s(u,K),s(u,U),s(U,O),s(u,Z),s(u,L),s(L,G),s(u,J),s(u,B),s(B,N),s(u,se)},d(T){T&&t(u)}}}function xh(ee){let u,q;return u=new H({props:{code:`from transformers import DataCollatorForSeq2Seq

data_collator = DataCollatorForSeq2Seq(tokenizer, model=model, return_tensors="tf")`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> DataCollatorForSeq2Seq

data_collator = DataCollatorForSeq2Seq(tokenizer, model=model, return_tensors=<span class="hljs-string">&quot;tf&quot;</span>)`}}),{c(){E(u.$$.fragment)},l(h){j(u.$$.fragment,h)},m(h,x){k(u,h,x),q=!0},i(h){q||(b(u.$$.fragment,h),q=!0)},o(h){$(u.$$.fragment,h),q=!1},d(h){w(u,h)}}}function zh(ee){let u,q;return u=new H({props:{code:`from transformers import DataCollatorForSeq2Seq

data_collator = DataCollatorForSeq2Seq(tokenizer, model=model)`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> DataCollatorForSeq2Seq

data_collator = DataCollatorForSeq2Seq(tokenizer, model=model)`}}),{c(){E(u.$$.fragment)},l(h){j(u.$$.fragment,h)},m(h,x){k(u,h,x),q=!0},i(h){q||(b(u.$$.fragment,h),q=!0)},o(h){$(u.$$.fragment,h),q=!1},d(h){w(u,h)}}}function yh(ee){let u,q,h,x,A,v,D,S,z,P,I;return P=new H({props:{code:`model.prepare_tf_dataset(
    tokenized_datasets["train"],
    collate_fn=data_collator,
    shuffle=True,
    batch_size=32,
)
tf_eval_dataset = model.prepare_tf_dataset(
    tokenized_datasets["validation"],
    collate_fn=data_collator,
    shuffle=False,
    batch_size=16,
)`,highlighted:`model.prepare_tf_dataset(
    tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>],
    collate_fn=data_collator,
    shuffle=<span class="hljs-literal">True</span>,
    batch_size=<span class="hljs-number">32</span>,
)
tf_eval_dataset = model.prepare_tf_dataset(
    tokenized_datasets[<span class="hljs-string">&quot;validation&quot;</span>],
    collate_fn=data_collator,
    shuffle=<span class="hljs-literal">False</span>,
    batch_size=<span class="hljs-number">16</span>,
)`}}),{c(){u=r("p"),q=a("Nous pouvons maintenant utiliser ce "),h=r("code"),x=a("data_collator"),A=a(" pour convertir chacun de nos jeux de donn\xE9es en un "),v=r("code"),D=a("tf.data.Dataset"),S=a(", pr\xEAt pour l\u2019entra\xEEnement :"),z=d(),E(P.$$.fragment)},l(C){u=l(C,"P",{});var y=o(u);q=n(y,"Nous pouvons maintenant utiliser ce "),h=l(y,"CODE",{});var K=o(h);x=n(K,"data_collator"),K.forEach(t),A=n(y," pour convertir chacun de nos jeux de donn\xE9es en un "),v=l(y,"CODE",{});var U=o(v);D=n(U,"tf.data.Dataset"),U.forEach(t),S=n(y,", pr\xEAt pour l\u2019entra\xEEnement :"),y.forEach(t),z=c(C),j(P.$$.fragment,C)},m(C,y){i(C,u,y),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S),i(C,z,y),k(P,C,y),I=!0},i(C){I||(b(P.$$.fragment,C),I=!0)},o(C){$(P.$$.fragment,C),I=!1},d(C){C&&t(u),C&&t(z),w(P,C)}}}function Ph(ee){let u,q,h,x,A,v,D,S;return{c(){u=r("p"),q=a("Nous allons transmettre ce "),h=r("code"),x=a("data_collator"),A=a(" au "),v=r("code"),D=a("Seq2SeqTrainer"),S=a(". Ensuite, jetons un coup d\u2019oeil \xE0 la m\xE9trique.")},l(z){u=l(z,"P",{});var P=o(u);q=n(P,"Nous allons transmettre ce "),h=l(P,"CODE",{});var I=o(h);x=n(I,"data_collator"),I.forEach(t),A=n(P," au "),v=l(P,"CODE",{});var C=o(v);D=n(C,"Seq2SeqTrainer"),C.forEach(t),S=n(P,". Ensuite, jetons un coup d\u2019oeil \xE0 la m\xE9trique."),P.forEach(t)},m(z,P){i(z,u,P),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S)},i:oh,o:oh,d(z){z&&t(u)}}}function ih(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se,T,F,Q,W,M,re,ae,te,de,ne,pe,ue,ve,be,$e,he,Y,ce;return{c(){u=r("p"),q=a("La fonctionnalit\xE9 que "),h=r("code"),x=a("Seq2SeqTrainer"),A=a(" ajoute \xE0 sa superclasse "),v=r("code"),D=a("Trainer"),S=a(" est la possibilit\xE9 d\u2019utiliser la m\xE9thode "),z=r("code"),P=a("generate()"),I=a(" pendant l\u2019\xE9valuation ou la pr\xE9diction. Pendant l\u2019entra\xEEnement, le mod\xE8le utilisera les "),C=r("code"),y=a("decoder_input_ids"),K=a(" avec un masque d\u2019attention assurant qu\u2019il n\u2019utilise pas les "),U=r("em"),O=a("tokens"),Z=a(" apr\xE8s le "),L=r("em"),G=a("token"),J=a(" qu\u2019il essaie de pr\xE9dire, pour acc\xE9l\xE9rer l\u2019entra\xEEnement. Pendant l\u2019inf\xE9rence, nous ne pourrons pas les utiliser puisque nous n\u2019aurons pas d\u2019\xE9tiquettes. Ainsi c\u2019est une bonne id\xE9e d\u2019\xE9valuer notre mod\xE8le avec la m\xEAme configuration."),B=d(),N=r("p"),se=a("Comme nous l\u2019avons vu dans le "),T=r("a"),F=a("chapitre 1"),Q=a(", le d\xE9codeur effectue l\u2019inf\xE9rence en pr\xE9disant les "),W=r("em"),M=a("tokens"),re=a(" un par un. C\u2019est quelque chose qui est impl\xE9ment\xE9 en coulisses dans \u{1F917} "),ae=r("em"),te=a("Transformers"),de=a(" par la m\xE9thode "),ne=r("code"),pe=a("generate()"),ue=a(". Le "),ve=r("code"),be=a("Seq2SeqTrainer"),$e=a(" nous laissera utiliser cette m\xE9thode pour l\u2019\xE9valuation si nous indiquons "),he=r("code"),Y=a("predict_with_generate=True"),ce=a("."),this.h()},l(me){u=l(me,"P",{});var V=o(u);q=n(V,"La fonctionnalit\xE9 que "),h=l(V,"CODE",{});var Ae=o(h);x=n(Ae,"Seq2SeqTrainer"),Ae.forEach(t),A=n(V," ajoute \xE0 sa superclasse "),v=l(V,"CODE",{});var ge=o(v);D=n(ge,"Trainer"),ge.forEach(t),S=n(V," est la possibilit\xE9 d\u2019utiliser la m\xE9thode "),z=l(V,"CODE",{});var Qe=o(z);P=n(Qe,"generate()"),Qe.forEach(t),I=n(V," pendant l\u2019\xE9valuation ou la pr\xE9diction. Pendant l\u2019entra\xEEnement, le mod\xE8le utilisera les "),C=l(V,"CODE",{});var Ee=o(C);y=n(Ee,"decoder_input_ids"),Ee.forEach(t),K=n(V," avec un masque d\u2019attention assurant qu\u2019il n\u2019utilise pas les "),U=l(V,"EM",{});var fe=o(U);O=n(fe,"tokens"),fe.forEach(t),Z=n(V," apr\xE8s le "),L=l(V,"EM",{});var Le=o(L);G=n(Le,"token"),Le.forEach(t),J=n(V," qu\u2019il essaie de pr\xE9dire, pour acc\xE9l\xE9rer l\u2019entra\xEEnement. Pendant l\u2019inf\xE9rence, nous ne pourrons pas les utiliser puisque nous n\u2019aurons pas d\u2019\xE9tiquettes. Ainsi c\u2019est une bonne id\xE9e d\u2019\xE9valuer notre mod\xE8le avec la m\xEAme configuration."),V.forEach(t),B=c(me),N=l(me,"P",{});var le=o(N);se=n(le,"Comme nous l\u2019avons vu dans le "),T=l(le,"A",{href:!0});var Oe=o(T);F=n(Oe,"chapitre 1"),Oe.forEach(t),Q=n(le,", le d\xE9codeur effectue l\u2019inf\xE9rence en pr\xE9disant les "),W=l(le,"EM",{});var oe=o(W);M=n(oe,"tokens"),oe.forEach(t),re=n(le," un par un. C\u2019est quelque chose qui est impl\xE9ment\xE9 en coulisses dans \u{1F917} "),ae=l(le,"EM",{});var ze=o(ae);te=n(ze,"Transformers"),ze.forEach(t),de=n(le," par la m\xE9thode "),ne=l(le,"CODE",{});var ye=o(ne);pe=n(ye,"generate()"),ye.forEach(t),ue=n(le,". Le "),ve=l(le,"CODE",{});var De=o(ve);be=n(De,"Seq2SeqTrainer"),De.forEach(t),$e=n(le," nous laissera utiliser cette m\xE9thode pour l\u2019\xE9valuation si nous indiquons "),he=l(le,"CODE",{});var ds=o(he);Y=n(ds,"predict_with_generate=True"),ds.forEach(t),ce=n(le,"."),le.forEach(t),this.h()},h(){_(T,"href","/course/fr/chapter1/6")},m(me,V){i(me,u,V),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S),s(u,z),s(z,P),s(u,I),s(u,C),s(C,y),s(u,K),s(u,U),s(U,O),s(u,Z),s(u,L),s(L,G),s(u,J),i(me,B,V),i(me,N,V),s(N,se),s(N,T),s(T,F),s(N,Q),s(N,W),s(W,M),s(N,re),s(N,ae),s(ae,te),s(N,de),s(N,ne),s(ne,pe),s(N,ue),s(N,ve),s(ve,be),s(N,$e),s(N,he),s(he,Y),s(N,ce)},d(me){me&&t(u),me&&t(B),me&&t(N)}}}function Ch(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J;return G=new H({props:{code:`import numpy as np


def compute_metrics(eval_preds):
    preds, labels = eval_preds
    # Dans le cas o\xF9 le mod\xE8le retourne plus que les logits de pr\xE9diction
    if isinstance(preds, tuple):
        preds = preds[0]

    decoded_preds = tokenizer.batch_decode(preds, skip_special_tokens=True)

    # Remplacer les -100 dans les \xE9tiquettes car nous ne pouvons pas les d\xE9coder
    labels = np.where(labels != -100, labels, tokenizer.pad_token_id)
    decoded_labels = tokenizer.batch_decode(labels, skip_special_tokens=True)

    # Quelques post-traitements simples
    decoded_preds = [pred.strip() for pred in decoded_preds]
    decoded_labels = [[label.strip()] for label in decoded_labels]

    result = metric.compute(predictions=decoded_preds, references=decoded_labels)
    return {"bleu": result["score"]}`,highlighted:`<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np


<span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_metrics</span>(<span class="hljs-params">eval_preds</span>):
    preds, labels = eval_preds
    <span class="hljs-comment"># Dans le cas o\xF9 le mod\xE8le retourne plus que les logits de pr\xE9diction</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(preds, <span class="hljs-built_in">tuple</span>):
        preds = preds[<span class="hljs-number">0</span>]

    decoded_preds = tokenizer.batch_decode(preds, skip_special_tokens=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># Remplacer les -100 dans les \xE9tiquettes car nous ne pouvons pas les d\xE9coder</span>
    labels = np.where(labels != -<span class="hljs-number">100</span>, labels, tokenizer.pad_token_id)
    decoded_labels = tokenizer.batch_decode(labels, skip_special_tokens=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># Quelques post-traitements simples</span>
    decoded_preds = [pred.strip() <span class="hljs-keyword">for</span> pred <span class="hljs-keyword">in</span> decoded_preds]
    decoded_labels = [[label.strip()] <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> decoded_labels]

    result = metric.compute(predictions=decoded_preds, references=decoded_labels)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;bleu&quot;</span>: result[<span class="hljs-string">&quot;score&quot;</span>]}`}}),{c(){u=r("p"),q=a("Pour passer des sorties du mod\xE8le aux textes utilisables par la m\xE9trique, nous allons utiliser la m\xE9thode "),h=r("code"),x=a("tokenizer.batch_decode()"),A=a(". Nous devons juste nettoyer tous les "),v=r("code"),D=a("-100"),S=a(" dans les \xE9tiquettes. Le "),z=r("em"),P=a("tokenizer"),I=a(" fera automatiquement la m\xEAme chose pour le "),C=r("em"),y=a("token"),K=a(" de "),U=r("em"),O=a("padding"),Z=a(" :"),L=d(),E(G.$$.fragment)},l(B){u=l(B,"P",{});var N=o(u);q=n(N,"Pour passer des sorties du mod\xE8le aux textes utilisables par la m\xE9trique, nous allons utiliser la m\xE9thode "),h=l(N,"CODE",{});var se=o(h);x=n(se,"tokenizer.batch_decode()"),se.forEach(t),A=n(N,". Nous devons juste nettoyer tous les "),v=l(N,"CODE",{});var T=o(v);D=n(T,"-100"),T.forEach(t),S=n(N," dans les \xE9tiquettes. Le "),z=l(N,"EM",{});var F=o(z);P=n(F,"tokenizer"),F.forEach(t),I=n(N," fera automatiquement la m\xEAme chose pour le "),C=l(N,"EM",{});var Q=o(C);y=n(Q,"token"),Q.forEach(t),K=n(N," de "),U=l(N,"EM",{});var W=o(U);O=n(W,"padding"),W.forEach(t),Z=n(N," :"),N.forEach(t),L=c(B),j(G.$$.fragment,B)},m(B,N){i(B,u,N),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S),s(u,z),s(z,P),s(u,I),s(u,C),s(C,y),s(u,K),s(u,U),s(U,O),s(u,Z),i(B,L,N),k(G,B,N),J=!0},i(B){J||(b(G.$$.fragment,B),J=!0)},o(B){$(G.$$.fragment,B),J=!1},d(B){B&&t(u),B&&t(L),w(G,B)}}}function Dh(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se,T,F,Q;return F=new H({props:{code:`import numpy as np
import tensorflow as tf
from tqdm import tqdm

generation_data_collator = DataCollatorForSeq2Seq(
    tokenizer, model=model, return_tensors="tf", pad_to_multiple_of=128
)
tf_generate_dataset = model.prepare_tf_dataset(
    tokenized_datasets["validation"],
    collate_fn=generation_data_collator,
    shuffle=False,
    batch_size=8,
)


@tf.function(jit_compile=True)
def generate_with_xla(batch):
    return model.generate(
        input_ids=batch["input_ids"],
        attention_mask=batch["attention_mask"],
        max_new_tokens=128,
    )


def compute_metrics():
    all_preds = []
    all_labels = []

    for batch, labels in tqdm(tf_generate_dataset):
        predictions = generate_with_xla(batch)
        decoded_preds = tokenizer.batch_decode(predictions, skip_special_tokens=True)
        labels = labels.numpy()
        labels = np.where(labels != -100, labels, tokenizer.pad_token_id)
        decoded_labels = tokenizer.batch_decode(labels, skip_special_tokens=True)
        decoded_preds = [pred.strip() for pred in decoded_preds]
        decoded_labels = [[label.strip()] for label in decoded_labels]
        all_preds.extend(decoded_preds)
        all_labels.extend(decoded_labels)

    result = metric.compute(predictions=all_preds, references=all_labels)
    return {"bleu": result["score"]}`,highlighted:`<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm

generation_data_collator = DataCollatorForSeq2Seq(
    tokenizer, model=model, return_tensors=<span class="hljs-string">&quot;tf&quot;</span>, pad_to_multiple_of=<span class="hljs-number">128</span>
)
tf_generate_dataset = model.prepare_tf_dataset(
    tokenized_datasets[<span class="hljs-string">&quot;validation&quot;</span>],
    collate_fn=generation_data_collator,
    shuffle=<span class="hljs-literal">False</span>,
    batch_size=<span class="hljs-number">8</span>,
)


<span class="hljs-meta">@tf.function(<span class="hljs-params">jit_compile=<span class="hljs-literal">True</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_with_xla</span>(<span class="hljs-params">batch</span>):
    <span class="hljs-keyword">return</span> model.generate(
        input_ids=batch[<span class="hljs-string">&quot;input_ids&quot;</span>],
        attention_mask=batch[<span class="hljs-string">&quot;attention_mask&quot;</span>],
        max_new_tokens=<span class="hljs-number">128</span>,
    )


<span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_metrics</span>():
    all_preds = []
    all_labels = []

    <span class="hljs-keyword">for</span> batch, labels <span class="hljs-keyword">in</span> tqdm(tf_generate_dataset):
        predictions = generate_with_xla(batch)
        decoded_preds = tokenizer.batch_decode(predictions, skip_special_tokens=<span class="hljs-literal">True</span>)
        labels = labels.numpy()
        labels = np.where(labels != -<span class="hljs-number">100</span>, labels, tokenizer.pad_token_id)
        decoded_labels = tokenizer.batch_decode(labels, skip_special_tokens=<span class="hljs-literal">True</span>)
        decoded_preds = [pred.strip() <span class="hljs-keyword">for</span> pred <span class="hljs-keyword">in</span> decoded_preds]
        decoded_labels = [[label.strip()] <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> decoded_labels]
        all_preds.extend(decoded_preds)
        all_labels.extend(decoded_labels)

    result = metric.compute(predictions=all_preds, references=all_labels)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;bleu&quot;</span>: result[<span class="hljs-string">&quot;score&quot;</span>]}`}}),{c(){u=r("p"),q=a("Pour passer des sorties du mod\xE8le aux textes utilisables par la m\xE9trique, nous allons utiliser la m\xE9thode "),h=r("code"),x=a("tokenizer.batch_decode()"),A=a(". Nous devons juste nettoyer tous les "),v=r("code"),D=a("-100"),S=a(" dans les \xE9tiquettes. Le "),z=r("em"),P=a("tokenizer"),I=a(" fera automatiquement la m\xEAme chose pour le "),C=r("em"),y=a("token"),K=a(" de remplissage. D\xE9finissons une fonction qui prend notre mod\xE8le et un jeu de donn\xE9es et calcule des m\xE9triques sur ceux-ci. Nous allons \xE9galement utiliser une astuce qui augmente consid\xE9rablement les performances : compiler notre code de g\xE9n\xE9ration avec "),U=r("a"),O=a("XLA"),Z=a(", le compilateur d\u2019alg\xE8bre lin\xE9aire acc\xE9l\xE9r\xE9 de TensorFlow. XLA applique diverses optimisations au graphe de calcul du mod\xE8le, ce qui permet d\u2019am\xE9liorer consid\xE9rablement la vitesse et l\u2019utilisation de la m\xE9moire. Comme d\xE9crit dans un article du "),L=r("a"),G=a("blog d\u2019Hugging Face"),J=a(", XLA fonctionne mieux lorsque nos formes d\u2019entr\xE9e ne varient pas trop. Pour g\xE9rer cela, nous allons rembourrer nos entr\xE9es \xE0 des multiples de 128, et cr\xE9er un nouveau jeu de donn\xE9es avec l\u2019assembleur de rembourrage. Puis nous appliquerons le d\xE9corateur "),B=r("code"),N=a("@tf.function(jit_compile=True)"),se=a(" \xE0 notre fonction de g\xE9n\xE9ration, qui marque la fonction enti\xE8re pour la compilation avec XLA."),T=d(),E(F.$$.fragment),this.h()},l(W){u=l(W,"P",{});var M=o(u);q=n(M,"Pour passer des sorties du mod\xE8le aux textes utilisables par la m\xE9trique, nous allons utiliser la m\xE9thode "),h=l(M,"CODE",{});var re=o(h);x=n(re,"tokenizer.batch_decode()"),re.forEach(t),A=n(M,". Nous devons juste nettoyer tous les "),v=l(M,"CODE",{});var ae=o(v);D=n(ae,"-100"),ae.forEach(t),S=n(M," dans les \xE9tiquettes. Le "),z=l(M,"EM",{});var te=o(z);P=n(te,"tokenizer"),te.forEach(t),I=n(M," fera automatiquement la m\xEAme chose pour le "),C=l(M,"EM",{});var de=o(C);y=n(de,"token"),de.forEach(t),K=n(M," de remplissage. D\xE9finissons une fonction qui prend notre mod\xE8le et un jeu de donn\xE9es et calcule des m\xE9triques sur ceux-ci. Nous allons \xE9galement utiliser une astuce qui augmente consid\xE9rablement les performances : compiler notre code de g\xE9n\xE9ration avec "),U=l(M,"A",{href:!0,rel:!0});var ne=o(U);O=n(ne,"XLA"),ne.forEach(t),Z=n(M,", le compilateur d\u2019alg\xE8bre lin\xE9aire acc\xE9l\xE9r\xE9 de TensorFlow. XLA applique diverses optimisations au graphe de calcul du mod\xE8le, ce qui permet d\u2019am\xE9liorer consid\xE9rablement la vitesse et l\u2019utilisation de la m\xE9moire. Comme d\xE9crit dans un article du "),L=l(M,"A",{href:!0,rel:!0});var pe=o(L);G=n(pe,"blog d\u2019Hugging Face"),pe.forEach(t),J=n(M,", XLA fonctionne mieux lorsque nos formes d\u2019entr\xE9e ne varient pas trop. Pour g\xE9rer cela, nous allons rembourrer nos entr\xE9es \xE0 des multiples de 128, et cr\xE9er un nouveau jeu de donn\xE9es avec l\u2019assembleur de rembourrage. Puis nous appliquerons le d\xE9corateur "),B=l(M,"CODE",{});var ue=o(B);N=n(ue,"@tf.function(jit_compile=True)"),ue.forEach(t),se=n(M," \xE0 notre fonction de g\xE9n\xE9ration, qui marque la fonction enti\xE8re pour la compilation avec XLA."),M.forEach(t),T=c(W),j(F.$$.fragment,W),this.h()},h(){_(U,"href","https://www.tensorflow.org/xla"),_(U,"rel","nofollow"),_(L,"href","https://huggingface.co/blog/tf-xla-generate"),_(L,"rel","nofollow")},m(W,M){i(W,u,M),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S),s(u,z),s(z,P),s(u,I),s(u,C),s(C,y),s(u,K),s(u,U),s(U,O),s(u,Z),s(u,L),s(L,G),s(u,J),s(u,B),s(B,N),s(u,se),i(W,T,M),k(F,W,M),Q=!0},i(W){Q||(b(F.$$.fragment,W),Q=!0)},o(W){$(F.$$.fragment,W),Q=!1},d(W){W&&t(u),W&&t(T),w(F,W)}}}function Th(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se,T,F,Q,W,M,re,ae,te,de,ne,pe,ue,ve,be,$e,he,Y,ce,me,V,Ae,ge,Qe,Ee,fe,Le,le,Oe,oe,ze,ye,De,ds,Fe,ss,cs,ts,Pe,Ue,He,je,Qs,Ie,Js,Ys,Je,Re,Ns,Ne,g,ie,js,ke,Be,_e,Ke,Me,ot,xe,as,it,ks,Ye,Zs,Xe,ms,Te,ut,fs,ns,Ms,et,Ve,Ut,ws,Os,Fs,Ce,Et,rs,Ht,hs,we,jt,kt,pt,wt,xt,zt,It,_s,zs,vs,Ge,yt,ys,Pt,dt,xs,Ct,We,Bt,Us,Dt,Rt,Hs,Ps,Se,Cs,ls,st,ct,Tt,Kt,bs,Xt,Vt,tt,$s,Ds,Ts,mt,at,ft,Ze;return y=new H({props:{code:`from transformers import Seq2SeqTrainingArguments

args = Seq2SeqTrainingArguments(
    f"marian-finetuned-kde4-en-to-fr",
    evaluation_strategy="no",
    save_strategy="epoch",
    learning_rate=2e-5,
    per_device_train_batch_size=32,
    per_device_eval_batch_size=64,
    weight_decay=0.01,
    save_total_limit=3,
    num_train_epochs=3,
    predict_with_generate=True,
    fp16=True,
    push_to_hub=True,
)`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Seq2SeqTrainingArguments

args = Seq2SeqTrainingArguments(
    <span class="hljs-string">f&quot;marian-finetuned-kde4-en-to-fr&quot;</span>,
    evaluation_strategy=<span class="hljs-string">&quot;no&quot;</span>,
    save_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,
    learning_rate=<span class="hljs-number">2e-5</span>,
    per_device_train_batch_size=<span class="hljs-number">32</span>,
    per_device_eval_batch_size=<span class="hljs-number">64</span>,
    weight_decay=<span class="hljs-number">0.01</span>,
    save_total_limit=<span class="hljs-number">3</span>,
    num_train_epochs=<span class="hljs-number">3</span>,
    predict_with_generate=<span class="hljs-literal">True</span>,
    fp16=<span class="hljs-literal">True</span>,
    push_to_hub=<span class="hljs-literal">True</span>,
)`}}),Ue=new Cn({props:{$$slots:{default:[Ah]},$$scope:{ctx:ee}}}),Re=new H({props:{code:`from transformers import Seq2SeqTrainer

trainer = Seq2SeqTrainer(
    model,
    args,
    train_dataset=tokenized_datasets["train"],
    eval_dataset=tokenized_datasets["validation"],
    data_collator=data_collator,
    tokenizer=tokenizer,
    compute_metrics=compute_metrics,
)`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Seq2SeqTrainer

trainer = Seq2SeqTrainer(
    model,
    args,
    train_dataset=tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>],
    eval_dataset=tokenized_datasets[<span class="hljs-string">&quot;validation&quot;</span>],
    data_collator=data_collator,
    tokenizer=tokenizer,
    compute_metrics=compute_metrics,
)`}}),_e=new H({props:{code:"trainer.evaluate(max_length=max_target_length)",highlighted:"trainer.evaluate(max_length=max_target_length)"}}),Me=new H({props:{code:`{'eval_loss': 1.6964408159255981,
 'eval_bleu': 39.26865061007616,
 'eval_runtime': 965.8884,
 'eval_samples_per_second': 21.76,
 'eval_steps_per_second': 0.341}`,highlighted:`{<span class="hljs-string">&#x27;eval_loss&#x27;</span>: <span class="hljs-number">1.6964408159255981</span>,
 <span class="hljs-string">&#x27;eval_bleu&#x27;</span>: <span class="hljs-number">39.26865061007616</span>,
 <span class="hljs-string">&#x27;eval_runtime&#x27;</span>: <span class="hljs-number">965.8884</span>,
 <span class="hljs-string">&#x27;eval_samples_per_second&#x27;</span>: <span class="hljs-number">21.76</span>,
 <span class="hljs-string">&#x27;eval_steps_per_second&#x27;</span>: <span class="hljs-number">0.341</span>}`}}),Xe=new H({props:{code:"trainer.train()",highlighted:"trainer.train()"}}),Os=new H({props:{code:"trainer.evaluate(max_length=max_target_length)",highlighted:"trainer.evaluate(max_length=max_target_length)"}}),Ce=new H({props:{code:`{'eval_loss': 0.8558505773544312,
 'eval_bleu': 52.94161337775576,
 'eval_runtime': 714.2576,
 'eval_samples_per_second': 29.426,
 'eval_steps_per_second': 0.461,
 'epoch': 3.0}`,highlighted:`{<span class="hljs-string">&#x27;eval_loss&#x27;</span>: <span class="hljs-number">0.8558505773544312</span>,
 <span class="hljs-string">&#x27;eval_bleu&#x27;</span>: <span class="hljs-number">52.94161337775576</span>,
 <span class="hljs-string">&#x27;eval_runtime&#x27;</span>: <span class="hljs-number">714.2576</span>,
 <span class="hljs-string">&#x27;eval_samples_per_second&#x27;</span>: <span class="hljs-number">29.426</span>,
 <span class="hljs-string">&#x27;eval_steps_per_second&#x27;</span>: <span class="hljs-number">0.461</span>,
 <span class="hljs-string">&#x27;epoch&#x27;</span>: <span class="hljs-number">3.0</span>}`}}),We=new H({props:{code:'trainer.push_to_hub(tags="translation", commit_message="Training complete")',highlighted:'trainer.push_to_hub(tags=<span class="hljs-string">&quot;translation&quot;</span>, commit_message=<span class="hljs-string">&quot;Training complete&quot;</span>)'}}),Hs=new H({props:{code:"'https://huggingface.co/sgugger/marian-finetuned-kde4-en-to-fr/commit/3601d621e3baae2bc63d3311452535f8f58f6ef3'",highlighted:'<span class="hljs-string">&#x27;https://huggingface.co/sgugger/marian-finetuned-kde4-en-to-fr/commit/3601d621e3baae2bc63d3311452535f8f58f6ef3&#x27;</span>'}}),{c(){u=r("p"),q=a("Une fois ceci fait, nous pouvons d\xE9finir notre "),h=r("code"),x=a("Seq2SeqTrainingArguments"),A=a(". Comme pour le "),v=r("code"),D=a("Trainer"),S=a(", nous utilisons une sous-classe de "),z=r("code"),P=a("TrainingArguments"),I=a(" qui contient quelques champs suppl\xE9mentaires :"),C=d(),E(y.$$.fragment),K=d(),U=r("p"),O=a("En dehors des hyperparam\xE8tres habituels (comme le taux d\u2019apprentissage, le nombre d\u2019\xE9poques, la taille des batchs et une le taux de d\xE9croissance des poids), voici quelques changements par rapport \xE0 ce que nous avons vu dans les sections pr\xE9c\xE9dentes :"),Z=d(),L=r("ul"),G=r("li"),J=a("Nous ne d\xE9finissons pas d\u2019\xE9valuation car elle prend du temps. Nous allons juste \xE9valuer une fois notre mod\xE8le avant l\u2019entra\xEEnement et apr\xE8s."),B=d(),N=r("li"),se=a("Nous avons mis "),T=r("code"),F=a("fp16=True"),Q=a(", ce qui acc\xE9l\xE8re l\u2019entra\xEEnement sur les GPUs modernes."),W=d(),M=r("li"),re=a("Nous d\xE9finissons "),ae=r("code"),te=a("predict_with_generate=True"),de=a(", comme discut\xE9 ci-dessus."),ne=d(),pe=r("li"),ue=a("Nous utilisons "),ve=r("code"),be=a("push_to_hub=True"),$e=a(" pour t\xE9l\xE9charger le mod\xE8le sur le "),he=r("em"),Y=a("Hub"),ce=a(" \xE0 la fin de chaque \xE9poque."),me=d(),V=r("p"),Ae=a("Notez que vous pouvez sp\xE9cifier le nom complet du d\xE9p\xF4t vers lequel vous voulez pousser avec l\u2019argument "),ge=r("code"),Qe=a("hub_model_id"),Ee=a(" (en particulier, vous devrez utiliser cet argument pour pousser vers une organisation). Par exemple, lorsque nous avons pouss\xE9 le mod\xE8le vers l\u2019organisation "),fe=r("a"),Le=r("code"),le=a("huggingface-course"),Oe=a(", nous avons ajout\xE9 "),oe=r("code"),ze=a('hub_model_id="huggingface-course/marian-finetuned-kde4-en-to-fr"'),ye=a(" \xE0 "),De=r("code"),ds=a("Seq2SeqTrainingArguments"),Fe=a(". Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace et nomm\xE9 d\u2019apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini. Dans notre cas ce sera "),ss=r("code"),cs=a('"sgugger/marian-finetuned-kde4-en-to-fr"'),ts=a(" (qui est le mod\xE8le que nous avons li\xE9 au d\xE9but de cette section)."),Pe=d(),E(Ue.$$.fragment),He=d(),je=r("p"),Qs=a("Enfin, nous passons tout au "),Ie=r("code"),Js=a("Seq2SeqTrainer"),Ys=a(" :"),Je=d(),E(Re.$$.fragment),Ns=d(),Ne=r("p"),g=a("Avant d\u2019entra\xEEner, nous allons d\u2019abord regarder le score obtenu par notre mod\xE8le, pour v\xE9rifier que nous n\u2019aggravons pas les choses avec notre "),ie=r("em"),js=a("finetuning"),ke=a(". Cette commande va prendre un peu de temps, vous pouvez donc prendre un caf\xE9 pendant qu\u2019elle s\u2019ex\xE9cute :"),Be=d(),E(_e.$$.fragment),Ke=d(),E(Me.$$.fragment),ot=d(),xe=r("p"),as=a("Un score BLEU de 39 n\u2019est pas trop mauvais, ce qui refl\xE8te le fait que notre mod\xE8le est d\xE9j\xE0 bon pour traduire des phrases anglaises en phrases fran\xE7aises."),it=d(),ks=r("p"),Ye=a("Vient ensuite l\u2019entra\xEEnement, qui prendra \xE9galement un peu de temps :"),Zs=d(),E(Xe.$$.fragment),ms=d(),Te=r("p"),ut=a("Notez que pendant l\u2019entra\xEEnement, chaque fois que le mod\xE8le est sauvegard\xE9 (ici, \xE0 chaque \xE9poque), il est t\xE9l\xE9charg\xE9 sur le "),fs=r("em"),ns=a("Hub"),Ms=a(" en arri\xE8re-plan. De cette fa\xE7on, vous serez en mesure de reprendre votre entra\xEEnement sur une autre machine si n\xE9cessaire."),et=d(),Ve=r("p"),Ut=a("Une fois l\u2019entra\xEEnement termin\xE9, nous \xE9valuons \xE0 nouveau notre mod\xE8le. Avec un peu de chance, nous verrons une am\xE9lioration du score BLEU !"),ws=d(),E(Os.$$.fragment),Fs=d(),E(Ce.$$.fragment),Et=d(),rs=r("p"),Ht=a("C\u2019est une am\xE9lioration de pr\xE8s de 14 points, ce qui est formidable."),hs=d(),we=r("p"),jt=a("Enfin, nous utilisons la m\xE9thode "),kt=r("code"),pt=a("push_to_hub()"),wt=a(" pour nous assurer que nous t\xE9l\xE9chargeons la derni\xE8re version du mod\xE8le. "),xt=r("code"),zt=a("Trainer"),It=a(" r\xE9dige \xE9galement une carte de mod\xE8le avec tous les r\xE9sultats de l\u2019\xE9valuation et la t\xE9l\xE9charge. Cette carte de mod\xE8le contient des m\xE9tadonn\xE9es qui aident le "),_s=r("em"),zs=a("Hub"),vs=a(" \xE0 choisir le "),Ge=r("em"),yt=a("widget"),ys=a(" pour l\u2019inf\xE9rence. Habituellement, il n\u2019y a pas besoin de dire quoi que ce soit car il peut inf\xE9rer le bon "),Pt=r("em"),dt=a("widget"),xs=a(" \xE0 partir de la classe du mod\xE8le, mais dans ce cas, la m\xEAme classe de mod\xE8le peut \xEAtre utilis\xE9e pour toutes sortes de probl\xE8mes de s\xE9quence \xE0 s\xE9quence. Ainsi nous sp\xE9cifions que c\u2019est un mod\xE8le de traduction :"),Ct=d(),E(We.$$.fragment),Bt=d(),Us=r("p"),Dt=a("Cette commande renvoie l\u2019URL du commit qu\u2019elle vient de faire, si vous voulez l\u2019inspecter :"),Rt=d(),E(Hs.$$.fragment),Ps=d(),Se=r("p"),Cs=a("\xC0 ce stade, vous pouvez utiliser le "),ls=r("em"),st=a("widget"),ct=a(" d\u2019inf\xE9rence sur le "),Tt=r("em"),Kt=a("Hub"),bs=a(" pour tester votre mod\xE8le et le partager avec vos amis. Vous avez r\xE9ussi \xE0 "),Xt=r("em"),Vt=a("finetuner"),tt=a(" un mod\xE8le sur une t\xE2che de traduction. F\xE9licitations !"),$s=d(),Ds=r("p"),Ts=a("Si vous souhaitez vous plonger un peu plus profond\xE9ment dans la boucle d\u2019entra\xEEnement, nous allons maintenant vous montrer comment faire la m\xEAme chose en utilisant \u{1F917} "),mt=r("em"),at=a("Accelerate"),ft=a("."),this.h()},l(f){u=l(f,"P",{});var R=o(u);q=n(R,"Une fois ceci fait, nous pouvons d\xE9finir notre "),h=l(R,"CODE",{});var gs=o(h);x=n(gs,"Seq2SeqTrainingArguments"),gs.forEach(t),A=n(R,". Comme pour le "),v=l(R,"CODE",{});var Ca=o(v);D=n(Ca,"Trainer"),Ca.forEach(t),S=n(R,", nous utilisons une sous-classe de "),z=l(R,"CODE",{});var nt=o(z);P=n(nt,"TrainingArguments"),nt.forEach(t),I=n(R," qui contient quelques champs suppl\xE9mentaires :"),R.forEach(t),C=c(f),j(y.$$.fragment,f),K=c(f),U=l(f,"P",{});var Gt=o(U);O=n(Gt,"En dehors des hyperparam\xE8tres habituels (comme le taux d\u2019apprentissage, le nombre d\u2019\xE9poques, la taille des batchs et une le taux de d\xE9croissance des poids), voici quelques changements par rapport \xE0 ce que nous avons vu dans les sections pr\xE9c\xE9dentes :"),Gt.forEach(t),Z=c(f),L=l(f,"UL",{});var Is=o(L);G=l(Is,"LI",{});var Wt=o(G);J=n(Wt,"Nous ne d\xE9finissons pas d\u2019\xE9valuation car elle prend du temps. Nous allons juste \xE9valuer une fois notre mod\xE8le avant l\u2019entra\xEEnement et apr\xE8s."),Wt.forEach(t),B=c(Is),N=l(Is,"LI",{});var ht=o(N);se=n(ht,"Nous avons mis "),T=l(ht,"CODE",{});var Da=o(T);F=n(Da,"fp16=True"),Da.forEach(t),Q=n(ht,", ce qui acc\xE9l\xE8re l\u2019entra\xEEnement sur les GPUs modernes."),ht.forEach(t),W=c(Is),M=l(Is,"LI",{});var St=o(M);re=n(St,"Nous d\xE9finissons "),ae=l(St,"CODE",{});var Bs=o(ae);te=n(Bs,"predict_with_generate=True"),Bs.forEach(t),de=n(St,", comme discut\xE9 ci-dessus."),St.forEach(t),ne=c(Is),pe=l(Is,"LI",{});var rt=o(pe);ue=n(rt,"Nous utilisons "),ve=l(rt,"CODE",{});var _t=o(ve);be=n(_t,"push_to_hub=True"),_t.forEach(t),$e=n(rt," pour t\xE9l\xE9charger le mod\xE8le sur le "),he=l(rt,"EM",{});var Qt=o(he);Y=n(Qt,"Hub"),Qt.forEach(t),ce=n(rt," \xE0 la fin de chaque \xE9poque."),rt.forEach(t),Is.forEach(t),me=c(f),V=l(f,"P",{});var qe=o(V);Ae=n(qe,"Notez que vous pouvez sp\xE9cifier le nom complet du d\xE9p\xF4t vers lequel vous voulez pousser avec l\u2019argument "),ge=l(qe,"CODE",{});var da=o(ge);Qe=n(da,"hub_model_id"),da.forEach(t),Ee=n(qe," (en particulier, vous devrez utiliser cet argument pour pousser vers une organisation). Par exemple, lorsque nous avons pouss\xE9 le mod\xE8le vers l\u2019organisation "),fe=l(qe,"A",{href:!0,rel:!0});var Rs=o(fe);Le=l(Rs,"CODE",{});var ca=o(Le);le=n(ca,"huggingface-course"),ca.forEach(t),Rs.forEach(t),Oe=n(qe,", nous avons ajout\xE9 "),oe=l(qe,"CODE",{});var Ss=o(oe);ze=n(Ss,'hub_model_id="huggingface-course/marian-finetuned-kde4-en-to-fr"'),Ss.forEach(t),ye=n(qe," \xE0 "),De=l(qe,"CODE",{});var Jt=o(De);ds=n(Jt,"Seq2SeqTrainingArguments"),Jt.forEach(t),Fe=n(qe,". Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace et nomm\xE9 d\u2019apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini. Dans notre cas ce sera "),ss=l(qe,"CODE",{});var Yt=o(ss);cs=n(Yt,'"sgugger/marian-finetuned-kde4-en-to-fr"'),Yt.forEach(t),ts=n(qe," (qui est le mod\xE8le que nous avons li\xE9 au d\xE9but de cette section)."),qe.forEach(t),Pe=c(f),j(Ue.$$.fragment,f),He=c(f),je=l(f,"P",{});var Zt=o(je);Qs=n(Zt,"Enfin, nous passons tout au "),Ie=l(Zt,"CODE",{});var ma=o(Ie);Js=n(ma,"Seq2SeqTrainer"),ma.forEach(t),Ys=n(Zt," :"),Zt.forEach(t),Je=c(f),j(Re.$$.fragment,f),Ns=c(f),Ne=l(f,"P",{});var os=o(Ne);g=n(os,"Avant d\u2019entra\xEEner, nous allons d\u2019abord regarder le score obtenu par notre mod\xE8le, pour v\xE9rifier que nous n\u2019aggravons pas les choses avec notre "),ie=l(os,"EM",{});var At=o(ie);js=n(At,"finetuning"),At.forEach(t),ke=n(os,". Cette commande va prendre un peu de temps, vous pouvez donc prendre un caf\xE9 pendant qu\u2019elle s\u2019ex\xE9cute :"),os.forEach(t),Be=c(f),j(_e.$$.fragment,f),Ke=c(f),j(Me.$$.fragment,f),ot=c(f),xe=l(f,"P",{});var Lt=o(xe);as=n(Lt,"Un score BLEU de 39 n\u2019est pas trop mauvais, ce qui refl\xE8te le fait que notre mod\xE8le est d\xE9j\xE0 bon pour traduire des phrases anglaises en phrases fran\xE7aises."),Lt.forEach(t),it=c(f),ks=l(f,"P",{});var Ta=o(ks);Ye=n(Ta,"Vient ensuite l\u2019entra\xEEnement, qui prendra \xE9galement un peu de temps :"),Ta.forEach(t),Zs=c(f),j(Xe.$$.fragment,f),ms=c(f),Te=l(f,"P",{});var vt=o(Te);ut=n(vt,"Notez que pendant l\u2019entra\xEEnement, chaque fois que le mod\xE8le est sauvegard\xE9 (ici, \xE0 chaque \xE9poque), il est t\xE9l\xE9charg\xE9 sur le "),fs=l(vt,"EM",{});var m=o(fs);ns=n(m,"Hub"),m.forEach(t),Ms=n(vt," en arri\xE8re-plan. De cette fa\xE7on, vous serez en mesure de reprendre votre entra\xEEnement sur une autre machine si n\xE9cessaire."),vt.forEach(t),et=c(f),Ve=l(f,"P",{});var X=o(Ve);Ut=n(X,"Une fois l\u2019entra\xEEnement termin\xE9, nous \xE9valuons \xE0 nouveau notre mod\xE8le. Avec un peu de chance, nous verrons une am\xE9lioration du score BLEU !"),X.forEach(t),ws=c(f),j(Os.$$.fragment,f),Fs=c(f),j(Ce.$$.fragment,f),Et=c(f),rs=l(f,"P",{});var Nt=o(rs);Ht=n(Nt,"C\u2019est une am\xE9lioration de pr\xE8s de 14 points, ce qui est formidable."),Nt.forEach(t),hs=c(f),we=l(f,"P",{});var is=o(we);jt=n(is,"Enfin, nous utilisons la m\xE9thode "),kt=l(is,"CODE",{});var bt=o(kt);pt=n(bt,"push_to_hub()"),bt.forEach(t),wt=n(is," pour nous assurer que nous t\xE9l\xE9chargeons la derni\xE8re version du mod\xE8le. "),xt=l(is,"CODE",{});var Mt=o(xt);zt=n(Mt,"Trainer"),Mt.forEach(t),It=n(is," r\xE9dige \xE9galement une carte de mod\xE8le avec tous les r\xE9sultats de l\u2019\xE9valuation et la t\xE9l\xE9charge. Cette carte de mod\xE8le contient des m\xE9tadonn\xE9es qui aident le "),_s=l(is,"EM",{});var fa=o(_s);zs=n(fa,"Hub"),fa.forEach(t),vs=n(is," \xE0 choisir le "),Ge=l(is,"EM",{});var Ya=o(Ge);yt=n(Ya,"widget"),Ya.forEach(t),ys=n(is," pour l\u2019inf\xE9rence. Habituellement, il n\u2019y a pas besoin de dire quoi que ce soit car il peut inf\xE9rer le bon "),Pt=l(is,"EM",{});var ha=o(Pt);dt=n(ha,"widget"),ha.forEach(t),xs=n(is," \xE0 partir de la classe du mod\xE8le, mais dans ce cas, la m\xEAme classe de mod\xE8le peut \xEAtre utilis\xE9e pour toutes sortes de probl\xE8mes de s\xE9quence \xE0 s\xE9quence. Ainsi nous sp\xE9cifions que c\u2019est un mod\xE8le de traduction :"),is.forEach(t),Ct=c(f),j(We.$$.fragment,f),Bt=c(f),Us=l(f,"P",{});var Sa=o(Us);Dt=n(Sa,"Cette commande renvoie l\u2019URL du commit qu\u2019elle vient de faire, si vous voulez l\u2019inspecter :"),Sa.forEach(t),Rt=c(f),j(Hs.$$.fragment,f),Ps=c(f),Se=l(f,"P",{});var qs=o(Se);Cs=n(qs,"\xC0 ce stade, vous pouvez utiliser le "),ls=l(qs,"EM",{});var Aa=o(ls);st=n(Aa,"widget"),Aa.forEach(t),ct=n(qs," d\u2019inf\xE9rence sur le "),Tt=l(qs,"EM",{});var As=o(Tt);Kt=n(As,"Hub"),As.forEach(t),bs=n(qs," pour tester votre mod\xE8le et le partager avec vos amis. Vous avez r\xE9ussi \xE0 "),Xt=l(qs,"EM",{});var La=o(Xt);Vt=n(La,"finetuner"),La.forEach(t),tt=n(qs," un mod\xE8le sur une t\xE2che de traduction. F\xE9licitations !"),qs.forEach(t),$s=c(f),Ds=l(f,"P",{});var Ks=o(Ds);Ts=n(Ks,"Si vous souhaitez vous plonger un peu plus profond\xE9ment dans la boucle d\u2019entra\xEEnement, nous allons maintenant vous montrer comment faire la m\xEAme chose en utilisant \u{1F917} "),mt=l(Ks,"EM",{});var _a=o(mt);at=n(_a,"Accelerate"),_a.forEach(t),ft=n(Ks,"."),Ks.forEach(t),this.h()},h(){_(fe,"href","https://huggingface.co/huggingface-course"),_(fe,"rel","nofollow")},m(f,R){i(f,u,R),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S),s(u,z),s(z,P),s(u,I),i(f,C,R),k(y,f,R),i(f,K,R),i(f,U,R),s(U,O),i(f,Z,R),i(f,L,R),s(L,G),s(G,J),s(L,B),s(L,N),s(N,se),s(N,T),s(T,F),s(N,Q),s(L,W),s(L,M),s(M,re),s(M,ae),s(ae,te),s(M,de),s(L,ne),s(L,pe),s(pe,ue),s(pe,ve),s(ve,be),s(pe,$e),s(pe,he),s(he,Y),s(pe,ce),i(f,me,R),i(f,V,R),s(V,Ae),s(V,ge),s(ge,Qe),s(V,Ee),s(V,fe),s(fe,Le),s(Le,le),s(V,Oe),s(V,oe),s(oe,ze),s(V,ye),s(V,De),s(De,ds),s(V,Fe),s(V,ss),s(ss,cs),s(V,ts),i(f,Pe,R),k(Ue,f,R),i(f,He,R),i(f,je,R),s(je,Qs),s(je,Ie),s(Ie,Js),s(je,Ys),i(f,Je,R),k(Re,f,R),i(f,Ns,R),i(f,Ne,R),s(Ne,g),s(Ne,ie),s(ie,js),s(Ne,ke),i(f,Be,R),k(_e,f,R),i(f,Ke,R),k(Me,f,R),i(f,ot,R),i(f,xe,R),s(xe,as),i(f,it,R),i(f,ks,R),s(ks,Ye),i(f,Zs,R),k(Xe,f,R),i(f,ms,R),i(f,Te,R),s(Te,ut),s(Te,fs),s(fs,ns),s(Te,Ms),i(f,et,R),i(f,Ve,R),s(Ve,Ut),i(f,ws,R),k(Os,f,R),i(f,Fs,R),k(Ce,f,R),i(f,Et,R),i(f,rs,R),s(rs,Ht),i(f,hs,R),i(f,we,R),s(we,jt),s(we,kt),s(kt,pt),s(we,wt),s(we,xt),s(xt,zt),s(we,It),s(we,_s),s(_s,zs),s(we,vs),s(we,Ge),s(Ge,yt),s(we,ys),s(we,Pt),s(Pt,dt),s(we,xs),i(f,Ct,R),k(We,f,R),i(f,Bt,R),i(f,Us,R),s(Us,Dt),i(f,Rt,R),k(Hs,f,R),i(f,Ps,R),i(f,Se,R),s(Se,Cs),s(Se,ls),s(ls,st),s(Se,ct),s(Se,Tt),s(Tt,Kt),s(Se,bs),s(Se,Xt),s(Xt,Vt),s(Se,tt),i(f,$s,R),i(f,Ds,R),s(Ds,Ts),s(Ds,mt),s(mt,at),s(Ds,ft),Ze=!0},i(f){Ze||(b(y.$$.fragment,f),b(Ue.$$.fragment,f),b(Re.$$.fragment,f),b(_e.$$.fragment,f),b(Me.$$.fragment,f),b(Xe.$$.fragment,f),b(Os.$$.fragment,f),b(Ce.$$.fragment,f),b(We.$$.fragment,f),b(Hs.$$.fragment,f),Ze=!0)},o(f){$(y.$$.fragment,f),$(Ue.$$.fragment,f),$(Re.$$.fragment,f),$(_e.$$.fragment,f),$(Me.$$.fragment,f),$(Xe.$$.fragment,f),$(Os.$$.fragment,f),$(Ce.$$.fragment,f),$(We.$$.fragment,f),$(Hs.$$.fragment,f),Ze=!1},d(f){f&&t(u),f&&t(C),w(y,f),f&&t(K),f&&t(U),f&&t(Z),f&&t(L),f&&t(me),f&&t(V),f&&t(Pe),w(Ue,f),f&&t(He),f&&t(je),f&&t(Je),w(Re,f),f&&t(Ns),f&&t(Ne),f&&t(Be),w(_e,f),f&&t(Ke),w(Me,f),f&&t(ot),f&&t(xe),f&&t(it),f&&t(ks),f&&t(Zs),w(Xe,f),f&&t(ms),f&&t(Te),f&&t(et),f&&t(Ve),f&&t(ws),w(Os,f),f&&t(Fs),w(Ce,f),f&&t(Et),f&&t(rs),f&&t(hs),f&&t(we),f&&t(Ct),w(We,f),f&&t(Bt),f&&t(Us),f&&t(Rt),w(Hs,f),f&&t(Ps),f&&t(Se),f&&t($s),f&&t(Ds)}}}function Sh(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se,T,F,Q,W,M,re,ae,te,de,ne,pe,ue,ve,be,$e,he,Y,ce,me,V,Ae,ge,Qe,Ee,fe,Le,le,Oe,oe,ze,ye,De,ds,Fe,ss,cs,ts,Pe,Ue,He,je,Qs,Ie,Js,Ys,Je,Re,Ns,Ne;return x=new H({props:{code:"print(compute_metrics())",highlighted:'<span class="hljs-built_in">print</span>(compute_metrics())'}}),v=new H({props:{code:"{'bleu': 33.26983701454733}",highlighted:'{&#x27;bleu&#x27;: <span class="hljs-number">33.26983701454733</span>}'}}),K=new H({props:{code:`from transformers import create_optimizer
from transformers.keras_callbacks import PushToHubCallback
import tensorflow as tf

# Le nombre d'\xE9tapes d'entra\xEEnement est le nombre d'\xE9chantillons dans le jeu de donn\xE9es, divis\xE9 par la taille du batch,
# puis multipli\xE9 par le nombre total d'\xE9poques. Notez que le jeu de donn\xE9es tf_train_dataset est ici un tf.data.Dataset,
# et non le jeu de donn\xE9es original donc son len() est d\xE9j\xE0 num_samples // batch_size.
num_epochs = 3
num_train_steps = len(tf_train_dataset) * num_epochs

optimizer, schedule = create_optimizer(
    init_lr=5e-5,
    num_warmup_steps=0,
    num_train_steps=num_train_steps,
    weight_decay_rate=0.01,
)
model.compile(optimizer=optimizer)

# Entra\xEEner en mixed-precision float16
tf.keras.mixed_precision.set_global_policy("mixed_float16")`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> create_optimizer
<span class="hljs-keyword">from</span> transformers.keras_callbacks <span class="hljs-keyword">import</span> PushToHubCallback
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf

<span class="hljs-comment"># Le nombre d&#x27;\xE9tapes d&#x27;entra\xEEnement est le nombre d&#x27;\xE9chantillons dans le jeu de donn\xE9es, divis\xE9 par la taille du batch,</span>
<span class="hljs-comment"># puis multipli\xE9 par le nombre total d&#x27;\xE9poques. Notez que le jeu de donn\xE9es tf_train_dataset est ici un tf.data.Dataset,</span>
<span class="hljs-comment"># et non le jeu de donn\xE9es original donc son len() est d\xE9j\xE0 num_samples // batch_size.</span>
num_epochs = <span class="hljs-number">3</span>
num_train_steps = <span class="hljs-built_in">len</span>(tf_train_dataset) * num_epochs

optimizer, schedule = create_optimizer(
    init_lr=<span class="hljs-number">5e-5</span>,
    num_warmup_steps=<span class="hljs-number">0</span>,
    num_train_steps=num_train_steps,
    weight_decay_rate=<span class="hljs-number">0.01</span>,
)
model.<span class="hljs-built_in">compile</span>(optimizer=optimizer)

<span class="hljs-comment"># Entra\xEEner en mixed-precision float16</span>
tf.keras.mixed_precision.set_global_policy(<span class="hljs-string">&quot;mixed_float16&quot;</span>)`}}),te=new H({props:{code:`from transformers.keras_callbacks import PushToHubCallback

callback = PushToHubCallback(
    output_dir="marian-finetuned-kde4-en-to-fr", tokenizer=tokenizer
)

model.fit(
    tf_train_dataset,
    validation_data=tf_eval_dataset,
    callbacks=[callback],
    epochs=num_epochs,
)`,highlighted:`<span class="hljs-keyword">from</span> transformers.keras_callbacks <span class="hljs-keyword">import</span> PushToHubCallback

callback = PushToHubCallback(
    output_dir=<span class="hljs-string">&quot;marian-finetuned-kde4-en-to-fr&quot;</span>, tokenizer=tokenizer
)

model.fit(
    tf_train_dataset,
    validation_data=tf_eval_dataset,
    callbacks=[callback],
    epochs=num_epochs,
)`}}),oe=new Cn({props:{$$slots:{default:[Lh]},$$scope:{ctx:ee}}}),Fe=new H({props:{code:"print(compute_metrics())",highlighted:'<span class="hljs-built_in">print</span>(compute_metrics())'}}),cs=new H({props:{code:"{'bleu': 57.334066271545865}",highlighted:'{&#x27;bleu&#x27;: <span class="hljs-number">57.334066271545865</span>}'}}),{c(){u=r("p"),q=a("Avant de commencer, voyons quel type de r\xE9sultats nous obtenons avec notre mod\xE8le sans entra\xEEnement :"),h=d(),E(x.$$.fragment),A=d(),E(v.$$.fragment),D=d(),S=r("p"),z=a("Une fois ceci fait, nous pouvons pr\xE9parer tout ce dont nous avons besoin pour compiler et entra\xEEner notre mod\xE8le. Notez l\u2019utilisation de "),P=r("code"),I=a('tf.keras.mixed_precision.set_global_policy("mixed_float16")'),C=a(". Ceci indiquera \xE0 Keras de s\u2019entra\xEEner en utilisant float16, ce qui peut donner un gain de vitesse significatif sur les GPUs qui le supportent (Nvidia 20xx/V100 ou plus r\xE9cent)."),y=d(),E(K.$$.fragment),U=d(),O=r("p"),Z=a("Ensuite, nous d\xE9finissons un "),L=r("code"),G=a("PushToHubCallback"),J=a(" pour t\xE9l\xE9charger notre mod\xE8le sur le "),B=r("em"),N=a("Hub"),se=a(" pendant l\u2019entra\xEEnement, comme nous l\u2019avons vu dans la "),T=r("a"),F=a("section 2"),Q=a(", puis nous entra\xEEnons simplement le mod\xE8le avec ce "),W=r("em"),M=a("callback"),re=a(" :"),ae=d(),E(te.$$.fragment),de=d(),ne=r("p"),pe=a("Notez que vous pouvez sp\xE9cifier le nom du d\xE9p\xF4t vers lequel vous voulez pousser le mod\xE8le avec l\u2019argument "),ue=r("code"),ve=a("hub_model_id"),be=a(" (en particulier, vous devrez utiliser cet argument pour pousser vers une organisation). Par exemple, lorsque nous avons pouss\xE9 le mod\xE8le vers l\u2019organisation "),$e=r("a"),he=r("code"),Y=a("huggingface-course"),ce=a(", nous avons ajout\xE9 "),me=r("code"),V=a('hub_model_id="huggingface-course/marian-finetuned-kde4-en-to-fr"'),Ae=a(" dans "),ge=r("code"),Qe=a("Seq2SeqTrainingArguments"),Ee=a(". Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace et nomm\xE9 apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini. Ici ce sera "),fe=r("code"),Le=a('"sgugger/marian-finetuned-kde4-en-to-fr"'),le=a(" (qui est le mod\xE8le que nous avons li\xE9 au d\xE9but de cette section)."),Oe=d(),E(oe.$$.fragment),ze=d(),ye=r("p"),De=a("Enfin, voyons \xE0 quoi ressemblent nos m\xE9triques maintenant que l\u2019entra\xEEnement est termin\xE9 :"),ds=d(),E(Fe.$$.fragment),ss=d(),E(cs.$$.fragment),ts=d(),Pe=r("p"),Ue=a("\xC0 ce stade, vous pouvez utiliser le "),He=r("em"),je=a("widget"),Qs=a(" d\u2019inf\xE9rence sur le "),Ie=r("em"),Js=a("Hub"),Ys=a(" pour tester votre mod\xE8le et le partager avec vos amis. Vous avez r\xE9ussi \xE0 "),Je=r("em"),Re=a("finetuner"),Ns=a(" un mod\xE8le sur une t\xE2che de traduction. F\xE9licitations !"),this.h()},l(g){u=l(g,"P",{});var ie=o(u);q=n(ie,"Avant de commencer, voyons quel type de r\xE9sultats nous obtenons avec notre mod\xE8le sans entra\xEEnement :"),ie.forEach(t),h=c(g),j(x.$$.fragment,g),A=c(g),j(v.$$.fragment,g),D=c(g),S=l(g,"P",{});var js=o(S);z=n(js,"Une fois ceci fait, nous pouvons pr\xE9parer tout ce dont nous avons besoin pour compiler et entra\xEEner notre mod\xE8le. Notez l\u2019utilisation de "),P=l(js,"CODE",{});var ke=o(P);I=n(ke,'tf.keras.mixed_precision.set_global_policy("mixed_float16")'),ke.forEach(t),C=n(js,". Ceci indiquera \xE0 Keras de s\u2019entra\xEEner en utilisant float16, ce qui peut donner un gain de vitesse significatif sur les GPUs qui le supportent (Nvidia 20xx/V100 ou plus r\xE9cent)."),js.forEach(t),y=c(g),j(K.$$.fragment,g),U=c(g),O=l(g,"P",{});var Be=o(O);Z=n(Be,"Ensuite, nous d\xE9finissons un "),L=l(Be,"CODE",{});var _e=o(L);G=n(_e,"PushToHubCallback"),_e.forEach(t),J=n(Be," pour t\xE9l\xE9charger notre mod\xE8le sur le "),B=l(Be,"EM",{});var Ke=o(B);N=n(Ke,"Hub"),Ke.forEach(t),se=n(Be," pendant l\u2019entra\xEEnement, comme nous l\u2019avons vu dans la "),T=l(Be,"A",{href:!0});var Me=o(T);F=n(Me,"section 2"),Me.forEach(t),Q=n(Be,", puis nous entra\xEEnons simplement le mod\xE8le avec ce "),W=l(Be,"EM",{});var ot=o(W);M=n(ot,"callback"),ot.forEach(t),re=n(Be," :"),Be.forEach(t),ae=c(g),j(te.$$.fragment,g),de=c(g),ne=l(g,"P",{});var xe=o(ne);pe=n(xe,"Notez que vous pouvez sp\xE9cifier le nom du d\xE9p\xF4t vers lequel vous voulez pousser le mod\xE8le avec l\u2019argument "),ue=l(xe,"CODE",{});var as=o(ue);ve=n(as,"hub_model_id"),as.forEach(t),be=n(xe," (en particulier, vous devrez utiliser cet argument pour pousser vers une organisation). Par exemple, lorsque nous avons pouss\xE9 le mod\xE8le vers l\u2019organisation "),$e=l(xe,"A",{href:!0,rel:!0});var it=o($e);he=l(it,"CODE",{});var ks=o(he);Y=n(ks,"huggingface-course"),ks.forEach(t),it.forEach(t),ce=n(xe,", nous avons ajout\xE9 "),me=l(xe,"CODE",{});var Ye=o(me);V=n(Ye,'hub_model_id="huggingface-course/marian-finetuned-kde4-en-to-fr"'),Ye.forEach(t),Ae=n(xe," dans "),ge=l(xe,"CODE",{});var Zs=o(ge);Qe=n(Zs,"Seq2SeqTrainingArguments"),Zs.forEach(t),Ee=n(xe,". Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace et nomm\xE9 apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini. Ici ce sera "),fe=l(xe,"CODE",{});var Xe=o(fe);Le=n(Xe,'"sgugger/marian-finetuned-kde4-en-to-fr"'),Xe.forEach(t),le=n(xe," (qui est le mod\xE8le que nous avons li\xE9 au d\xE9but de cette section)."),xe.forEach(t),Oe=c(g),j(oe.$$.fragment,g),ze=c(g),ye=l(g,"P",{});var ms=o(ye);De=n(ms,"Enfin, voyons \xE0 quoi ressemblent nos m\xE9triques maintenant que l\u2019entra\xEEnement est termin\xE9 :"),ms.forEach(t),ds=c(g),j(Fe.$$.fragment,g),ss=c(g),j(cs.$$.fragment,g),ts=c(g),Pe=l(g,"P",{});var Te=o(Pe);Ue=n(Te,"\xC0 ce stade, vous pouvez utiliser le "),He=l(Te,"EM",{});var ut=o(He);je=n(ut,"widget"),ut.forEach(t),Qs=n(Te," d\u2019inf\xE9rence sur le "),Ie=l(Te,"EM",{});var fs=o(Ie);Js=n(fs,"Hub"),fs.forEach(t),Ys=n(Te," pour tester votre mod\xE8le et le partager avec vos amis. Vous avez r\xE9ussi \xE0 "),Je=l(Te,"EM",{});var ns=o(Je);Re=n(ns,"finetuner"),ns.forEach(t),Ns=n(Te," un mod\xE8le sur une t\xE2che de traduction. F\xE9licitations !"),Te.forEach(t),this.h()},h(){_(T,"href","/course/fr/chapter7/2"),_($e,"href","https://huggingface.co/huggingface-course"),_($e,"rel","nofollow")},m(g,ie){i(g,u,ie),s(u,q),i(g,h,ie),k(x,g,ie),i(g,A,ie),k(v,g,ie),i(g,D,ie),i(g,S,ie),s(S,z),s(S,P),s(P,I),s(S,C),i(g,y,ie),k(K,g,ie),i(g,U,ie),i(g,O,ie),s(O,Z),s(O,L),s(L,G),s(O,J),s(O,B),s(B,N),s(O,se),s(O,T),s(T,F),s(O,Q),s(O,W),s(W,M),s(O,re),i(g,ae,ie),k(te,g,ie),i(g,de,ie),i(g,ne,ie),s(ne,pe),s(ne,ue),s(ue,ve),s(ne,be),s(ne,$e),s($e,he),s(he,Y),s(ne,ce),s(ne,me),s(me,V),s(ne,Ae),s(ne,ge),s(ge,Qe),s(ne,Ee),s(ne,fe),s(fe,Le),s(ne,le),i(g,Oe,ie),k(oe,g,ie),i(g,ze,ie),i(g,ye,ie),s(ye,De),i(g,ds,ie),k(Fe,g,ie),i(g,ss,ie),k(cs,g,ie),i(g,ts,ie),i(g,Pe,ie),s(Pe,Ue),s(Pe,He),s(He,je),s(Pe,Qs),s(Pe,Ie),s(Ie,Js),s(Pe,Ys),s(Pe,Je),s(Je,Re),s(Pe,Ns),Ne=!0},i(g){Ne||(b(x.$$.fragment,g),b(v.$$.fragment,g),b(K.$$.fragment,g),b(te.$$.fragment,g),b(oe.$$.fragment,g),b(Fe.$$.fragment,g),b(cs.$$.fragment,g),Ne=!0)},o(g){$(x.$$.fragment,g),$(v.$$.fragment,g),$(K.$$.fragment,g),$(te.$$.fragment,g),$(oe.$$.fragment,g),$(Fe.$$.fragment,g),$(cs.$$.fragment,g),Ne=!1},d(g){g&&t(u),g&&t(h),w(x,g),g&&t(A),w(v,g),g&&t(D),g&&t(S),g&&t(y),w(K,g),g&&t(U),g&&t(O),g&&t(ae),w(te,g),g&&t(de),g&&t(ne),g&&t(Oe),w(oe,g),g&&t(ze),g&&t(ye),g&&t(ds),w(Fe,g),g&&t(ss),w(cs,g),g&&t(ts),g&&t(Pe)}}}function Ah(ee){let u,q,h,x,A;return{c(){u=r("p"),q=a("\u{1F4A1} Si le r\xE9pertoire de sortie que vous utilisez existe d\xE9j\xE0, il doit \xEAtre un clone local du d\xE9p\xF4t vers lequel vous voulez pousser. S\u2019il ne l\u2019est pas, vous obtiendrez une erreur lors de la d\xE9finition de votre "),h=r("code"),x=a("Seq2SeqTrainer"),A=a(" et devrez d\xE9finir un nouveau nom.")},l(v){u=l(v,"P",{});var D=o(u);q=n(D,"\u{1F4A1} Si le r\xE9pertoire de sortie que vous utilisez existe d\xE9j\xE0, il doit \xEAtre un clone local du d\xE9p\xF4t vers lequel vous voulez pousser. S\u2019il ne l\u2019est pas, vous obtiendrez une erreur lors de la d\xE9finition de votre "),h=l(D,"CODE",{});var S=o(h);x=n(S,"Seq2SeqTrainer"),S.forEach(t),A=n(D," et devrez d\xE9finir un nouveau nom."),D.forEach(t)},m(v,D){i(v,u,D),s(u,q),s(u,h),s(h,x),s(u,A)},d(v){v&&t(u)}}}function Lh(ee){let u,q,h,x,A;return{c(){u=r("p"),q=a("\u{1F4A1} Si le r\xE9pertoire de sortie que vous utilisez existe d\xE9j\xE0, il doit \xEAtre un clone local du d\xE9p\xF4t vers lequel vous voulez pousser. S\u2019il ne l\u2019est pas, vous obtiendrez une erreur lors de l\u2019appel de "),h=r("code"),x=a("model.fit()"),A=a(" et devrez d\xE9finir un nouveau nom.")},l(v){u=l(v,"P",{});var D=o(u);q=n(D,"\u{1F4A1} Si le r\xE9pertoire de sortie que vous utilisez existe d\xE9j\xE0, il doit \xEAtre un clone local du d\xE9p\xF4t vers lequel vous voulez pousser. S\u2019il ne l\u2019est pas, vous obtiendrez une erreur lors de l\u2019appel de "),h=l(D,"CODE",{});var S=o(h);x=n(S,"model.fit()"),S.forEach(t),A=n(D," et devrez d\xE9finir un nouveau nom."),D.forEach(t)},m(v,D){i(v,u,D),s(u,q),s(u,h),s(h,x),s(u,A)},d(v){v&&t(u)}}}function uh(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se,T,F,Q,W,M,re,ae,te,de,ne,pe,ue,ve,be,$e,he,Y,ce,me,V,Ae,ge,Qe,Ee,fe,Le,le,Oe,oe,ze,ye,De,ds,Fe,ss,cs,ts,Pe,Ue,He,je,Qs,Ie,Js,Ys,Je,Re,Ns,Ne,g,ie,js,ke,Be,_e,Ke,Me,ot,xe,as,it,ks,Ye,Zs,Xe,ms,Te,ut,fs,ns,Ms,et,Ve,Ut,ws,Os,Fs,Ce,Et,rs,Ht,hs,we,jt,kt,pt,wt,xt,zt,It,_s,zs,vs,Ge,yt,ys,Pt,dt,xs,Ct,We,Bt,Us,Dt,Rt,Hs,Ps,Se,Cs,ls,st,ct,Tt,Kt,bs,Xt,Vt,tt,$s,Ds,Ts,mt,at,ft,Ze,f,R,gs,Ca,nt,Gt,Is,Wt,ht,Da,St,Bs,rt,_t,Qt,qe,da,Rs,ca,Ss,Jt,Yt,Zt,ma,os,At,Lt,Ta,vt;return x=new Ft({}),B=new Ft({}),ue=new H({props:{code:`from torch.utils.data import DataLoader

tokenized_datasets.set_format("torch")
train_dataloader = DataLoader(
    tokenized_datasets["train"],
    shuffle=True,
    collate_fn=data_collator,
    batch_size=8,
)
eval_dataloader = DataLoader(
    tokenized_datasets["validation"], collate_fn=data_collator, batch_size=8
)`,highlighted:`<span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader

tokenized_datasets.set_format(<span class="hljs-string">&quot;torch&quot;</span>)
train_dataloader = DataLoader(
    tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>],
    shuffle=<span class="hljs-literal">True</span>,
    collate_fn=data_collator,
    batch_size=<span class="hljs-number">8</span>,
)
eval_dataloader = DataLoader(
    tokenized_datasets[<span class="hljs-string">&quot;validation&quot;</span>], collate_fn=data_collator, batch_size=<span class="hljs-number">8</span>
)`}}),V=new H({props:{code:"model = AutoModelForSeq2SeqLM.from_pretrained(model_checkpoint)",highlighted:"model = AutoModelForSeq2SeqLM.from_pretrained(model_checkpoint)"}}),fe=new H({props:{code:`from transformers import AdamW

optimizer = AdamW(model.parameters(), lr=2e-5)`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AdamW

optimizer = AdamW(model.parameters(), lr=<span class="hljs-number">2e-5</span>)`}}),Ue=new H({props:{code:`from accelerate import Accelerator

accelerator = Accelerator()
model, optimizer, train_dataloader, eval_dataloader = accelerator.prepare(
    model, optimizer, train_dataloader, eval_dataloader
)`,highlighted:`<span class="hljs-keyword">from</span> accelerate <span class="hljs-keyword">import</span> Accelerator

accelerator = Accelerator()
model, optimizer, train_dataloader, eval_dataloader = accelerator.prepare(
    model, optimizer, train_dataloader, eval_dataloader
)`}}),ke=new H({props:{code:`from transformers import get_scheduler

num_train_epochs = 3
num_update_steps_per_epoch = len(train_dataloader)
num_training_steps = num_train_epochs * num_update_steps_per_epoch

lr_scheduler = get_scheduler(
    "linear",
    optimizer=optimizer,
    num_warmup_steps=0,
    num_training_steps=num_training_steps,
)`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> get_scheduler

num_train_epochs = <span class="hljs-number">3</span>
num_update_steps_per_epoch = <span class="hljs-built_in">len</span>(train_dataloader)
num_training_steps = num_train_epochs * num_update_steps_per_epoch

lr_scheduler = get_scheduler(
    <span class="hljs-string">&quot;linear&quot;</span>,
    optimizer=optimizer,
    num_warmup_steps=<span class="hljs-number">0</span>,
    num_training_steps=num_training_steps,
)`}}),Ve=new H({props:{code:`from huggingface_hub import Repository, get_full_repo_name

model_name = "marian-finetuned-kde4-en-to-fr-accelerate"
repo_name = get_full_repo_name(model_name)
repo_name`,highlighted:`<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> Repository, get_full_repo_name

model_name = <span class="hljs-string">&quot;marian-finetuned-kde4-en-to-fr-accelerate&quot;</span>
repo_name = get_full_repo_name(model_name)
repo_name`}}),ws=new H({props:{code:"'sgugger/marian-finetuned-kde4-en-to-fr-accelerate'",highlighted:'<span class="hljs-string">&#x27;sgugger/marian-finetuned-kde4-en-to-fr-accelerate&#x27;</span>'}}),rs=new H({props:{code:`output_dir = "marian-finetuned-kde4-en-to-fr-accelerate"
repo = Repository(output_dir, clone_from=repo_name)`,highlighted:`output_dir = <span class="hljs-string">&quot;marian-finetuned-kde4-en-to-fr-accelerate&quot;</span>
repo = Repository(output_dir, clone_from=repo_name)`}}),Ge=new Ft({}),Se=new H({props:{code:`def postprocess(predictions, labels):
    predictions = predictions.cpu().numpy()
    labels = labels.cpu().numpy()

    decoded_preds = tokenizer.batch_decode(predictions, skip_special_tokens=True)

    # Remplace -100 dans les \xE9tiquettes car nous ne pouvons pas les d\xE9coder
    labels = np.where(labels != -100, labels, tokenizer.pad_token_id)
    decoded_labels = tokenizer.batch_decode(labels, skip_special_tokens=True)

    # Quelques post-traitements simples
    decoded_preds = [pred.strip() for pred in decoded_preds]
    decoded_labels = [[label.strip()] for label in decoded_labels]
    return decoded_preds, decoded_labels`,highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">postprocess</span>(<span class="hljs-params">predictions, labels</span>):
    predictions = predictions.cpu().numpy()
    labels = labels.cpu().numpy()

    decoded_preds = tokenizer.batch_decode(predictions, skip_special_tokens=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># Remplace -100 dans les \xE9tiquettes car nous ne pouvons pas les d\xE9coder</span>
    labels = np.where(labels != -<span class="hljs-number">100</span>, labels, tokenizer.pad_token_id)
    decoded_labels = tokenizer.batch_decode(labels, skip_special_tokens=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># Quelques post-traitements simples</span>
    decoded_preds = [pred.strip() <span class="hljs-keyword">for</span> pred <span class="hljs-keyword">in</span> decoded_preds]
    decoded_labels = [[label.strip()] <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> decoded_labels]
    <span class="hljs-keyword">return</span> decoded_preds, decoded_labels`}}),qe=new H({props:{code:`from tqdm.auto import tqdm
import torch

progress_bar = tqdm(range(num_training_steps))

for epoch in range(num_train_epochs):
    # Entra\xEEnement
    model.train()
    for batch in train_dataloader:
        outputs = model(**batch)
        loss = outputs.loss
        accelerator.backward(loss)

        optimizer.step()
        lr_scheduler.step()
        optimizer.zero_grad()
        progress_bar.update(1)

    # Evaluation
    model.eval()
    for batch in tqdm(eval_dataloader):
        with torch.no_grad():
            generated_tokens = accelerator.unwrap_model(model).generate(
                batch["input_ids"],
                attention_mask=batch["attention_mask"],
                max_length=128,
            )
        labels = batch["labels"]

        # N\xE9cessaire pour rembourrer les pr\xE9dictions et les \xE9tiquettes \xE0 rassembler
        generated_tokens = accelerator.pad_across_processes(
            generated_tokens, dim=1, pad_index=tokenizer.pad_token_id
        )
        labels = accelerator.pad_across_processes(labels, dim=1, pad_index=-100)

        predictions_gathered = accelerator.gather(generated_tokens)
        labels_gathered = accelerator.gather(labels)

        decoded_preds, decoded_labels = postprocess(predictions_gathered, labels_gathered)
        metric.add_batch(predictions=decoded_preds, references=decoded_labels)

    results = metric.compute()
    print(f"epoch {epoch}, BLEU score: {results['score']:.2f}")

    # Sauvegarder et t\xE9l\xE9charger
    accelerator.wait_for_everyone()
    unwrapped_model = accelerator.unwrap_model(model)
    unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)
    if accelerator.is_main_process:
        tokenizer.save_pretrained(output_dir)
        repo.push_to_hub(
            commit_message=f"Training in progress epoch {epoch}", blocking=False
        )`,highlighted:`<span class="hljs-keyword">from</span> tqdm.auto <span class="hljs-keyword">import</span> tqdm
<span class="hljs-keyword">import</span> torch

progress_bar = tqdm(<span class="hljs-built_in">range</span>(num_training_steps))

<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_train_epochs):
    <span class="hljs-comment"># Entra\xEEnement</span>
    model.train()
    <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> train_dataloader:
        outputs = model(**batch)
        loss = outputs.loss
        accelerator.backward(loss)

        optimizer.step()
        lr_scheduler.step()
        optimizer.zero_grad()
        progress_bar.update(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># Evaluation</span>
    model.<span class="hljs-built_in">eval</span>()
    <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> tqdm(eval_dataloader):
        <span class="hljs-keyword">with</span> torch.no_grad():
            generated_tokens = accelerator.unwrap_model(model).generate(
                batch[<span class="hljs-string">&quot;input_ids&quot;</span>],
                attention_mask=batch[<span class="hljs-string">&quot;attention_mask&quot;</span>],
                max_length=<span class="hljs-number">128</span>,
            )
        labels = batch[<span class="hljs-string">&quot;labels&quot;</span>]

        <span class="hljs-comment"># N\xE9cessaire pour rembourrer les pr\xE9dictions et les \xE9tiquettes \xE0 rassembler</span>
        generated_tokens = accelerator.pad_across_processes(
            generated_tokens, dim=<span class="hljs-number">1</span>, pad_index=tokenizer.pad_token_id
        )
        labels = accelerator.pad_across_processes(labels, dim=<span class="hljs-number">1</span>, pad_index=-<span class="hljs-number">100</span>)

        predictions_gathered = accelerator.gather(generated_tokens)
        labels_gathered = accelerator.gather(labels)

        decoded_preds, decoded_labels = postprocess(predictions_gathered, labels_gathered)
        metric.add_batch(predictions=decoded_preds, references=decoded_labels)

    results = metric.compute()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;epoch <span class="hljs-subst">{epoch}</span>, BLEU score: <span class="hljs-subst">{results[<span class="hljs-string">&#x27;score&#x27;</span>]:<span class="hljs-number">.2</span>f}</span>&quot;</span>)

    <span class="hljs-comment"># Sauvegarder et t\xE9l\xE9charger</span>
    accelerator.wait_for_everyone()
    unwrapped_model = accelerator.unwrap_model(model)
    unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)
    <span class="hljs-keyword">if</span> accelerator.is_main_process:
        tokenizer.save_pretrained(output_dir)
        repo.push_to_hub(
            commit_message=<span class="hljs-string">f&quot;Training in progress epoch <span class="hljs-subst">{epoch}</span>&quot;</span>, blocking=<span class="hljs-literal">False</span>
        )`}}),Rs=new H({props:{code:`epoch 0, BLEU score: 53.47
epoch 1, BLEU score: 54.24
epoch 2, BLEU score: 54.44`,highlighted:`epoch <span class="hljs-number">0</span>, BLEU score: <span class="hljs-number">53.47</span>
epoch <span class="hljs-number">1</span>, BLEU score: <span class="hljs-number">54.24</span>
epoch <span class="hljs-number">2</span>, BLEU score: <span class="hljs-number">54.44</span>`}}),{c(){u=r("h2"),q=r("a"),h=r("span"),E(x.$$.fragment),A=d(),v=r("span"),D=a("Une boucle d'entra\xEEnement personnalis\xE9e"),S=d(),z=r("p"),P=a("Jetons maintenant un coup d\u2019\u0153il \xE0 la boucle d\u2019entra\xEEnement compl\xE8te afin que vous puissiez facilement personnaliser les parties dont vous avez besoin. Elle ressemblera beaucoup \xE0 ce que nous avons fait dans la "),I=r("a"),C=a("section 2"),y=a(" et dans le "),K=r("a"),U=a("chapitre 3"),O=a("."),Z=d(),L=r("h3"),G=r("a"),J=r("span"),E(B.$$.fragment),N=d(),se=r("span"),T=a("Pr\xE9parer le tout pour l'entra\xEEnement"),F=d(),Q=r("p"),W=a("Vous avez vu tout cela plusieurs fois maintenant, donc nous allons passer en revue le code assez rapidement. D\u2019abord, nous allons construire le "),M=r("code"),re=a("DataLoader"),ae=a(" \xE0 partir de nos jeux de donn\xE9es, apr\xE8s avoir configur\xE9 les jeux de donn\xE9es au format "),te=r("code"),de=a('"torch"'),ne=a(" pour obtenir les tenseurs PyTorch :"),pe=d(),E(ue.$$.fragment),ve=d(),be=r("p"),$e=a("Ensuite, nous r\xE9instantifions notre mod\xE8le pour nous assurer que nous ne poursuivons pas le "),he=r("em"),Y=a("finetuning"),ce=a(" pr\xE9c\xE9dent et que nous repartons du mod\xE8le pr\xE9-entra\xEEn\xE9 :"),me=d(),E(V.$$.fragment),Ae=d(),ge=r("p"),Qe=a("Nous aurons alors besoin d\u2019un optimiseur :"),Ee=d(),E(fe.$$.fragment),Le=d(),le=r("p"),Oe=a("Une fois que nous avons tous ces objets, nous pouvons les envoyer \xE0 la m\xE9thode "),oe=r("code"),ze=a("accelerator.prepare()"),ye=a(". Rappelez-vous que si vous voulez entra\xEEner sur des TPUs dans un "),De=r("em"),ds=a("notebook"),Fe=a(" de Colab, vous devez d\xE9placer tout ce code dans une fonction d\u2019entra\xEEnement et ne devrait pas ex\xE9cuter une cellule qui instancie un "),ss=r("code"),cs=a("Accelerator"),ts=a("."),Pe=d(),E(Ue.$$.fragment),He=d(),je=r("p"),Qs=a("Maintenant que nous avons envoy\xE9 notre "),Ie=r("code"),Js=a("train_dataloader"),Ys=a(" \xE0 "),Je=r("code"),Re=a("accelerator.prepare()"),Ns=a(", nous pouvons utiliser sa longueur pour calculer le nombre d\u2019\xE9tapes d\u2019entra\xEEnement. Rappelez-vous que nous devrions toujours faire cela apr\xE8s avoir pr\xE9par\xE9 le chargeur de donn\xE9es car cette m\xE9thode va changer la longueur du "),Ne=r("code"),g=a("DataLoader"),ie=a(". Nous utilisons un programme lin\xE9aire classique du taux d\u2019apprentissage \xE0 0 :"),js=d(),E(ke.$$.fragment),Be=d(),_e=r("p"),Ke=a("Enfin, pour pousser notre mod\xE8le vers le "),Me=r("em"),ot=a("Hub"),xe=a(", nous aurons besoin de cr\xE9er un objet "),as=r("code"),it=a("Repository"),ks=a(" dans un dossier de travail. Tout d\u2019abord, connectez-vous au "),Ye=r("em"),Zs=a("Hub"),Xe=a(" si vous n\u2019\xEAtes pas d\xE9j\xE0 connect\xE9. Nous d\xE9terminerons le nom du d\xE9p\xF4t \xE0 partir de l\u2019identifiant du mod\xE8le que nous voulons donner \xE0 notre mod\xE8le (n\u2019h\xE9sitez pas \xE0 remplacer le "),ms=r("code"),Te=a("repo_name"),ut=a(" par votre propre choix, il doit juste contenir votre nom d\u2019utilisateur, ce que fait la fonction "),fs=r("code"),ns=a("get_full_repo_name()"),Ms=a(") :"),et=d(),E(Ve.$$.fragment),Ut=d(),E(ws.$$.fragment),Os=d(),Fs=r("p"),Ce=a("Ensuite, nous pouvons cloner ce d\xE9p\xF4t dans un dossier local. S\u2019il existe d\xE9j\xE0, ce dossier local doit \xEAtre un clone du d\xE9p\xF4t avec lequel nous travaillons :"),Et=d(),E(rs.$$.fragment),Ht=d(),hs=r("p"),we=a("Nous pouvons maintenant t\xE9l\xE9charger tout ce que nous sauvegardons dans "),jt=r("code"),kt=a("output_dir"),pt=a(" en appelant la m\xE9thode "),wt=r("code"),xt=a("repo.push_to_hub()"),zt=a(". Cela nous aidera \xE0 t\xE9l\xE9charger les mod\xE8les interm\xE9diaires \xE0 la fin de chaque \xE9poque."),It=d(),_s=r("h3"),zs=r("a"),vs=r("span"),E(Ge.$$.fragment),yt=d(),ys=r("span"),Pt=a("Boucle d'entra\xEEnement"),dt=d(),xs=r("p"),Ct=a("Nous sommes maintenant pr\xEAts \xE0 \xE9crire la boucle d\u2019entra\xEEnement compl\xE8te. Pour simplifier sa partie \xE9valuation, nous d\xE9finissons cette fonction "),We=r("code"),Bt=a("postprocess()"),Us=a(" qui prend les pr\xE9dictions et les \xE9tiquettes et les convertit en listes de cha\xEEnes de caract\xE8res que notre objet "),Dt=r("code"),Rt=a("metric"),Hs=a(" attend :"),Ps=d(),E(Se.$$.fragment),Cs=d(),ls=r("p"),st=a("La boucle d\u2019entra\xEEnement ressemble beaucoup \xE0 celles de la "),ct=r("a"),Tt=a("section 2"),Kt=a(" et du "),bs=r("a"),Xt=a("chapitre 3"),Vt=a(", avec quelques diff\xE9rences dans la partie \xE9valuation. Donc concentrons-nous sur cela !"),tt=d(),$s=r("p"),Ds=a("La premi\xE8re chose \xE0 noter est que nous utilisons la m\xE9thode "),Ts=r("code"),mt=a("generate()"),at=a(" pour calculer les pr\xE9dictions. C\u2019est une m\xE9thode sur notre mod\xE8le de base et non pas le mod\xE8le envelopp\xE9 cr\xE9\xE9 dans la m\xE9thode "),ft=r("code"),Ze=a("prepare()"),f=a(". C\u2019est pourquoi nous d\xE9ballons d\u2019abord le mod\xE8le, puis nous appelons cette m\xE9thode."),R=d(),gs=r("p"),Ca=a("La deuxi\xE8me chose est que, comme avec la classification de "),nt=r("a"),Gt=r("em"),Is=a("token"),Wt=a(", deux processus peuvent avoir rembourr\xE9s les entr\xE9es et les \xE9tiquettes \xE0 des formes diff\xE9rentes. Ainsi nous utilisons "),ht=r("code"),Da=a("accelerator.pad_across_processes()"),St=a(" pour rendre les pr\xE9dictions et les \xE9tiquettes de la m\xEAme forme avant d\u2019appeler la m\xE9thode "),Bs=r("code"),rt=a("gather()"),_t=a(". Si nous ne faisons pas cela, l\u2019\xE9valuation va soit se tromper, soit se bloquer pour toujours."),Qt=d(),E(qe.$$.fragment),da=d(),E(Rs.$$.fragment),ca=d(),Ss=r("p"),Jt=a("Une fois que c\u2019est fait, vous devriez avoir un mod\xE8le qui a des r\xE9sultats assez similaires \xE0 celui entra\xEEn\xE9 avec "),Yt=r("code"),Zt=a("Seq2SeqTrainer"),ma=a(". Vous pouvez v\xE9rifier celui que nous avons entra\xEEn\xE9 en utilisant ce code sur "),os=r("a"),At=r("em"),Lt=a("huggingface-course/marian-finetuned-kde4-en-to-fr-accelerate"),Ta=a(". Et si vous voulez tester des modifications de la boucle d\u2019entra\xEEnement, vous pouvez les mettre en \u0153uvre directement en modifiant le code ci-dessus !"),this.h()},l(m){u=l(m,"H2",{class:!0});var X=o(u);q=l(X,"A",{id:!0,class:!0,href:!0});var Nt=o(q);h=l(Nt,"SPAN",{});var is=o(h);j(x.$$.fragment,is),is.forEach(t),Nt.forEach(t),A=c(X),v=l(X,"SPAN",{});var bt=o(v);D=n(bt,"Une boucle d'entra\xEEnement personnalis\xE9e"),bt.forEach(t),X.forEach(t),S=c(m),z=l(m,"P",{});var Mt=o(z);P=n(Mt,"Jetons maintenant un coup d\u2019\u0153il \xE0 la boucle d\u2019entra\xEEnement compl\xE8te afin que vous puissiez facilement personnaliser les parties dont vous avez besoin. Elle ressemblera beaucoup \xE0 ce que nous avons fait dans la "),I=l(Mt,"A",{href:!0});var fa=o(I);C=n(fa,"section 2"),fa.forEach(t),y=n(Mt," et dans le "),K=l(Mt,"A",{href:!0});var Ya=o(K);U=n(Ya,"chapitre 3"),Ya.forEach(t),O=n(Mt,"."),Mt.forEach(t),Z=c(m),L=l(m,"H3",{class:!0});var ha=o(L);G=l(ha,"A",{id:!0,class:!0,href:!0});var Sa=o(G);J=l(Sa,"SPAN",{});var qs=o(J);j(B.$$.fragment,qs),qs.forEach(t),Sa.forEach(t),N=c(ha),se=l(ha,"SPAN",{});var Aa=o(se);T=n(Aa,"Pr\xE9parer le tout pour l'entra\xEEnement"),Aa.forEach(t),ha.forEach(t),F=c(m),Q=l(m,"P",{});var As=o(Q);W=n(As,"Vous avez vu tout cela plusieurs fois maintenant, donc nous allons passer en revue le code assez rapidement. D\u2019abord, nous allons construire le "),M=l(As,"CODE",{});var La=o(M);re=n(La,"DataLoader"),La.forEach(t),ae=n(As," \xE0 partir de nos jeux de donn\xE9es, apr\xE8s avoir configur\xE9 les jeux de donn\xE9es au format "),te=l(As,"CODE",{});var Ks=o(te);de=n(Ks,'"torch"'),Ks.forEach(t),ne=n(As," pour obtenir les tenseurs PyTorch :"),As.forEach(t),pe=c(m),j(ue.$$.fragment,m),ve=c(m),be=l(m,"P",{});var _a=o(be);$e=n(_a,"Ensuite, nous r\xE9instantifions notre mod\xE8le pour nous assurer que nous ne poursuivons pas le "),he=l(_a,"EM",{});var rn=o(he);Y=n(rn,"finetuning"),rn.forEach(t),ce=n(_a," pr\xE9c\xE9dent et que nous repartons du mod\xE8le pr\xE9-entra\xEEn\xE9 :"),_a.forEach(t),me=c(m),j(V.$$.fragment,m),Ae=c(m),ge=l(m,"P",{});var Or=o(ge);Qe=n(Or,"Nous aurons alors besoin d\u2019un optimiseur :"),Or.forEach(t),Ee=c(m),j(fe.$$.fragment,m),Le=c(m),le=l(m,"P",{});var ea=o(le);Oe=n(ea,"Une fois que nous avons tous ces objets, nous pouvons les envoyer \xE0 la m\xE9thode "),oe=l(ea,"CODE",{});var Dn=o(oe);ze=n(Dn,"accelerator.prepare()"),Dn.forEach(t),ye=n(ea,". Rappelez-vous que si vous voulez entra\xEEner sur des TPUs dans un "),De=l(ea,"EM",{});var Na=o(De);ds=n(Na,"notebook"),Na.forEach(t),Fe=n(ea," de Colab, vous devez d\xE9placer tout ce code dans une fonction d\u2019entra\xEEnement et ne devrait pas ex\xE9cuter une cellule qui instancie un "),ss=l(ea,"CODE",{});var Tn=o(ss);cs=n(Tn,"Accelerator"),Tn.forEach(t),ts=n(ea,"."),ea.forEach(t),Pe=c(m),j(Ue.$$.fragment,m),He=c(m),je=l(m,"P",{});var Xs=o(je);Qs=n(Xs,"Maintenant que nous avons envoy\xE9 notre "),Ie=l(Xs,"CODE",{});var Sn=o(Ie);Js=n(Sn,"train_dataloader"),Sn.forEach(t),Ys=n(Xs," \xE0 "),Je=l(Xs,"CODE",{});var Za=o(Je);Re=n(Za,"accelerator.prepare()"),Za.forEach(t),Ns=n(Xs,", nous pouvons utiliser sa longueur pour calculer le nombre d\u2019\xE9tapes d\u2019entra\xEEnement. Rappelez-vous que nous devrions toujours faire cela apr\xE8s avoir pr\xE9par\xE9 le chargeur de donn\xE9es car cette m\xE9thode va changer la longueur du "),Ne=l(Xs,"CODE",{});var Fr=o(Ne);g=n(Fr,"DataLoader"),Fr.forEach(t),ie=n(Xs,". Nous utilisons un programme lin\xE9aire classique du taux d\u2019apprentissage \xE0 0 :"),Xs.forEach(t),js=c(m),j(ke.$$.fragment,m),Be=c(m),_e=l(m,"P",{});var Ls=o(_e);Ke=n(Ls,"Enfin, pour pousser notre mod\xE8le vers le "),Me=l(Ls,"EM",{});var Ma=o(Me);ot=n(Ma,"Hub"),Ma.forEach(t),xe=n(Ls,", nous aurons besoin de cr\xE9er un objet "),as=l(Ls,"CODE",{});var An=o(as);it=n(An,"Repository"),An.forEach(t),ks=n(Ls," dans un dossier de travail. Tout d\u2019abord, connectez-vous au "),Ye=l(Ls,"EM",{});var Oa=o(Ye);Zs=n(Oa,"Hub"),Oa.forEach(t),Xe=n(Ls," si vous n\u2019\xEAtes pas d\xE9j\xE0 connect\xE9. Nous d\xE9terminerons le nom du d\xE9p\xF4t \xE0 partir de l\u2019identifiant du mod\xE8le que nous voulons donner \xE0 notre mod\xE8le (n\u2019h\xE9sitez pas \xE0 remplacer le "),ms=l(Ls,"CODE",{});var Ln=o(ms);Te=n(Ln,"repo_name"),Ln.forEach(t),ut=n(Ls," par votre propre choix, il doit juste contenir votre nom d\u2019utilisateur, ce que fait la fonction "),fs=l(Ls,"CODE",{});var Ot=o(fs);ns=n(Ot,"get_full_repo_name()"),Ot.forEach(t),Ms=n(Ls,") :"),Ls.forEach(t),et=c(m),j(Ve.$$.fragment,m),Ut=c(m),j(ws.$$.fragment,m),Os=c(m),Fs=l(m,"P",{});var Ur=o(Fs);Ce=n(Ur,"Ensuite, nous pouvons cloner ce d\xE9p\xF4t dans un dossier local. S\u2019il existe d\xE9j\xE0, ce dossier local doit \xEAtre un clone du d\xE9p\xF4t avec lequel nous travaillons :"),Ur.forEach(t),Et=c(m),j(rs.$$.fragment,m),Ht=c(m),hs=l(m,"P",{});var sa=o(hs);we=n(sa,"Nous pouvons maintenant t\xE9l\xE9charger tout ce que nous sauvegardons dans "),jt=l(sa,"CODE",{});var Hr=o(jt);kt=n(Hr,"output_dir"),Hr.forEach(t),pt=n(sa," en appelant la m\xE9thode "),wt=l(sa,"CODE",{});var Ir=o(wt);xt=n(Ir,"repo.push_to_hub()"),Ir.forEach(t),zt=n(sa,". Cela nous aidera \xE0 t\xE9l\xE9charger les mod\xE8les interm\xE9diaires \xE0 la fin de chaque \xE9poque."),sa.forEach(t),It=c(m),_s=l(m,"H3",{class:!0});var Fa=o(_s);zs=l(Fa,"A",{id:!0,class:!0,href:!0});var Br=o(zs);vs=l(Br,"SPAN",{});var Rr=o(vs);j(Ge.$$.fragment,Rr),Rr.forEach(t),Br.forEach(t),yt=c(Fa),ys=l(Fa,"SPAN",{});var Nn=o(ys);Pt=n(Nn,"Boucle d'entra\xEEnement"),Nn.forEach(t),Fa.forEach(t),dt=c(m),xs=l(m,"P",{});var $t=o(xs);Ct=n($t,"Nous sommes maintenant pr\xEAts \xE0 \xE9crire la boucle d\u2019entra\xEEnement compl\xE8te. Pour simplifier sa partie \xE9valuation, nous d\xE9finissons cette fonction "),We=l($t,"CODE",{});var Mn=o(We);Bt=n(Mn,"postprocess()"),Mn.forEach(t),Us=n($t," qui prend les pr\xE9dictions et les \xE9tiquettes et les convertit en listes de cha\xEEnes de caract\xE8res que notre objet "),Dt=l($t,"CODE",{});var va=o(Dt);Rt=n(va,"metric"),va.forEach(t),Hs=n($t," attend :"),$t.forEach(t),Ps=c(m),j(Se.$$.fragment,m),Cs=c(m),ls=l(m,"P",{});var ba=o(ls);st=n(ba,"La boucle d\u2019entra\xEEnement ressemble beaucoup \xE0 celles de la "),ct=l(ba,"A",{href:!0});var ta=o(ct);Tt=n(ta,"section 2"),ta.forEach(t),Kt=n(ba," et du "),bs=l(ba,"A",{href:!0});var $a=o(bs);Xt=n($a,"chapitre 3"),$a.forEach(t),Vt=n(ba,", avec quelques diff\xE9rences dans la partie \xE9valuation. Donc concentrons-nous sur cela !"),ba.forEach(t),tt=c(m),$s=l(m,"P",{});var aa=o($s);Ds=n(aa,"La premi\xE8re chose \xE0 noter est que nous utilisons la m\xE9thode "),Ts=l(aa,"CODE",{});var Ua=o(Ts);mt=n(Ua,"generate()"),Ua.forEach(t),at=n(aa," pour calculer les pr\xE9dictions. C\u2019est une m\xE9thode sur notre mod\xE8le de base et non pas le mod\xE8le envelopp\xE9 cr\xE9\xE9 dans la m\xE9thode "),ft=l(aa,"CODE",{});var Kr=o(ft);Ze=n(Kr,"prepare()"),Kr.forEach(t),f=n(aa,". C\u2019est pourquoi nous d\xE9ballons d\u2019abord le mod\xE8le, puis nous appelons cette m\xE9thode."),aa.forEach(t),R=c(m),gs=l(m,"P",{});var gt=o(gs);Ca=n(gt,"La deuxi\xE8me chose est que, comme avec la classification de "),nt=l(gt,"A",{href:!0});var Xr=o(nt);Gt=l(Xr,"EM",{});var On=o(Gt);Is=n(On,"token"),On.forEach(t),Xr.forEach(t),Wt=n(gt,", deux processus peuvent avoir rembourr\xE9s les entr\xE9es et les \xE9tiquettes \xE0 des formes diff\xE9rentes. Ainsi nous utilisons "),ht=l(gt,"CODE",{});var Ha=o(ht);Da=n(Ha,"accelerator.pad_across_processes()"),Ha.forEach(t),St=n(gt," pour rendre les pr\xE9dictions et les \xE9tiquettes de la m\xEAme forme avant d\u2019appeler la m\xE9thode "),Bs=l(gt,"CODE",{});var Fn=o(Bs);rt=n(Fn,"gather()"),Fn.forEach(t),_t=n(gt,". Si nous ne faisons pas cela, l\u2019\xE9valuation va soit se tromper, soit se bloquer pour toujours."),gt.forEach(t),Qt=c(m),j(qe.$$.fragment,m),da=c(m),j(Rs.$$.fragment,m),ca=c(m),Ss=l(m,"P",{});var es=o(Ss);Jt=n(es,"Une fois que c\u2019est fait, vous devriez avoir un mod\xE8le qui a des r\xE9sultats assez similaires \xE0 celui entra\xEEn\xE9 avec "),Yt=l(es,"CODE",{});var Vr=o(Yt);Zt=n(Vr,"Seq2SeqTrainer"),Vr.forEach(t),ma=n(es,". Vous pouvez v\xE9rifier celui que nous avons entra\xEEn\xE9 en utilisant ce code sur "),os=l(es,"A",{href:!0,rel:!0});var ln=o(os);At=l(ln,"EM",{});var Gr=o(At);Lt=n(Gr,"huggingface-course/marian-finetuned-kde4-en-to-fr-accelerate"),Gr.forEach(t),ln.forEach(t),Ta=n(es,". Et si vous voulez tester des modifications de la boucle d\u2019entra\xEEnement, vous pouvez les mettre en \u0153uvre directement en modifiant le code ci-dessus !"),es.forEach(t),this.h()},h(){_(q,"id","une-boucle-dentranement-personnalise"),_(q,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(q,"href","#une-boucle-dentranement-personnalise"),_(u,"class","relative group"),_(I,"href","/course/fr/chapter7/2"),_(K,"href","/course/fr/chapter3/4"),_(G,"id","prparer-le-tout-pour-lentranement"),_(G,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(G,"href","#prparer-le-tout-pour-lentranement"),_(L,"class","relative group"),_(zs,"id","boucle-dentranement"),_(zs,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(zs,"href","#boucle-dentranement"),_(_s,"class","relative group"),_(ct,"href","/course/fr/chapter7/2"),_(bs,"href","/course/fr/chapter3"),_(nt,"href","/course/fr/chapter7/2"),_(os,"href","https://huggingface.co/huggingface-course/marian-finetuned-kde4-en-to-fr-accelerate"),_(os,"rel","nofollow")},m(m,X){i(m,u,X),s(u,q),s(q,h),k(x,h,null),s(u,A),s(u,v),s(v,D),i(m,S,X),i(m,z,X),s(z,P),s(z,I),s(I,C),s(z,y),s(z,K),s(K,U),s(z,O),i(m,Z,X),i(m,L,X),s(L,G),s(G,J),k(B,J,null),s(L,N),s(L,se),s(se,T),i(m,F,X),i(m,Q,X),s(Q,W),s(Q,M),s(M,re),s(Q,ae),s(Q,te),s(te,de),s(Q,ne),i(m,pe,X),k(ue,m,X),i(m,ve,X),i(m,be,X),s(be,$e),s(be,he),s(he,Y),s(be,ce),i(m,me,X),k(V,m,X),i(m,Ae,X),i(m,ge,X),s(ge,Qe),i(m,Ee,X),k(fe,m,X),i(m,Le,X),i(m,le,X),s(le,Oe),s(le,oe),s(oe,ze),s(le,ye),s(le,De),s(De,ds),s(le,Fe),s(le,ss),s(ss,cs),s(le,ts),i(m,Pe,X),k(Ue,m,X),i(m,He,X),i(m,je,X),s(je,Qs),s(je,Ie),s(Ie,Js),s(je,Ys),s(je,Je),s(Je,Re),s(je,Ns),s(je,Ne),s(Ne,g),s(je,ie),i(m,js,X),k(ke,m,X),i(m,Be,X),i(m,_e,X),s(_e,Ke),s(_e,Me),s(Me,ot),s(_e,xe),s(_e,as),s(as,it),s(_e,ks),s(_e,Ye),s(Ye,Zs),s(_e,Xe),s(_e,ms),s(ms,Te),s(_e,ut),s(_e,fs),s(fs,ns),s(_e,Ms),i(m,et,X),k(Ve,m,X),i(m,Ut,X),k(ws,m,X),i(m,Os,X),i(m,Fs,X),s(Fs,Ce),i(m,Et,X),k(rs,m,X),i(m,Ht,X),i(m,hs,X),s(hs,we),s(hs,jt),s(jt,kt),s(hs,pt),s(hs,wt),s(wt,xt),s(hs,zt),i(m,It,X),i(m,_s,X),s(_s,zs),s(zs,vs),k(Ge,vs,null),s(_s,yt),s(_s,ys),s(ys,Pt),i(m,dt,X),i(m,xs,X),s(xs,Ct),s(xs,We),s(We,Bt),s(xs,Us),s(xs,Dt),s(Dt,Rt),s(xs,Hs),i(m,Ps,X),k(Se,m,X),i(m,Cs,X),i(m,ls,X),s(ls,st),s(ls,ct),s(ct,Tt),s(ls,Kt),s(ls,bs),s(bs,Xt),s(ls,Vt),i(m,tt,X),i(m,$s,X),s($s,Ds),s($s,Ts),s(Ts,mt),s($s,at),s($s,ft),s(ft,Ze),s($s,f),i(m,R,X),i(m,gs,X),s(gs,Ca),s(gs,nt),s(nt,Gt),s(Gt,Is),s(gs,Wt),s(gs,ht),s(ht,Da),s(gs,St),s(gs,Bs),s(Bs,rt),s(gs,_t),i(m,Qt,X),k(qe,m,X),i(m,da,X),k(Rs,m,X),i(m,ca,X),i(m,Ss,X),s(Ss,Jt),s(Ss,Yt),s(Yt,Zt),s(Ss,ma),s(Ss,os),s(os,At),s(At,Lt),s(Ss,Ta),vt=!0},i(m){vt||(b(x.$$.fragment,m),b(B.$$.fragment,m),b(ue.$$.fragment,m),b(V.$$.fragment,m),b(fe.$$.fragment,m),b(Ue.$$.fragment,m),b(ke.$$.fragment,m),b(Ve.$$.fragment,m),b(ws.$$.fragment,m),b(rs.$$.fragment,m),b(Ge.$$.fragment,m),b(Se.$$.fragment,m),b(qe.$$.fragment,m),b(Rs.$$.fragment,m),vt=!0)},o(m){$(x.$$.fragment,m),$(B.$$.fragment,m),$(ue.$$.fragment,m),$(V.$$.fragment,m),$(fe.$$.fragment,m),$(Ue.$$.fragment,m),$(ke.$$.fragment,m),$(Ve.$$.fragment,m),$(ws.$$.fragment,m),$(rs.$$.fragment,m),$(Ge.$$.fragment,m),$(Se.$$.fragment,m),$(qe.$$.fragment,m),$(Rs.$$.fragment,m),vt=!1},d(m){m&&t(u),w(x),m&&t(S),m&&t(z),m&&t(Z),m&&t(L),w(B),m&&t(F),m&&t(Q),m&&t(pe),w(ue,m),m&&t(ve),m&&t(be),m&&t(me),w(V,m),m&&t(Ae),m&&t(ge),m&&t(Ee),w(fe,m),m&&t(Le),m&&t(le),m&&t(Pe),w(Ue,m),m&&t(He),m&&t(je),m&&t(js),w(ke,m),m&&t(Be),m&&t(_e),m&&t(et),w(Ve,m),m&&t(Ut),w(ws,m),m&&t(Os),m&&t(Fs),m&&t(Et),w(rs,m),m&&t(Ht),m&&t(hs),m&&t(It),m&&t(_s),w(Ge),m&&t(dt),m&&t(xs),m&&t(Ps),w(Se,m),m&&t(Cs),m&&t(ls),m&&t(tt),m&&t($s),m&&t(R),m&&t(gs),m&&t(Qt),w(qe,m),m&&t(da),w(Rs,m),m&&t(ca),m&&t(Ss)}}}function Nh(ee){let u,q,h,x,A,v,D,S;return{c(){u=r("p"),q=a("\u270F\uFE0F "),h=r("strong"),x=a("A votre tour !"),A=a(" Que retourne le mod\xE8le sur l\u2019\xE9chantillon avec le mot \xAB "),v=r("em"),D=a("email"),S=a(" \xBB que vous avez identifi\xE9 plus t\xF4t ?")},l(z){u=l(z,"P",{});var P=o(u);q=n(P,"\u270F\uFE0F "),h=l(P,"STRONG",{});var I=o(h);x=n(I,"A votre tour !"),I.forEach(t),A=n(P," Que retourne le mod\xE8le sur l\u2019\xE9chantillon avec le mot \xAB "),v=l(P,"EM",{});var C=o(v);D=n(C,"email"),C.forEach(t),S=n(P," \xBB que vous avez identifi\xE9 plus t\xF4t ?"),P.forEach(t)},m(z,P){i(z,u,P),s(u,q),s(u,h),s(h,x),s(u,A),s(u,v),s(v,D),s(u,S)},d(z){z&&t(u)}}}function Mh(ee){let u,q,h,x,A,v,D,S,z,P,I,C,y,K,U,O,Z,L,G,J,B,N,se,T,F,Q,W,M,re,ae,te,de,ne,pe,ue,ve,be,$e,he,Y,ce,me,V,Ae,ge,Qe,Ee,fe,Le,le,Oe,oe,ze,ye,De,ds,Fe,ss,cs,ts,Pe,Ue,He,je,Qs,Ie,Js,Ys,Je,Re,Ns,Ne,g,ie,js,ke,Be,_e,Ke,Me,ot,xe,as,it,ks,Ye,Zs,Xe,ms,Te,ut,fs,ns,Ms,et,Ve,Ut,ws,Os,Fs,Ce,Et,rs,Ht,hs,we,jt,kt,pt,wt,xt,zt,It,_s,zs,vs,Ge,yt,ys,Pt,dt,xs,Ct,We,Bt,Us,Dt,Rt,Hs,Ps,Se,Cs,ls,st,ct,Tt,Kt,bs,Xt,Vt,tt,$s,Ds,Ts,mt,at,ft,Ze,f,R,gs,Ca,nt,Gt,Is,Wt,ht,Da,St,Bs,rt,_t,Qt,qe,da,Rs,ca,Ss,Jt,Yt,Zt,ma,os,At,Lt,Ta,vt,m,X,Nt,is,bt,Mt,fa,Ya,ha,Sa,qs,Aa,As,La,Ks,_a,rn,Or,ea,Dn,Na,Tn,Xs,Sn,Za,Fr,Ls,Ma,An,Oa,Ln,Ot,Ur,sa,Hr,Ir,Fa,Br,Rr,Nn,$t,Mn,va,ba,ta,$a,aa,Ua,Kr,gt,Xr,On,Ha,Fn,es,Vr,ln,Gr,zu,Cl,yu,Pu,Dl,Cu,Du,Un,Tu,Su,Io,Hn,Bo,na,Au,Tl,Lu,Nu,In,Sl,Mu,Ou,Al,Fu,Uu,Ro,on,Ko,Ia,Hu,Ll,Iu,Bu,Nl,Ru,Ku,Xo,un,Xu,Ml,Vu,Gu,Vo,Bn,Go,Ba,Wu,Ol,Qu,Ju,Fl,Yu,Zu,Wo,Ra,ep,Ul,sp,tp,Hl,ap,np,Qo,Wr,rp,Jo,Rn,Yo,pn,lp,Il,op,ip,Zo,Kn,ei,Xn,si,ra,up,Bl,pp,dp,Rl,cp,mp,Kl,fp,hp,ti,la,_p,Xl,vp,bp,Vl,$p,gp,Gl,qp,Ep,ai,Vn,ni,Qr,jp,ri,dn,li,cn,oi,Jr,kp,ii,Gn,ui,mn,wp,Wl,xp,zp,pi,ga,qa,Yr,Zr,yp,di,en,fn,Ql,Wn,Pp,Jl,Cp,ci,us,Dp,Yl,Tp,Sp,el,Ap,Lp,Zl,Np,Mp,eo,Op,Fp,so,Up,Hp,to,Ip,Bp,ao,Rp,Kp,mi,ps,Xp,Qn,no,Vp,Gp,ro,Wp,Qp,lo,Jp,Yp,oo,Zp,ed,io,sd,td,uo,ad,nd,po,rd,ld,fi,Ea,ja,sl,tl,od,hi,Jn,_i,Yn,vi,hn,id,co,ud,pd,bi,Zn,$i,er,gi,al,dd,qi,sr,Ei,tr,ji,nl,cd,ki,ar,wi,nr,xi,ka,wa,rl,sn,_n,mo,rr,md,fo,fd,zi,lr,yi,ll,Ka,hd,or,_d,vd,ir,bd,$d,Pi,oa,gd,ho,qd,Ed,ur,jd,kd,_o,wd,xd,Ci,pr,Di,Xa,zd,vo,yd,Pd,ol,Cd,Dd,Ti,dr,Si,il,Td,Ai,ul,Sd,Li,cr,Ni,mr,Mi,Vs,Ad,bo,Ld,Nd,fr,$o,Md,Od,go,Fd,Ud,qo,Hd,Id,hr,Bd,Rd,Oi,_r,Fi,vr,Ui,br,Hi,$r,Ii,pl,Kd,Bi,xa,za,dl,vn,Xd,Eo,Vd,Gd,Ri,tn,bn,jo,gr,Wd,cl,ko,Qd,Jd,Ki,Va,Yd,wo,Zd,ec,xo,sc,tc,Xi,qr,Vi,$n,ac,zo,nc,rc,Gi,gn,lc,yo,oc,ic,Wi,Er,Qi,ya,Pa,ml,fl,an,qn,Po,jr,uc,hl,pc,Co,dc,Ji,qt,cc,Do,mc,fc,To,hc,_c,So,vc,bc,Ao,$c,gc,Yi,kr,Zi,wr,eu,ia,qc,Lo,Ec,jc,No,kc,wc,Mo,xc,zc,su,xr,tu,zr,au,_l,yc,nu,En,ru;h=new _h({props:{fw:ee[0]}}),S=new Ft({});const Dc=[bh,vh],yr=[];function Tc(e,p){return e[0]==="pt"?0:1}y=Tc(ee),K=yr[y]=Dc[y](ee),ce=new xu({props:{id:"1JvfrvZgi6c"}}),Ve=new Ft({}),ys=new Ft({}),Ps=new H({props:{code:`from datasets import load_dataset

raw_datasets = load_dataset("kde4", lang1="en", lang2="fr")`,highlighted:`<span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset

raw_datasets = load_dataset(<span class="hljs-string">&quot;kde4&quot;</span>, lang1=<span class="hljs-string">&quot;en&quot;</span>, lang2=<span class="hljs-string">&quot;fr&quot;</span>)`}}),Ts=new H({props:{code:"raw_datasets",highlighted:"raw_datasets"}}),at=new H({props:{code:`DatasetDict({
    train: Dataset({
        features: ['id', 'translation'],
        num_rows: 210173
    })
})`,highlighted:`DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;translation&#x27;</span>],
        num_rows: <span class="hljs-number">210173</span>
    })
})`}}),Bs=new H({props:{code:`split_datasets = raw_datasets["train"].train_test_split(train_size=0.9, seed=20)
split_datasets`,highlighted:`split_datasets = raw_datasets[<span class="hljs-string">&quot;train&quot;</span>].train_test_split(train_size=<span class="hljs-number">0.9</span>, seed=<span class="hljs-number">20</span>)
split_datasets`}}),_t=new H({props:{code:`DatasetDict({
    train: Dataset({
        features: ['id', 'translation'],
        num_rows: 189155
    })
    test: Dataset({
        features: ['id', 'translation'],
        num_rows: 21018
    })
})`,highlighted:`DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;translation&#x27;</span>],
        num_rows: <span class="hljs-number">189155</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;translation&#x27;</span>],
        num_rows: <span class="hljs-number">21018</span>
    })
})`}}),os=new H({props:{code:'split_datasets["validation"] = split_datasets.pop("test")',highlighted:'split_datasets[<span class="hljs-string">&quot;validation&quot;</span>] = split_datasets.pop(<span class="hljs-string">&quot;test&quot;</span>)'}}),m=new H({props:{code:'split_datasets["train"][1]["translation"]',highlighted:'split_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&quot;translation&quot;</span>]'}}),Nt=new H({props:{code:`{'en': 'Default to expanded threads',
 'fr': 'Par d\xE9faut, d\xE9velopper les fils de discussion'}`,highlighted:`{<span class="hljs-string">&#x27;en&#x27;</span>: <span class="hljs-string">&#x27;Default to expanded threads&#x27;</span>,
 <span class="hljs-string">&#x27;fr&#x27;</span>: <span class="hljs-string">&#x27;Par d\xE9faut, d\xE9velopper les fils de discussion&#x27;</span>}`}}),qs=new H({props:{code:`from transformers import pipeline

model_checkpoint = "Helsinki-NLP/opus-mt-en-fr"
translator = pipeline("translation", model=model_checkpoint)
translator("Default to expanded threads")`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

model_checkpoint = <span class="hljs-string">&quot;Helsinki-NLP/opus-mt-en-fr&quot;</span>
translator = pipeline(<span class="hljs-string">&quot;translation&quot;</span>, model=model_checkpoint)
translator(<span class="hljs-string">&quot;Default to expanded threads&quot;</span>)`}}),As=new H({props:{code:"[{'translation_text': 'Par d\xE9faut pour les threads \xE9largis'}]",highlighted:'[{<span class="hljs-string">&#x27;translation_text&#x27;</span>: <span class="hljs-string">&#x27;Par d\xE9faut pour les threads \xE9largis&#x27;</span>}]'}}),Na=new H({props:{code:'split_datasets["train"][172]["translation"]',highlighted:'split_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">172</span>][<span class="hljs-string">&quot;translation&quot;</span>]'}}),Xs=new H({props:{code:`{'en': 'Unable to import %1 using the OFX importer plugin. This file is not the correct format.',
 'fr': "Impossible d'importer %1 en utilisant le module d'extension d'importation OFX. Ce fichier n'a pas un format correct."}`,highlighted:`{<span class="hljs-string">&#x27;en&#x27;</span>: <span class="hljs-string">&#x27;Unable to import %1 using the OFX importer plugin. This file is not the correct format.&#x27;</span>,
 <span class="hljs-string">&#x27;fr&#x27;</span>: <span class="hljs-string">&quot;Impossible d&#x27;importer %1 en utilisant le module d&#x27;extension d&#x27;importation OFX. Ce fichier n&#x27;a pas un format correct.&quot;</span>}`}}),Ma=new H({props:{code:`translator(
    "Unable to import %1 using the OFX importer plugin. This file is not the correct format."
)`,highlighted:`translator(
    <span class="hljs-string">&quot;Unable to import %1 using the OFX importer plugin. This file is not the correct format.&quot;</span>
)`}}),Oa=new H({props:{code:`[{'translation_text': "Impossible d'importer %1 en utilisant le plugin d'importateur OFX. Ce fichier n'est pas le bon format."}]`,highlighted:'[{<span class="hljs-string">&#x27;translation_text&#x27;</span>: <span class="hljs-string">&quot;Impossible d&#x27;importer %1 en utilisant le plugin d&#x27;importateur OFX. Ce fichier n&#x27;est pas le bon format.&quot;</span>}]'}}),$t=new xu({props:{id:"0Oxphw4Q9fo"}}),va=new Cn({props:{$$slots:{default:[$h]},$$scope:{ctx:ee}}}),Ua=new Ft({}),Ha=new xu({props:{id:"XAR8jnZZuUs"}}),Hn=new H({props:{code:`from transformers import AutoTokenizer

model_checkpoint = "Helsinki-NLP/opus-mt-en-fr"
tokenizer = AutoTokenizer.from_pretrained(model_checkpoint, return_tensors="tf")`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer

model_checkpoint = <span class="hljs-string">&quot;Helsinki-NLP/opus-mt-en-fr&quot;</span>
tokenizer = AutoTokenizer.from_pretrained(model_checkpoint, return_tensors=<span class="hljs-string">&quot;tf&quot;</span>)`}}),on=new Cn({props:{$$slots:{default:[gh]},$$scope:{ctx:ee}}}),Bn=new H({props:{code:`with open(file_path) as f:
    content = f.read()`,highlighted:`<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path) <span class="hljs-keyword">as</span> f:
    content = f.<span class="hljs-built_in">read</span>()`}}),Rn=new H({props:{code:`en_sentence = split_datasets["train"][1]["translation"]["en"]
fr_sentence = split_datasets["train"][1]["translation"]["fr"]

inputs = tokenizer(en_sentence)
with tokenizer.as_target_tokenizer():
    targets = tokenizer(fr_sentence)`,highlighted:`en_sentence = split_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&quot;translation&quot;</span>][<span class="hljs-string">&quot;en&quot;</span>]
fr_sentence = split_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&quot;translation&quot;</span>][<span class="hljs-string">&quot;fr&quot;</span>]

inputs = tokenizer(en_sentence)
<span class="hljs-keyword">with</span> tokenizer.as_target_tokenizer():
    targets = tokenizer(fr_sentence)`}}),Kn=new H({props:{code:`wrong_targets = tokenizer(fr_sentence)
print(tokenizer.convert_ids_to_tokens(wrong_targets["input_ids"]))
print(tokenizer.convert_ids_to_tokens(targets["input_ids"]))`,highlighted:`wrong_targets = tokenizer(fr_sentence)
<span class="hljs-built_in">print</span>(tokenizer.convert_ids_to_tokens(wrong_targets[<span class="hljs-string">&quot;input_ids&quot;</span>]))
<span class="hljs-built_in">print</span>(tokenizer.convert_ids_to_tokens(targets[<span class="hljs-string">&quot;input_ids&quot;</span>]))`}}),Xn=new H({props:{code:`['\u2581Par', '\u2581d\xE9', 'f', 'aut', ',', '\u2581d\xE9', 've', 'lop', 'per', '\u2581les', '\u2581fil', 's', '\u2581de', '\u2581discussion', '</s>']
['\u2581Par', '\u2581d\xE9faut', ',', '\u2581d\xE9velopper', '\u2581les', '\u2581fils', '\u2581de', '\u2581discussion', '</s>']`,highlighted:`[<span class="hljs-string">&#x27;\u2581Par&#x27;</span>, <span class="hljs-string">&#x27;\u2581d\xE9&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;aut&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;\u2581d\xE9&#x27;</span>, <span class="hljs-string">&#x27;ve&#x27;</span>, <span class="hljs-string">&#x27;lop&#x27;</span>, <span class="hljs-string">&#x27;per&#x27;</span>, <span class="hljs-string">&#x27;\u2581les&#x27;</span>, <span class="hljs-string">&#x27;\u2581fil&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;\u2581de&#x27;</span>, <span class="hljs-string">&#x27;\u2581discussion&#x27;</span>, <span class="hljs-string">&#x27;&lt;/s&gt;&#x27;</span>]
[<span class="hljs-string">&#x27;\u2581Par&#x27;</span>, <span class="hljs-string">&#x27;\u2581d\xE9faut&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;\u2581d\xE9velopper&#x27;</span>, <span class="hljs-string">&#x27;\u2581les&#x27;</span>, <span class="hljs-string">&#x27;\u2581fils&#x27;</span>, <span class="hljs-string">&#x27;\u2581de&#x27;</span>, <span class="hljs-string">&#x27;\u2581discussion&#x27;</span>, <span class="hljs-string">&#x27;&lt;/s&gt;&#x27;</span>]`}}),Vn=new H({props:{code:`max_input_length = 128
max_target_length = 128


def preprocess_function(examples):
    inputs = [ex["en"] for ex in examples["translation"]]
    targets = [ex["fr"] for ex in examples["translation"]]
    model_inputs = tokenizer(inputs, max_length=max_input_length, truncation=True)

    # Configurer le tokenizer pour les cibles.
    with tokenizer.as_target_tokenizer():
        labels = tokenizer(targets, max_length=max_target_length, truncation=True)

    model_inputs["labels"] = labels["input_ids"]
    return model_inputs`,highlighted:`max_input_length = <span class="hljs-number">128</span>
max_target_length = <span class="hljs-number">128</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess_function</span>(<span class="hljs-params">examples</span>):
    inputs = [ex[<span class="hljs-string">&quot;en&quot;</span>] <span class="hljs-keyword">for</span> ex <span class="hljs-keyword">in</span> examples[<span class="hljs-string">&quot;translation&quot;</span>]]
    targets = [ex[<span class="hljs-string">&quot;fr&quot;</span>] <span class="hljs-keyword">for</span> ex <span class="hljs-keyword">in</span> examples[<span class="hljs-string">&quot;translation&quot;</span>]]
    model_inputs = tokenizer(inputs, max_length=max_input_length, truncation=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># Configurer le tokenizer pour les cibles.</span>
    <span class="hljs-keyword">with</span> tokenizer.as_target_tokenizer():
        labels = tokenizer(targets, max_length=max_target_length, truncation=<span class="hljs-literal">True</span>)

    model_inputs[<span class="hljs-string">&quot;labels&quot;</span>] = labels[<span class="hljs-string">&quot;input_ids&quot;</span>]
    <span class="hljs-keyword">return</span> model_inputs`}}),dn=new Cn({props:{$$slots:{default:[qh]},$$scope:{ctx:ee}}}),cn=new Cn({props:{warning:!0,$$slots:{default:[Eh]},$$scope:{ctx:ee}}}),Gn=new H({props:{code:`tokenized_datasets = split_datasets.map(
    preprocess_function,
    batched=True,
    remove_columns=split_datasets["train"].column_names,
)`,highlighted:`tokenized_datasets = split_datasets.<span class="hljs-built_in">map</span>(
    preprocess_function,
    batched=<span class="hljs-literal">True</span>,
    remove_columns=split_datasets[<span class="hljs-string">&quot;train&quot;</span>].column_names,
)`}});const Sc=[kh,jh],Pr=[];function Ac(e,p){return e[0]==="pt"?0:1}ga=Ac(ee),qa=Pr[ga]=Sc[ga](ee),Wn=new Ft({});const Lc=[zh,xh],Cr=[];function Nc(e,p){return e[0]==="pt"?0:1}Ea=Nc(ee),ja=Cr[Ea]=Lc[Ea](ee),Jn=new H({props:{code:`batch = data_collator([tokenized_datasets["train"][i] for i in range(1, 3)])
batch.keys()`,highlighted:`batch = data_collator([tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>][i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)])
batch.keys()`}}),Yn=new H({props:{code:"dict_keys(['attention_mask', 'input_ids', 'labels', 'decoder_input_ids'])",highlighted:'dict_keys([<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;decoder_input_ids&#x27;</span>])'}}),Zn=new H({props:{code:'batch["labels"]',highlighted:'batch[<span class="hljs-string">&quot;labels&quot;</span>]'}}),er=new H({props:{code:`tensor([[  577,  5891,     2,  3184,    16,  2542,     5,  1710,     0,  -100,
          -100,  -100,  -100,  -100,  -100,  -100],
        [ 1211,     3,    49,  9409,  1211,     3, 29140,   817,  3124,   817,
           550,  7032,  5821,  7907, 12649,     0]])`,highlighted:`tensor([[  <span class="hljs-number">577</span>,  <span class="hljs-number">5891</span>,     <span class="hljs-number">2</span>,  <span class="hljs-number">3184</span>,    <span class="hljs-number">16</span>,  <span class="hljs-number">2542</span>,     <span class="hljs-number">5</span>,  <span class="hljs-number">1710</span>,     <span class="hljs-number">0</span>,  -<span class="hljs-number">100</span>,
          -<span class="hljs-number">100</span>,  -<span class="hljs-number">100</span>,  -<span class="hljs-number">100</span>,  -<span class="hljs-number">100</span>,  -<span class="hljs-number">100</span>,  -<span class="hljs-number">100</span>],
        [ <span class="hljs-number">1211</span>,     <span class="hljs-number">3</span>,    <span class="hljs-number">49</span>,  <span class="hljs-number">9409</span>,  <span class="hljs-number">1211</span>,     <span class="hljs-number">3</span>, <span class="hljs-number">29140</span>,   <span class="hljs-number">817</span>,  <span class="hljs-number">3124</span>,   <span class="hljs-number">817</span>,
           <span class="hljs-number">550</span>,  <span class="hljs-number">7032</span>,  <span class="hljs-number">5821</span>,  <span class="hljs-number">7907</span>, <span class="hljs-number">12649</span>,     <span class="hljs-number">0</span>]])`}}),sr=new H({props:{code:'batch["decoder_input_ids"]',highlighted:'batch[<span class="hljs-string">&quot;decoder_input_ids&quot;</span>]'}}),tr=new H({props:{code:`tensor([[59513,   577,  5891,     2,  3184,    16,  2542,     5,  1710,     0,
         59513, 59513, 59513, 59513, 59513, 59513],
        [59513,  1211,     3,    49,  9409,  1211,     3, 29140,   817,  3124,
           817,   550,  7032,  5821,  7907, 12649]])`,highlighted:`tensor([[<span class="hljs-number">59513</span>,   <span class="hljs-number">577</span>,  <span class="hljs-number">5891</span>,     <span class="hljs-number">2</span>,  <span class="hljs-number">3184</span>,    <span class="hljs-number">16</span>,  <span class="hljs-number">2542</span>,     <span class="hljs-number">5</span>,  <span class="hljs-number">1710</span>,     <span class="hljs-number">0</span>,
         <span class="hljs-number">59513</span>, <span class="hljs-number">59513</span>, <span class="hljs-number">59513</span>, <span class="hljs-number">59513</span>, <span class="hljs-number">59513</span>, <span class="hljs-number">59513</span>],
        [<span class="hljs-number">59513</span>,  <span class="hljs-number">1211</span>,     <span class="hljs-number">3</span>,    <span class="hljs-number">49</span>,  <span class="hljs-number">9409</span>,  <span class="hljs-number">1211</span>,     <span class="hljs-number">3</span>, <span class="hljs-number">29140</span>,   <span class="hljs-number">817</span>,  <span class="hljs-number">3124</span>,
           <span class="hljs-number">817</span>,   <span class="hljs-number">550</span>,  <span class="hljs-number">7032</span>,  <span class="hljs-number">5821</span>,  <span class="hljs-number">7907</span>, <span class="hljs-number">12649</span>]])`}}),ar=new H({props:{code:`for i in range(1, 3):
    print(tokenized_datasets["train"][i]["labels"])`,highlighted:`<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>):
    <span class="hljs-built_in">print</span>(tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>][i][<span class="hljs-string">&quot;labels&quot;</span>])`}}),nr=new H({props:{code:`[577, 5891, 2, 3184, 16, 2542, 5, 1710, 0]
[1211, 3, 49, 9409, 1211, 3, 29140, 817, 3124, 817, 550, 7032, 5821, 7907, 12649, 0]`,highlighted:`[<span class="hljs-number">577</span>, <span class="hljs-number">5891</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3184</span>, <span class="hljs-number">16</span>, <span class="hljs-number">2542</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1710</span>, <span class="hljs-number">0</span>]
[<span class="hljs-number">1211</span>, <span class="hljs-number">3</span>, <span class="hljs-number">49</span>, <span class="hljs-number">9409</span>, <span class="hljs-number">1211</span>, <span class="hljs-number">3</span>, <span class="hljs-number">29140</span>, <span class="hljs-number">817</span>, <span class="hljs-number">3124</span>, <span class="hljs-number">817</span>, <span class="hljs-number">550</span>, <span class="hljs-number">7032</span>, <span class="hljs-number">5821</span>, <span class="hljs-number">7907</span>, <span class="hljs-number">12649</span>, <span class="hljs-number">0</span>]`}});const Mc=[Ph,yh],Dr=[];function Oc(e,p){return e[0]==="pt"?0:1}ka=Oc(ee),wa=Dr[ka]=Mc[ka](ee),rr=new Ft({}),lr=new xu({props:{id:"M05L1DhFqcw"}});let lt=ee[0]==="pt"&&ih();pr=new H({props:{code:"!pip install sacrebleu",highlighted:"!pip install sacrebleu"}}),dr=new H({props:{code:`import evaluate

metric = evaluate.load("sacrebleu")`,highlighted:`<span class="hljs-keyword">import</span> evaluate

metric = evaluate.load(<span class="hljs-string">&quot;sacrebleu&quot;</span>)`}}),cr=new H({props:{code:`predictions = [
    "This plugin lets you translate web pages between several languages automatically."
]
references = [
    [
        "This plugin allows you to automatically translate web pages between several languages."
    ]
]
metric.compute(predictions=predictions, references=references)`,highlighted:`predictions = [
    <span class="hljs-string">&quot;This plugin lets you translate web pages between several languages automatically.&quot;</span>
]
references = [
    [
        <span class="hljs-string">&quot;This plugin allows you to automatically translate web pages between several languages.&quot;</span>
    ]
]
metric.compute(predictions=predictions, references=references)`}}),mr=new H({props:{code:`{'score': 46.750469682990165,
 'counts': [11, 6, 4, 3],
 'totals': [12, 11, 10, 9],
 'precisions': [91.67, 54.54, 40.0, 33.33],
 'bp': 0.9200444146293233,
 'sys_len': 12,
 'ref_len': 13}`,highlighted:`{<span class="hljs-string">&#x27;score&#x27;</span>: <span class="hljs-number">46.750469682990165</span>,
 <span class="hljs-string">&#x27;counts&#x27;</span>: [<span class="hljs-number">11</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>],
 <span class="hljs-string">&#x27;totals&#x27;</span>: [<span class="hljs-number">12</span>, <span class="hljs-number">11</span>, <span class="hljs-number">10</span>, <span class="hljs-number">9</span>],
 <span class="hljs-string">&#x27;precisions&#x27;</span>: [<span class="hljs-number">91.67</span>, <span class="hljs-number">54.54</span>, <span class="hljs-number">40.0</span>, <span class="hljs-number">33.33</span>],
 <span class="hljs-string">&#x27;bp&#x27;</span>: <span class="hljs-number">0.9200444146293233</span>,
 <span class="hljs-string">&#x27;sys_len&#x27;</span>: <span class="hljs-number">12</span>,
 <span class="hljs-string">&#x27;ref_len&#x27;</span>: <span class="hljs-number">13</span>}`}}),_r=new H({props:{code:`predictions = ["This This This This"]
references = [
    [
        "This plugin allows you to automatically translate web pages between several languages."
    ]
]
metric.compute(predictions=predictions, references=references)`,highlighted:`predictions = [<span class="hljs-string">&quot;This This This This&quot;</span>]
references = [
    [
        <span class="hljs-string">&quot;This plugin allows you to automatically translate web pages between several languages.&quot;</span>
    ]
]
metric.compute(predictions=predictions, references=references)`}}),vr=new H({props:{code:`{'score': 1.683602693167689,
 'counts': [1, 0, 0, 0],
 'totals': [4, 3, 2, 1],
 'precisions': [25.0, 16.67, 12.5, 12.5],
 'bp': 0.10539922456186433,
 'sys_len': 4,
 'ref_len': 13}`,highlighted:`{<span class="hljs-string">&#x27;score&#x27;</span>: <span class="hljs-number">1.683602693167689</span>,
 <span class="hljs-string">&#x27;counts&#x27;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
 <span class="hljs-string">&#x27;totals&#x27;</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>],
 <span class="hljs-string">&#x27;precisions&#x27;</span>: [<span class="hljs-number">25.0</span>, <span class="hljs-number">16.67</span>, <span class="hljs-number">12.5</span>, <span class="hljs-number">12.5</span>],
 <span class="hljs-string">&#x27;bp&#x27;</span>: <span class="hljs-number">0.10539922456186433</span>,
 <span class="hljs-string">&#x27;sys_len&#x27;</span>: <span class="hljs-number">4</span>,
 <span class="hljs-string">&#x27;ref_len&#x27;</span>: <span class="hljs-number">13</span>}`}}),br=new H({props:{code:`predictions = ["This plugin"]
references = [
    [
        "This plugin allows you to automatically translate web pages between several languages."
    ]
]
metric.compute(predictions=predictions, references=references)`,highlighted:`predictions = [<span class="hljs-string">&quot;This plugin&quot;</span>]
references = [
    [
        <span class="hljs-string">&quot;This plugin allows you to automatically translate web pages between several languages.&quot;</span>
    ]
]
metric.compute(predictions=predictions, references=references)`}}),$r=new H({props:{code:`{'score': 0.0,
 'counts': [2, 1, 0, 0],
 'totals': [2, 1, 0, 0],
 'precisions': [100.0, 100.0, 0.0, 0.0],
 'bp': 0.004086771438464067,
 'sys_len': 2,
 'ref_len': 13}`,highlighted:`{<span class="hljs-string">&#x27;score&#x27;</span>: <span class="hljs-number">0.0</span>,
 <span class="hljs-string">&#x27;counts&#x27;</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
 <span class="hljs-string">&#x27;totals&#x27;</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
 <span class="hljs-string">&#x27;precisions&#x27;</span>: [<span class="hljs-number">100.0</span>, <span class="hljs-number">100.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],
 <span class="hljs-string">&#x27;bp&#x27;</span>: <span class="hljs-number">0.004086771438464067</span>,
 <span class="hljs-string">&#x27;sys_len&#x27;</span>: <span class="hljs-number">2</span>,
 <span class="hljs-string">&#x27;ref_len&#x27;</span>: <span class="hljs-number">13</span>}`}});const Fc=[Dh,Ch],Tr=[];function Uc(e,p){return e[0]==="tf"?0:1}xa=Uc(ee),za=Tr[xa]=Fc[xa](ee),gr=new Ft({}),qr=new H({props:{code:`from huggingface_hub import notebook_login

notebook_login()`,highlighted:`<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> notebook_login

notebook_login()`}}),Er=new H({props:{code:"huggingface-cli login",highlighted:"huggingface-cli login"}});const Hc=[Sh,Th],Sr=[];function Ic(e,p){return e[0]==="tf"?0:1}ya=Ic(ee),Pa=Sr[ya]=Hc[ya](ee);let Es=ee[0]==="pt"&&uh();return jr=new Ft({}),kr=new H({props:{code:`from transformers import pipeline

# Remplacez ceci par votre propre checkpoint
model_checkpoint = "huggingface-course/marian-finetuned-kde4-en-to-fr"
translator = pipeline("translation", model=model_checkpoint)
translator("Default to expanded threads")`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

<span class="hljs-comment"># Remplacez ceci par votre propre checkpoint</span>
model_checkpoint = <span class="hljs-string">&quot;huggingface-course/marian-finetuned-kde4-en-to-fr&quot;</span>
translator = pipeline(<span class="hljs-string">&quot;translation&quot;</span>, model=model_checkpoint)
translator(<span class="hljs-string">&quot;Default to expanded threads&quot;</span>)`}}),wr=new H({props:{code:"[{'translation_text': 'Par d\xE9faut, d\xE9velopper les fils de discussion'}]",highlighted:'[{<span class="hljs-string">&#x27;translation_text&#x27;</span>: <span class="hljs-string">&#x27;Par d\xE9faut, d\xE9velopper les fils de discussion&#x27;</span>}]'}}),xr=new H({props:{code:`translator(
    "Unable to import %1 using the OFX importer plugin. This file is not the correct format."
)`,highlighted:`translator(
    <span class="hljs-string">&quot;Unable to import %1 using the OFX importer plugin. This file is not the correct format.&quot;</span>
)`}}),zr=new H({props:{code:`[{'translation_text': "Impossible d'importer %1 en utilisant le module externe d'importation OFX. Ce fichier n'est pas le bon format."}]`,highlighted:'[{<span class="hljs-string">&#x27;translation_text&#x27;</span>: <span class="hljs-string">&quot;Impossible d&#x27;importer %1 en utilisant le module externe d&#x27;importation OFX. Ce fichier n&#x27;est pas le bon format.&quot;</span>}]'}}),En=new Cn({props:{$$slots:{default:[Nh]},$$scope:{ctx:ee}}}),{c(){u=r("meta"),q=d(),E(h.$$.fragment),x=d(),A=r("h1"),v=r("a"),D=r("span"),E(S.$$.fragment),z=d(),P=r("span"),I=a("Traduction"),C=d(),K.c(),U=d(),O=r("p"),Z=a("Plongeons maintenant dans la traduction. Il s\u2019agit d\u2019une autre "),L=r("a"),G=a("t\xE2che de s\xE9quence \xE0 s\xE9quence"),J=a(", ce qui signifie que c\u2019est un probl\xE8me qui peut \xEAtre formul\xE9 comme le passage d\u2019une s\xE9quence \xE0 une autre. En ce sens, le probl\xE8me est assez proche de la t\xE2che de "),B=r("a"),N=a("r\xE9sum\xE9"),se=a(" et vous pouvez adapter ce que nous allons voir ici \xE0 d\u2019autres probl\xE8mes de s\xE9quence \xE0 s\xE9quence tels que :"),T=d(),F=r("ul"),Q=r("li"),W=a("Le "),M=r("strong"),re=a("transfert de style"),ae=a(" ? c\u2019est-\xE0-dire cr\xE9er un mod\xE8le qui "),te=r("em"),de=a("traduit"),ne=a(" des textes \xE9crits dans un certain style vers un autre (par exemple, du formel au d\xE9contract\xE9 ou de l\u2019anglais shakespearien \xE0 l\u2019anglais moderne)."),pe=d(),ue=r("li"),ve=a("La "),be=r("strong"),$e=a("g\xE9n\xE9ration de r\xE9ponse \xE0 des questions"),he=a(" c\u2019est-\xE0-dire cr\xE9er un mod\xE8le qui g\xE9n\xE8re des r\xE9ponses \xE0 des questions compte tenu d\u2019un contexte."),Y=d(),E(ce.$$.fragment),me=d(),V=r("p"),Ae=a("Si vous disposez d\u2019un corpus de textes suffisamment important en deux langues diff\xE9rentes (ou plus), vous pouvez entra\xEEner un nouveau mod\xE8le de traduction \xE0 partir de z\xE9ro, comme nous le ferons dans la section sur la "),ge=r("a"),Qe=a("mod\xE9lisation causale du langage"),Ee=a(". Il est toutefois plus rapide de "),fe=r("em"),Le=a("finetuner"),le=a(" un mod\xE8le de traduction existant, qu\u2019il s\u2019agisse d\u2019un mod\xE8le multilingue comme mT5 ou mBART que vous souhaitez adapter \xE0 une paire de langues sp\xE9cifique, ou m\xEAme d\u2019un mod\xE8le sp\xE9cialis\xE9 dans la traduction d\u2019une langue vers une autre que vous souhaitez adapter \xE0 votre corpus sp\xE9cifique."),Oe=d(),oe=r("p"),ze=a("Dans cette section, nous allons "),ye=r("em"),De=a("finetuner"),ds=a(" un mod\xE8le Marian pr\xE9-entra\xEEn\xE9 pour traduire de l\u2019anglais au fran\xE7ais (puisque de nombreux employ\xE9s de Hugging Face parlent ces deux langues) sur le jeu de donn\xE9es "),Fe=r("a"),ss=a("KDE4"),cs=a(" qui est un jeu de donn\xE9es de fichiers localis\xE9s pour les applications "),ts=r("a"),Pe=a("KDE"),Ue=a(". Le mod\xE8le que nous utiliserons a \xE9t\xE9 pr\xE9-entra\xEEn\xE9 sur un large corpus de textes fran\xE7ais et anglais provenant du jeu de donn\xE9es "),He=r("a"),je=a("Opus"),Qs=a(" qui contient en fait le jeu de donn\xE9es KDE4. A noter que m\xEAme si le mod\xE8le pr\xE9-entra\xEEn\xE9 que nous utilisons a vu ces donn\xE9es pendant son pr\xE9-entra\xEEnement, nous verrons que nous pouvons obtenir une meilleure version de ce mod\xE8le apr\xE8s un "),Ie=r("em"),Js=a("finetuning"),Ys=a("."),Je=d(),Re=r("p"),Ns=a("Une fois que nous aurons termin\xE9, nous aurons un mod\xE8le capable de faire des pr\xE9dictions comme celle-ci :"),Ne=d(),g=r("iframe"),js=d(),ke=r("iframe"),_e=d(),Ke=r("a"),Me=r("img"),xe=d(),as=r("img"),ks=d(),Ye=r("p"),Zs=a("Comme dans les sections pr\xE9c\xE9dentes, vous pouvez trouver, t\xE9l\xE9charger et v\xE9rifier les pr\xE9cisions de ce mod\xE8le sur le "),Xe=r("a"),ms=r("em"),Te=a("Hub"),ut=a("."),fs=d(),ns=r("h2"),Ms=r("a"),et=r("span"),E(Ve.$$.fragment),Ut=d(),ws=r("span"),Os=a("Pr\xE9paration des donn\xE9es"),Fs=d(),Ce=r("p"),Et=a("Pour "),rs=r("em"),Ht=a("finetuner"),hs=a(" ou entra\xEEner un mod\xE8le de traduction \xE0 partir de z\xE9ro, nous avons besoin d\u2019un jeu de donn\xE9es adapt\xE9 \xE0 cette t\xE2che. Comme mentionn\xE9 pr\xE9c\xE9demment, nous utiliserons le jeu de donn\xE9es "),we=r("a"),jt=a("KDE4"),kt=a(" dans cette section. Notez que vous pouvez adapter assez facilement le code pour utiliser vos propres donn\xE9es du moment que vous disposez de paires de phrases dans les deux langues que vous voulez traduire. Reportez-vous au "),pt=r("a"),wt=a("chapitre 5"),xt=a(" si vous avez besoin d\u2019un rappel sur la fa\xE7on de charger vos donn\xE9es personnalis\xE9es dans un "),zt=r("code"),It=a("Dataset"),_s=a("."),zs=d(),vs=r("h3"),Ge=r("a"),yt=r("span"),E(ys.$$.fragment),Pt=d(),dt=r("span"),xs=a("Le jeu de donn\xE9es KDE4"),Ct=d(),We=r("p"),Bt=a("Comme d\u2019habitude, nous t\xE9l\xE9chargeons notre jeu de donn\xE9es en utilisant la fonction "),Us=r("code"),Dt=a("load_dataset()"),Rt=a(" :"),Hs=d(),E(Ps.$$.fragment),Se=d(),Cs=r("p"),ls=a("Si vous souhaitez travailler avec une autre paire de langues, 92 langues sont disponibles au total pour ce jeu de donn\xE9es. Vous pouvez les voir dans la "),st=r("a"),ct=a("carte du jeu de donn\xE9es"),Tt=a("."),Kt=d(),bs=r("img"),Vt=d(),tt=r("p"),$s=a("Jetons un coup d\u2019\u0153il au jeu de donn\xE9es :"),Ds=d(),E(Ts.$$.fragment),mt=d(),E(at.$$.fragment),ft=d(),Ze=r("p"),f=a("Nous avons 210 173 paires de phrases. Cependant regroup\xE9es dans un seul \xE9chantillon. Nous devrons donc cr\xE9er notre propre jeu de validation. Comme nous l\u2019avons vu dans le "),R=r("a"),gs=a("chapitre 5"),Ca=a(", un "),nt=r("code"),Gt=a("Dataset"),Is=a(" poss\xE8de une m\xE9thode "),Wt=r("code"),ht=a("train_test_split()"),Da=a(" qui peut nous aider. Nous allons fournir une graine pour la reproductibilit\xE9 :"),St=d(),E(Bs.$$.fragment),rt=d(),E(_t.$$.fragment),Qt=d(),qe=r("p"),da=a("Nous pouvons renommer la cl\xE9 "),Rs=r("code"),ca=a("test"),Ss=a(" en "),Jt=r("code"),Yt=a("validation"),Zt=a(" comme ceci :"),ma=d(),E(os.$$.fragment),At=d(),Lt=r("p"),Ta=a("Examinons maintenant un \xE9l\xE9ment de ce jeu de donn\xE9es :"),vt=d(),E(m.$$.fragment),X=d(),E(Nt.$$.fragment),is=d(),bt=r("p"),Mt=a(`Nous obtenons un dictionnaire contenant deux phrases dans la paire de langues qui nous int\xE9resse.
Une particularit\xE9 de ce jeu de donn\xE9es rempli de termes techniques informatiques est qu\u2019ils sont tous enti\xE8rement traduits en fran\xE7ais. Cependant, les ing\xE9nieurs fran\xE7ais sont souvent paresseux et laissent la plupart des mots sp\xE9cifiques \xE0 l\u2019informatique en anglais lorsqu\u2019ils parlent. Ici, par exemple, le mot \xAB `),fa=r("em"),Ya=a("threads"),ha=a(" \xBB pourrait tr\xE8s bien appara\xEEtre dans une phrase fran\xE7aise, surtout dans une conversation technique. Mais dans ce jeu de donn\xE9es, il a \xE9t\xE9 traduit en \xAB fils de discussion \xBB. Le mod\xE8le pr\xE9-entra\xEEn\xE9 que nous utilisons (qui a \xE9t\xE9 pr\xE9-entra\xEEn\xE9 sur un plus grand corpus de phrases fran\xE7aises et anglaises) prend l\u2019option de laisser le mot tel quel :"),Sa=d(),E(qs.$$.fragment),Aa=d(),E(As.$$.fragment),La=d(),Ks=r("p"),_a=a("Un autre exemple de ce comportement peut \xEAtre observ\xE9 avec le mot  \xAB "),rn=r("em"),Or=a("plugin"),ea=a(` \xBB qui n\u2019est pas officiellement un mot fran\xE7ais mais que la plupart des francophones comprendront et ne prendront pas la peine de traduire.
Dans le jeu de donn\xE9es KDE4, ce mot a \xE9t\xE9 traduit en fran\xE7ais par le plus officiel \xAB module d\u2019extension \xBB :`),Dn=d(),E(Na.$$.fragment),Tn=d(),E(Xs.$$.fragment),Sn=d(),Za=r("p"),Fr=a("Notre mod\xE8le pr\xE9-entra\xEEn\xE9, lui, s\u2019en tient au mot anglais :"),Ls=d(),E(Ma.$$.fragment),An=d(),E(Oa.$$.fragment),Ln=d(),Ot=r("p"),Ur=a("Il sera int\xE9ressant de voir si notre mod\xE8le "),sa=r("em"),Hr=a("finetun\xE9"),Ir=a(" tient compte de ces particularit\xE9s (alerte "),Fa=r("em"),Br=a("spoiler"),Rr=a(" : il le fera)."),Nn=d(),E($t.$$.fragment),Mn=d(),E(va.$$.fragment),ba=d(),ta=r("h3"),$a=r("a"),aa=r("span"),E(Ua.$$.fragment),Kr=d(),gt=r("span"),Xr=a("Traitement des donn\xE9es"),On=d(),E(Ha.$$.fragment),Fn=d(),es=r("p"),Vr=a("Vous devriez maintenant conna\xEEtre le principe : les textes doivent tous \xEAtre convertis en ensembles d\u2019ID de "),ln=r("em"),Gr=a("tokens"),zu=a(" pour que le mod\xE8le puisse leur donner un sens. Pour cette t\xE2che, nous aurons besoin de tokeniser les entr\xE9es et les cibles. Notre premi\xE8re t\xE2che est de cr\xE9er notre objet "),Cl=r("code"),yu=a("tokenizer"),Pu=a(". Comme indiqu\xE9 pr\xE9c\xE9demment, nous utiliserons un mod\xE8le pr\xE9-entra\xEEn\xE9 Marian English to French. Si vous essayez ce code avec une autre paire de langues, assurez-vous d\u2019adapter le "),Dl=r("em"),Cu=a("checkpoint"),Du=a(" du mod\xE8le. L\u2019organisation "),Un=r("a"),Tu=a("Helsinki-NLP"),Su=a(" fournit plus de mille mod\xE8les dans plusieurs langues."),Io=d(),E(Hn.$$.fragment),Bo=d(),na=r("p"),Au=a("Vous pouvez remplacer le "),Tl=r("code"),Lu=a("model_checkpoint"),Nu=a(" par un tout autre mod\xE8le disponible sur le "),In=r("a"),Sl=r("em"),Mu=a("Hub"),Ou=a(" qui aurait votre pr\xE9f\xE9rence, ou par un dossier en local o\xF9 vous avez sauvegard\xE9 un mod\xE8le pr\xE9-entra\xEEn\xE9 et un "),Al=r("em"),Fu=a("tokenizer"),Uu=a("."),Ro=d(),E(on.$$.fragment),Ko=d(),Ia=r("p"),Hu=a("La pr\xE9paration de nos donn\xE9es est assez simple. Il y a juste une chose \xE0 retenir : vous traitez les entr\xE9es comme d\u2019habitude, mais pour les cibles, vous devez envelopper le "),Ll=r("em"),Iu=a("tokenizer"),Bu=a(" dans le gestionnaire de contexte "),Nl=r("code"),Ru=a("as_target_tokenizer()"),Ku=a("."),Xo=d(),un=r("p"),Xu=a("Un gestionnaire de contexte en Python est introduit avec l\u2019instruction "),Ml=r("code"),Vu=a("with"),Gu=a(" et est utile lorsque vous avez deux op\xE9rations li\xE9es \xE0 ex\xE9cuter en paire. L\u2019exemple le plus courant est lorsque vous \xE9crivez ou lisez un fichier, ce qui est souvent fait dans une instruction comme :"),Vo=d(),E(Bn.$$.fragment),Go=d(),Ba=r("p"),Wu=a("Ici, les deux op\xE9rations connexes qui sont ex\xE9cut\xE9es en paire sont les actions d\u2019ouverture et de fermeture du fichier. L\u2019objet correspondant au fichier ouvert "),Ol=r("code"),Qu=a("f"),Ju=a(" n\u2019existe qu\u2019\xE0 l\u2019int\xE9rieur du bloc indent\xE9 sous le "),Fl=r("code"),Yu=a("with"),Zu=a(". L\u2019ouverture se produit avant ce bloc et la fermeture \xE0 la fin du bloc."),Wo=d(),Ra=r("p"),ep=a("Dans le cas pr\xE9sent, le gestionnaire de contexte "),Ul=r("code"),sp=a("as_target_tokenizer()"),tp=a(" va d\xE9finir le "),Hl=r("em"),ap=a("tokenizer"),np=a(" dans la langue de sortie (ici, le fran\xE7ais) avant l\u2019ex\xE9cution du bloc indent\xE9, puis le red\xE9finir dans la langue d\u2019entr\xE9e (ici, l\u2019anglais)."),Qo=d(),Wr=r("p"),rp=a("Ainsi, le pr\xE9traitement d\u2019un \xE9chantillon ressemble \xE0 ceci :"),Jo=d(),E(Rn.$$.fragment),Yo=d(),pn=r("p"),lp=a("Si nous oublions de tokeniser les cibles dans le gestionnaire de contexte, elles seront tokenis\xE9es par le "),Il=r("em"),op=a("tokenizer"),ip=a(" d\u2019entr\xE9e, ce qui dans le cas d\u2019un mod\xE8le Marian, ne va pas du tout bien se passer :"),Zo=d(),E(Kn.$$.fragment),ei=d(),E(Xn.$$.fragment),si=d(),ra=r("p"),up=a("Comme on peut le voir, utiliser le "),Bl=r("em"),pp=a("tokenizer"),dp=a(" anglais pour pr\xE9traiter une phrase fran\xE7aise donne un batch de "),Rl=r("em"),cp=a("tokens"),mp=a(" plus important, puisque le "),Kl=r("em"),fp=a("tokenizer"),hp=a(" ne conna\xEEt aucun mot fran\xE7ais (sauf ceux qui apparaissent aussi en anglais, comme \xAB discussion \xBB)."),ti=d(),la=r("p"),_p=a("Les "),Xl=r("code"),vp=a("inputs"),bp=a(" et les "),Vl=r("code"),$p=a("targets"),gp=a(" sont des dictionnaires avec nos cl\xE9s habituelles (identifiants d\u2019entr\xE9e, masque d\u2019attention, etc.). La derni\xE8re \xE9tape est de d\xE9finir une cl\xE9 "),Gl=r("code"),qp=a('"labels"'),Ep=a(" dans les entr\xE9es. Nous faisons cela dans la fonction de pr\xE9traitement que nous allons appliquer sur les jeux de donn\xE9es :"),ai=d(),E(Vn.$$.fragment),ni=d(),Qr=r("p"),jp=a("Notez que nous avons fix\xE9 des longueurs maximales similaires pour nos entr\xE9es et nos sorties. Comme les textes que nous traitons semblent assez courts, nous utilisons 128."),ri=d(),E(dn.$$.fragment),li=d(),E(cn.$$.fragment),oi=d(),Jr=r("p"),kp=a("Nous pouvons maintenant appliquer ce pr\xE9traitement en une seule fois sur toutes les \xE9chantillons de notre jeu de donn\xE9es :"),ii=d(),E(Gn.$$.fragment),ui=d(),mn=r("p"),wp=a("Maintenant que les donn\xE9es ont \xE9t\xE9 pr\xE9trait\xE9es, nous sommes pr\xEAts \xE0 "),Wl=r("em"),xp=a("finetuner"),zp=a(" notre mod\xE8le pr\xE9-entra\xEEn\xE9 !"),pi=d(),qa.c(),Yr=d(),Zr=r("p"),yp=a("Notez que cette fois-ci, nous utilisons un mod\xE8le qui a \xE9t\xE9 entra\xEEn\xE9 sur une t\xE2che de traduction et qui peut d\xE9j\xE0 \xEAtre utilis\xE9, donc il n\u2019y a pas d\u2019avertissement concernant les poids manquants ou ceux nouvellement initialis\xE9s."),di=d(),en=r("h3"),fn=r("a"),Ql=r("span"),E(Wn.$$.fragment),Pp=d(),Jl=r("span"),Cp=a("Assemblage des donn\xE9es"),ci=d(),us=r("p"),Dp=a("Nous aurons besoin d\u2019un assembleur de donn\xE9es pour g\xE9rer le rembourrage pour la mise en batchs dynamique. Ici, nous ne pouvons pas simplement utiliser un "),Yl=r("code"),Tp=a("DataCollatorWithPadding"),Sp=a(" comme dans le "),el=r("a"),Ap=a("chapitre 3"),Lp=a(" car cela ne rembourre que les entr\xE9es (identifiants d\u2019entr\xE9e, masque d\u2019attention, et "),Zl=r("em"),Np=a("token"),Mp=a(" de type identifiants). Nos \xE9tiquettes doivent \xE9galement \xEAtre rembourr\xE9es \xE0 la longueur maximale rencontr\xE9e dans les \xE9tiquettes. Et, comme mentionn\xE9 pr\xE9c\xE9demment, la valeur de remplissage utilis\xE9e pour remplir les \xE9tiquettes doit \xEAtre "),eo=r("code"),Op=a("-100"),Fp=a(" et non le "),so=r("em"),Up=a("token"),Hp=a(" de "),to=r("em"),Ip=a("padding"),Bp=a(" du "),ao=r("em"),Rp=a("tokenizer"),Kp=a(" afin de s\u2019assurer que ces valeurs soient ignor\xE9es dans le calcul de la perte."),mi=d(),ps=r("p"),Xp=a("Tout ceci est r\xE9alis\xE9 par un "),Qn=r("a"),no=r("code"),Vp=a("DataCollatorForSeq2Seq"),Gp=a(". Comme le "),ro=r("code"),Wp=a("DataCollatorWithPadding"),Qp=a(", il prend le "),lo=r("code"),Jp=a("tokenizer"),Yp=a(" utilis\xE9 pour pr\xE9traiter les entr\xE9es, mais \xE9galement le "),oo=r("code"),Zp=a("model"),ed=a(". C\u2019est parce que cet assembleur de donn\xE9es est \xE9galement responsable de la pr\xE9paration des identifiants d\u2019entr\xE9e du d\xE9codeur, qui sont des versions d\xE9cal\xE9es des \xE9tiquettes avec un "),io=r("em"),sd=a("token"),td=a(" sp\xE9cial au d\xE9but. Comme ce d\xE9calage est effectu\xE9 de mani\xE8re l\xE9g\xE8rement diff\xE9rente selon les architectures, le "),uo=r("code"),ad=a("DataCollatorForSeq2Seq"),nd=a(" a besoin de conna\xEEtre l\u2019objet "),po=r("code"),rd=a("model"),ld=a(" :"),fi=d(),ja.c(),sl=d(),tl=r("p"),od=a("Pour le tester sur quelques \xE9chantillons, nous l\u2019appelons simplement sur une liste d\u2019exemples de notre \xE9chantillon d\u2019entrainement tok\xE9nis\xE9 :"),hi=d(),E(Jn.$$.fragment),_i=d(),E(Yn.$$.fragment),vi=d(),hn=r("p"),id=a("Nous pouvons v\xE9rifier que nos \xE9tiquettes ont \xE9t\xE9 rembourr\xE9es \xE0 la longueur maximale du batch, en utilisant "),co=r("code"),ud=a("-100"),pd=a(" :"),bi=d(),E(Zn.$$.fragment),$i=d(),E(er.$$.fragment),gi=d(),al=r("p"),dd=a("Nous pouvons aussi jeter un coup d\u2019\u0153il aux identifiants d\u2019entr\xE9e du d\xE9codeur, pour voir qu\u2019il s\u2019agit de versions d\xE9cal\xE9es des \xE9tiquettes :"),qi=d(),E(sr.$$.fragment),Ei=d(),E(tr.$$.fragment),ji=d(),nl=r("p"),cd=a("Voici les \xE9tiquettes des premier et deuxi\xE8me \xE9l\xE9ments de notre jeu de donn\xE9es :"),ki=d(),E(ar.$$.fragment),wi=d(),E(nr.$$.fragment),xi=d(),wa.c(),rl=d(),sn=r("h3"),_n=r("a"),mo=r("span"),E(rr.$$.fragment),md=d(),fo=r("span"),fd=a("M\xE9triques"),zi=d(),E(lr.$$.fragment),yi=d(),lt&&lt.c(),ll=d(),Ka=r("p"),hd=a("La m\xE9trique traditionnelle utilis\xE9e pour la traduction est le "),or=r("a"),_d=a("score BLEU"),vd=a(", introduit dans "),ir=r("a"),bd=a("un article de 2002"),$d=a(" par Kishore Papineni et al. Le score BLEU \xE9value dans quelle mesure les traductions sont proches de leurs \xE9tiquettes. Il ne mesure pas l\u2019intelligibilit\xE9 ou l\u2019exactitude grammaticale des r\xE9sultats g\xE9n\xE9r\xE9s par le mod\xE8le, mais utilise des r\xE8gles statistiques pour garantir que tous les mots des r\xE9sultats g\xE9n\xE9r\xE9s apparaissent \xE9galement dans les cibles. En outre, il existe des r\xE8gles qui p\xE9nalisent les r\xE9p\xE9titions des m\xEAmes mots s\u2019ils ne sont pas \xE9galement r\xE9p\xE9t\xE9s dans les cibles (pour \xE9viter que le mod\xE8le ne produise des phrases telles que \xAB the the the the the the the \xBB) et les phrases produites qui sont plus courtes que celles des cibles (pour \xE9viter que le mod\xE8le ne produise des phrases telles que \xAB the \xBB)."),Pi=d(),oa=r("p"),gd=a("L\u2019une des faiblesses de BLEU est qu\u2019il s\u2019attend \xE0 ce que le texte soit d\xE9j\xE0 tokenis\xE9, ce qui rend difficile la comparaison des scores entre les mod\xE8les qui utilisent diff\xE9rents "),ho=r("em"),qd=a("tokenizers"),Ed=a(". Par cons\xE9quent, la mesure la plus couramment utilis\xE9e aujourd\u2019hui pour \xE9valuer les mod\xE8les de traduction est "),ur=r("a"),jd=a("SacreBLEU"),kd=a(" qui rem\xE9die \xE0 cette faiblesse (et \xE0 d\u2019autres) en standardisant l\u2019\xE9tape de tokenisation. Pour utiliser cette m\xE9trique, nous devons d\u2019abord installer la biblioth\xE8que "),_o=r("em"),wd=a("SacreBLEU"),xd=a(" :"),Ci=d(),E(pr.$$.fragment),Di=d(),Xa=r("p"),zd=a("Nous pouvons ensuite charger ce score via "),vo=r("code"),yd=a("evaluate.load()"),Pd=a(" comme nous l\u2019avons fait dans le "),ol=r("a"),Cd=a("chapitre 3"),Dd=a(" :"),Ti=d(),E(dr.$$.fragment),Si=d(),il=r("p"),Td=a("Cette m\xE9trique prend des textes comme entr\xE9es et cibles. Elle est con\xE7ue pour accepter plusieurs cibles acceptables car il y a souvent plusieurs traductions possibles d\u2019une m\xEAme phrase. Le jeu de donn\xE9es que nous utilisons n\u2019en fournit qu\u2019une seule, mais en NLP, il n\u2019est pas rare de trouver des jeux de donn\xE9es ayant plusieurs phrases comme \xE9tiquettes. Ainsi, les pr\xE9dictions doivent \xEAtre une liste de phrases mais les r\xE9f\xE9rences doivent \xEAtre une liste de listes de phrases."),Ai=d(),ul=r("p"),Sd=a("Essayons un exemple :"),Li=d(),E(cr.$$.fragment),Ni=d(),E(mr.$$.fragment),Mi=d(),Vs=r("p"),Ad=a("Cela donne un score BLEU de 46.75, ce qui est plut\xF4t bon. A titre de comparaison, le "),bo=r("em"),Ld=a("Transformer"),Nd=a(" original dans l\u2019article "),fr=r("a"),$o=r("em"),Md=a("Attention Is All You Need"),Od=a(" a obtenu un score BLEU de 41.8 sur une t\xE2che de traduction similaire entre l\u2019anglais et le fran\xE7ais ! (Pour plus d\u2019informations sur les m\xE9triques individuelles, comme "),go=r("code"),Fd=a("counts"),Ud=a(" et "),qo=r("code"),Hd=a("bp"),Id=a(", voir le "),hr=r("a"),Bd=a("d\xE9p\xF4t SacreBLEU"),Rd=a(". D\u2019autre part, si nous essayons avec les deux mauvais types de pr\xE9dictions (r\xE9p\xE9titions ou pr\xE9diction trop courte) qui sortent souvent des mod\xE8les de traduction, nous obtiendrons des scores BLEU plut\xF4t mauvais :"),Oi=d(),E(_r.$$.fragment),Fi=d(),E(vr.$$.fragment),Ui=d(),E(br.$$.fragment),Hi=d(),E($r.$$.fragment),Ii=d(),pl=r("p"),Kd=a("Le score peut aller de 0 \xE0 100. Plus il est \xE9lev\xE9, mieux c\u2019est."),Bi=d(),za.c(),dl=d(),vn=r("p"),Xd=a("Maintenant que c\u2019est fait, nous sommes pr\xEAts \xE0 "),Eo=r("em"),Vd=a("finetuner"),Gd=a(" notre mod\xE8le !"),Ri=d(),tn=r("h3"),bn=r("a"),jo=r("span"),E(gr.$$.fragment),Wd=d(),cl=r("span"),ko=r("i"),Qd=a("Finetuner"),Jd=a(" le mod\xE8le"),Ki=d(),Va=r("p"),Yd=a("La premi\xE8re \xE9tape consiste \xE0 se connecter \xE0 Hugging Face, afin de pouvoir t\xE9l\xE9charger vos r\xE9sultats sur le "),wo=r("em"),Zd=a("Hub"),ec=a(". Il y a une fonction pratique pour vous aider \xE0 le faire dans un "),xo=r("em"),sc=a("notebook"),tc=a(" :"),Xi=d(),E(qr.$$.fragment),Vi=d(),$n=r("p"),ac=a("Cela affichera un "),zo=r("em"),nc=a("widget"),rc=a(" o\xF9 vous pourrez entrer vos identifiants de connexion \xE0 Hugging Face."),Gi=d(),gn=r("p"),lc=a("Si vous ne travaillez pas dans un "),yo=r("em"),oc=a("notebook"),ic=a(", tapez simplement la ligne suivante dans votre terminal :"),Wi=d(),E(Er.$$.fragment),Qi=d(),Pa.c(),ml=d(),Es&&Es.c(),fl=d(),an=r("h3"),qn=r("a"),Po=r("span"),E(jr.$$.fragment),uc=d(),hl=r("span"),pc=a("Utilisation du mod\xE8le "),Co=r("i"),dc=a("finetun\xE9"),Ji=d(),qt=r("p"),cc=a("Nous vous avons d\xE9j\xE0 montr\xE9 comment vous pouvez utiliser le mod\xE8le que nous avons "),Do=r("em"),mc=a("finetun\xE9"),fc=a(" sur le "),To=r("em"),hc=a("Hub"),_c=a(" avec le "),So=r("em"),vc=a("widget"),bc=a(" d\u2019inf\xE9rence. Pour l\u2019utiliser localement dans un "),Ao=r("code"),$c=a("pipeline"),gc=a(", nous devons juste sp\xE9cifier l\u2019identifiant de mod\xE8le appropri\xE9 :"),Yi=d(),E(kr.$$.fragment),Zi=d(),E(wr.$$.fragment),eu=d(),ia=r("p"),qc=a("Comme pr\xE9vu, notre mod\xE8le pr\xE9-entra\xEEn\xE9 a adapt\xE9 ses connaissances au corpus sur lequel nous l\u2019avons "),Lo=r("em"),Ec=a("finetun\xE9"),jc=a(". Et au lieu de laisser le mot anglais \xAB "),No=r("em"),kc=a("threads"),wc=a(" \xBB, le mod\xE8le le traduit maintenant par la version fran\xE7aise officielle. Il en va de m\xEAme pour \xAB "),Mo=r("em"),xc=a("plugin"),zc=a(" \xBB :"),su=d(),E(xr.$$.fragment),tu=d(),E(zr.$$.fragment),au=d(),_l=r("p"),yc=a("Un autre excellent exemple d\u2019adaptation au domaine !"),nu=d(),E(En.$$.fragment),this.h()},l(e){const p=fh('[data-svelte="svelte-1phssyn"]',document.head);u=l(p,"META",{name:!0,content:!0}),p.forEach(t),q=c(e),j(h.$$.fragment,e),x=c(e),A=l(e,"H1",{class:!0});var Ar=o(A);v=l(Ar,"A",{id:!0,class:!0,href:!0});var vl=o(v);D=l(vl,"SPAN",{});var Oo=o(D);j(S.$$.fragment,Oo),Oo.forEach(t),vl.forEach(t),z=c(Ar),P=l(Ar,"SPAN",{});var Fo=o(P);I=n(Fo,"Traduction"),Fo.forEach(t),Ar.forEach(t),C=c(e),K.l(e),U=c(e),O=l(e,"P",{});var nn=o(O);Z=n(nn,"Plongeons maintenant dans la traduction. Il s\u2019agit d\u2019une autre "),L=l(nn,"A",{href:!0});var Uo=o(L);G=n(Uo,"t\xE2che de s\xE9quence \xE0 s\xE9quence"),Uo.forEach(t),J=n(nn,", ce qui signifie que c\u2019est un probl\xE8me qui peut \xEAtre formul\xE9 comme le passage d\u2019une s\xE9quence \xE0 une autre. En ce sens, le probl\xE8me est assez proche de la t\xE2che de "),B=l(nn,"A",{href:!0});var bl=o(B);N=n(bl,"r\xE9sum\xE9"),bl.forEach(t),se=n(nn," et vous pouvez adapter ce que nous allons voir ici \xE0 d\u2019autres probl\xE8mes de s\xE9quence \xE0 s\xE9quence tels que :"),nn.forEach(t),T=c(e),F=l(e,"UL",{});var jn=o(F);Q=l(jn,"LI",{});var Ga=o(Q);W=n(Ga,"Le "),M=l(Ga,"STRONG",{});var $l=o(M);re=n($l,"transfert de style"),$l.forEach(t),ae=n(Ga," ? c\u2019est-\xE0-dire cr\xE9er un mod\xE8le qui "),te=l(Ga,"EM",{});var gl=o(te);de=n(gl,"traduit"),gl.forEach(t),ne=n(Ga," des textes \xE9crits dans un certain style vers un autre (par exemple, du formel au d\xE9contract\xE9 ou de l\u2019anglais shakespearien \xE0 l\u2019anglais moderne)."),Ga.forEach(t),pe=c(jn),ue=l(jn,"LI",{});var Lr=o(ue);ve=n(Lr,"La "),be=l(Lr,"STRONG",{});var Bc=o(be);$e=n(Bc,"g\xE9n\xE9ration de r\xE9ponse \xE0 des questions"),Bc.forEach(t),he=n(Lr," c\u2019est-\xE0-dire cr\xE9er un mod\xE8le qui g\xE9n\xE8re des r\xE9ponses \xE0 des questions compte tenu d\u2019un contexte."),Lr.forEach(t),jn.forEach(t),Y=c(e),j(ce.$$.fragment,e),me=c(e),V=l(e,"P",{});var ql=o(V);Ae=n(ql,"Si vous disposez d\u2019un corpus de textes suffisamment important en deux langues diff\xE9rentes (ou plus), vous pouvez entra\xEEner un nouveau mod\xE8le de traduction \xE0 partir de z\xE9ro, comme nous le ferons dans la section sur la "),ge=l(ql,"A",{href:!0});var Rc=o(ge);Qe=n(Rc,"mod\xE9lisation causale du langage"),Rc.forEach(t),Ee=n(ql,". Il est toutefois plus rapide de "),fe=l(ql,"EM",{});var Kc=o(fe);Le=n(Kc,"finetuner"),Kc.forEach(t),le=n(ql," un mod\xE8le de traduction existant, qu\u2019il s\u2019agisse d\u2019un mod\xE8le multilingue comme mT5 ou mBART que vous souhaitez adapter \xE0 une paire de langues sp\xE9cifique, ou m\xEAme d\u2019un mod\xE8le sp\xE9cialis\xE9 dans la traduction d\u2019une langue vers une autre que vous souhaitez adapter \xE0 votre corpus sp\xE9cifique."),ql.forEach(t),Oe=c(e),oe=l(e,"P",{});var ua=o(oe);ze=n(ua,"Dans cette section, nous allons "),ye=l(ua,"EM",{});var Xc=o(ye);De=n(Xc,"finetuner"),Xc.forEach(t),ds=n(ua," un mod\xE8le Marian pr\xE9-entra\xEEn\xE9 pour traduire de l\u2019anglais au fran\xE7ais (puisque de nombreux employ\xE9s de Hugging Face parlent ces deux langues) sur le jeu de donn\xE9es "),Fe=l(ua,"A",{href:!0,rel:!0});var Vc=o(Fe);ss=n(Vc,"KDE4"),Vc.forEach(t),cs=n(ua," qui est un jeu de donn\xE9es de fichiers localis\xE9s pour les applications "),ts=l(ua,"A",{href:!0,rel:!0});var Gc=o(ts);Pe=n(Gc,"KDE"),Gc.forEach(t),Ue=n(ua,". Le mod\xE8le que nous utiliserons a \xE9t\xE9 pr\xE9-entra\xEEn\xE9 sur un large corpus de textes fran\xE7ais et anglais provenant du jeu de donn\xE9es "),He=l(ua,"A",{href:!0,rel:!0});var Wc=o(He);je=n(Wc,"Opus"),Wc.forEach(t),Qs=n(ua," qui contient en fait le jeu de donn\xE9es KDE4. A noter que m\xEAme si le mod\xE8le pr\xE9-entra\xEEn\xE9 que nous utilisons a vu ces donn\xE9es pendant son pr\xE9-entra\xEEnement, nous verrons que nous pouvons obtenir une meilleure version de ce mod\xE8le apr\xE8s un "),Ie=l(ua,"EM",{});var Qc=o(Ie);Js=n(Qc,"finetuning"),Qc.forEach(t),Ys=n(ua,"."),ua.forEach(t),Je=c(e),Re=l(e,"P",{});var Jc=o(Re);Ns=n(Jc,"Une fois que nous aurons termin\xE9, nous aurons un mod\xE8le capable de faire des pr\xE9dictions comme celle-ci :"),Jc.forEach(t),Ne=c(e),g=l(e,"IFRAME",{src:!0,frameborder:!0,height:!0,title:!0,class:!0,allow:!0,sandbox:!0}),o(g).forEach(t),js=c(e),ke=l(e,"IFRAME",{src:!0,frameborder:!0,height:!0,title:!0,class:!0,allow:!0,sandbox:!0}),o(ke).forEach(t),_e=c(e),Ke=l(e,"A",{class:!0,href:!0});var lu=o(Ke);Me=l(lu,"IMG",{class:!0,src:!0,alt:!0}),xe=c(lu),as=l(lu,"IMG",{class:!0,src:!0,alt:!0}),lu.forEach(t),ks=c(e),Ye=l(e,"P",{});var ou=o(Ye);Zs=n(ou,"Comme dans les sections pr\xE9c\xE9dentes, vous pouvez trouver, t\xE9l\xE9charger et v\xE9rifier les pr\xE9cisions de ce mod\xE8le sur le "),Xe=l(ou,"A",{href:!0,rel:!0});var Yc=o(Xe);ms=l(Yc,"EM",{});var Zc=o(ms);Te=n(Zc,"Hub"),Zc.forEach(t),Yc.forEach(t),ut=n(ou,"."),ou.forEach(t),fs=c(e),ns=l(e,"H2",{class:!0});var iu=o(ns);Ms=l(iu,"A",{id:!0,class:!0,href:!0});var em=o(Ms);et=l(em,"SPAN",{});var sm=o(et);j(Ve.$$.fragment,sm),sm.forEach(t),em.forEach(t),Ut=c(iu),ws=l(iu,"SPAN",{});var tm=o(ws);Os=n(tm,"Pr\xE9paration des donn\xE9es"),tm.forEach(t),iu.forEach(t),Fs=c(e),Ce=l(e,"P",{});var Wa=o(Ce);Et=n(Wa,"Pour "),rs=l(Wa,"EM",{});var am=o(rs);Ht=n(am,"finetuner"),am.forEach(t),hs=n(Wa," ou entra\xEEner un mod\xE8le de traduction \xE0 partir de z\xE9ro, nous avons besoin d\u2019un jeu de donn\xE9es adapt\xE9 \xE0 cette t\xE2che. Comme mentionn\xE9 pr\xE9c\xE9demment, nous utiliserons le jeu de donn\xE9es "),we=l(Wa,"A",{href:!0,rel:!0});var nm=o(we);jt=n(nm,"KDE4"),nm.forEach(t),kt=n(Wa," dans cette section. Notez que vous pouvez adapter assez facilement le code pour utiliser vos propres donn\xE9es du moment que vous disposez de paires de phrases dans les deux langues que vous voulez traduire. Reportez-vous au "),pt=l(Wa,"A",{href:!0});var rm=o(pt);wt=n(rm,"chapitre 5"),rm.forEach(t),xt=n(Wa," si vous avez besoin d\u2019un rappel sur la fa\xE7on de charger vos donn\xE9es personnalis\xE9es dans un "),zt=l(Wa,"CODE",{});var lm=o(zt);It=n(lm,"Dataset"),lm.forEach(t),_s=n(Wa,"."),Wa.forEach(t),zs=c(e),vs=l(e,"H3",{class:!0});var uu=o(vs);Ge=l(uu,"A",{id:!0,class:!0,href:!0});var om=o(Ge);yt=l(om,"SPAN",{});var im=o(yt);j(ys.$$.fragment,im),im.forEach(t),om.forEach(t),Pt=c(uu),dt=l(uu,"SPAN",{});var um=o(dt);xs=n(um,"Le jeu de donn\xE9es KDE4"),um.forEach(t),uu.forEach(t),Ct=c(e),We=l(e,"P",{});var pu=o(We);Bt=n(pu,"Comme d\u2019habitude, nous t\xE9l\xE9chargeons notre jeu de donn\xE9es en utilisant la fonction "),Us=l(pu,"CODE",{});var pm=o(Us);Dt=n(pm,"load_dataset()"),pm.forEach(t),Rt=n(pu," :"),pu.forEach(t),Hs=c(e),j(Ps.$$.fragment,e),Se=c(e),Cs=l(e,"P",{});var du=o(Cs);ls=n(du,"Si vous souhaitez travailler avec une autre paire de langues, 92 langues sont disponibles au total pour ce jeu de donn\xE9es. Vous pouvez les voir dans la "),st=l(du,"A",{href:!0,rel:!0});var dm=o(st);ct=n(dm,"carte du jeu de donn\xE9es"),dm.forEach(t),Tt=n(du,"."),du.forEach(t),Kt=c(e),bs=l(e,"IMG",{src:!0,alt:!0,width:!0}),Vt=c(e),tt=l(e,"P",{});var cm=o(tt);$s=n(cm,"Jetons un coup d\u2019\u0153il au jeu de donn\xE9es :"),cm.forEach(t),Ds=c(e),j(Ts.$$.fragment,e),mt=c(e),j(at.$$.fragment,e),ft=c(e),Ze=l(e,"P",{});var kn=o(Ze);f=n(kn,"Nous avons 210 173 paires de phrases. Cependant regroup\xE9es dans un seul \xE9chantillon. Nous devrons donc cr\xE9er notre propre jeu de validation. Comme nous l\u2019avons vu dans le "),R=l(kn,"A",{href:!0});var mm=o(R);gs=n(mm,"chapitre 5"),mm.forEach(t),Ca=n(kn,", un "),nt=l(kn,"CODE",{});var fm=o(nt);Gt=n(fm,"Dataset"),fm.forEach(t),Is=n(kn," poss\xE8de une m\xE9thode "),Wt=l(kn,"CODE",{});var hm=o(Wt);ht=n(hm,"train_test_split()"),hm.forEach(t),Da=n(kn," qui peut nous aider. Nous allons fournir une graine pour la reproductibilit\xE9 :"),kn.forEach(t),St=c(e),j(Bs.$$.fragment,e),rt=c(e),j(_t.$$.fragment,e),Qt=c(e),qe=l(e,"P",{});var El=o(qe);da=n(El,"Nous pouvons renommer la cl\xE9 "),Rs=l(El,"CODE",{});var _m=o(Rs);ca=n(_m,"test"),_m.forEach(t),Ss=n(El," en "),Jt=l(El,"CODE",{});var vm=o(Jt);Yt=n(vm,"validation"),vm.forEach(t),Zt=n(El," comme ceci :"),El.forEach(t),ma=c(e),j(os.$$.fragment,e),At=c(e),Lt=l(e,"P",{});var bm=o(Lt);Ta=n(bm,"Examinons maintenant un \xE9l\xE9ment de ce jeu de donn\xE9es :"),bm.forEach(t),vt=c(e),j(m.$$.fragment,e),X=c(e),j(Nt.$$.fragment,e),is=c(e),bt=l(e,"P",{});var cu=o(bt);Mt=n(cu,`Nous obtenons un dictionnaire contenant deux phrases dans la paire de langues qui nous int\xE9resse.
Une particularit\xE9 de ce jeu de donn\xE9es rempli de termes techniques informatiques est qu\u2019ils sont tous enti\xE8rement traduits en fran\xE7ais. Cependant, les ing\xE9nieurs fran\xE7ais sont souvent paresseux et laissent la plupart des mots sp\xE9cifiques \xE0 l\u2019informatique en anglais lorsqu\u2019ils parlent. Ici, par exemple, le mot \xAB `),fa=l(cu,"EM",{});var $m=o(fa);Ya=n($m,"threads"),$m.forEach(t),ha=n(cu," \xBB pourrait tr\xE8s bien appara\xEEtre dans une phrase fran\xE7aise, surtout dans une conversation technique. Mais dans ce jeu de donn\xE9es, il a \xE9t\xE9 traduit en \xAB fils de discussion \xBB. Le mod\xE8le pr\xE9-entra\xEEn\xE9 que nous utilisons (qui a \xE9t\xE9 pr\xE9-entra\xEEn\xE9 sur un plus grand corpus de phrases fran\xE7aises et anglaises) prend l\u2019option de laisser le mot tel quel :"),cu.forEach(t),Sa=c(e),j(qs.$$.fragment,e),Aa=c(e),j(As.$$.fragment,e),La=c(e),Ks=l(e,"P",{});var mu=o(Ks);_a=n(mu,"Un autre exemple de ce comportement peut \xEAtre observ\xE9 avec le mot  \xAB "),rn=l(mu,"EM",{});var gm=o(rn);Or=n(gm,"plugin"),gm.forEach(t),ea=n(mu,` \xBB qui n\u2019est pas officiellement un mot fran\xE7ais mais que la plupart des francophones comprendront et ne prendront pas la peine de traduire.
Dans le jeu de donn\xE9es KDE4, ce mot a \xE9t\xE9 traduit en fran\xE7ais par le plus officiel \xAB module d\u2019extension \xBB :`),mu.forEach(t),Dn=c(e),j(Na.$$.fragment,e),Tn=c(e),j(Xs.$$.fragment,e),Sn=c(e),Za=l(e,"P",{});var qm=o(Za);Fr=n(qm,"Notre mod\xE8le pr\xE9-entra\xEEn\xE9, lui, s\u2019en tient au mot anglais :"),qm.forEach(t),Ls=c(e),j(Ma.$$.fragment,e),An=c(e),j(Oa.$$.fragment,e),Ln=c(e),Ot=l(e,"P",{});var jl=o(Ot);Ur=n(jl,"Il sera int\xE9ressant de voir si notre mod\xE8le "),sa=l(jl,"EM",{});var Em=o(sa);Hr=n(Em,"finetun\xE9"),Em.forEach(t),Ir=n(jl," tient compte de ces particularit\xE9s (alerte "),Fa=l(jl,"EM",{});var jm=o(Fa);Br=n(jm,"spoiler"),jm.forEach(t),Rr=n(jl," : il le fera)."),jl.forEach(t),Nn=c(e),j($t.$$.fragment,e),Mn=c(e),j(va.$$.fragment,e),ba=c(e),ta=l(e,"H3",{class:!0});var fu=o(ta);$a=l(fu,"A",{id:!0,class:!0,href:!0});var km=o($a);aa=l(km,"SPAN",{});var wm=o(aa);j(Ua.$$.fragment,wm),wm.forEach(t),km.forEach(t),Kr=c(fu),gt=l(fu,"SPAN",{});var xm=o(gt);Xr=n(xm,"Traitement des donn\xE9es"),xm.forEach(t),fu.forEach(t),On=c(e),j(Ha.$$.fragment,e),Fn=c(e),es=l(e,"P",{});var Qa=o(es);Vr=n(Qa,"Vous devriez maintenant conna\xEEtre le principe : les textes doivent tous \xEAtre convertis en ensembles d\u2019ID de "),ln=l(Qa,"EM",{});var zm=o(ln);Gr=n(zm,"tokens"),zm.forEach(t),zu=n(Qa," pour que le mod\xE8le puisse leur donner un sens. Pour cette t\xE2che, nous aurons besoin de tokeniser les entr\xE9es et les cibles. Notre premi\xE8re t\xE2che est de cr\xE9er notre objet "),Cl=l(Qa,"CODE",{});var ym=o(Cl);yu=n(ym,"tokenizer"),ym.forEach(t),Pu=n(Qa,". Comme indiqu\xE9 pr\xE9c\xE9demment, nous utiliserons un mod\xE8le pr\xE9-entra\xEEn\xE9 Marian English to French. Si vous essayez ce code avec une autre paire de langues, assurez-vous d\u2019adapter le "),Dl=l(Qa,"EM",{});var Pm=o(Dl);Cu=n(Pm,"checkpoint"),Pm.forEach(t),Du=n(Qa," du mod\xE8le. L\u2019organisation "),Un=l(Qa,"A",{href:!0,rel:!0});var Cm=o(Un);Tu=n(Cm,"Helsinki-NLP"),Cm.forEach(t),Su=n(Qa," fournit plus de mille mod\xE8les dans plusieurs langues."),Qa.forEach(t),Io=c(e),j(Hn.$$.fragment,e),Bo=c(e),na=l(e,"P",{});var wn=o(na);Au=n(wn,"Vous pouvez remplacer le "),Tl=l(wn,"CODE",{});var Dm=o(Tl);Lu=n(Dm,"model_checkpoint"),Dm.forEach(t),Nu=n(wn," par un tout autre mod\xE8le disponible sur le "),In=l(wn,"A",{href:!0,rel:!0});var Tm=o(In);Sl=l(Tm,"EM",{});var Sm=o(Sl);Mu=n(Sm,"Hub"),Sm.forEach(t),Tm.forEach(t),Ou=n(wn," qui aurait votre pr\xE9f\xE9rence, ou par un dossier en local o\xF9 vous avez sauvegard\xE9 un mod\xE8le pr\xE9-entra\xEEn\xE9 et un "),Al=l(wn,"EM",{});var Am=o(Al);Fu=n(Am,"tokenizer"),Am.forEach(t),Uu=n(wn,"."),wn.forEach(t),Ro=c(e),j(on.$$.fragment,e),Ko=c(e),Ia=l(e,"P",{});var kl=o(Ia);Hu=n(kl,"La pr\xE9paration de nos donn\xE9es est assez simple. Il y a juste une chose \xE0 retenir : vous traitez les entr\xE9es comme d\u2019habitude, mais pour les cibles, vous devez envelopper le "),Ll=l(kl,"EM",{});var Lm=o(Ll);Iu=n(Lm,"tokenizer"),Lm.forEach(t),Bu=n(kl," dans le gestionnaire de contexte "),Nl=l(kl,"CODE",{});var Nm=o(Nl);Ru=n(Nm,"as_target_tokenizer()"),Nm.forEach(t),Ku=n(kl,"."),kl.forEach(t),Xo=c(e),un=l(e,"P",{});var hu=o(un);Xu=n(hu,"Un gestionnaire de contexte en Python est introduit avec l\u2019instruction "),Ml=l(hu,"CODE",{});var Mm=o(Ml);Vu=n(Mm,"with"),Mm.forEach(t),Gu=n(hu," et est utile lorsque vous avez deux op\xE9rations li\xE9es \xE0 ex\xE9cuter en paire. L\u2019exemple le plus courant est lorsque vous \xE9crivez ou lisez un fichier, ce qui est souvent fait dans une instruction comme :"),hu.forEach(t),Vo=c(e),j(Bn.$$.fragment,e),Go=c(e),Ba=l(e,"P",{});var wl=o(Ba);Wu=n(wl,"Ici, les deux op\xE9rations connexes qui sont ex\xE9cut\xE9es en paire sont les actions d\u2019ouverture et de fermeture du fichier. L\u2019objet correspondant au fichier ouvert "),Ol=l(wl,"CODE",{});var Om=o(Ol);Qu=n(Om,"f"),Om.forEach(t),Ju=n(wl," n\u2019existe qu\u2019\xE0 l\u2019int\xE9rieur du bloc indent\xE9 sous le "),Fl=l(wl,"CODE",{});var Fm=o(Fl);Yu=n(Fm,"with"),Fm.forEach(t),Zu=n(wl,". L\u2019ouverture se produit avant ce bloc et la fermeture \xE0 la fin du bloc."),wl.forEach(t),Wo=c(e),Ra=l(e,"P",{});var xl=o(Ra);ep=n(xl,"Dans le cas pr\xE9sent, le gestionnaire de contexte "),Ul=l(xl,"CODE",{});var Um=o(Ul);sp=n(Um,"as_target_tokenizer()"),Um.forEach(t),tp=n(xl," va d\xE9finir le "),Hl=l(xl,"EM",{});var Hm=o(Hl);ap=n(Hm,"tokenizer"),Hm.forEach(t),np=n(xl," dans la langue de sortie (ici, le fran\xE7ais) avant l\u2019ex\xE9cution du bloc indent\xE9, puis le red\xE9finir dans la langue d\u2019entr\xE9e (ici, l\u2019anglais)."),xl.forEach(t),Qo=c(e),Wr=l(e,"P",{});var Im=o(Wr);rp=n(Im,"Ainsi, le pr\xE9traitement d\u2019un \xE9chantillon ressemble \xE0 ceci :"),Im.forEach(t),Jo=c(e),j(Rn.$$.fragment,e),Yo=c(e),pn=l(e,"P",{});var _u=o(pn);lp=n(_u,"Si nous oublions de tokeniser les cibles dans le gestionnaire de contexte, elles seront tokenis\xE9es par le "),Il=l(_u,"EM",{});var Bm=o(Il);op=n(Bm,"tokenizer"),Bm.forEach(t),ip=n(_u," d\u2019entr\xE9e, ce qui dans le cas d\u2019un mod\xE8le Marian, ne va pas du tout bien se passer :"),_u.forEach(t),Zo=c(e),j(Kn.$$.fragment,e),ei=c(e),j(Xn.$$.fragment,e),si=c(e),ra=l(e,"P",{});var xn=o(ra);up=n(xn,"Comme on peut le voir, utiliser le "),Bl=l(xn,"EM",{});var Rm=o(Bl);pp=n(Rm,"tokenizer"),Rm.forEach(t),dp=n(xn," anglais pour pr\xE9traiter une phrase fran\xE7aise donne un batch de "),Rl=l(xn,"EM",{});var Km=o(Rl);cp=n(Km,"tokens"),Km.forEach(t),mp=n(xn," plus important, puisque le "),Kl=l(xn,"EM",{});var Xm=o(Kl);fp=n(Xm,"tokenizer"),Xm.forEach(t),hp=n(xn," ne conna\xEEt aucun mot fran\xE7ais (sauf ceux qui apparaissent aussi en anglais, comme \xAB discussion \xBB)."),xn.forEach(t),ti=c(e),la=l(e,"P",{});var zn=o(la);_p=n(zn,"Les "),Xl=l(zn,"CODE",{});var Vm=o(Xl);vp=n(Vm,"inputs"),Vm.forEach(t),bp=n(zn," et les "),Vl=l(zn,"CODE",{});var Gm=o(Vl);$p=n(Gm,"targets"),Gm.forEach(t),gp=n(zn," sont des dictionnaires avec nos cl\xE9s habituelles (identifiants d\u2019entr\xE9e, masque d\u2019attention, etc.). La derni\xE8re \xE9tape est de d\xE9finir une cl\xE9 "),Gl=l(zn,"CODE",{});var Wm=o(Gl);qp=n(Wm,'"labels"'),Wm.forEach(t),Ep=n(zn," dans les entr\xE9es. Nous faisons cela dans la fonction de pr\xE9traitement que nous allons appliquer sur les jeux de donn\xE9es :"),zn.forEach(t),ai=c(e),j(Vn.$$.fragment,e),ni=c(e),Qr=l(e,"P",{});var Qm=o(Qr);jp=n(Qm,"Notez que nous avons fix\xE9 des longueurs maximales similaires pour nos entr\xE9es et nos sorties. Comme les textes que nous traitons semblent assez courts, nous utilisons 128."),Qm.forEach(t),ri=c(e),j(dn.$$.fragment,e),li=c(e),j(cn.$$.fragment,e),oi=c(e),Jr=l(e,"P",{});var Jm=o(Jr);kp=n(Jm,"Nous pouvons maintenant appliquer ce pr\xE9traitement en une seule fois sur toutes les \xE9chantillons de notre jeu de donn\xE9es :"),Jm.forEach(t),ii=c(e),j(Gn.$$.fragment,e),ui=c(e),mn=l(e,"P",{});var vu=o(mn);wp=n(vu,"Maintenant que les donn\xE9es ont \xE9t\xE9 pr\xE9trait\xE9es, nous sommes pr\xEAts \xE0 "),Wl=l(vu,"EM",{});var Ym=o(Wl);xp=n(Ym,"finetuner"),Ym.forEach(t),zp=n(vu," notre mod\xE8le pr\xE9-entra\xEEn\xE9 !"),vu.forEach(t),pi=c(e),qa.l(e),Yr=c(e),Zr=l(e,"P",{});var Zm=o(Zr);yp=n(Zm,"Notez que cette fois-ci, nous utilisons un mod\xE8le qui a \xE9t\xE9 entra\xEEn\xE9 sur une t\xE2che de traduction et qui peut d\xE9j\xE0 \xEAtre utilis\xE9, donc il n\u2019y a pas d\u2019avertissement concernant les poids manquants ou ceux nouvellement initialis\xE9s."),Zm.forEach(t),di=c(e),en=l(e,"H3",{class:!0});var bu=o(en);fn=l(bu,"A",{id:!0,class:!0,href:!0});var ef=o(fn);Ql=l(ef,"SPAN",{});var sf=o(Ql);j(Wn.$$.fragment,sf),sf.forEach(t),ef.forEach(t),Pp=c(bu),Jl=l(bu,"SPAN",{});var tf=o(Jl);Cp=n(tf,"Assemblage des donn\xE9es"),tf.forEach(t),bu.forEach(t),ci=c(e),us=l(e,"P",{});var Gs=o(us);Dp=n(Gs,"Nous aurons besoin d\u2019un assembleur de donn\xE9es pour g\xE9rer le rembourrage pour la mise en batchs dynamique. Ici, nous ne pouvons pas simplement utiliser un "),Yl=l(Gs,"CODE",{});var af=o(Yl);Tp=n(af,"DataCollatorWithPadding"),af.forEach(t),Sp=n(Gs," comme dans le "),el=l(Gs,"A",{href:!0});var nf=o(el);Ap=n(nf,"chapitre 3"),nf.forEach(t),Lp=n(Gs," car cela ne rembourre que les entr\xE9es (identifiants d\u2019entr\xE9e, masque d\u2019attention, et "),Zl=l(Gs,"EM",{});var rf=o(Zl);Np=n(rf,"token"),rf.forEach(t),Mp=n(Gs," de type identifiants). Nos \xE9tiquettes doivent \xE9galement \xEAtre rembourr\xE9es \xE0 la longueur maximale rencontr\xE9e dans les \xE9tiquettes. Et, comme mentionn\xE9 pr\xE9c\xE9demment, la valeur de remplissage utilis\xE9e pour remplir les \xE9tiquettes doit \xEAtre "),eo=l(Gs,"CODE",{});var lf=o(eo);Op=n(lf,"-100"),lf.forEach(t),Fp=n(Gs," et non le "),so=l(Gs,"EM",{});var of=o(so);Up=n(of,"token"),of.forEach(t),Hp=n(Gs," de "),to=l(Gs,"EM",{});var uf=o(to);Ip=n(uf,"padding"),uf.forEach(t),Bp=n(Gs," du "),ao=l(Gs,"EM",{});var pf=o(ao);Rp=n(pf,"tokenizer"),pf.forEach(t),Kp=n(Gs," afin de s\u2019assurer que ces valeurs soient ignor\xE9es dans le calcul de la perte."),Gs.forEach(t),mi=c(e),ps=l(e,"P",{});var Ws=o(ps);Xp=n(Ws,"Tout ceci est r\xE9alis\xE9 par un "),Qn=l(Ws,"A",{href:!0,rel:!0});var df=o(Qn);no=l(df,"CODE",{});var cf=o(no);Vp=n(cf,"DataCollatorForSeq2Seq"),cf.forEach(t),df.forEach(t),Gp=n(Ws,". Comme le "),ro=l(Ws,"CODE",{});var mf=o(ro);Wp=n(mf,"DataCollatorWithPadding"),mf.forEach(t),Qp=n(Ws,", il prend le "),lo=l(Ws,"CODE",{});var ff=o(lo);Jp=n(ff,"tokenizer"),ff.forEach(t),Yp=n(Ws," utilis\xE9 pour pr\xE9traiter les entr\xE9es, mais \xE9galement le "),oo=l(Ws,"CODE",{});var hf=o(oo);Zp=n(hf,"model"),hf.forEach(t),ed=n(Ws,". C\u2019est parce que cet assembleur de donn\xE9es est \xE9galement responsable de la pr\xE9paration des identifiants d\u2019entr\xE9e du d\xE9codeur, qui sont des versions d\xE9cal\xE9es des \xE9tiquettes avec un "),io=l(Ws,"EM",{});var _f=o(io);sd=n(_f,"token"),_f.forEach(t),td=n(Ws," sp\xE9cial au d\xE9but. Comme ce d\xE9calage est effectu\xE9 de mani\xE8re l\xE9g\xE8rement diff\xE9rente selon les architectures, le "),uo=l(Ws,"CODE",{});var vf=o(uo);ad=n(vf,"DataCollatorForSeq2Seq"),vf.forEach(t),nd=n(Ws," a besoin de conna\xEEtre l\u2019objet "),po=l(Ws,"CODE",{});var bf=o(po);rd=n(bf,"model"),bf.forEach(t),ld=n(Ws," :"),Ws.forEach(t),fi=c(e),ja.l(e),sl=c(e),tl=l(e,"P",{});var $f=o(tl);od=n($f,"Pour le tester sur quelques \xE9chantillons, nous l\u2019appelons simplement sur une liste d\u2019exemples de notre \xE9chantillon d\u2019entrainement tok\xE9nis\xE9 :"),$f.forEach(t),hi=c(e),j(Jn.$$.fragment,e),_i=c(e),j(Yn.$$.fragment,e),vi=c(e),hn=l(e,"P",{});var $u=o(hn);id=n($u,"Nous pouvons v\xE9rifier que nos \xE9tiquettes ont \xE9t\xE9 rembourr\xE9es \xE0 la longueur maximale du batch, en utilisant "),co=l($u,"CODE",{});var gf=o(co);ud=n(gf,"-100"),gf.forEach(t),pd=n($u," :"),$u.forEach(t),bi=c(e),j(Zn.$$.fragment,e),$i=c(e),j(er.$$.fragment,e),gi=c(e),al=l(e,"P",{});var qf=o(al);dd=n(qf,"Nous pouvons aussi jeter un coup d\u2019\u0153il aux identifiants d\u2019entr\xE9e du d\xE9codeur, pour voir qu\u2019il s\u2019agit de versions d\xE9cal\xE9es des \xE9tiquettes :"),qf.forEach(t),qi=c(e),j(sr.$$.fragment,e),Ei=c(e),j(tr.$$.fragment,e),ji=c(e),nl=l(e,"P",{});var Ef=o(nl);cd=n(Ef,"Voici les \xE9tiquettes des premier et deuxi\xE8me \xE9l\xE9ments de notre jeu de donn\xE9es :"),Ef.forEach(t),ki=c(e),j(ar.$$.fragment,e),wi=c(e),j(nr.$$.fragment,e),xi=c(e),wa.l(e),rl=c(e),sn=l(e,"H3",{class:!0});var gu=o(sn);_n=l(gu,"A",{id:!0,class:!0,href:!0});var jf=o(_n);mo=l(jf,"SPAN",{});var kf=o(mo);j(rr.$$.fragment,kf),kf.forEach(t),jf.forEach(t),md=c(gu),fo=l(gu,"SPAN",{});var wf=o(fo);fd=n(wf,"M\xE9triques"),wf.forEach(t),gu.forEach(t),zi=c(e),j(lr.$$.fragment,e),yi=c(e),lt&&lt.l(e),ll=c(e),Ka=l(e,"P",{});var zl=o(Ka);hd=n(zl,"La m\xE9trique traditionnelle utilis\xE9e pour la traduction est le "),or=l(zl,"A",{href:!0,rel:!0});var xf=o(or);_d=n(xf,"score BLEU"),xf.forEach(t),vd=n(zl,", introduit dans "),ir=l(zl,"A",{href:!0,rel:!0});var zf=o(ir);bd=n(zf,"un article de 2002"),zf.forEach(t),$d=n(zl," par Kishore Papineni et al. Le score BLEU \xE9value dans quelle mesure les traductions sont proches de leurs \xE9tiquettes. Il ne mesure pas l\u2019intelligibilit\xE9 ou l\u2019exactitude grammaticale des r\xE9sultats g\xE9n\xE9r\xE9s par le mod\xE8le, mais utilise des r\xE8gles statistiques pour garantir que tous les mots des r\xE9sultats g\xE9n\xE9r\xE9s apparaissent \xE9galement dans les cibles. En outre, il existe des r\xE8gles qui p\xE9nalisent les r\xE9p\xE9titions des m\xEAmes mots s\u2019ils ne sont pas \xE9galement r\xE9p\xE9t\xE9s dans les cibles (pour \xE9viter que le mod\xE8le ne produise des phrases telles que \xAB the the the the the the the \xBB) et les phrases produites qui sont plus courtes que celles des cibles (pour \xE9viter que le mod\xE8le ne produise des phrases telles que \xAB the \xBB)."),zl.forEach(t),Pi=c(e),oa=l(e,"P",{});var yn=o(oa);gd=n(yn,"L\u2019une des faiblesses de BLEU est qu\u2019il s\u2019attend \xE0 ce que le texte soit d\xE9j\xE0 tokenis\xE9, ce qui rend difficile la comparaison des scores entre les mod\xE8les qui utilisent diff\xE9rents "),ho=l(yn,"EM",{});var yf=o(ho);qd=n(yf,"tokenizers"),yf.forEach(t),Ed=n(yn,". Par cons\xE9quent, la mesure la plus couramment utilis\xE9e aujourd\u2019hui pour \xE9valuer les mod\xE8les de traduction est "),ur=l(yn,"A",{href:!0,rel:!0});var Pf=o(ur);jd=n(Pf,"SacreBLEU"),Pf.forEach(t),kd=n(yn," qui rem\xE9die \xE0 cette faiblesse (et \xE0 d\u2019autres) en standardisant l\u2019\xE9tape de tokenisation. Pour utiliser cette m\xE9trique, nous devons d\u2019abord installer la biblioth\xE8que "),_o=l(yn,"EM",{});var Cf=o(_o);wd=n(Cf,"SacreBLEU"),Cf.forEach(t),xd=n(yn," :"),yn.forEach(t),Ci=c(e),j(pr.$$.fragment,e),Di=c(e),Xa=l(e,"P",{});var yl=o(Xa);zd=n(yl,"Nous pouvons ensuite charger ce score via "),vo=l(yl,"CODE",{});var Df=o(vo);yd=n(Df,"evaluate.load()"),Df.forEach(t),Pd=n(yl," comme nous l\u2019avons fait dans le "),ol=l(yl,"A",{href:!0});var Tf=o(ol);Cd=n(Tf,"chapitre 3"),Tf.forEach(t),Dd=n(yl," :"),yl.forEach(t),Ti=c(e),j(dr.$$.fragment,e),Si=c(e),il=l(e,"P",{});var Sf=o(il);Td=n(Sf,"Cette m\xE9trique prend des textes comme entr\xE9es et cibles. Elle est con\xE7ue pour accepter plusieurs cibles acceptables car il y a souvent plusieurs traductions possibles d\u2019une m\xEAme phrase. Le jeu de donn\xE9es que nous utilisons n\u2019en fournit qu\u2019une seule, mais en NLP, il n\u2019est pas rare de trouver des jeux de donn\xE9es ayant plusieurs phrases comme \xE9tiquettes. Ainsi, les pr\xE9dictions doivent \xEAtre une liste de phrases mais les r\xE9f\xE9rences doivent \xEAtre une liste de listes de phrases."),Sf.forEach(t),Ai=c(e),ul=l(e,"P",{});var Af=o(ul);Sd=n(Af,"Essayons un exemple :"),Af.forEach(t),Li=c(e),j(cr.$$.fragment,e),Ni=c(e),j(mr.$$.fragment,e),Mi=c(e),Vs=l(e,"P",{});var pa=o(Vs);Ad=n(pa,"Cela donne un score BLEU de 46.75, ce qui est plut\xF4t bon. A titre de comparaison, le "),bo=l(pa,"EM",{});var Lf=o(bo);Ld=n(Lf,"Transformer"),Lf.forEach(t),Nd=n(pa," original dans l\u2019article "),fr=l(pa,"A",{href:!0,rel:!0});var Nf=o(fr);$o=l(Nf,"EM",{});var Mf=o($o);Md=n(Mf,"Attention Is All You Need"),Mf.forEach(t),Nf.forEach(t),Od=n(pa," a obtenu un score BLEU de 41.8 sur une t\xE2che de traduction similaire entre l\u2019anglais et le fran\xE7ais ! (Pour plus d\u2019informations sur les m\xE9triques individuelles, comme "),go=l(pa,"CODE",{});var Of=o(go);Fd=n(Of,"counts"),Of.forEach(t),Ud=n(pa," et "),qo=l(pa,"CODE",{});var Ff=o(qo);Hd=n(Ff,"bp"),Ff.forEach(t),Id=n(pa,", voir le "),hr=l(pa,"A",{href:!0,rel:!0});var Uf=o(hr);Bd=n(Uf,"d\xE9p\xF4t SacreBLEU"),Uf.forEach(t),Rd=n(pa,". D\u2019autre part, si nous essayons avec les deux mauvais types de pr\xE9dictions (r\xE9p\xE9titions ou pr\xE9diction trop courte) qui sortent souvent des mod\xE8les de traduction, nous obtiendrons des scores BLEU plut\xF4t mauvais :"),pa.forEach(t),Oi=c(e),j(_r.$$.fragment,e),Fi=c(e),j(vr.$$.fragment,e),Ui=c(e),j(br.$$.fragment,e),Hi=c(e),j($r.$$.fragment,e),Ii=c(e),pl=l(e,"P",{});var Hf=o(pl);Kd=n(Hf,"Le score peut aller de 0 \xE0 100. Plus il est \xE9lev\xE9, mieux c\u2019est."),Hf.forEach(t),Bi=c(e),za.l(e),dl=c(e),vn=l(e,"P",{});var qu=o(vn);Xd=n(qu,"Maintenant que c\u2019est fait, nous sommes pr\xEAts \xE0 "),Eo=l(qu,"EM",{});var If=o(Eo);Vd=n(If,"finetuner"),If.forEach(t),Gd=n(qu," notre mod\xE8le !"),qu.forEach(t),Ri=c(e),tn=l(e,"H3",{class:!0});var Eu=o(tn);bn=l(Eu,"A",{id:!0,class:!0,href:!0});var Bf=o(bn);jo=l(Bf,"SPAN",{});var Rf=o(jo);j(gr.$$.fragment,Rf),Rf.forEach(t),Bf.forEach(t),Wd=c(Eu),cl=l(Eu,"SPAN",{});var Pc=o(cl);ko=l(Pc,"I",{});var Kf=o(ko);Qd=n(Kf,"Finetuner"),Kf.forEach(t),Jd=n(Pc," le mod\xE8le"),Pc.forEach(t),Eu.forEach(t),Ki=c(e),Va=l(e,"P",{});var Pl=o(Va);Yd=n(Pl,"La premi\xE8re \xE9tape consiste \xE0 se connecter \xE0 Hugging Face, afin de pouvoir t\xE9l\xE9charger vos r\xE9sultats sur le "),wo=l(Pl,"EM",{});var Xf=o(wo);Zd=n(Xf,"Hub"),Xf.forEach(t),ec=n(Pl,". Il y a une fonction pratique pour vous aider \xE0 le faire dans un "),xo=l(Pl,"EM",{});var Vf=o(xo);sc=n(Vf,"notebook"),Vf.forEach(t),tc=n(Pl," :"),Pl.forEach(t),Xi=c(e),j(qr.$$.fragment,e),Vi=c(e),$n=l(e,"P",{});var ju=o($n);ac=n(ju,"Cela affichera un "),zo=l(ju,"EM",{});var Gf=o(zo);nc=n(Gf,"widget"),Gf.forEach(t),rc=n(ju," o\xF9 vous pourrez entrer vos identifiants de connexion \xE0 Hugging Face."),ju.forEach(t),Gi=c(e),gn=l(e,"P",{});var ku=o(gn);lc=n(ku,"Si vous ne travaillez pas dans un "),yo=l(ku,"EM",{});var Wf=o(yo);oc=n(Wf,"notebook"),Wf.forEach(t),ic=n(ku,", tapez simplement la ligne suivante dans votre terminal :"),ku.forEach(t),Wi=c(e),j(Er.$$.fragment,e),Qi=c(e),Pa.l(e),ml=c(e),Es&&Es.l(e),fl=c(e),an=l(e,"H3",{class:!0});var wu=o(an);qn=l(wu,"A",{id:!0,class:!0,href:!0});var Qf=o(qn);Po=l(Qf,"SPAN",{});var Jf=o(Po);j(jr.$$.fragment,Jf),Jf.forEach(t),Qf.forEach(t),uc=c(wu),hl=l(wu,"SPAN",{});var Cc=o(hl);pc=n(Cc,"Utilisation du mod\xE8le "),Co=l(Cc,"I",{});var Yf=o(Co);dc=n(Yf,"finetun\xE9"),Yf.forEach(t),Cc.forEach(t),wu.forEach(t),Ji=c(e),qt=l(e,"P",{});var Ja=o(qt);cc=n(Ja,"Nous vous avons d\xE9j\xE0 montr\xE9 comment vous pouvez utiliser le mod\xE8le que nous avons "),Do=l(Ja,"EM",{});var Zf=o(Do);mc=n(Zf,"finetun\xE9"),Zf.forEach(t),fc=n(Ja," sur le "),To=l(Ja,"EM",{});var eh=o(To);hc=n(eh,"Hub"),eh.forEach(t),_c=n(Ja," avec le "),So=l(Ja,"EM",{});var sh=o(So);vc=n(sh,"widget"),sh.forEach(t),bc=n(Ja," d\u2019inf\xE9rence. Pour l\u2019utiliser localement dans un "),Ao=l(Ja,"CODE",{});var th=o(Ao);$c=n(th,"pipeline"),th.forEach(t),gc=n(Ja,", nous devons juste sp\xE9cifier l\u2019identifiant de mod\xE8le appropri\xE9 :"),Ja.forEach(t),Yi=c(e),j(kr.$$.fragment,e),Zi=c(e),j(wr.$$.fragment,e),eu=c(e),ia=l(e,"P",{});var Pn=o(ia);qc=n(Pn,"Comme pr\xE9vu, notre mod\xE8le pr\xE9-entra\xEEn\xE9 a adapt\xE9 ses connaissances au corpus sur lequel nous l\u2019avons "),Lo=l(Pn,"EM",{});var ah=o(Lo);Ec=n(ah,"finetun\xE9"),ah.forEach(t),jc=n(Pn,". Et au lieu de laisser le mot anglais \xAB "),No=l(Pn,"EM",{});var nh=o(No);kc=n(nh,"threads"),nh.forEach(t),wc=n(Pn," \xBB, le mod\xE8le le traduit maintenant par la version fran\xE7aise officielle. Il en va de m\xEAme pour \xAB "),Mo=l(Pn,"EM",{});var rh=o(Mo);xc=n(rh,"plugin"),rh.forEach(t),zc=n(Pn," \xBB :"),Pn.forEach(t),su=c(e),j(xr.$$.fragment,e),tu=c(e),j(zr.$$.fragment,e),au=c(e),_l=l(e,"P",{});var lh=o(_l);yc=n(lh,"Un autre excellent exemple d\u2019adaptation au domaine !"),lh.forEach(t),nu=c(e),j(En.$$.fragment,e),this.h()},h(){_(u,"name","hf:doc:metadata"),_(u,"content",JSON.stringify(Oh)),_(v,"id","traduction"),_(v,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(v,"href","#traduction"),_(A,"class","relative group"),_(L,"href","/course/fr/chapitre1/7"),_(B,"href","/course/fr/chapitre7/6"),_(ge,"href","/course/fr/chapitre7/6"),_(Fe,"href","https://huggingface.co/datasets/kde4"),_(Fe,"rel","nofollow"),_(ts,"href","https://apps.kde.org/"),_(ts,"rel","nofollow"),_(He,"href","https://opus.nlpl.eu/"),_(He,"rel","nofollow"),Ho(g.src,ie="https://hf.space/gradioiframe/course-demos/marian-finetuned-kde4-en-to-fr/+")||_(g,"src",ie),_(g,"frameborder","0"),_(g,"height","350"),_(g,"title","Gradio app"),_(g,"class","block dark:hidden container p-0 flex-grow space-iframe"),_(g,"allow","accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking"),_(g,"sandbox","allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"),Ho(ke.src,Be="https://hf.space/gradioiframe/course-demos/marian-finetuned-kde4-en-to-fr-darkmode/+")||_(ke,"src",Be),_(ke,"frameborder","0"),_(ke,"height","350"),_(ke,"title","Gradio app"),_(ke,"class","hidden dark:block container p-0 flex-grow space-iframe"),_(ke,"allow","accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking"),_(ke,"sandbox","allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"),_(Me,"class","block dark:hidden lg:w-3/5"),Ho(Me.src,ot="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/modeleval-marian-finetuned-kde4-en-to-fr.png")||_(Me,"src",ot),_(Me,"alt","One-hot encoded labels for question answering."),_(as,"class","hidden dark:block lg:w-3/5"),Ho(as.src,it="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/modeleval-marian-finetuned-kde4-en-to-fr-dark.png")||_(as,"src",it),_(as,"alt","One-hot encoded labels for question answering."),_(Ke,"class","flex justify-center"),_(Ke,"href","/huggingface-course/marian-finetuned-kde4-en-to-fr"),_(Xe,"href","https://huggingface.co/huggingface-course/marian-finetuned-kde4-en-to-fr?text=This+plugin+allows+you+to+automatically+translate+web+pages+between+several+languages."),_(Xe,"rel","nofollow"),_(Ms,"id","prparation-des-donnes"),_(Ms,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(Ms,"href","#prparation-des-donnes"),_(ns,"class","relative group"),_(we,"href","https://huggingface.co/datasets/kde4"),_(we,"rel","nofollow"),_(pt,"href","/course/fr/chapter5"),_(Ge,"id","le-jeu-de-donnes-kde4"),_(Ge,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(Ge,"href","#le-jeu-de-donnes-kde4"),_(vs,"class","relative group"),_(st,"href","https://huggingface.co/datasets/kde4"),_(st,"rel","nofollow"),Ho(bs.src,Xt="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/language_tags.png")||_(bs,"src",Xt),_(bs,"alt","Language available for the KDE4 dataset."),_(bs,"width","100%"),_(R,"href","/course/fr/chapter5"),_($a,"id","traitement-des-donnes"),_($a,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_($a,"href","#traitement-des-donnes"),_(ta,"class","relative group"),_(Un,"href","https://huggingface.co/Helsinki-NLP"),_(Un,"rel","nofollow"),_(In,"href","https://huggingface.co/models"),_(In,"rel","nofollow"),_(fn,"id","assemblage-des-donnes"),_(fn,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(fn,"href","#assemblage-des-donnes"),_(en,"class","relative group"),_(el,"href","/course/fr/chapter3"),_(Qn,"href","https://huggingface.co/transformers/main_classes/data_collator.html#datacollatorforseq2seq"),_(Qn,"rel","nofollow"),_(_n,"id","mtriques"),_(_n,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(_n,"href","#mtriques"),_(sn,"class","relative group"),_(or,"href","https://en.wikipedia.org/wiki/BLEU"),_(or,"rel","nofollow"),_(ir,"href","https://aclanthology.org/P02-1040.pdf"),_(ir,"rel","nofollow"),_(ur,"href","https://github.com/mjpost/sacrebleu"),_(ur,"rel","nofollow"),_(ol,"href","/course/fr/chapter3"),_(fr,"href","https://arxiv.org/pdf/1706.03762.pdf"),_(fr,"rel","nofollow"),_(hr,"href","https://github.com/mjpost/sacrebleu/blob/078c440168c6adc89ba75fe6d63f0d922d42bcfe/sacrebleu/metrics/bleu.py#L74"),_(hr,"rel","nofollow"),_(bn,"id","ifinetuneri-le-modle"),_(bn,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(bn,"href","#ifinetuneri-le-modle"),_(tn,"class","relative group"),_(qn,"id","utilisation-du-modle-ifinetuni"),_(qn,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),_(qn,"href","#utilisation-du-modle-ifinetuni"),_(an,"class","relative group")},m(e,p){s(document.head,u),i(e,q,p),k(h,e,p),i(e,x,p),i(e,A,p),s(A,v),s(v,D),k(S,D,null),s(A,z),s(A,P),s(P,I),i(e,C,p),yr[y].m(e,p),i(e,U,p),i(e,O,p),s(O,Z),s(O,L),s(L,G),s(O,J),s(O,B),s(B,N),s(O,se),i(e,T,p),i(e,F,p),s(F,Q),s(Q,W),s(Q,M),s(M,re),s(Q,ae),s(Q,te),s(te,de),s(Q,ne),s(F,pe),s(F,ue),s(ue,ve),s(ue,be),s(be,$e),s(ue,he),i(e,Y,p),k(ce,e,p),i(e,me,p),i(e,V,p),s(V,Ae),s(V,ge),s(ge,Qe),s(V,Ee),s(V,fe),s(fe,Le),s(V,le),i(e,Oe,p),i(e,oe,p),s(oe,ze),s(oe,ye),s(ye,De),s(oe,ds),s(oe,Fe),s(Fe,ss),s(oe,cs),s(oe,ts),s(ts,Pe),s(oe,Ue),s(oe,He),s(He,je),s(oe,Qs),s(oe,Ie),s(Ie,Js),s(oe,Ys),i(e,Je,p),i(e,Re,p),s(Re,Ns),i(e,Ne,p),i(e,g,p),i(e,js,p),i(e,ke,p),i(e,_e,p),i(e,Ke,p),s(Ke,Me),s(Ke,xe),s(Ke,as),i(e,ks,p),i(e,Ye,p),s(Ye,Zs),s(Ye,Xe),s(Xe,ms),s(ms,Te),s(Ye,ut),i(e,fs,p),i(e,ns,p),s(ns,Ms),s(Ms,et),k(Ve,et,null),s(ns,Ut),s(ns,ws),s(ws,Os),i(e,Fs,p),i(e,Ce,p),s(Ce,Et),s(Ce,rs),s(rs,Ht),s(Ce,hs),s(Ce,we),s(we,jt),s(Ce,kt),s(Ce,pt),s(pt,wt),s(Ce,xt),s(Ce,zt),s(zt,It),s(Ce,_s),i(e,zs,p),i(e,vs,p),s(vs,Ge),s(Ge,yt),k(ys,yt,null),s(vs,Pt),s(vs,dt),s(dt,xs),i(e,Ct,p),i(e,We,p),s(We,Bt),s(We,Us),s(Us,Dt),s(We,Rt),i(e,Hs,p),k(Ps,e,p),i(e,Se,p),i(e,Cs,p),s(Cs,ls),s(Cs,st),s(st,ct),s(Cs,Tt),i(e,Kt,p),i(e,bs,p),i(e,Vt,p),i(e,tt,p),s(tt,$s),i(e,Ds,p),k(Ts,e,p),i(e,mt,p),k(at,e,p),i(e,ft,p),i(e,Ze,p),s(Ze,f),s(Ze,R),s(R,gs),s(Ze,Ca),s(Ze,nt),s(nt,Gt),s(Ze,Is),s(Ze,Wt),s(Wt,ht),s(Ze,Da),i(e,St,p),k(Bs,e,p),i(e,rt,p),k(_t,e,p),i(e,Qt,p),i(e,qe,p),s(qe,da),s(qe,Rs),s(Rs,ca),s(qe,Ss),s(qe,Jt),s(Jt,Yt),s(qe,Zt),i(e,ma,p),k(os,e,p),i(e,At,p),i(e,Lt,p),s(Lt,Ta),i(e,vt,p),k(m,e,p),i(e,X,p),k(Nt,e,p),i(e,is,p),i(e,bt,p),s(bt,Mt),s(bt,fa),s(fa,Ya),s(bt,ha),i(e,Sa,p),k(qs,e,p),i(e,Aa,p),k(As,e,p),i(e,La,p),i(e,Ks,p),s(Ks,_a),s(Ks,rn),s(rn,Or),s(Ks,ea),i(e,Dn,p),k(Na,e,p),i(e,Tn,p),k(Xs,e,p),i(e,Sn,p),i(e,Za,p),s(Za,Fr),i(e,Ls,p),k(Ma,e,p),i(e,An,p),k(Oa,e,p),i(e,Ln,p),i(e,Ot,p),s(Ot,Ur),s(Ot,sa),s(sa,Hr),s(Ot,Ir),s(Ot,Fa),s(Fa,Br),s(Ot,Rr),i(e,Nn,p),k($t,e,p),i(e,Mn,p),k(va,e,p),i(e,ba,p),i(e,ta,p),s(ta,$a),s($a,aa),k(Ua,aa,null),s(ta,Kr),s(ta,gt),s(gt,Xr),i(e,On,p),k(Ha,e,p),i(e,Fn,p),i(e,es,p),s(es,Vr),s(es,ln),s(ln,Gr),s(es,zu),s(es,Cl),s(Cl,yu),s(es,Pu),s(es,Dl),s(Dl,Cu),s(es,Du),s(es,Un),s(Un,Tu),s(es,Su),i(e,Io,p),k(Hn,e,p),i(e,Bo,p),i(e,na,p),s(na,Au),s(na,Tl),s(Tl,Lu),s(na,Nu),s(na,In),s(In,Sl),s(Sl,Mu),s(na,Ou),s(na,Al),s(Al,Fu),s(na,Uu),i(e,Ro,p),k(on,e,p),i(e,Ko,p),i(e,Ia,p),s(Ia,Hu),s(Ia,Ll),s(Ll,Iu),s(Ia,Bu),s(Ia,Nl),s(Nl,Ru),s(Ia,Ku),i(e,Xo,p),i(e,un,p),s(un,Xu),s(un,Ml),s(Ml,Vu),s(un,Gu),i(e,Vo,p),k(Bn,e,p),i(e,Go,p),i(e,Ba,p),s(Ba,Wu),s(Ba,Ol),s(Ol,Qu),s(Ba,Ju),s(Ba,Fl),s(Fl,Yu),s(Ba,Zu),i(e,Wo,p),i(e,Ra,p),s(Ra,ep),s(Ra,Ul),s(Ul,sp),s(Ra,tp),s(Ra,Hl),s(Hl,ap),s(Ra,np),i(e,Qo,p),i(e,Wr,p),s(Wr,rp),i(e,Jo,p),k(Rn,e,p),i(e,Yo,p),i(e,pn,p),s(pn,lp),s(pn,Il),s(Il,op),s(pn,ip),i(e,Zo,p),k(Kn,e,p),i(e,ei,p),k(Xn,e,p),i(e,si,p),i(e,ra,p),s(ra,up),s(ra,Bl),s(Bl,pp),s(ra,dp),s(ra,Rl),s(Rl,cp),s(ra,mp),s(ra,Kl),s(Kl,fp),s(ra,hp),i(e,ti,p),i(e,la,p),s(la,_p),s(la,Xl),s(Xl,vp),s(la,bp),s(la,Vl),s(Vl,$p),s(la,gp),s(la,Gl),s(Gl,qp),s(la,Ep),i(e,ai,p),k(Vn,e,p),i(e,ni,p),i(e,Qr,p),s(Qr,jp),i(e,ri,p),k(dn,e,p),i(e,li,p),k(cn,e,p),i(e,oi,p),i(e,Jr,p),s(Jr,kp),i(e,ii,p),k(Gn,e,p),i(e,ui,p),i(e,mn,p),s(mn,wp),s(mn,Wl),s(Wl,xp),s(mn,zp),i(e,pi,p),Pr[ga].m(e,p),i(e,Yr,p),i(e,Zr,p),s(Zr,yp),i(e,di,p),i(e,en,p),s(en,fn),s(fn,Ql),k(Wn,Ql,null),s(en,Pp),s(en,Jl),s(Jl,Cp),i(e,ci,p),i(e,us,p),s(us,Dp),s(us,Yl),s(Yl,Tp),s(us,Sp),s(us,el),s(el,Ap),s(us,Lp),s(us,Zl),s(Zl,Np),s(us,Mp),s(us,eo),s(eo,Op),s(us,Fp),s(us,so),s(so,Up),s(us,Hp),s(us,to),s(to,Ip),s(us,Bp),s(us,ao),s(ao,Rp),s(us,Kp),i(e,mi,p),i(e,ps,p),s(ps,Xp),s(ps,Qn),s(Qn,no),s(no,Vp),s(ps,Gp),s(ps,ro),s(ro,Wp),s(ps,Qp),s(ps,lo),s(lo,Jp),s(ps,Yp),s(ps,oo),s(oo,Zp),s(ps,ed),s(ps,io),s(io,sd),s(ps,td),s(ps,uo),s(uo,ad),s(ps,nd),s(ps,po),s(po,rd),s(ps,ld),i(e,fi,p),Cr[Ea].m(e,p),i(e,sl,p),i(e,tl,p),s(tl,od),i(e,hi,p),k(Jn,e,p),i(e,_i,p),k(Yn,e,p),i(e,vi,p),i(e,hn,p),s(hn,id),s(hn,co),s(co,ud),s(hn,pd),i(e,bi,p),k(Zn,e,p),i(e,$i,p),k(er,e,p),i(e,gi,p),i(e,al,p),s(al,dd),i(e,qi,p),k(sr,e,p),i(e,Ei,p),k(tr,e,p),i(e,ji,p),i(e,nl,p),s(nl,cd),i(e,ki,p),k(ar,e,p),i(e,wi,p),k(nr,e,p),i(e,xi,p),Dr[ka].m(e,p),i(e,rl,p),i(e,sn,p),s(sn,_n),s(_n,mo),k(rr,mo,null),s(sn,md),s(sn,fo),s(fo,fd),i(e,zi,p),k(lr,e,p),i(e,yi,p),lt&&lt.m(e,p),i(e,ll,p),i(e,Ka,p),s(Ka,hd),s(Ka,or),s(or,_d),s(Ka,vd),s(Ka,ir),s(ir,bd),s(Ka,$d),i(e,Pi,p),i(e,oa,p),s(oa,gd),s(oa,ho),s(ho,qd),s(oa,Ed),s(oa,ur),s(ur,jd),s(oa,kd),s(oa,_o),s(_o,wd),s(oa,xd),i(e,Ci,p),k(pr,e,p),i(e,Di,p),i(e,Xa,p),s(Xa,zd),s(Xa,vo),s(vo,yd),s(Xa,Pd),s(Xa,ol),s(ol,Cd),s(Xa,Dd),i(e,Ti,p),k(dr,e,p),i(e,Si,p),i(e,il,p),s(il,Td),i(e,Ai,p),i(e,ul,p),s(ul,Sd),i(e,Li,p),k(cr,e,p),i(e,Ni,p),k(mr,e,p),i(e,Mi,p),i(e,Vs,p),s(Vs,Ad),s(Vs,bo),s(bo,Ld),s(Vs,Nd),s(Vs,fr),s(fr,$o),s($o,Md),s(Vs,Od),s(Vs,go),s(go,Fd),s(Vs,Ud),s(Vs,qo),s(qo,Hd),s(Vs,Id),s(Vs,hr),s(hr,Bd),s(Vs,Rd),i(e,Oi,p),k(_r,e,p),i(e,Fi,p),k(vr,e,p),i(e,Ui,p),k(br,e,p),i(e,Hi,p),k($r,e,p),i(e,Ii,p),i(e,pl,p),s(pl,Kd),i(e,Bi,p),Tr[xa].m(e,p),i(e,dl,p),i(e,vn,p),s(vn,Xd),s(vn,Eo),s(Eo,Vd),s(vn,Gd),i(e,Ri,p),i(e,tn,p),s(tn,bn),s(bn,jo),k(gr,jo,null),s(tn,Wd),s(tn,cl),s(cl,ko),s(ko,Qd),s(cl,Jd),i(e,Ki,p),i(e,Va,p),s(Va,Yd),s(Va,wo),s(wo,Zd),s(Va,ec),s(Va,xo),s(xo,sc),s(Va,tc),i(e,Xi,p),k(qr,e,p),i(e,Vi,p),i(e,$n,p),s($n,ac),s($n,zo),s(zo,nc),s($n,rc),i(e,Gi,p),i(e,gn,p),s(gn,lc),s(gn,yo),s(yo,oc),s(gn,ic),i(e,Wi,p),k(Er,e,p),i(e,Qi,p),Sr[ya].m(e,p),i(e,ml,p),Es&&Es.m(e,p),i(e,fl,p),i(e,an,p),s(an,qn),s(qn,Po),k(jr,Po,null),s(an,uc),s(an,hl),s(hl,pc),s(hl,Co),s(Co,dc),i(e,Ji,p),i(e,qt,p),s(qt,cc),s(qt,Do),s(Do,mc),s(qt,fc),s(qt,To),s(To,hc),s(qt,_c),s(qt,So),s(So,vc),s(qt,bc),s(qt,Ao),s(Ao,$c),s(qt,gc),i(e,Yi,p),k(kr,e,p),i(e,Zi,p),k(wr,e,p),i(e,eu,p),i(e,ia,p),s(ia,qc),s(ia,Lo),s(Lo,Ec),s(ia,jc),s(ia,No),s(No,kc),s(ia,wc),s(ia,Mo),s(Mo,xc),s(ia,zc),i(e,su,p),k(xr,e,p),i(e,tu,p),k(zr,e,p),i(e,au,p),i(e,_l,p),s(_l,yc),i(e,nu,p),k(En,e,p),ru=!0},p(e,[p]){const Ar={};p&1&&(Ar.fw=e[0]),h.$set(Ar);let vl=y;y=Tc(e),y!==vl&&(Mr(),$(yr[vl],1,1,()=>{yr[vl]=null}),Nr(),K=yr[y],K||(K=yr[y]=Dc[y](e),K.c()),b(K,1),K.m(U.parentNode,U));const Oo={};p&2&&(Oo.$$scope={dirty:p,ctx:e}),va.$set(Oo);const Fo={};p&2&&(Fo.$$scope={dirty:p,ctx:e}),on.$set(Fo);const nn={};p&2&&(nn.$$scope={dirty:p,ctx:e}),dn.$set(nn);const Uo={};p&2&&(Uo.$$scope={dirty:p,ctx:e}),cn.$set(Uo);let bl=ga;ga=Ac(e),ga!==bl&&(Mr(),$(Pr[bl],1,1,()=>{Pr[bl]=null}),Nr(),qa=Pr[ga],qa||(qa=Pr[ga]=Sc[ga](e),qa.c()),b(qa,1),qa.m(Yr.parentNode,Yr));let jn=Ea;Ea=Nc(e),Ea!==jn&&(Mr(),$(Cr[jn],1,1,()=>{Cr[jn]=null}),Nr(),ja=Cr[Ea],ja||(ja=Cr[Ea]=Lc[Ea](e),ja.c()),b(ja,1),ja.m(sl.parentNode,sl));let Ga=ka;ka=Oc(e),ka!==Ga&&(Mr(),$(Dr[Ga],1,1,()=>{Dr[Ga]=null}),Nr(),wa=Dr[ka],wa||(wa=Dr[ka]=Mc[ka](e),wa.c()),b(wa,1),wa.m(rl.parentNode,rl)),e[0]==="pt"?lt||(lt=ih(),lt.c(),lt.m(ll.parentNode,ll)):lt&&(lt.d(1),lt=null);let $l=xa;xa=Uc(e),xa!==$l&&(Mr(),$(Tr[$l],1,1,()=>{Tr[$l]=null}),Nr(),za=Tr[xa],za||(za=Tr[xa]=Fc[xa](e),za.c()),b(za,1),za.m(dl.parentNode,dl));let gl=ya;ya=Ic(e),ya!==gl&&(Mr(),$(Sr[gl],1,1,()=>{Sr[gl]=null}),Nr(),Pa=Sr[ya],Pa||(Pa=Sr[ya]=Hc[ya](e),Pa.c()),b(Pa,1),Pa.m(ml.parentNode,ml)),e[0]==="pt"?Es?p&1&&b(Es,1):(Es=uh(),Es.c(),b(Es,1),Es.m(fl.parentNode,fl)):Es&&(Mr(),$(Es,1,1,()=>{Es=null}),Nr());const Lr={};p&2&&(Lr.$$scope={dirty:p,ctx:e}),En.$set(Lr)},i(e){ru||(b(h.$$.fragment,e),b(S.$$.fragment,e),b(K),b(ce.$$.fragment,e),b(Ve.$$.fragment,e),b(ys.$$.fragment,e),b(Ps.$$.fragment,e),b(Ts.$$.fragment,e),b(at.$$.fragment,e),b(Bs.$$.fragment,e),b(_t.$$.fragment,e),b(os.$$.fragment,e),b(m.$$.fragment,e),b(Nt.$$.fragment,e),b(qs.$$.fragment,e),b(As.$$.fragment,e),b(Na.$$.fragment,e),b(Xs.$$.fragment,e),b(Ma.$$.fragment,e),b(Oa.$$.fragment,e),b($t.$$.fragment,e),b(va.$$.fragment,e),b(Ua.$$.fragment,e),b(Ha.$$.fragment,e),b(Hn.$$.fragment,e),b(on.$$.fragment,e),b(Bn.$$.fragment,e),b(Rn.$$.fragment,e),b(Kn.$$.fragment,e),b(Xn.$$.fragment,e),b(Vn.$$.fragment,e),b(dn.$$.fragment,e),b(cn.$$.fragment,e),b(Gn.$$.fragment,e),b(qa),b(Wn.$$.fragment,e),b(ja),b(Jn.$$.fragment,e),b(Yn.$$.fragment,e),b(Zn.$$.fragment,e),b(er.$$.fragment,e),b(sr.$$.fragment,e),b(tr.$$.fragment,e),b(ar.$$.fragment,e),b(nr.$$.fragment,e),b(wa),b(rr.$$.fragment,e),b(lr.$$.fragment,e),b(pr.$$.fragment,e),b(dr.$$.fragment,e),b(cr.$$.fragment,e),b(mr.$$.fragment,e),b(_r.$$.fragment,e),b(vr.$$.fragment,e),b(br.$$.fragment,e),b($r.$$.fragment,e),b(za),b(gr.$$.fragment,e),b(qr.$$.fragment,e),b(Er.$$.fragment,e),b(Pa),b(Es),b(jr.$$.fragment,e),b(kr.$$.fragment,e),b(wr.$$.fragment,e),b(xr.$$.fragment,e),b(zr.$$.fragment,e),b(En.$$.fragment,e),ru=!0)},o(e){$(h.$$.fragment,e),$(S.$$.fragment,e),$(K),$(ce.$$.fragment,e),$(Ve.$$.fragment,e),$(ys.$$.fragment,e),$(Ps.$$.fragment,e),$(Ts.$$.fragment,e),$(at.$$.fragment,e),$(Bs.$$.fragment,e),$(_t.$$.fragment,e),$(os.$$.fragment,e),$(m.$$.fragment,e),$(Nt.$$.fragment,e),$(qs.$$.fragment,e),$(As.$$.fragment,e),$(Na.$$.fragment,e),$(Xs.$$.fragment,e),$(Ma.$$.fragment,e),$(Oa.$$.fragment,e),$($t.$$.fragment,e),$(va.$$.fragment,e),$(Ua.$$.fragment,e),$(Ha.$$.fragment,e),$(Hn.$$.fragment,e),$(on.$$.fragment,e),$(Bn.$$.fragment,e),$(Rn.$$.fragment,e),$(Kn.$$.fragment,e),$(Xn.$$.fragment,e),$(Vn.$$.fragment,e),$(dn.$$.fragment,e),$(cn.$$.fragment,e),$(Gn.$$.fragment,e),$(qa),$(Wn.$$.fragment,e),$(ja),$(Jn.$$.fragment,e),$(Yn.$$.fragment,e),$(Zn.$$.fragment,e),$(er.$$.fragment,e),$(sr.$$.fragment,e),$(tr.$$.fragment,e),$(ar.$$.fragment,e),$(nr.$$.fragment,e),$(wa),$(rr.$$.fragment,e),$(lr.$$.fragment,e),$(pr.$$.fragment,e),$(dr.$$.fragment,e),$(cr.$$.fragment,e),$(mr.$$.fragment,e),$(_r.$$.fragment,e),$(vr.$$.fragment,e),$(br.$$.fragment,e),$($r.$$.fragment,e),$(za),$(gr.$$.fragment,e),$(qr.$$.fragment,e),$(Er.$$.fragment,e),$(Pa),$(Es),$(jr.$$.fragment,e),$(kr.$$.fragment,e),$(wr.$$.fragment,e),$(xr.$$.fragment,e),$(zr.$$.fragment,e),$(En.$$.fragment,e),ru=!1},d(e){t(u),e&&t(q),w(h,e),e&&t(x),e&&t(A),w(S),e&&t(C),yr[y].d(e),e&&t(U),e&&t(O),e&&t(T),e&&t(F),e&&t(Y),w(ce,e),e&&t(me),e&&t(V),e&&t(Oe),e&&t(oe),e&&t(Je),e&&t(Re),e&&t(Ne),e&&t(g),e&&t(js),e&&t(ke),e&&t(_e),e&&t(Ke),e&&t(ks),e&&t(Ye),e&&t(fs),e&&t(ns),w(Ve),e&&t(Fs),e&&t(Ce),e&&t(zs),e&&t(vs),w(ys),e&&t(Ct),e&&t(We),e&&t(Hs),w(Ps,e),e&&t(Se),e&&t(Cs),e&&t(Kt),e&&t(bs),e&&t(Vt),e&&t(tt),e&&t(Ds),w(Ts,e),e&&t(mt),w(at,e),e&&t(ft),e&&t(Ze),e&&t(St),w(Bs,e),e&&t(rt),w(_t,e),e&&t(Qt),e&&t(qe),e&&t(ma),w(os,e),e&&t(At),e&&t(Lt),e&&t(vt),w(m,e),e&&t(X),w(Nt,e),e&&t(is),e&&t(bt),e&&t(Sa),w(qs,e),e&&t(Aa),w(As,e),e&&t(La),e&&t(Ks),e&&t(Dn),w(Na,e),e&&t(Tn),w(Xs,e),e&&t(Sn),e&&t(Za),e&&t(Ls),w(Ma,e),e&&t(An),w(Oa,e),e&&t(Ln),e&&t(Ot),e&&t(Nn),w($t,e),e&&t(Mn),w(va,e),e&&t(ba),e&&t(ta),w(Ua),e&&t(On),w(Ha,e),e&&t(Fn),e&&t(es),e&&t(Io),w(Hn,e),e&&t(Bo),e&&t(na),e&&t(Ro),w(on,e),e&&t(Ko),e&&t(Ia),e&&t(Xo),e&&t(un),e&&t(Vo),w(Bn,e),e&&t(Go),e&&t(Ba),e&&t(Wo),e&&t(Ra),e&&t(Qo),e&&t(Wr),e&&t(Jo),w(Rn,e),e&&t(Yo),e&&t(pn),e&&t(Zo),w(Kn,e),e&&t(ei),w(Xn,e),e&&t(si),e&&t(ra),e&&t(ti),e&&t(la),e&&t(ai),w(Vn,e),e&&t(ni),e&&t(Qr),e&&t(ri),w(dn,e),e&&t(li),w(cn,e),e&&t(oi),e&&t(Jr),e&&t(ii),w(Gn,e),e&&t(ui),e&&t(mn),e&&t(pi),Pr[ga].d(e),e&&t(Yr),e&&t(Zr),e&&t(di),e&&t(en),w(Wn),e&&t(ci),e&&t(us),e&&t(mi),e&&t(ps),e&&t(fi),Cr[Ea].d(e),e&&t(sl),e&&t(tl),e&&t(hi),w(Jn,e),e&&t(_i),w(Yn,e),e&&t(vi),e&&t(hn),e&&t(bi),w(Zn,e),e&&t($i),w(er,e),e&&t(gi),e&&t(al),e&&t(qi),w(sr,e),e&&t(Ei),w(tr,e),e&&t(ji),e&&t(nl),e&&t(ki),w(ar,e),e&&t(wi),w(nr,e),e&&t(xi),Dr[ka].d(e),e&&t(rl),e&&t(sn),w(rr),e&&t(zi),w(lr,e),e&&t(yi),lt&&lt.d(e),e&&t(ll),e&&t(Ka),e&&t(Pi),e&&t(oa),e&&t(Ci),w(pr,e),e&&t(Di),e&&t(Xa),e&&t(Ti),w(dr,e),e&&t(Si),e&&t(il),e&&t(Ai),e&&t(ul),e&&t(Li),w(cr,e),e&&t(Ni),w(mr,e),e&&t(Mi),e&&t(Vs),e&&t(Oi),w(_r,e),e&&t(Fi),w(vr,e),e&&t(Ui),w(br,e),e&&t(Hi),w($r,e),e&&t(Ii),e&&t(pl),e&&t(Bi),Tr[xa].d(e),e&&t(dl),e&&t(vn),e&&t(Ri),e&&t(tn),w(gr),e&&t(Ki),e&&t(Va),e&&t(Xi),w(qr,e),e&&t(Vi),e&&t($n),e&&t(Gi),e&&t(gn),e&&t(Wi),w(Er,e),e&&t(Qi),Sr[ya].d(e),e&&t(ml),Es&&Es.d(e),e&&t(fl),e&&t(an),w(jr),e&&t(Ji),e&&t(qt),e&&t(Yi),w(kr,e),e&&t(Zi),w(wr,e),e&&t(eu),e&&t(ia),e&&t(su),w(xr,e),e&&t(tu),w(zr,e),e&&t(au),e&&t(_l),e&&t(nu),w(En,e)}}}const Oh={local:"traduction",sections:[{local:"prparation-des-donnes",sections:[{local:"le-jeu-de-donnes-kde4",title:"Le jeu de donn\xE9es KDE4"},{local:"traitement-des-donnes",title:"Traitement des donn\xE9es"}],title:"Pr\xE9paration des donn\xE9es"},{local:"ifinetuneri-le-modle-avec-lapi-trainer",title:"<i>Finetuner</i> le mod\xE8le avec l'API `Trainer`"},{local:"ifinetuneri-du-modle-avec-keras",sections:[{local:"assemblage-des-donnes",title:"Assemblage des donn\xE9es"},{local:"mtriques",title:"M\xE9triques"},{local:"ifinetuneri-le-modle",title:"<i>Finetuner</i> le mod\xE8le"}],title:"<i>Finetuner</i> du mod\xE8le avec Keras"},{local:"une-boucle-dentranement-personnalise",sections:[{local:"prparer-le-tout-pour-lentranement",title:"Pr\xE9parer le tout pour l'entra\xEEnement"},{local:"boucle-dentranement",title:"Boucle d'entra\xEEnement"},{local:"utilisation-du-modle-ifinetuni",title:"Utilisation du mod\xE8le <i>finetun\xE9</i>"}],title:"Une boucle d'entra\xEEnement personnalis\xE9e"}],title:"Traduction"};function Fh(ee,u,q){let h="pt";return hh(()=>{const x=new URLSearchParams(window.location.search);q(0,h=x.get("fw")||"pt")}),[h]}class Vh extends dh{constructor(u){super();ch(this,u,Fh,Mh,mh,{})}}export{Vh as default,Oh as metadata};
