<meta charset="utf-8" /><meta http-equiv="content-security-policy" content=""><meta name="hf:doc:metadata" content="{&quot;local&quot;:&quot;&quot;,&quot;sections&quot;:[{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;é€‰æ‹©ç”¨äºæ©ç è¯­è¨€å»ºæ¨¡çš„é¢„è®­ç»ƒæ¨¡å‹&quot;},{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;æ•°æ®é›†&quot;},{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;é¢„å¤„ç†æ•°æ®&quot;},{&quot;local&quot;:&quot;trainer-api-distilbert&quot;,&quot;sections&quot;:[{&quot;local&quot;:&quot;perplexity&quot;,&quot;title&quot;:&quot;è¯­è¨€æ¨¡å‹çš„perplexity&quot;}],&quot;title&quot;:&quot;ä½¿ç”¨ `Trainer` API å¾®è°ƒDistilBERT&quot;},{&quot;local&quot;:&quot;accelerate-distilbert&quot;,&quot;title&quot;:&quot;ä½¿ç”¨ ğŸ¤— Accelerate å¾®è°ƒ DistilBERT&quot;},{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;ä½¿ç”¨æˆ‘ä»¬å¾®è°ƒçš„æ¨¡å‹&quot;}],&quot;title&quot;:&quot;å¾®è°ƒæ©ç è¯­è¨€æ¨¡å‹&quot;}" data-svelte="svelte-1phssyn">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/assets/pages/__layout.svelte-hf-doc-builder.css">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/start-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/vendor-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/paths-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/pages/__layout.svelte-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/pages/chapter7/3.mdx-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/Tip-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/Youtube-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/IconCopyLink-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/CodeBlock-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/DocNotebookDropdown-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/FrameworkSwitchCourse-hf-doc-builder.js"> 





<div class="bg-white leading-none border border-gray-100 rounded-lg flex p-0.5 w-56 text-sm mb-4"><a class="flex justify-center flex-1 py-1.5 px-2.5 focus:outline-none !no-underline rounded-l bg-red-50 dark:bg-transparent text-red-600" href="?fw=pt"><svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><defs><clipPath id="a"><rect x="3.05" y="0.5" width="25.73" height="31" fill="none"></rect></clipPath></defs><g clip-path="url(#a)"><path d="M24.94,9.51a12.81,12.81,0,0,1,0,18.16,12.68,12.68,0,0,1-18,0,12.81,12.81,0,0,1,0-18.16l9-9V5l-.84.83-6,6a9.58,9.58,0,1,0,13.55,0ZM20.44,9a1.68,1.68,0,1,1,1.67-1.67A1.68,1.68,0,0,1,20.44,9Z" fill="#ee4c2c"></path></g></svg>
			Pytorch
		</a><a class="flex justify-center flex-1 py-1.5 px-2.5 focus:outline-none !no-underline rounded-r text-gray-500 filter grayscale" href="?fw=tf"><svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="0.94em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 274"><path d="M145.726 42.065v42.07l72.861 42.07v-42.07l-72.86-42.07zM0 84.135v42.07l36.43 21.03V105.17L0 84.135zm109.291 21.035l-36.43 21.034v126.2l36.43 21.035v-84.135l36.435 21.035v-42.07l-36.435-21.034V105.17z" fill="#E55B2D"></path><path d="M145.726 42.065L36.43 105.17v42.065l72.861-42.065v42.065l36.435-21.03v-84.14zM255.022 63.1l-36.435 21.035v42.07l36.435-21.035V63.1zm-72.865 84.135l-36.43 21.035v42.07l36.43-21.036v-42.07zm-36.43 63.104l-36.436-21.035v84.135l36.435-21.035V210.34z" fill="#ED8E24"></path><path d="M145.726 0L0 84.135l36.43 21.035l109.296-63.105l72.861 42.07L255.022 63.1L145.726 0zm0 126.204l-36.435 21.03l36.435 21.036l36.43-21.035l-36.43-21.03z" fill="#F8BF3C"></path></svg>
			TensorFlow
		</a></div>
<h1 id="">å¾®è°ƒæ©ç è¯­è¨€æ¨¡å‹</h1>


<div class="flex space-x-1 absolute z-10 right-0 top-0">
	<a href="https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter7/section3_pt.ipynb" target="_blank"><img alt="Open In Colab" class="!m-0" src="https://colab.research.google.com/assets/colab-badge.svg"></a>
	<a href="https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter7/section3_pt.ipynb" target="_blank"><img alt="Open In Studio Lab" class="!m-0" src="https://studiolab.sagemaker.aws/studiolab.svg"></a></div>
<p>å¯¹äºè®¸å¤šæ¶‰åŠ Transformer æ¨¡å‹çš„ NLP ç¨‹åº, ä½ å¯ä»¥ç®€å•åœ°ä» Hugging Face Hub ä¸­è·å–ä¸€ä¸ªé¢„è®­ç»ƒçš„æ¨¡å‹, ç„¶åç›´æ¥åœ¨ä½ çš„æ•°æ®ä¸Šå¯¹å…¶è¿›è¡Œå¾®è°ƒ, ä»¥å®Œæˆæ‰‹å¤´çš„ä»»åŠ¡ã€‚åªè¦ç”¨äºé¢„è®­ç»ƒçš„è¯­æ–™åº“ä¸ç”¨äºå¾®è°ƒçš„è¯­æ–™åº“æ²¡æœ‰å¤ªå¤§åŒºåˆ«, è¿ç§»å­¦ä¹ é€šå¸¸ä¼šäº§ç”Ÿå¾ˆå¥½çš„ç»“æœã€‚ </p>
<p>ä½†æ˜¯, åœ¨æŸäº›æƒ…å†µä¸‹, ä½ éœ€è¦å…ˆå¾®è°ƒæ•°æ®ä¸Šçš„è¯­è¨€æ¨¡å‹, ç„¶åå†è®­ç»ƒç‰¹å®šäºä»»åŠ¡çš„headã€‚ä¾‹å¦‚, å¦‚æœæ‚¨çš„æ•°æ®é›†åŒ…å«æ³•å¾‹åˆåŒæˆ–ç§‘å­¦æ–‡ç« , åƒ BERT è¿™æ ·çš„æ™®é€š Transformer æ¨¡å‹é€šå¸¸ä¼šå°†æ‚¨è¯­æ–™åº“ä¸­çš„ç‰¹å®šé¢†åŸŸè¯è§†ä¸ºç¨€æœ‰æ ‡è®°, ç»“æœæ€§èƒ½å¯èƒ½ä¸å°½å¦‚äººæ„ã€‚é€šè¿‡åœ¨åŸŸå†…æ•°æ®ä¸Šå¾®è°ƒè¯­è¨€æ¨¡å‹, ä½ å¯ä»¥æé«˜è®¸å¤šä¸‹æ¸¸ä»»åŠ¡çš„æ€§èƒ½, è¿™æ„å‘³ç€æ‚¨é€šå¸¸åªéœ€æ‰§è¡Œä¸€æ¬¡æ­¤æ­¥éª¤!</p>
<p>è¿™ç§åœ¨åŸŸå†…æ•°æ®ä¸Šå¾®è°ƒé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹çš„è¿‡ç¨‹é€šå¸¸ç§°ä¸º <em>é¢†åŸŸé€‚åº”</em>ã€‚ å®ƒäº 2018 å¹´ç”± <a href="https://arxiv.org/abs/1801.06146" rel="nofollow">ULMFiT</a>æ¨å¹¿, è¿™æ˜¯ä½¿è¿ç§»å­¦ä¹ çœŸæ­£é€‚ç”¨äº NLP çš„é¦–æ‰¹ç¥ç»æ¶æ„ä¹‹ä¸€ (åŸºäº LSTM)ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†ä½¿ç”¨ ULMFiT è¿›è¡ŒåŸŸè‡ªé€‚åº”çš„ç¤ºä¾‹; åœ¨æœ¬èŠ‚ä¸­, æˆ‘ä»¬å°†åšç±»ä¼¼çš„äº‹æƒ…, ä½†ä½¿ç”¨çš„æ˜¯ Transformer è€Œä¸æ˜¯ LSTM!</p>
<div class="flex justify-center"><img class="block dark:hidden" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/ulmfit.svg" alt="ULMFiT.">
<img class="hidden dark:block" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/ulmfit-dark.svg" alt="ULMFiT."></div>
<p>åœ¨æœ¬èŠ‚ç»“æŸæ—¶, ä½ å°†åœ¨Hubä¸Šæ‹¥æœ‰ä¸€ä¸ª<a href="https://huggingface.co/huggingface-course/distilbert-base-uncased-finetuned-imdb?text=This+is+a+great+%5BMASK%5D." rel="nofollow">æ©ç è¯­è¨€æ¨¡å‹(masked language model)</a>, è¯¥æ¨¡å‹å¯ä»¥è‡ªåŠ¨å®Œæˆå¥å­, å¦‚ä¸‹æ‰€ç¤º:</p>
<iframe src="https://hf.space/gradioiframe/course-demos/distilbert-base-uncased-finetuned-imdb/+" frameborder="0" height="300" title="Gradio app" class="block dark:hidden container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>
<iframe src="https://hf.space/gradioiframe/course-demos/distilbert-base-uncased-finetuned-imdb-darkmode/+" frameborder="0" height="300" title="Gradio app" class="hidden dark:block container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>
<p>è®©æˆ‘ä»¬å¼€å§‹å§!</p>
<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/mqElG5QJWUg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>ğŸ™‹ å¦‚æœæ‚¨å¯¹â€œæ©ç è¯­è¨€å»ºæ¨¡â€å’Œâ€œé¢„è®­ç»ƒæ¨¡å‹â€è¿™ä¸¤ä¸ªæœ¯è¯­æ„Ÿåˆ°é™Œç”Ÿ, è¯·æŸ¥çœ‹<a href="/course/chapter1">ç¬¬ä¸€ç« </a>, æˆ‘ä»¬åœ¨å…¶ä¸­è§£é‡Šäº†æ‰€æœ‰è¿™äº›æ ¸å¿ƒæ¦‚å¿µ, å¹¶é™„æœ‰è§†é¢‘!</p></div>
<h2 id="">é€‰æ‹©ç”¨äºæ©ç è¯­è¨€å»ºæ¨¡çš„é¢„è®­ç»ƒæ¨¡å‹</h2>
<p>é¦–å…ˆ, è®©æˆ‘ä»¬ä¸ºæ©ç è¯­è¨€å»ºæ¨¡é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚å¦‚ä»¥ä¸‹å±å¹•æˆªå›¾æ‰€ç¤º, ä½ å¯ä»¥é€šè¿‡åœ¨<a href="https://huggingface.co/models?pipeline_tag=fill-mask&sort=downloads" rel="nofollow">Hugging Face Hub</a>ä¸Šåº”ç”¨â€Fill-Maskâ€è¿‡æ»¤å™¨æ‰¾åˆ°:</p>
<div class="flex justify-center"><img src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/mlm-models.png" alt="Hub models." width="80%"></div>
<p>å°½ç®¡ BERT å’Œ RoBERTa ç³»åˆ—æ¨¡å‹çš„ä¸‹è½½é‡æœ€å¤§, ä½†æˆ‘ä»¬å°†ä½¿ç”¨åä¸º <a href="https://huggingface.co/distilbert-base-uncased" rel="nofollow">DistilBERT</a>çš„æ¨¡å‹ã€‚
å¯ä»¥æ›´å¿«åœ°è®­ç»ƒ, è€Œä¸‹æ¸¸æ€§èƒ½å‡ ä¹æ²¡æœ‰æŸå¤±ã€‚è¿™ä¸ªæ¨¡å‹ä½¿ç”¨ä¸€ç§ç§°ä¸º<a href="https://en.wikipedia.org/wiki/Knowledge_distillation" rel="nofollow"><em>çŸ¥è¯†è’¸é¦</em></a>çš„ç‰¹æ®ŠæŠ€æœ¯è¿›è¡Œè®­ç»ƒ, å…¶ä¸­ä½¿ç”¨åƒ BERT è¿™æ ·çš„å¤§å‹â€œæ•™å¸ˆæ¨¡å‹â€æ¥æŒ‡å¯¼å‚æ•°å°‘å¾—å¤šçš„â€œå­¦ç”Ÿæ¨¡å‹â€çš„è®­ç»ƒã€‚åœ¨æœ¬èŠ‚ä¸­å¯¹çŸ¥è¯†è’¸é¦ç»†èŠ‚çš„è§£é‡Šä¼šä½¿æˆ‘ä»¬ç¦»é¢˜å¤ªè¿œ, ä½†å¦‚æœä½ æœ‰å…´è¶£, å¯ä»¥é˜…è¯»æ‰€æœ‰ç›¸å…³å†…å®¹ <a href="https://learning.oreilly.com/library/view/natural-language-processing/9781098103231/ch05.html" rel="nofollow"><em>Natural Language Processing with Transformers</em></a> (ä¿—ç§°Transformersæ•™ç§‘ä¹¦)ã€‚</p>
<p>è®©æˆ‘ä»¬ç»§ç»­, ä½¿ç”¨ <code>AutoModelForMaskedLM</code> ç±»ä¸‹è½½ DistilBERT:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForMaskedLM

model_checkpoint = <span class="hljs-string">&quot;distilbert-base-uncased&quot;</span>
model = AutoModelForMaskedLM.from_pretrained(model_checkpoint)<!-- HTML_TAG_END --></pre></div>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ <code>num_parameters()</code> æ–¹æ³•æŸ¥çœ‹æ¨¡å‹æœ‰å¤šå°‘å‚æ•°:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->distilbert_num_parameters = model.num_parameters() / <span class="hljs-number">1_000_000</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; DistilBERT number of parameters: <span class="hljs-subst">{<span class="hljs-built_in">round</span>(distilbert_num_parameters)}</span>M&#x27;&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; BERT number of parameters: 110M&#x27;&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; DistilBERT number of parameters: 67M&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; BERT number of parameters: 110M&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>DistilBERT å¤§çº¦æœ‰ 6700 ä¸‡ä¸ªå‚æ•°, å¤§çº¦æ¯” BERT åŸºæœ¬æ¨¡å‹å°ä¸¤å€, è¿™å¤§è‡´æ„å‘³ç€è®­ç»ƒçš„é€Ÿåº¦æé«˜äº†ä¸¤å€ â€” éå¸¸æ£’! ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ¨¡å‹é¢„æµ‹ä»€ä¹ˆæ ·çš„æ ‡è®°æœ€æœ‰å¯èƒ½å®Œæˆä¸€å°éƒ¨åˆ†æ–‡æœ¬:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->text = <span class="hljs-string">&quot;This is a great [MASK].&quot;</span><!-- HTML_TAG_END --></pre></div>
<p>ä½œä¸ºäººç±», æˆ‘ä»¬å¯ä»¥æƒ³è±¡ <code>[MASK]</code> æ ‡è®°æœ‰å¾ˆå¤šå¯èƒ½æ€§, ä¾‹å¦‚ â€œdayâ€ã€ â€œrideâ€ æˆ–è€… â€œpaintingâ€ã€‚å¯¹äºé¢„è®­ç»ƒæ¨¡å‹, é¢„æµ‹å–å†³äºæ¨¡å‹æ‰€è®­ç»ƒçš„è¯­æ–™åº“, å› ä¸ºå®ƒä¼šå­¦ä¹ è·å–æ•°æ®ä¸­å­˜åœ¨çš„ç»Ÿè®¡æ¨¡å¼ã€‚ä¸ BERT ä¸€æ ·, DistilBERT åœ¨<a href="https://huggingface.co/datasets/wikipedia" rel="nofollow">English Wikipedia</a> å’Œ <a href="https://huggingface.co/datasets/bookcorpus" rel="nofollow">BookCorpus</a> æ•°æ®é›†ä¸Šè¿›è¡Œé¢„è®­ç»ƒ, æ‰€ä»¥æˆ‘ä»¬æœŸæœ›å¯¹ <code>[MASK]</code> çš„é¢„æµ‹èƒ½å¤Ÿåæ˜ è¿™äº›é¢†åŸŸã€‚ä¸ºäº†é¢„æµ‹æ©ç , æˆ‘ä»¬éœ€è¦ DistilBERT çš„æ ‡è®°å™¨æ¥ç”Ÿæˆæ¨¡å‹çš„è¾“å…¥, æ‰€ä»¥è®©æˆ‘ä»¬ä¹Ÿä» Hub ä¸‹è½½å®ƒ:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained(model_checkpoint)<!-- HTML_TAG_END --></pre></div>
<p>ä½¿ç”¨æ ‡è®°å™¨å’Œæ¨¡å‹, æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†æˆ‘ä»¬çš„æ–‡æœ¬ç¤ºä¾‹ä¼ é€’ç»™æ¨¡å‹, æå– logits, å¹¶æ‰“å°å‡ºå‰ 5 ä¸ªå€™é€‰:</p>
<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">import</span> torch

inputs = tokenizer(text, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>)
token_logits = model(**inputs).logits
<span class="hljs-comment"># Find the location of [MASK] and extract its logits</span>
mask_token_index = torch.where(inputs[<span class="hljs-string">&quot;input_ids&quot;</span>] == tokenizer.mask_token_id)[<span class="hljs-number">1</span>]
mask_token_logits = token_logits[<span class="hljs-number">0</span>, mask_token_index, :]
<span class="hljs-comment"># Pick the [MASK] candidates with the highest logits</span>
top_5_tokens = torch.topk(mask_token_logits, <span class="hljs-number">5</span>, dim=<span class="hljs-number">1</span>).indices[<span class="hljs-number">0</span>].tolist()

<span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> top_5_tokens:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; <span class="hljs-subst">{text.replace(tokenizer.mask_token, tokenizer.decode([token]))}</span>&#x27;&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great deal.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great success.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great adventure.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great idea.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great feat.&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>æˆ‘ä»¬å¯ä»¥ä»è¾“å‡ºä¸­çœ‹åˆ°æ¨¡å‹çš„é¢„æµ‹æ˜¯æŒ‡æ—¥å¸¸ç”¨è¯­, é‰´äºè‹±è¯­ç»´åŸºç™¾ç§‘çš„åŸºç¡€, è¿™ä¹Ÿè®¸å¹¶ä¸å¥‡æ€ªã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•å°†è¿™ä¸ªé¢†åŸŸæ”¹å˜ä¸ºæ›´å°ä¼—çš„ä¸œè¥¿ â€” é«˜åº¦ä¸¤æåˆ†åŒ–çš„ç”µå½±è¯„è®º!</p>
<h2 id="">æ•°æ®é›†</h2>
<p>ä¸ºäº†å±•ç¤ºåŸŸé€‚é…, æˆ‘ä»¬å°†ä½¿ç”¨è‘—åçš„<a href="https://huggingface.co/datasets/imdb" rel="nofollow">å¤§å‹ç”µå½±è¯„è®ºæ•°æ®é›†(Large Movie Review Dataset)</a> (æˆ–è€…ç®€ç§°ä¸ºIMDb), è¿™æ˜¯ä¸€ä¸ªç”µå½±è¯„è®ºè¯­æ–™åº“, é€šå¸¸ç”¨äºå¯¹æƒ…æ„Ÿåˆ†ææ¨¡å‹è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚é€šè¿‡åœ¨è¿™ä¸ªè¯­æ–™åº“ä¸Šå¯¹ DistilBERT è¿›è¡Œå¾®è°ƒ, æˆ‘ä»¬é¢„è®¡è¯­è¨€æ¨¡å‹å°†æ ¹æ®ç»´åŸºç™¾ç§‘çš„äº‹å®æ•°æ®è°ƒæ•´å…¶è¯æ±‡è¡¨, è¿™äº›æ•°æ®å·²ç»é¢„å…ˆè®­ç»ƒåˆ°ç”µå½±è¯„è®ºä¸­æ›´ä¸»è§‚çš„å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ğŸ¤— Datasetsä¸­çš„<code>load_dataset()</code>å‡½æ•°ä»Hugging Face ä¸­è·å–æ•°æ®:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset

imdb_dataset = load_dataset(<span class="hljs-string">&quot;imdb&quot;</span>)
imdb_dataset<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-string">&#x27;label&#x27;</span>],
        num_rows: <span class="hljs-number">25000</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-string">&#x27;label&#x27;</span>],
        num_rows: <span class="hljs-number">25000</span>
    })
    unsupervised: Dataset({
        features: [<span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-string">&#x27;label&#x27;</span>],
        num_rows: <span class="hljs-number">50000</span>
    })
})<!-- HTML_TAG_END --></pre></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>train</code> å’Œ <code>test</code> æ¯ä¸ªæ‹†åˆ†åŒ…å« 25,000 æ¡è¯„è®º, è€Œæœ‰ä¸€ä¸ªæœªæ ‡è®°çš„æ‹†åˆ†ç§°ä¸º <code>unsupervised</code> åŒ…å« 50,000 æ¡è¯„è®ºã€‚è®©æˆ‘ä»¬çœ‹ä¸€äº›ç¤ºä¾‹, ä»¥äº†è§£æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„æ–‡æœ¬ç±»å‹ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨æœ¬è¯¾ç¨‹çš„å‰å‡ ç« ä¸­æ‰€åšçš„é‚£æ ·, æˆ‘ä»¬å°†é“¾æ¥ <code>Dataset.shuffle()</code> å’Œ <code>Dataset.select()</code> å‡½æ•°åˆ›å»ºéšæœºæ ·æœ¬:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->sample = imdb_dataset[<span class="hljs-string">&quot;train&quot;</span>].shuffle(seed=<span class="hljs-number">42</span>).select(<span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>))

<span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> sample:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&#x27;&gt;&gt;&gt; Review: <span class="hljs-subst">{row[<span class="hljs-string">&#x27;text&#x27;</span>]}</span>&#x27;&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; Label: <span class="hljs-subst">{row[<span class="hljs-string">&#x27;label&#x27;</span>]}</span>&#x27;&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->
<span class="hljs-string">&#x27;&gt;&gt;&gt; Review: This is your typical Priyadarshan movie--a bunch of loony characters out on some silly mission. His signature climax has the entire cast of the film coming together and fighting each other in some crazy moshpit over hidden money. Whether it is a winning lottery ticket in Malamaal Weekly, black money in Hera Pheri, &quot;kodokoo&quot; in Phir Hera Pheri, etc., etc., the director is becoming ridiculously predictable. Don\&#x27;t get me wrong; as clichÃ©d and preposterous his movies may be, I usually end up enjoying the comedy. However, in most his previous movies there has actually been some good humor, (Hungama and Hera Pheri being noteworthy ones). Now, the hilarity of his films is fading as he is using the same formula over and over again.&lt;br /&gt;&lt;br /&gt;Songs are good. Tanushree Datta looks awesome. Rajpal Yadav is irritating, and Tusshar is not a whole lot better. Kunal Khemu is OK, and Sharman Joshi is the best.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Label: 0&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; Review: Okay, the story makes no sense, the characters lack any dimensionally, the best dialogue is ad-libs about the low quality of movie, the cinematography is dismal, and only editing saves a bit of the muddle, but Sam&quot; Peckinpah directed the film. Somehow, his direction is not enough. For those who appreciate Peckinpah and his great work, this movie is a disappointment. Even a great cast cannot redeem the time the viewer wastes with this minimal effort.&lt;br /&gt;&lt;br /&gt;The proper response to the movie is the contempt that the director San Peckinpah, James Caan, Robert Duvall, Burt Young, Bo Hopkins, Arthur Hill, and even Gig Young bring to their work. Watch the great Peckinpah films. Skip this mess.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Label: 0&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; Review: I saw this movie at the theaters when I was about 6 or 7 years old. I loved it then, and have recently come to own a VHS version. &lt;br /&gt;&lt;br /&gt;My 4 and 6 year old children love this movie and have been asking again and again to watch it. &lt;br /&gt;&lt;br /&gt;I have enjoyed watching it again too. Though I have to admit it is not as good on a little TV.&lt;br /&gt;&lt;br /&gt;I do not have older children so I do not know what they would think of it. &lt;br /&gt;&lt;br /&gt;The songs are very cute. My daughter keeps singing them over and over.&lt;br /&gt;&lt;br /&gt;Hope this helps.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Label: 1&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>æ˜¯çš„, è¿™äº›è‚¯å®šæ˜¯ç”µå½±è¯„è®º, å¦‚æœä½ å¹´é¾„è¶³å¤Ÿ,ä½ ç”šè‡³å¯èƒ½ä¼šç†è§£ä¸Šæ¬¡è¯„è®ºä¸­å…³äºæ‹¥æœ‰ VHS ç‰ˆæœ¬çš„è¯„è®ºğŸ˜œ! è™½ç„¶æˆ‘ä»¬ä¸éœ€è¦è¯­è¨€å»ºæ¨¡çš„æ ‡ç­¾, ä½†æˆ‘ä»¬å·²ç»å¯ä»¥çœ‹åˆ° <code>0</code> è¡¨ç¤ºè´Ÿé¢è¯„è®º, è€Œ <code>1</code> å¯¹åº”æ­£é¢ã€‚</p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>âœï¸ <strong>è¯•è¯•çœ‹!</strong> åˆ›å»º <code>æ— ç›‘ç£</code> æ‹†åˆ†çš„éšæœºæ ·æœ¬, å¹¶éªŒè¯æ ‡ç­¾æ—¢ä¸æ˜¯ <code>0</code> ä¹Ÿä¸æ˜¯ <code>1</code>ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­, ä½ è¿˜å¯ä»¥æ£€æŸ¥ <code>train</code> å’Œ <code>test</code> æ‹†åˆ†ä¸­çš„æ ‡ç­¾æ˜¯å¦ç¡®å®ä¸º <code>0</code> æˆ– <code>1</code> â€” è¿™æ˜¯æ¯ä¸ª NLP ä»ä¸šè€…åœ¨æ–°é¡¹ç›®å¼€å§‹æ—¶éƒ½åº”è¯¥æ‰§è¡Œçš„æœ‰ç”¨çš„å¥å…¨æ€§æ£€æŸ¥!</p></div>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å¿«é€Ÿæµè§ˆäº†æ•°æ®, è®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶ä¸ºæ©ç è¯­è¨€å»ºæ¨¡åšå‡†å¤‡ã€‚æ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„, ä¸æˆ‘ä»¬åœ¨<a href="/course/chapter3">ç¬¬ä¸‰ç« </a>ä¸­çœ‹åˆ°çš„åºåˆ—åˆ†ç±»ä»»åŠ¡ç›¸æ¯”, è¿˜éœ€è¦é‡‡å–ä¸€äº›é¢å¤–çš„æ­¥éª¤ã€‚è®©æˆ‘ä»¬ç»§ç»­!</p>
<h2 id="">é¢„å¤„ç†æ•°æ®</h2>
<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/8PmhEIXhBvI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>å¯¹äºè‡ªå›å½’å’Œæ©ç è¯­è¨€å»ºæ¨¡, ä¸€ä¸ªå¸¸è§çš„é¢„å¤„ç†æ­¥éª¤æ˜¯è¿æ¥æ‰€æœ‰ç¤ºä¾‹, ç„¶åå°†æ•´ä¸ªè¯­æ–™åº“æ‹†åˆ†ä¸ºç›¸åŒå¤§å°çš„å—ã€‚ è¿™ä¸æˆ‘ä»¬é€šå¸¸çš„æ–¹æ³•å®Œå…¨ä¸åŒ, æˆ‘ä»¬åªæ˜¯ç®€å•åœ°æ ‡è®°å•ä¸ªç¤ºä¾‹ã€‚ä¸ºä»€ä¹ˆè¦å°†æ‰€æœ‰å†…å®¹è¿æ¥åœ¨ä¸€èµ·? åŸå› æ˜¯å•ä¸ªç¤ºä¾‹å¦‚æœå¤ªé•¿å¯èƒ½ä¼šè¢«æˆªæ–­, è¿™å°†å¯¼è‡´ä¸¢å¤±å¯èƒ½å¯¹è¯­è¨€å»ºæ¨¡ä»»åŠ¡æœ‰ç”¨çš„ä¿¡æ¯!</p>
<p>å› æ­¤, æˆ‘ä»¬å°†åƒå¾€å¸¸ä¸€æ ·é¦–å…ˆæ ‡è®°æˆ‘ä»¬çš„è¯­æ–™åº“, ä½†æ˜¯ <em>æ²¡æœ‰</em> åœ¨æˆ‘ä»¬çš„æ ‡è®°å™¨ä¸­è®¾ç½® <code>truncation=True</code> é€‰é¡¹ã€‚ æˆ‘ä»¬è¿˜å°†è·å–å¯ç”¨çš„å•è¯ ID ((å¦‚æœæˆ‘ä»¬ä½¿ç”¨å¿«é€Ÿæ ‡è®°å™¨, å®ƒä»¬æ˜¯å¯ç”¨çš„, å¦‚ <a href="/course/chapter6/3">ç¬¬å…­ç« </a>ä¸­æ‰€è¿°), å› ä¸ºæˆ‘ä»¬ç¨åå°†éœ€è¦å®ƒä»¬æ¥è¿›è¡Œå…¨å­—å±è”½ã€‚æˆ‘ä»¬å°†æŠŠå®ƒåŒ…è£…åœ¨ä¸€ä¸ªç®€å•çš„å‡½æ•°ä¸­, å½“æˆ‘ä»¬åœ¨åšçš„æ—¶å€™, æˆ‘ä»¬å°†åˆ é™¤ <code>text</code> å’Œ <code>label</code> åˆ—, å› ä¸ºæˆ‘ä»¬ä¸å†éœ€è¦å®ƒä»¬:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize_function</span>(<span class="hljs-params">examples</span>):
    result = tokenizer(examples[<span class="hljs-string">&quot;text&quot;</span>])
    <span class="hljs-keyword">if</span> tokenizer.is_fast:
        result[<span class="hljs-string">&quot;word_ids&quot;</span>] = [result.word_ids(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(result[<span class="hljs-string">&quot;input_ids&quot;</span>]))]
    <span class="hljs-keyword">return</span> result


<span class="hljs-comment"># Use batched=True to activate fast multithreading!</span>
tokenized_datasets = imdb_dataset.<span class="hljs-built_in">map</span>(
    tokenize_function, batched=<span class="hljs-literal">True</span>, remove_columns=[<span class="hljs-string">&quot;text&quot;</span>, <span class="hljs-string">&quot;label&quot;</span>]
)
tokenized_datasets<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">25000</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">25000</span>
    })
    unsupervised: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">50000</span>
    })
})<!-- HTML_TAG_END --></pre></div>
<p>ç”±äº DistilBERT æ˜¯ä¸€ä¸ªç±»ä¼¼ BERT çš„æ¨¡å‹, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¼–ç æ–‡æœ¬ç”±æˆ‘ä»¬åœ¨å…¶ä»–ç« èŠ‚ä¸­çœ‹åˆ°çš„ <code>input_ids</code> å’Œ <code>attention_mask</code> ç»„æˆ, ä»¥åŠæˆ‘ä»¬æ·»åŠ çš„ <code>word_ids</code>ã€‚ </p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æ ‡è®°äº†æˆ‘ä»¬çš„ç”µå½±è¯„è®º, ä¸‹ä¸€æ­¥æ˜¯å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·å¹¶å°†ç»“æœåˆ†æˆå—ã€‚ ä½†æ˜¯è¿™äº›å—åº”è¯¥æœ‰å¤šå¤§? è¿™æœ€ç»ˆå°†å–å†³äºä½ å¯ç”¨çš„ GPU å†…å­˜é‡, ä½†ä¸€ä¸ªå¥½çš„èµ·ç‚¹æ˜¯æŸ¥çœ‹æ¨¡å‹çš„æœ€å¤§ä¸Šä¸‹æ–‡å¤§å°æ˜¯å¤šå°‘ã€‚è¿™å¯ä»¥é€šè¿‡æ£€æŸ¥æ ‡è®°å™¨çš„ <code>model_max_length</code> å±æ€§æ¥åˆ¤æ–­:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->tokenizer.model_max_length<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-number">512</span><!-- HTML_TAG_END --></pre></div>
<p>è¯¥å€¼æ¥è‡ªäºä¸æ£€æŸ¥ç‚¹ç›¸å…³è”çš„ <em>tokenizer_config.json</em> æ–‡ä»¶; åœ¨è¿™ç§æƒ…å†µä¸‹, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šä¸‹æ–‡å¤§å°æ˜¯ 512 ä¸ªæ ‡è®°, å°±åƒ BERT ä¸€æ ·ã€‚</p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>âœï¸ <strong>è¯•è¯•çœ‹!</strong> ä¸€äº› Transformer æ¨¡å‹, ä¾‹å¦‚ <a href="https://huggingface.co/google/bigbird-roberta-base" rel="nofollow">BigBird</a> å’Œ <a href="hf.co/allenai/longformer-base-4096">Longformer</a>, å®ƒä»¬å…·æœ‰æ¯”BERTå’Œå…¶ä»–æ—©æœŸTransformeræ¨¡å‹æ›´é•¿çš„ä¸Šä¸‹æ–‡é•¿åº¦ã€‚ä¸ºè¿™äº›æ£€æŸ¥ç‚¹ä¹‹ä¸€å®ä¾‹åŒ–æ ‡è®°å™¨, å¹¶éªŒè¯ <code>model_max_length</code> æ˜¯å¦ä¸æ¨¡å‹å¡ä¸Šå¼•ç”¨çš„å†…å®¹ä¸€è‡´ã€‚</p></div>
<p>å› æ­¤, ä»¥ä¾¿åœ¨åƒGoogle Colab é‚£æ ·çš„ GPU ä¸Šè¿è¡Œæˆ‘ä»¬çš„å®éªŒ, æˆ‘ä»¬å°†é€‰æ‹©å¯ä»¥æ”¾å…¥å†…å­˜çš„æ›´å°ä¸€äº›çš„ä¸œè¥¿:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->chunk_size = <span class="hljs-number">128</span><!-- HTML_TAG_END --></pre></div>


<div class="course-tip course-tip-orange bg-gradient-to-br dark:bg-gradient-to-r before:border-orange-500 dark:before:border-orange-800 from-orange-50 dark:from-gray-900 to-white dark:to-gray-950 border border-orange-50 text-orange-700 dark:text-gray-400"><p>è¯·æ³¨æ„, åœ¨å®é™…åœºæ™¯ä¸­ä½¿ç”¨è¾ƒå°çš„å—å¤§å°å¯èƒ½æ˜¯æœ‰å®³çš„, å› æ­¤ä½ åº”è¯¥ä½¿ç”¨ä¸å°†åº”ç”¨æ¨¡å‹çš„ç”¨ä¾‹ç›¸å¯¹åº”çš„å¤§å°ã€‚</p></div>
<p>æœ‰è¶£çš„æ¥äº†ã€‚ä¸ºäº†å±•ç¤ºä¸²è”æ˜¯å¦‚ä½•å·¥ä½œçš„, è®©æˆ‘ä»¬ä»æˆ‘ä»¬çš„æ ‡è®°åŒ–è®­ç»ƒé›†ä¸­å–ä¸€äº›è¯„è®ºå¹¶æ‰“å°å‡ºæ¯ä¸ªè¯„è®ºçš„æ ‡è®°æ•°é‡:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-comment"># Slicing produces a list of lists for each feature</span>
tokenized_samples = tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>][:<span class="hljs-number">3</span>]

<span class="hljs-keyword">for</span> idx, sample <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(tokenized_samples[<span class="hljs-string">&quot;input_ids&quot;</span>]):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; Review <span class="hljs-subst">{idx}</span> length: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(sample)}</span>&#x27;&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; Review 0 length: 200&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Review 1 length: 559&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Review 2 length: 192&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„å­—å…¸ç†è§£æ¥è¿æ¥æ‰€æœ‰ä¾‹å­, å¦‚ä¸‹æ‰€ç¤º:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->concatenated_examples = {
    k: <span class="hljs-built_in">sum</span>(tokenized_samples[k], []) <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> tokenized_samples.keys()
}
total_length = <span class="hljs-built_in">len</span>(concatenated_examples[<span class="hljs-string">&quot;input_ids&quot;</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; Concatenated reviews length: <span class="hljs-subst">{total_length}</span>&#x27;&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; Concatenated reviews length: 951&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>å¾ˆæ£’, æ€»é•¿åº¦æ£€æŸ¥å‡ºæ¥äº† â€” ç°åœ¨, è®©æˆ‘ä»¬å°†è¿æ¥çš„è¯„è®ºæ‹†åˆ†ä¸ºå¤§å°ä¸º <code>block_size</code> çš„å—ã€‚ä¸ºæ­¤, æˆ‘ä»¬è¿­ä»£äº† <code>concatenated_examples</code> ä¸­çš„ç‰¹å¾, å¹¶ä½¿ç”¨åˆ—è¡¨ç†è§£æ¥åˆ›å»ºæ¯ä¸ªç‰¹å¾çš„åˆ‡ç‰‡ã€‚ç»“æœæ˜¯æ¯ä¸ªç‰¹å¾çš„å—å­—å…¸:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->chunks = {
    k: [t[i : i + chunk_size] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, total_length, chunk_size)]
    <span class="hljs-keyword">for</span> k, t <span class="hljs-keyword">in</span> concatenated_examples.items()
}

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chunks[<span class="hljs-string">&quot;input_ids&quot;</span>]:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; Chunk length: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunk)}</span>&#x27;&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 55&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>æ­£å¦‚ä½ åœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹åˆ°çš„, æœ€åä¸€ä¸ªå—é€šå¸¸ä¼šå°äºæœ€å¤§å—å¤§å°ã€‚æœ‰ä¸¤ç§ä¸»è¦çš„ç­–ç•¥æ¥å¤„ç†è¿™ä¸ªé—®é¢˜:</p>
<ul><li>å¦‚æœæœ€åä¸€ä¸ªå—å°äº <code>chunk_size</code>, è¯·åˆ é™¤å®ƒã€‚</li>
<li>å¡«å……æœ€åä¸€ä¸ªå—, ç›´åˆ°å…¶é•¿åº¦ç­‰äº <code>chunk_size</code>ã€‚</li></ul>
<p>æˆ‘ä»¬å°†åœ¨è¿™é‡Œé‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ³•, å› æ­¤è®©æˆ‘ä»¬å°†ä¸Šè¿°æ‰€æœ‰é€»è¾‘åŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­, æˆ‘ä»¬å¯ä»¥å°†å…¶åº”ç”¨äºæˆ‘ä»¬çš„æ ‡è®°åŒ–æ•°æ®é›†:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">group_texts</span>(<span class="hljs-params">examples</span>):
    <span class="hljs-comment"># Concatenate all texts</span>
    concatenated_examples = {k: <span class="hljs-built_in">sum</span>(examples[k], []) <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> examples.keys()}
    <span class="hljs-comment"># Compute length of concatenated texts</span>
    total_length = <span class="hljs-built_in">len</span>(concatenated_examples[<span class="hljs-built_in">list</span>(examples.keys())[<span class="hljs-number">0</span>]])
    <span class="hljs-comment"># We drop the last chunk if it&#x27;s smaller than chunk_size</span>
    total_length = (total_length // chunk_size) * chunk_size
    <span class="hljs-comment"># Split by chunks of max_len</span>
    result = {
        k: [t[i : i + chunk_size] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, total_length, chunk_size)]
        <span class="hljs-keyword">for</span> k, t <span class="hljs-keyword">in</span> concatenated_examples.items()
    }
    <span class="hljs-comment"># Create a new labels column</span>
    result[<span class="hljs-string">&quot;labels&quot;</span>] = result[<span class="hljs-string">&quot;input_ids&quot;</span>].copy()
    <span class="hljs-keyword">return</span> result<!-- HTML_TAG_END --></pre></div>
<p>æ³¨æ„, åœ¨ <code>group_texts()</code> çš„æœ€åä¸€æ­¥ä¸­, æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <code>labels</code> åˆ—, å®ƒæ˜¯ <code>input_ids</code> åˆ—çš„å‰¯æœ¬ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°, è¿™æ˜¯å› ä¸ºåœ¨æ©ç è¯­è¨€å»ºæ¨¡ä¸­, ç›®æ ‡æ˜¯é¢„æµ‹è¾“å…¥æ‰¹æ¬¡ä¸­éšæœºæ©ç çš„æ ‡è®°, å¹¶é€šè¿‡åˆ›å»ºä¸€ä¸ª <code>labels</code> åˆ—, ä»¬ä¸ºæˆ‘ä»¬çš„è¯­è¨€æ¨¡å‹æä¾›äº†åŸºç¡€äº‹å®ä»¥ä¾›å­¦ä¹ ã€‚</p>
<p>ç°åœ¨, è®©æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬å¯ä¿¡èµ–çš„ <code>Dataset.map()</code> å‡½æ•°å°† <code>group_texts()</code> åº”ç”¨åˆ°æˆ‘ä»¬çš„æ ‡è®°åŒ–æ•°æ®é›†:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->lm_datasets = tokenized_datasets.<span class="hljs-built_in">map</span>(group_texts, batched=<span class="hljs-literal">True</span>)
lm_datasets<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">61289</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">59905</span>
    })
    unsupervised: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">122963</span>
    })
})<!-- HTML_TAG_END --></pre></div>
<p>ä½ å¯ä»¥çœ‹åˆ°, å¯¹æ–‡æœ¬è¿›è¡Œåˆ†ç»„, ç„¶åå¯¹æ–‡æœ¬è¿›è¡Œåˆ†å—, äº§ç”Ÿçš„ç¤ºä¾‹æ¯”æˆ‘ä»¬æœ€åˆçš„ 25,000 ç”¨äº <code>train</code>å’Œ <code>test</code> æ‹†åˆ†çš„ç¤ºä¾‹å¤šå¾—å¤šã€‚é‚£æ˜¯å› ä¸ºæˆ‘ä»¬ç°åœ¨æœ‰äº†æ¶‰åŠ <em>è¿ç»­æ ‡è®°</em> çš„ç¤ºä¾‹, è¿™äº›ç¤ºä¾‹è·¨è¶Šäº†åŸå§‹è¯­æ–™åº“ä¸­çš„å¤šä¸ªç¤ºä¾‹ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨å…¶ä¸­ä¸€ä¸ªå—ä¸­æŸ¥æ‰¾ç‰¹æ®Šçš„ <code>[SEP]</code> å’Œ <code>[CLS]</code> æ ‡è®°æ¥æ˜ç¡®çš„çœ‹åˆ°è¿™ä¸€ç‚¹:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->tokenizer.decode(lm_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&quot;input_ids&quot;</span>])<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&quot;.... at.......... high. a classic line : inspector : i&#x27;m here to sack one of your teachers. student : welcome to bromwell high. i expect that many adults of my age think that bromwell high is far fetched. what a pity that it isn&#x27;t! [SEP] [CLS] homelessness ( or houselessness as george carlin stated ) has been an issue for years but never a plan to help those on the street that were once considered human who did everything from going to school, work, or vote for the matter. most people think of the homeless&quot;</span><!-- HTML_TAG_END --></pre></div>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­, ä½ å¯ä»¥çœ‹åˆ°ä¸¤ç¯‡é‡å çš„ç”µå½±è¯„è®º, ä¸€ç¯‡å…³äºé«˜ä¸­ç”µå½±, å¦ä¸€ç¯‡å…³äºæ— å®¶å¯å½’ã€‚ è®©æˆ‘ä»¬ä¹Ÿçœ‹çœ‹æ©ç è¯­è¨€å»ºæ¨¡çš„æ ‡ç­¾æ˜¯ä»€ä¹ˆæ ·çš„:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->tokenizer.decode(lm_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&quot;labels&quot;</span>])<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&quot;.... at.......... high. a classic line : inspector : i&#x27;m here to sack one of your teachers. student : welcome to bromwell high. i expect that many adults of my age think that bromwell high is far fetched. what a pity that it isn&#x27;t! [SEP] [CLS] homelessness ( or houselessness as george carlin stated ) has been an issue for years but never a plan to help those on the street that were once considered human who did everything from going to school, work, or vote for the matter. most people think of the homeless&quot;</span><!-- HTML_TAG_END --></pre></div>
<p>æ­£å¦‚å‰é¢çš„ <code>group_texts()</code> å‡½æ•°æ‰€æœŸæœ›çš„é‚£æ ·, è¿™çœ‹èµ·æ¥ä¸è§£ç åçš„ <code>input_ids</code> ç›¸åŒ â€” ä½†æ˜¯æˆ‘ä»¬çš„æ¨¡å‹æ€ä¹ˆå¯èƒ½å­¦åˆ°ä»»ä½•ä¸œè¥¿å‘¢? æˆ‘ä»¬é”™è¿‡äº†ä¸€ä¸ªå…³é”®æ­¥éª¤: åœ¨è¾“å…¥ä¸­çš„éšæœºä½ç½®æ’å…¥ <code>[MASK]</code> æ ‡è®°! è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ç‰¹æ®Šçš„æ•°æ®æ•´ç†å™¨åœ¨å¾®è°ƒæœŸé—´å³æ—¶æ‰§è¡Œæ­¤æ“ä½œã€‚</p>
<h2 class="relative group"><a id="trainer-api-distilbert" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#trainer-api-distilbert"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>ä½¿ç”¨ <code>Trainer</code> API å¾®è°ƒDistilBERT
	</span></h2>

<p>å¾®è°ƒå±è”½è¯­è¨€æ¨¡å‹å‡ ä¹ä¸å¾®è°ƒåºåˆ—åˆ†ç±»æ¨¡å‹ç›¸åŒ, å°±åƒæˆ‘ä»¬åœ¨ <a href="/course/chapter3">ç¬¬ä¸‰ç« </a>æ‰€ä½œçš„é‚£æ ·ã€‚ å”¯ä¸€çš„åŒºåˆ«æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®æ•´ç†å™¨, å®ƒå¯ä»¥éšæœºå±è”½æ¯æ‰¹æ–‡æœ¬ä¸­çš„ä¸€äº›æ ‡è®°ã€‚å¹¸è¿çš„æ˜¯, ğŸ¤— Transformers ä¸ºè¿™é¡¹ä»»åŠ¡å‡†å¤‡äº†ä¸“ç”¨çš„ <code>DataCollatorForLanguageModeling</code> ã€‚æˆ‘ä»¬åªéœ€è¦å°†å®ƒè½¬é€’ç»™æ ‡è®°å™¨å’Œä¸€ä¸ª <code>mlm_probability</code> å‚æ•°, è¯¥å‚æ•°æŒ‡å®šè¦å±è”½çš„æ ‡è®°çš„åˆ†æ•°ã€‚æˆ‘ä»¬å°†é€‰æ‹© 15%, è¿™æ˜¯ BERT ä½¿ç”¨çš„æ•°é‡ä¹Ÿæ˜¯æ–‡çŒ®ä¸­çš„å¸¸è§é€‰æ‹©:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> DataCollatorForLanguageModeling

data_collator = DataCollatorForLanguageModeling(tokenizer=tokenizer, mlm_probability=<span class="hljs-number">0.15</span>)<!-- HTML_TAG_END --></pre></div>
<p>è¦äº†è§£éšæœºæ©ç çš„å·¥ä½œåŸç†, è®©æˆ‘ä»¬å‘æ•°æ®æ•´ç†å™¨æä¾›ä¸€äº›ç¤ºä¾‹ã€‚ç”±äºå®ƒéœ€è¦ä¸€ä¸ª <code>dict</code> çš„åˆ—è¡¨, å…¶ä¸­æ¯ä¸ª <code>dict</code> è¡¨ç¤ºå•ä¸ªè¿ç»­æ–‡æœ¬å—, æˆ‘ä»¬é¦–å…ˆè¿­ä»£æ•°æ®é›†, ç„¶åå†å°†æ‰¹æ¬¡æä¾›ç»™æ•´ç†å™¨ã€‚æˆ‘ä»¬åˆ é™¤äº†è¿™ä¸ªæ•°æ®æ•´ç†å™¨çš„ <code>&quot;word_ids&quot;</code> é”®, å› ä¸ºå®ƒä¸éœ€è¦å®ƒ:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->samples = [lm_datasets[<span class="hljs-string">&quot;train&quot;</span>][i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]
<span class="hljs-keyword">for</span> sample <span class="hljs-keyword">in</span> samples:
    _ = sample.pop(<span class="hljs-string">&quot;word_ids&quot;</span>)

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> data_collator(samples)[<span class="hljs-string">&quot;input_ids&quot;</span>]:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&#x27;&gt;&gt;&gt; <span class="hljs-subst">{tokenizer.decode(chunk)}</span>&#x27;&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; [CLS] bromwell [MASK] is a cartoon comedy. it ran at the same [MASK] as some other [MASK] about school life, [MASK] as &quot; teachers &quot;. [MASK] [MASK] [MASK] in the teaching [MASK] lead [MASK] to believe that bromwell high\&#x27;[MASK] satire is much closer to reality than is &quot; teachers &quot;. the scramble [MASK] [MASK] financially, the [MASK]ful students whogn [MASK] right through [MASK] pathetic teachers\&#x27;pomp, the pettiness of the whole situation, distinction remind me of the schools i knew and their students. when i saw [MASK] episode in [MASK] a student repeatedly tried to burn down the school, [MASK] immediately recalled. [MASK]...&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; .... at.. [MASK]... [MASK]... high. a classic line plucked inspector : i\&#x27;[MASK] here to [MASK] one of your [MASK]. student : welcome to bromwell [MASK]. i expect that many adults of my age think that [MASK]mwell [MASK] is [MASK] fetched. what a pity that it isn\&#x27;t! [SEP] [CLS] [MASK]ness ( or [MASK]lessness as george å®‡in stated )å…¬ been an issue for years but never [MASK] plan to help those on the street that were once considered human [MASK] did everything from going to school, [MASK], [MASK] vote for the matter. most people think [MASK] the homeless&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>å¾ˆæ£’, æˆåŠŸäº†! æˆ‘ä»¬å¯ä»¥çœ‹åˆ°, <code>[MASK]</code> æ ‡è®°å·²éšæœºæ’å…¥æˆ‘ä»¬æ–‡æœ¬ä¸­çš„ä¸åŒä½ç½®ã€‚ è¿™äº›å°†æ˜¯æˆ‘ä»¬çš„æ¨¡å‹åœ¨è®­ç»ƒæœŸé—´å¿…é¡»é¢„æµ‹çš„æ ‡è®° â€” æ•°æ®æ•´ç†å™¨çš„ç¾å¦™ä¹‹å¤„åœ¨äº, å®ƒå°†éšæœºåŒ–æ¯ä¸ªæ‰¹æ¬¡çš„ <code>[MASK]</code> æ’å…¥! </p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>âœï¸ <strong>è¯•è¯•çœ‹!</strong> å¤šæ¬¡è¿è¡Œä¸Šé¢çš„ä»£ç ç‰‡æ®µ, çœ‹çœ‹éšæœºå±è”½å‘ç”Ÿåœ¨ä½ çœ¼å‰! è¿˜è¦å°† <code>tokenizer.decode()</code> æ–¹æ³•æ›¿æ¢ä¸º <code>tokenizer.convert_ids_to_tokens()</code> ä»¥æŸ¥çœ‹æœ‰æ—¶ä¼šå±è”½ç»™å®šå•è¯ä¸­çš„å•ä¸ªæ ‡è®°, è€Œä¸æ˜¯å…¶ä»–æ ‡è®°ã€‚</p></div>
<p>éšæœºæ©ç çš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯, å½“ä½¿ç”¨ <code>Trainer</code> æ—¶, æˆ‘ä»¬çš„è¯„ä¼°æŒ‡æ ‡å°†ä¸æ˜¯ç¡®å®šæ€§çš„, å› ä¸ºæˆ‘ä»¬å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä½¿ç”¨ç›¸åŒçš„æ•°æ®æ•´ç†å™¨ã€‚ç¨åæˆ‘ä»¬ä¼šçœ‹åˆ°, å½“æˆ‘ä»¬ä½¿ç”¨ ğŸ¤— Accelerate è¿›è¡Œå¾®è°ƒæ—¶, æˆ‘ä»¬å°†å¦‚ä½•åˆ©ç”¨è‡ªå®šä¹‰è¯„ä¼°å¾ªç¯çš„çµæ´»æ€§æ¥å†»ç»“éšæœºæ€§ã€‚</p>
<p>åœ¨ä¸ºæ©ç è¯­è¨€å»ºæ¨¡è®­ç»ƒæ¨¡å‹æ—¶, å¯ä»¥ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯æ˜¯å°†æ•´ä¸ªå•è¯ä¸€èµ·å±è”½, è€Œä¸ä»…ä»…æ˜¯å•ä¸ªæ ‡è®°ã€‚è¿™ç§æ–¹æ³•ç§°ä¸º <em>å…¨è¯å±è”½</em>ã€‚ å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨å…¨è¯å±è”½, æˆ‘ä»¬éœ€è¦è‡ªå·±æ„å»ºä¸€ä¸ªæ•°æ®æ•´ç†å™¨ã€‚æ•°æ®æ•´ç†å™¨åªæ˜¯ä¸€ä¸ªå‡½æ•°, å®ƒæ¥å—ä¸€ä¸ªæ ·æœ¬åˆ—è¡¨å¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºä¸€ä¸ªæ‰¹æ¬¡, æ‰€ä»¥ç°åœ¨è®©æˆ‘ä»¬è¿™æ ·åšå§! æˆ‘ä»¬å°†ä½¿ç”¨ä¹‹å‰è®¡ç®—çš„å•è¯ ID åœ¨å•è¯ç´¢å¼•å’Œç›¸åº”æ ‡è®°ä¹‹é—´è¿›è¡Œæ˜ å°„, ç„¶åéšæœºå†³å®šè¦å±è”½å“ªäº›å•è¯å¹¶å°†è¯¥å±è”½åº”ç”¨äºè¾“å…¥ã€‚è¯·æ³¨æ„, é™¤äº†ä¸æ©ç å¯¹åº”çš„æ ‡ç­¾å¤–, æ‰€æœ‰çš„æ ‡ç­¾å‡ä¸º <code>-100</code>ã€‚</p>
<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">import</span> collections
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> default_data_collator

wwm_probability = <span class="hljs-number">0.2</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">whole_word_masking_data_collator</span>(<span class="hljs-params">features</span>):
    <span class="hljs-keyword">for</span> feature <span class="hljs-keyword">in</span> features:
        word_ids = feature.pop(<span class="hljs-string">&quot;word_ids&quot;</span>)

        <span class="hljs-comment"># Create a map between words and corresponding token indices</span>
        mapping = collections.defaultdict(<span class="hljs-built_in">list</span>)
        current_word_index = -<span class="hljs-number">1</span>
        current_word = <span class="hljs-literal">None</span>
        <span class="hljs-keyword">for</span> idx, word_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(word_ids):
            <span class="hljs-keyword">if</span> word_id <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                <span class="hljs-keyword">if</span> word_id != current_word:
                    current_word = word_id
                    current_word_index += <span class="hljs-number">1</span>
                mapping[current_word_index].append(idx)

        <span class="hljs-comment"># Randomly mask words</span>
        mask = np.random.binomial(<span class="hljs-number">1</span>, wwm_probability, (<span class="hljs-built_in">len</span>(mapping),))
        input_ids = feature[<span class="hljs-string">&quot;input_ids&quot;</span>]
        labels = feature[<span class="hljs-string">&quot;labels&quot;</span>]
        new_labels = [-<span class="hljs-number">100</span>] * <span class="hljs-built_in">len</span>(labels)
        <span class="hljs-keyword">for</span> word_id <span class="hljs-keyword">in</span> np.where(mask)[<span class="hljs-number">0</span>]:
            word_id = word_id.item()
            <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> mapping[word_id]:
                new_labels[idx] = labels[idx]
                input_ids[idx] = tokenizer.mask_token_id
        feature[<span class="hljs-string">&quot;labels&quot;</span>] = new_labels

    <span class="hljs-keyword">return</span> default_data_collator(features)<!-- HTML_TAG_END --></pre></div>
<p>Next, we can try it on the same samples as before:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->samples = [lm_datasets[<span class="hljs-string">&quot;train&quot;</span>][i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]
batch = whole_word_masking_data_collator(samples)

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> batch[<span class="hljs-string">&quot;input_ids&quot;</span>]:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&#x27;&gt;&gt;&gt; <span class="hljs-subst">{tokenizer.decode(chunk)}</span>&#x27;&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; [CLS] bromwell high is a cartoon comedy [MASK] it ran at the same time as some other programs about school life, such as &quot; teachers &quot;. my 35 years in the teaching profession lead me to believe that bromwell high\&#x27;s satire is much closer to reality than is &quot; teachers &quot;. the scramble to survive financially, the insightful students who can see right through their pathetic teachers\&#x27;pomp, the pettiness of the whole situation, all remind me of the schools i knew and their students. when i saw the episode in which a student repeatedly tried to burn down the school, i immediately recalled.....&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; .... [MASK] [MASK] [MASK] [MASK]....... high. a classic line : inspector : i\&#x27;m here to sack one of your teachers. student : welcome to bromwell high. i expect that many adults of my age think that bromwell high is far fetched. what a pity that it isn\&#x27;t! [SEP] [CLS] homelessness ( or houselessness as george carlin stated ) has been an issue for years but never a plan to help those on the street that were once considered human who did everything from going to school, work, or vote for the matter. most people think of the homeless&#x27;</span><!-- HTML_TAG_END --></pre></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>âœï¸ <strong>è¯•è¯•çœ‹!</strong> å¤šæ¬¡è¿è¡Œä¸Šé¢çš„ä»£ç ç‰‡æ®µ, çœ‹çœ‹éšæœºå±è”½å‘ç”Ÿåœ¨ä½ çœ¼å‰! è¿˜è¦å°† <code>tokenizer.decode()</code> æ–¹æ³•æ›¿æ¢ä¸º <code>tokenizer.convert_ids_to_tokens()</code> ä»¥æŸ¥çœ‹æ¥è‡ªç»™å®šå•è¯çš„æ ‡è®°å§‹ç»ˆè¢«å±è”½åœ¨ä¸€èµ·ã€‚</p></div>
<p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ•°æ®æ•´ç†å™¨, å…¶ä½™çš„å¾®è°ƒæ­¥éª¤æ˜¯æ ‡å‡†çš„ã€‚å¦‚æœæ‚¨æ²¡æœ‰è¶³å¤Ÿå¹¸è¿åœ°è·å¾—ç¥è¯èˆ¬çš„ P100 GPU ğŸ˜­, åœ¨ Google Colab ä¸Šè¿›è¡Œè®­ç»ƒå¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´, å› æ­¤æˆ‘ä»¬å°†é¦–å…ˆå°†è®­ç»ƒé›†çš„å¤§å°ç¼©å‡ä¸ºå‡ åƒä¸ªç¤ºä¾‹ã€‚åˆ«æ‹…å¿ƒ, æˆ‘ä»¬ä»ç„¶ä¼šå¾—åˆ°ä¸€ä¸ªç›¸å½“ä¸é”™çš„è¯­è¨€æ¨¡å‹! åœ¨ ğŸ¤— Datasets ä¸­å¿«é€Ÿä¸‹é‡‡æ ·æ•°æ®é›†çš„æ–¹æ³•æ˜¯é€šè¿‡æˆ‘ä»¬åœ¨ <a href="/course/chapter5">ç¬¬äº”ç« </a> ä¸­çœ‹åˆ°çš„ <code>Dataset.train_test_split()</code> å‡½æ•°:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->train_size = <span class="hljs-number">10_000</span>
test_size = <span class="hljs-built_in">int</span>(<span class="hljs-number">0.1</span> * train_size)

downsampled_dataset = lm_datasets[<span class="hljs-string">&quot;train&quot;</span>].train_test_split(
    train_size=train_size, test_size=test_size, seed=<span class="hljs-number">42</span>
)
downsampled_dataset<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">10000</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">1000</span>
    })
})<!-- HTML_TAG_END --></pre></div>
<p>è¿™ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ <code>train</code> å’Œ <code>test</code> æ‹†åˆ†, è®­ç»ƒé›†å¤§å°è®¾ç½®ä¸º 10,000 ä¸ªç¤ºä¾‹, éªŒè¯è®¾ç½®ä¸ºå…¶ä¸­çš„ 10% â€” å¦‚æœä½ æœ‰ä¸€ä¸ªå¼ºå¤§çš„ GPU, å¯ä»¥éšæ„å¢åŠ å®ƒ! æˆ‘ä»¬éœ€è¦åšçš„ä¸‹ä¸€ä»¶äº‹æ˜¯ç™»å½• Hugging Face Hubã€‚å¦‚æœä½ åœ¨ç¬”è®°æœ¬ä¸­è¿è¡Œæ­¤ä»£ç , åˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å®ç”¨ç¨‹åºå‡½æ•°æ‰§è¡Œæ­¤æ“ä½œ:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> notebook_login

notebook_login()<!-- HTML_TAG_END --></pre></div>
<p>è¿™å°†æ˜¾ç¤ºä¸€ä¸ªå°éƒ¨ä»¶, ä½ å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥ä½ çš„å‡­æ®ã€‚æˆ–è€…, ä½ å¯ä»¥è¿è¡Œ: </p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->huggingface-<span class="hljs-keyword">cli</span> login<!-- HTML_TAG_END --></pre></div>
<p>åœ¨ä½ æœ€å–œæ¬¢çš„ç»ˆç«¯ä¸­ç™»å½•ã€‚ </p>
<p>ç™»é™†å, æˆ‘ä»¬å¯ä»¥æŒ‡å®š <code>Trainer</code> å‚æ•°:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> TrainingArguments

batch_size = <span class="hljs-number">64</span>
<span class="hljs-comment"># Show the training loss with every epoch</span>
logging_steps = <span class="hljs-built_in">len</span>(downsampled_dataset[<span class="hljs-string">&quot;train&quot;</span>]) // batch_size
model_name = model_checkpoint.split(<span class="hljs-string">&quot;/&quot;</span>)[-<span class="hljs-number">1</span>]

training_args = TrainingArguments(
    output_dir=<span class="hljs-string">f&quot;<span class="hljs-subst">{model_name}</span>-finetuned-imdb&quot;</span>,
    overwrite_output_dir=<span class="hljs-literal">True</span>,
    evaluation_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,
    learning_rate=<span class="hljs-number">2e-5</span>,
    weight_decay=<span class="hljs-number">0.01</span>,
    per_device_train_batch_size=batch_size,
    per_device_eval_batch_size=batch_size,
    push_to_hub=<span class="hljs-literal">True</span>,
    fp16=<span class="hljs-literal">True</span>,
    logging_steps=logging_steps,
)<!-- HTML_TAG_END --></pre></div>
<p>åœ¨è¿™é‡Œ, æˆ‘ä»¬è°ƒæ•´äº†ä¸€äº›é»˜è®¤é€‰é¡¹, åŒ…æ‹¬ <code>logging_steps</code> , ä»¥ç¡®ä¿æˆ‘ä»¬è·Ÿè¸ªæ¯ä¸ªepochçš„è®­ç»ƒæŸå¤±ã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨äº† <code>fp16=True</code> æ¥å®ç°æ··åˆç²¾åº¦è®­ç»ƒ, è¿™ç»™æˆ‘ä»¬å¸¦æ¥äº†å¦ä¸€ä¸ªé€Ÿåº¦æå‡ã€‚é»˜è®¤æƒ…å†µä¸‹, <code>Trainer</code> å°†åˆ é™¤ä¸å±äºæ¨¡å‹çš„ <code>forward()</code> æ–¹æ³•çš„åˆ—ã€‚è¿™æ„å‘³ç€, å¦‚æœä½ ä½¿ç”¨æ•´ä¸ªå•è¯å±è”½æ’åºå™¨, ä½ è¿˜éœ€è¦è®¾ç½® <code>remove_unused_columns=False</code>, ä»¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šåœ¨è®­ç»ƒæœŸé—´ä¸¢å¤± <code>word_ids</code> åˆ—ã€‚</p>
<p>è¯·æ³¨æ„, ä½ å¯ä»¥ä½¿ç”¨ <code>hub_model_id</code> å‚æ•°æŒ‡å®šè¦æ¨é€åˆ°çš„å­˜å‚¨åº“çš„åç§°((ç‰¹åˆ«æ˜¯ä½ å°†å¿…é¡»ä½¿ç”¨è¯¥å‚æ•°å‘ç»„ç»‡æ¨é€)ã€‚ä¾‹å¦‚, å½“æˆ‘ä»¬å°†æ¨¡å‹æ¨é€åˆ° <a href="https://huggingface.co/huggingface-course" rel="nofollow"><code>huggingface-course</code> organization</a> æ—¶, æˆ‘ä»¬æ·»åŠ äº† <code>hub_model_id=&quot;huggingface-course/distilbert-finetuned-imdb&quot;</code> åˆ° <code>TrainingArguments</code> ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹, ä½¿ç”¨çš„å­˜å‚¨åº“å°†åœ¨ä½ çš„å‘½åç©ºé—´ä¸­å¹¶ä»¥ä½ è®¾ç½®çš„è¾“å‡ºç›®å½•å‘½å, å› æ­¤åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­, å®ƒå°†æ˜¯ <code>&quot;lewtun/distilbert-finetuned-imdb&quot;</code>ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨æ‹¥æœ‰å®ä¾‹åŒ– <code>Trainer</code> çš„æ‰€æœ‰æˆåˆ†ã€‚è¿™é‡Œæˆ‘ä»¬åªä½¿ç”¨æ ‡å‡†çš„ <code>data_collator</code>, ä½†ä½ å¯ä»¥å°è¯•ä½¿ç”¨æ•´ä¸ªå•è¯æ©ç æ•´ç†å™¨å¹¶æ¯”è¾ƒç»“æœä½œä¸ºç»ƒä¹ : </p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Trainer

trainer = Trainer(
    model=model,
    args=training_args,
    train_dataset=downsampled_dataset[<span class="hljs-string">&quot;train&quot;</span>],
    eval_dataset=downsampled_dataset[<span class="hljs-string">&quot;test&quot;</span>],
    data_collator=data_collator,
)<!-- HTML_TAG_END --></pre></div>
<p>æˆ‘ä»¬ç°åœ¨å‡†å¤‡è¿è¡Œ <code>trainer.train()</code> â€” ä½†åœ¨æ­¤ä¹‹å‰è®©æˆ‘ä»¬ç®€è¦åœ°çœ‹ä¸€ä¸‹ <em>perplexity</em>, è¿™æ˜¯è¯„ä¼°è¯­è¨€æ¨¡å‹æ€§èƒ½çš„å¸¸ç”¨æŒ‡æ ‡ã€‚</p>
<h3 class="relative group"><a id="perplexity" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#perplexity"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>è¯­è¨€æ¨¡å‹çš„perplexity
	</span></h3>

<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/NURcDHhYe98" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>ä¸æ–‡æœ¬åˆ†ç±»æˆ–é—®ç­”ç­‰å…¶ä»–ä»»åŠ¡ä¸åŒ, åœ¨è¿™äº›ä»»åŠ¡ä¸­, æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è¯­æ–™åº“è¿›è¡Œè®­ç»ƒ, è€Œè¯­è¨€å»ºæ¨¡åˆ™æ²¡æœ‰ä»»ä½•æ˜ç¡®çš„æ ‡ç­¾ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ç¡®å®šä»€ä¹ˆæ˜¯å¥½çš„è¯­è¨€æ¨¡å‹å‘¢? å°±åƒæ‰‹æœºä¸­çš„è‡ªåŠ¨æ›´æ­£åŠŸèƒ½ä¸€æ ·, ä¸€ä¸ªå¥½çš„è¯­è¨€æ¨¡å‹æ˜¯ä¸ºè¯­æ³•æ­£ç¡®çš„å¥å­åˆ†é…é«˜æ¦‚ç‡, ä¸ºæ— æ„ä¹‰çš„å¥å­åˆ†é…ä½æ¦‚ç‡ã€‚ä¸ºäº†è®©ä½ æ›´å¥½åœ°äº†è§£è¿™æ˜¯ä»€ä¹ˆæ ·å­, æ‚¨å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€æ•´å¥— â€œautocorrect failsâ€, å…¶ä¸­ä¸€ä¸ªäººæ‰‹æœºä¸­çš„æ¨¡å‹äº§ç”Ÿäº†ä¸€äº›ç›¸å½“æœ‰è¶£ (è€Œä¸”é€šå¸¸ä¸åˆé€‚) çš„ç»“æœ! </p>
<p>å‡è®¾æˆ‘ä»¬çš„æµ‹è¯•é›†ä¸»è¦ç”±è¯­æ³•æ­£ç¡®çš„å¥å­ç»„æˆ, é‚£ä¹ˆè¡¡é‡æˆ‘ä»¬çš„è¯­è¨€æ¨¡å‹è´¨é‡çš„ä¸€ç§æ–¹æ³•æ˜¯è®¡ç®—å®ƒåˆ†é…ç»™æµ‹è¯•é›†ä¸­æ‰€æœ‰å¥å­ä¸­çš„ä¸‹ä¸€ä¸ªå•è¯çš„æ¦‚ç‡ã€‚é«˜æ¦‚ç‡è¡¨æ˜æ¨¡å‹å¯¹çœ‹ä¸è§çš„ä¾‹å­å¹¶ä¸æ„Ÿåˆ° â€œæƒŠè®¶â€ æˆ– â€œç–‘æƒ‘â€, å¹¶è¡¨æ˜å®ƒå·²ç»å­¦ä¹ äº†è¯­è¨€ä¸­çš„åŸºæœ¬è¯­æ³•æ¨¡å¼ã€‚ perplexityåº¦æœ‰å¤šç§æ•°å­¦å®šä¹‰, ä½†æˆ‘ä»¬å°†ä½¿ç”¨çš„å®šä¹‰æ˜¯äº¤å‰ç†µæŸå¤±çš„æŒ‡æ•°ã€‚å› æ­¤, æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Trainer.evaluate()</code> å‡½æ•°è®¡ç®—æµ‹è¯•é›†ä¸Šçš„äº¤å‰ç†µæŸå¤±, ç„¶åå–ç»“æœçš„æŒ‡æ•°æ¥è®¡ç®—é¢„è®­ç»ƒæ¨¡å‹çš„perplexityåº¦:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">import</span> math

eval_results = trainer.evaluate()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt;&gt; Perplexity: <span class="hljs-subst">{math.exp(eval_results[<span class="hljs-string">&#x27;eval_loss&#x27;</span>]):<span class="hljs-number">.2</span>f}</span>&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-meta">&gt;&gt;&gt; </span>Perplexity: <span class="hljs-number">21.75</span><!-- HTML_TAG_END --></pre></div>
<p>è¾ƒä½çš„perplexityåˆ†æ•°æ„å‘³ç€æ›´å¥½çš„è¯­è¨€æ¨¡å‹, æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æˆ‘ä»¬çš„èµ·å§‹æ¨¡å‹æœ‰ä¸€ä¸ªè¾ƒå¤§çš„å€¼ã€‚çœ‹çœ‹æˆ‘ä»¬èƒ½ä¸èƒ½é€šè¿‡å¾®è°ƒæ¥é™ä½å®ƒ! ä¸ºæ­¤, æˆ‘ä»¬é¦–å…ˆè¿è¡Œè®­ç»ƒå¾ªç¯:</p>
<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->trainer.train()<!-- HTML_TAG_END --></pre></div>
<p>ç„¶ååƒä»¥å‰ä¸€æ ·è®¡ç®—æµ‹è¯•é›†ä¸Šçš„perplexityåº¦:</p>
<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->eval_results = trainer.evaluate()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt;&gt; Perplexity: <span class="hljs-subst">{math.exp(eval_results[<span class="hljs-string">&#x27;eval_loss&#x27;</span>]):<span class="hljs-number">.2</span>f}</span>&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-meta">&gt;&gt;&gt; </span>Perplexity: <span class="hljs-number">11.32</span><!-- HTML_TAG_END --></pre></div>
<p>å¾ˆå¥½ â€” è¿™å¤§å¤§å‡å°‘äº†å›°æƒ‘, è¿™å‘Šè¯‰æˆ‘ä»¬æ¨¡å‹å·²ç»äº†è§£äº†ä¸€äº›å…³äºç”µå½±è¯„è®ºé¢†åŸŸçš„çŸ¥è¯†!</p>
<p>è®­ç»ƒå®Œæˆå, æˆ‘ä»¬å¯ä»¥å°†å¸¦æœ‰è®­ç»ƒä¿¡æ¯çš„æ¨¡å‹å¡æ¨é€åˆ° Hub (æ£€æŸ¥ç‚¹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªè¡Œä¿å­˜):</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->trainer.push_to_hub()<!-- HTML_TAG_END --></pre></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>âœï¸ <strong>è½®åˆ°ä½ äº†!</strong> å°†æ•°æ®æ•´ç†å™¨æ”¹ä¸ºå…¨å­—å±è”½æ•´ç†å™¨åè¿è¡Œä¸Šé¢çš„è®­ç»ƒã€‚ä½ æœ‰å¾—åˆ°æ›´å¥½çš„ç»“æœå—?</p></div>
<p>åœ¨æˆ‘ä»¬çš„ç”¨ä¾‹ä¸­, æˆ‘ä»¬ä¸éœ€è¦å¯¹è®­ç»ƒå¾ªç¯åšä»»ä½•ç‰¹åˆ«çš„äº‹æƒ…, ä½†åœ¨æŸäº›æƒ…å†µä¸‹, ä½ å¯èƒ½éœ€è¦å®ç°ä¸€äº›è‡ªå®šä¹‰é€»è¾‘ã€‚å¯¹äºè¿™äº›åº”ç”¨, ä½ å¯ä»¥ä½¿ç”¨ ğŸ¤— Accelerate â€” è®©æˆ‘ä»¬æ¥çœ‹çœ‹å§!</p>
<h2 class="relative group"><a id="accelerate-distilbert" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#accelerate-distilbert"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>ä½¿ç”¨ ğŸ¤— Accelerate å¾®è°ƒ DistilBERT
	</span></h2>

<p>æ­£å¦‚æˆ‘ä»¬åœ¨ <code>Trainer</code> ä¸­çœ‹åˆ°çš„, å¯¹æ©ç è¯­è¨€æ¨¡å‹çš„å¾®è°ƒä¸ <a href="/course/chapter3">ç¬¬ä¸‰ç« </a> ä¸­çš„æ–‡æœ¬åˆ†ç±»ç¤ºä¾‹éå¸¸ç›¸ä¼¼ã€‚äº‹å®ä¸Š, å”¯ä¸€çš„å¾®å¦™ä¹‹å¤„æ˜¯ä½¿ç”¨ç‰¹æ®Šçš„æ•°æ®æ•´ç†å™¨, æˆ‘ä»¬å·²ç»åœ¨æœ¬èŠ‚çš„å‰é¢ä»‹ç»è¿‡äº†! </p>
<p>ç„¶è€Œ, æˆ‘ä»¬çœ‹åˆ° <code>DataCollatorForLanguageModeling</code> è¿˜å¯¹æ¯æ¬¡è¯„ä¼°åº”ç”¨éšæœºæ©ç , å› æ­¤æ¯æ¬¡è®­ç»ƒè¿è¡Œæ—¶, æˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°perplexityåº¦åˆ†æ•°çš„ä¸€äº›æ³¢åŠ¨ã€‚æ¶ˆé™¤è¿™ç§éšæœºæ€§æ¥æºçš„ä¸€ç§æ–¹æ³•æ˜¯åº”ç”¨æ©ç  <em>ä¸€æ¬¡</em> åœ¨æ•´ä¸ªæµ‹è¯•é›†ä¸Š, ç„¶åä½¿ç”¨ğŸ¤— Transformers ä¸­çš„é»˜è®¤æ•°æ®æ•´ç†å™¨åœ¨è¯„ä¼°æœŸé—´æ”¶é›†æ‰¹æ¬¡ã€‚ä¸ºäº†çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„, è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„å‡½æ•°, å°†æ©ç åº”ç”¨äºæ‰¹å¤„ç†, ç±»ä¼¼äºæˆ‘ä»¬ç¬¬ä¸€æ¬¡é‡åˆ°çš„ <code>DataCollatorForLanguageModeling</code>:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">insert_random_mask</span>(<span class="hljs-params">batch</span>):
    features = [<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(batch, t)) <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(*batch.values())]
    masked_inputs = data_collator(features)
    <span class="hljs-comment"># Create a new &quot;masked&quot; column for each column in the dataset</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;masked_&quot;</span> + k: v.numpy() <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> masked_inputs.items()}<!-- HTML_TAG_END --></pre></div>
<p>æ¥ä¸‹æ¥, æˆ‘ä»¬å°†æ­¤å‡½æ•°åº”ç”¨äºæˆ‘ä»¬çš„æµ‹è¯•é›†å¹¶åˆ é™¤æœªæ©ç çš„åˆ—, ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç”¨æ©ç çš„åˆ—æ›¿æ¢å®ƒä»¬ã€‚ä½ å¯ä»¥é€šè¿‡ç”¨é€‚å½“çš„æ›¿æ¢ä¸Šé¢çš„ <code>data_collator</code> æ¥ä½¿æ•´ä¸ªå•è¯æ©ç , åœ¨è¿™ç§æƒ…å†µä¸‹, ä½ åº”è¯¥åˆ é™¤æ­¤å¤„çš„ç¬¬ä¸€è¡Œ:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->downsampled_dataset = downsampled_dataset.remove_columns([<span class="hljs-string">&quot;word_ids&quot;</span>])
eval_dataset = downsampled_dataset[<span class="hljs-string">&quot;test&quot;</span>].<span class="hljs-built_in">map</span>(
    insert_random_mask,
    batched=<span class="hljs-literal">True</span>,
    remove_columns=downsampled_dataset[<span class="hljs-string">&quot;test&quot;</span>].column_names,
)
eval_dataset = eval_dataset.rename_columns(
    {
        <span class="hljs-string">&quot;masked_input_ids&quot;</span>: <span class="hljs-string">&quot;input_ids&quot;</span>,
        <span class="hljs-string">&quot;masked_attention_mask&quot;</span>: <span class="hljs-string">&quot;attention_mask&quot;</span>,
        <span class="hljs-string">&quot;masked_labels&quot;</span>: <span class="hljs-string">&quot;labels&quot;</span>,
    }
)<!-- HTML_TAG_END --></pre></div>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥åƒå¾€å¸¸ä¸€æ ·è®¾ç½®æ•°æ®åŠ è½½å™¨, ä½†æˆ‘ä»¬å°†ä½¿ç”¨ğŸ¤— Transformers ä¸­çš„ <code>default_data_collator</code> ä½œä¸ºè¯„ä¼°é›†:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> default_data_collator

batch_size = <span class="hljs-number">64</span>
train_dataloader = DataLoader(
    downsampled_dataset[<span class="hljs-string">&quot;train&quot;</span>],
    shuffle=<span class="hljs-literal">True</span>,
    batch_size=batch_size,
    collate_fn=data_collator,
)
eval_dataloader = DataLoader(
    eval_dataset, batch_size=batch_size, collate_fn=default_data_collator
)<!-- HTML_TAG_END --></pre></div>
<p>ä»è¿™é‡Œå¼€å§‹, æˆ‘ä»¬éµå¾ªğŸ¤— Accelerate çš„æ ‡å‡†æ­¥éª¤ã€‚ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯åŠ è½½é¢„è®­ç»ƒæ¨¡å‹çš„æ–°ç‰ˆæœ¬:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->model = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AutoModelForMaskedLM</span>.</span></span>from<span class="hljs-constructor">_pretrained(<span class="hljs-params">model_checkpoint</span>)</span><!-- HTML_TAG_END --></pre></div>
<p>ç„¶åæˆ‘ä»¬éœ€è¦æŒ‡å®šä¼˜åŒ–å™¨; æˆ‘ä»¬å°†ä½¿ç”¨æ ‡å‡†çš„ <code>AdamW</code>:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> AdamW

optimizer = AdamW(model.parameters(), lr=<span class="hljs-number">5e-5</span>)<!-- HTML_TAG_END --></pre></div>
<p>æœ‰äº†è¿™äº›å¯¹è±¡, æˆ‘ä»¬ç°åœ¨å¯ä»¥å‡†å¤‡ä½¿ç”¨ <code>Accelerator</code> åŠ é€Ÿå™¨è¿›è¡Œè®­ç»ƒçš„ä¸€åˆ‡:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> accelerate <span class="hljs-keyword">import</span> Accelerator

accelerator = Accelerator()
model, optimizer, train_dataloader, eval_dataloader = accelerator.prepare(
    model, optimizer, train_dataloader, eval_dataloader
)<!-- HTML_TAG_END --></pre></div>
<p>ç°åœ¨æˆ‘ä»¬çš„æ¨¡å‹ã€ä¼˜åŒ–å™¨å’Œæ•°æ®åŠ è½½å™¨éƒ½é…ç½®å¥½äº†, æˆ‘ä»¬å¯ä»¥æŒ‡å®šå­¦ä¹ ç‡è°ƒåº¦å™¨å¦‚ä¸‹:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> get_scheduler

num_train_epochs = <span class="hljs-number">3</span>
num_update_steps_per_epoch = <span class="hljs-built_in">len</span>(train_dataloader)
num_training_steps = num_train_epochs * num_update_steps_per_epoch

lr_scheduler = get_scheduler(
    <span class="hljs-string">&quot;linear&quot;</span>,
    optimizer=optimizer,
    num_warmup_steps=<span class="hljs-number">0</span>,
    num_training_steps=num_training_steps,
)<!-- HTML_TAG_END --></pre></div>
<p>åœ¨è®­ç»ƒä¹‹å‰è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯: åœ¨ Hugging Face Hub ä¸Šåˆ›å»ºä¸€ä¸ªæ¨¡å‹åº“! æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ğŸ¤— Hub åº“æ¥é¦–å…ˆç”Ÿæˆæˆ‘ä»¬çš„ repo çš„å…¨å:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> get_full_repo_name

model_name = <span class="hljs-string">&quot;distilbert-base-uncased-finetuned-imdb-accelerate&quot;</span>
repo_name = get_full_repo_name(model_name)
repo_name<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;lewtun/distilbert-base-uncased-finetuned-imdb-accelerate&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>ç„¶åä½¿ç”¨æ¥è‡ªğŸ¤— Hub çš„ <code>Repository</code> ç±»:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> Repository

output_dir = model_name
repo = Repository(output_dir, clone_from=repo_name)<!-- HTML_TAG_END --></pre></div>
<p>å®Œæˆå, åªéœ€å†™å‡ºå®Œæ•´çš„è®­ç»ƒå’Œè¯„ä¼°å¾ªç¯å³å¯:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> tqdm.auto <span class="hljs-keyword">import</span> tqdm
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> math

progress_bar = tqdm(<span class="hljs-built_in">range</span>(num_training_steps))

<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_train_epochs):
    <span class="hljs-comment"># Training</span>
    model.train()
    <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> train_dataloader:
        outputs = model(**batch)
        loss = outputs.loss
        accelerator.backward(loss)

        optimizer.step()
        lr_scheduler.step()
        optimizer.zero_grad()
        progress_bar.update(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># Evaluation</span>
    model.<span class="hljs-built_in">eval</span>()
    losses = []
    <span class="hljs-keyword">for</span> step, batch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(eval_dataloader):
        <span class="hljs-keyword">with</span> torch.no_grad():
            outputs = model(**batch)

        loss = outputs.loss
        losses.append(accelerator.gather(loss.repeat(batch_size)))

    losses = torch.cat(losses)
    losses = losses[: <span class="hljs-built_in">len</span>(eval_dataset)]
    <span class="hljs-keyword">try</span>:
        perplexity = math.exp(torch.mean(losses))
    <span class="hljs-keyword">except</span> OverflowError:
        perplexity = <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt;&gt; Epoch <span class="hljs-subst">{epoch}</span>: Perplexity: <span class="hljs-subst">{perplexity}</span>&quot;</span>)

    <span class="hljs-comment"># Save and upload</span>
    accelerator.wait_for_everyone()
    unwrapped_model = accelerator.unwrap_model(model)
    unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)
    <span class="hljs-keyword">if</span> accelerator.is_main_process:
        tokenizer.save_pretrained(output_dir)
        repo.push_to_hub(
            commit_message=<span class="hljs-string">f&quot;Training in progress epoch <span class="hljs-subst">{epoch}</span>&quot;</span>, blocking=<span class="hljs-literal">False</span>
        )<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-meta">&gt;&gt;&gt; </span>Epoch <span class="hljs-number">0</span>: Perplexity: <span class="hljs-number">11.397545307900472</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>Epoch <span class="hljs-number">1</span>: Perplexity: <span class="hljs-number">10.904909330983092</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>Epoch <span class="hljs-number">2</span>: Perplexity: <span class="hljs-number">10.729503505340409</span><!-- HTML_TAG_END --></pre></div>
<p>å¾ˆæ£’, æˆ‘ä»¬å·²ç»èƒ½å¤Ÿè¯„ä¼°æ¯ä¸ª epoch çš„perplexityåº¦, å¹¶ç¡®ä¿å¤šæ¬¡è®­ç»ƒè¿è¡Œæ˜¯å¯é‡å¤çš„!</p>
<h2 id="">ä½¿ç”¨æˆ‘ä»¬å¾®è°ƒçš„æ¨¡å‹</h2>
<p>ä½ å¯ä»¥é€šè¿‡åœ¨Hubä¸Šä½¿ç”¨å…¶ä»–å°éƒ¨ä»¶æˆ–åœ¨æœ¬åœ°ä½¿ç”¨ğŸ¤— Transformers çš„<code>ç®¡é“</code>äºå¾®è°ƒæ¨¡å‹è¿›è¡Œäº¤äº’ã€‚è®©æˆ‘ä»¬ä½¿ç”¨åè€…æ¥ä¸‹è½½æˆ‘ä»¬çš„æ¨¡å‹, ä½¿ç”¨ <code>fill-mask</code> ç®¡é“:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

mask_filler = pipeline(
    <span class="hljs-string">&quot;fill-mask&quot;</span>, model=<span class="hljs-string">&quot;huggingface-course/distilbert-base-uncased-finetuned-imdb&quot;</span>
)<!-- HTML_TAG_END --></pre></div>
<p>ç„¶å, æˆ‘ä»¬å¯ä»¥å‘ç®¡é“æä¾› â€œThis is a great [MASK]â€ ç¤ºä¾‹æ–‡æœ¬, å¹¶æŸ¥çœ‹å‰ 5 ä¸ªé¢„æµ‹æ˜¯ä»€ä¹ˆ:</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->preds = mask_filler(text)

<span class="hljs-keyword">for</span> pred <span class="hljs-keyword">in</span> preds:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt;&gt; <span class="hljs-subst">{pred[<span class="hljs-string">&#x27;sequence&#x27;</span>]}</span>&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great movie.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great film.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great story.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great movies.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great character.&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>å¥½çš„ â€” æˆ‘ä»¬çš„æ¨¡å‹æ˜¾ç„¶å·²ç»è°ƒæ•´äº†å®ƒçš„æƒé‡æ¥é¢„æµ‹ä¸ç”µå½±æ›´å¯†åˆ‡ç›¸å…³çš„è¯!</p>
<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/0Oxphw4Q9fo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>è¿™ç»“æŸäº†æˆ‘ä»¬è®­ç»ƒè¯­è¨€æ¨¡å‹çš„ç¬¬ä¸€ä¸ªå®éªŒã€‚åœ¨ <a href="/course/chapter7/section6">ç¬¬å…­èŠ‚</a>ä¸­ä½ å°†å­¦ä¹ å¦‚ä½•ä»å¤´å¼€å§‹è®­ç»ƒåƒ GPT-2 è¿™æ ·çš„è‡ªå›å½’æ¨¡å‹; å¦‚æœä½ æƒ³äº†è§£å¦‚ä½•é¢„è®­ç»ƒæ‚¨è‡ªå·±çš„ Transformer æ¨¡å‹, è¯·å‰å¾€é‚£é‡Œ!</p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>âœï¸ <strong>è¯•è¯•çœ‹!</strong> ä¸ºäº†é‡åŒ–åŸŸé€‚åº”çš„å¥½å¤„, å¾®è°ƒ IMDb æ ‡ç­¾ä¸Šçš„åˆ†ç±»å™¨å’Œé¢„å…ˆè®­ç»ƒå’Œå¾®è°ƒçš„Distil BERTæ£€æŸ¥ç‚¹ã€‚å¦‚æœä½ éœ€è¦å¤ä¹ æ–‡æœ¬åˆ†ç±», è¯·æŸ¥çœ‹ <a href="/course/chapter3">ç¬¬ä¸‰ç« </a>ã€‚</p></div>


		<script type="module" data-hydrate="1dpdpxl">
		import { start } from "/docs/course/main/zh-CN/_app/start-hf-doc-builder.js";
		start({
			target: document.querySelector('[data-hydrate="1dpdpxl"]').parentNode,
			paths: {"base":"/docs/course/main/zh-CN","assets":"/docs/course/main/zh-CN"},
			session: {},
			route: false,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/docs/course/main/zh-CN/_app/pages/__layout.svelte-hf-doc-builder.js"),
						import("/docs/course/main/zh-CN/_app/pages/chapter7/3.mdx-hf-doc-builder.js")
				],
				params: {}
			}
		});
	</script>
