<meta charset="utf-8" /><meta http-equiv="content-security-policy" content=""><meta name="hf:doc:metadata" content="{&quot;local&quot;:&quot;&quot;,&quot;sections&quot;:[{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;å‡†å¤‡å¤šè¯­è¨€è¯­æ–™åº“&quot;},{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;æ–‡æœ¬æ‘˜è¦æ¨¡å‹&quot;},{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;é¢„å¤„ç†æ•°æ®&quot;},{&quot;local&quot;:&quot;&quot;,&quot;sections&quot;:[{&quot;local&quot;:&quot;baseline&quot;,&quot;title&quot;:&quot;åˆ›å»ºå¼ºå¤§çš„baseline&quot;}],&quot;title&quot;:&quot;æ–‡æœ¬æ‘˜è¦çš„æŒ‡æ ‡&quot;},{&quot;local&quot;:&quot;trainer-apimt5&quot;,&quot;title&quot;:&quot;ä½¿ç”¨ `Trainer` APIå¾®è°ƒmT5 &quot;},{&quot;local&quot;:&quot;keras-apimt5&quot;,&quot;title&quot;:&quot;ä½¿ç”¨ `Keras` APIå¾®è°ƒmT5 &quot;},{&quot;local&quot;:&quot;accelerate-mt5&quot;,&quot;sections&quot;:[{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;ä¸ºè®­ç»ƒåšå¥½ä¸€åˆ‡å‡†å¤‡&quot;},{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;è®­ç»ƒå¾ªç¯&quot;}],&quot;title&quot;:&quot;ä½¿ç”¨ ğŸ¤— Accelerate å¾®è°ƒ mT5&quot;},{&quot;local&quot;:&quot;&quot;,&quot;title&quot;:&quot;ä½¿ç”¨æ‚¨å¾®è°ƒçš„æ¨¡å‹&quot;}],&quot;title&quot;:&quot;æå–æ–‡æœ¬æ‘˜è¦&quot;}" data-svelte="svelte-1phssyn">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/assets/pages/__layout.svelte-hf-doc-builder.css">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/start-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/vendor-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/paths-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/pages/__layout.svelte-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/pages/chapter7/5.mdx-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/Tip-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/Youtube-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/IconCopyLink-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/CodeBlock-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/DocNotebookDropdown-hf-doc-builder.js">
	<link rel="modulepreload" href="/docs/course/main/zh-CN/_app/chunks/FrameworkSwitchCourse-hf-doc-builder.js"> 





<div class="bg-white leading-none border border-gray-100 rounded-lg flex p-0.5 w-56 text-sm mb-4"><a class="flex justify-center flex-1 py-1.5 px-2.5 focus:outline-none !no-underline rounded-l bg-red-50 dark:bg-transparent text-red-600" href="?fw=pt"><svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><defs><clipPath id="a"><rect x="3.05" y="0.5" width="25.73" height="31" fill="none"></rect></clipPath></defs><g clip-path="url(#a)"><path d="M24.94,9.51a12.81,12.81,0,0,1,0,18.16,12.68,12.68,0,0,1-18,0,12.81,12.81,0,0,1,0-18.16l9-9V5l-.84.83-6,6a9.58,9.58,0,1,0,13.55,0ZM20.44,9a1.68,1.68,0,1,1,1.67-1.67A1.68,1.68,0,0,1,20.44,9Z" fill="#ee4c2c"></path></g></svg>
			Pytorch
		</a><a class="flex justify-center flex-1 py-1.5 px-2.5 focus:outline-none !no-underline rounded-r text-gray-500 filter grayscale" href="?fw=tf"><svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" role="img" width="0.94em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 274"><path d="M145.726 42.065v42.07l72.861 42.07v-42.07l-72.86-42.07zM0 84.135v42.07l36.43 21.03V105.17L0 84.135zm109.291 21.035l-36.43 21.034v126.2l36.43 21.035v-84.135l36.435 21.035v-42.07l-36.435-21.034V105.17z" fill="#E55B2D"></path><path d="M145.726 42.065L36.43 105.17v42.065l72.861-42.065v42.065l36.435-21.03v-84.14zM255.022 63.1l-36.435 21.035v42.07l36.435-21.035V63.1zm-72.865 84.135l-36.43 21.035v42.07l36.43-21.036v-42.07zm-36.43 63.104l-36.436-21.035v84.135l36.435-21.035V210.34z" fill="#ED8E24"></path><path d="M145.726 0L0 84.135l36.43 21.035l109.296-63.105l72.861 42.07L255.022 63.1L145.726 0zm0 126.204l-36.435 21.03l36.435 21.036l36.43-21.035l-36.43-21.03z" fill="#F8BF3C"></path></svg>
			TensorFlow
		</a></div>
<h1 id="">æå–æ–‡æœ¬æ‘˜è¦</h1>


<div class="flex space-x-1 absolute z-10 right-0 top-0">
	<a href="https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter7/section5_pt.ipynb" target="_blank"><img alt="Open In Colab" class="!m-0" src="https://colab.research.google.com/assets/colab-badge.svg"></a>
	<a href="https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter7/section5_pt.ipynb" target="_blank"><img alt="Open In Studio Lab" class="!m-0" src="https://studiolab.sagemaker.aws/studiolab.svg"></a></div>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Transformer æ¨¡å‹å°†é•¿æ–‡æ¡£å‹ç¼©ä¸ºæ‘˜è¦ï¼Œè¿™é¡¹ä»»åŠ¡ç§°ä¸ºæ–‡æœ¬æ‘˜è¦.è¿™æ˜¯æœ€å…·æŒ‘æˆ˜æ€§çš„ NLP ä»»åŠ¡ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸€ç³»åˆ—èƒ½åŠ›ï¼Œä¾‹å¦‚ç†è§£é•¿ç¯‡æ–‡ç« å’Œç”Ÿæˆèƒ½å¤Ÿæ•æ‰æ–‡æ¡£ä¸­ä¸»è¦ä¸»é¢˜çš„è¿è´¯æ–‡æœ¬ã€‚ä½†æ˜¯ï¼Œå¦‚æœåšå¾—å¥½ï¼Œæ–‡æœ¬æ‘˜è¦æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å‡è½»é¢†åŸŸä¸“å®¶è¯¦ç»†é˜…è¯»é•¿æ–‡æ¡£çš„è´Ÿæ‹…ï¼Œä»è€ŒåŠ å¿«å„ç§ä¸šåŠ¡æµç¨‹ã€‚</p>
<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/yHnr5Dk2zCI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>å°½ç®¡åœ¨<a href="https://huggingface.co/models?pipeline_tag=summarization=downloads" rel="nofollow">Hugging Face Hub</a>ä¸Šå·²ç»å­˜åœ¨å„ç§å¾®è°ƒæ¨¡å‹ç”¨äºæ–‡æœ¬æ‘˜è¦ï¼Œå‡ ä¹æ‰€æœ‰è¿™äº›éƒ½åªé€‚ç”¨äºè‹±æ–‡æ–‡æ¡£ã€‚å› æ­¤ï¼Œä¸ºäº†åœ¨æœ¬èŠ‚ä¸­æ·»åŠ ä¸€äº›å˜åŒ–ï¼Œæˆ‘ä»¬å°†ä¸ºè‹±è¯­å’Œè¥¿ç­ç‰™è¯­è®­ç»ƒä¸€ä¸ªåŒè¯­æ¨¡å‹ã€‚åœ¨æœ¬èŠ‚ç»“æŸæ—¶ï¼Œæ‚¨å°†æœ‰ä¸€ä¸ªå¯ä»¥æ€»ç»“å®¢æˆ·è¯„è®ºçš„<a href="https://huggingface.co/huggingface-course/mt5-small-finetuned-amazon-en-es" rel="nofollow">æ¨¡å‹</a>ã€‚</p>
<iframe src="https://hf.space/gradioiframe/course-demos/mt5-small-finetuned-amazon-en-es/+" frameborder="0" height="400" title="Gradio app" class="block dark:hidden container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>
<iframe src="https://hf.space/gradioiframe/course-demos/mt5-small-finetuned-amazon-en-es-darkmode/+" frameborder="0" height="400" title="Gradio app" class="hidden dark:block container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼šæ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ï¼Œè¿™äº›æ‘˜è¦å¾ˆç®€æ´ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä»å®¢æˆ·åœ¨äº§å“è¯„è®ºä¸­æä¾›çš„æ ‡é¢˜ä¸­å­¦åˆ°çš„ã€‚è®©æˆ‘ä»¬é¦–å…ˆä¸ºè¿™é¡¹ä»»åŠ¡å‡†å¤‡ä¸€ä¸ªåˆé€‚çš„åŒè¯­è¯­æ–™åº“ã€‚</p>
<h2 id="">å‡†å¤‡å¤šè¯­è¨€è¯­æ–™åº“</h2>
<p>æˆ‘ä»¬å°†ä½¿ç”¨<a href="https://huggingface.co/datasets/amazon_reviews_multi" rel="nofollow">å¤šè¯­è¨€äºšé©¬é€Šè¯„è®ºè¯­æ–™åº“</a>åˆ›å»ºæˆ‘ä»¬çš„åŒè¯­æ‘˜è¦å™¨ã€‚è¯¥è¯­æ–™åº“ç”±å…­ç§è¯­è¨€çš„äºšé©¬é€Šäº§å“è¯„è®ºç»„æˆï¼Œé€šå¸¸ç”¨äºå¯¹å¤šè¯­è¨€åˆ†ç±»å™¨è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚ç„¶è€Œï¼Œç”±äºæ¯æ¡è¯„è®ºéƒ½é™„æœ‰ä¸€ä¸ªç®€çŸ­çš„æ ‡é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡é¢˜ä½œä¸ºæˆ‘ä»¬æ¨¡å‹å­¦ä¹ çš„ç›®æ ‡æ‘˜è¦ï¼é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä» Hugging Face Hub ä¸‹è½½è‹±è¯­å’Œè¥¿ç­ç‰™è¯­å­é›†ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset

spanish_dataset = load_dataset(<span class="hljs-string">&quot;amazon_reviews_multi&quot;</span>, <span class="hljs-string">&quot;es&quot;</span>)
english_dataset = load_dataset(<span class="hljs-string">&quot;amazon_reviews_multi&quot;</span>, <span class="hljs-string">&quot;en&quot;</span>)
english_dataset<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;review_id&#x27;</span>, <span class="hljs-string">&#x27;product_id&#x27;</span>, <span class="hljs-string">&#x27;reviewer_id&#x27;</span>, <span class="hljs-string">&#x27;stars&#x27;</span>, <span class="hljs-string">&#x27;review_body&#x27;</span>, <span class="hljs-string">&#x27;review_title&#x27;</span>, <span class="hljs-string">&#x27;language&#x27;</span>, <span class="hljs-string">&#x27;product_category&#x27;</span>],
        num_rows: <span class="hljs-number">200000</span>
    })
    validation: Dataset({
        features: [<span class="hljs-string">&#x27;review_id&#x27;</span>, <span class="hljs-string">&#x27;product_id&#x27;</span>, <span class="hljs-string">&#x27;reviewer_id&#x27;</span>, <span class="hljs-string">&#x27;stars&#x27;</span>, <span class="hljs-string">&#x27;review_body&#x27;</span>, <span class="hljs-string">&#x27;review_title&#x27;</span>, <span class="hljs-string">&#x27;language&#x27;</span>, <span class="hljs-string">&#x27;product_category&#x27;</span>],
        num_rows: <span class="hljs-number">5000</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;review_id&#x27;</span>, <span class="hljs-string">&#x27;product_id&#x27;</span>, <span class="hljs-string">&#x27;reviewer_id&#x27;</span>, <span class="hljs-string">&#x27;stars&#x27;</span>, <span class="hljs-string">&#x27;review_body&#x27;</span>, <span class="hljs-string">&#x27;review_title&#x27;</span>, <span class="hljs-string">&#x27;language&#x27;</span>, <span class="hljs-string">&#x27;product_category&#x27;</span>],
        num_rows: <span class="hljs-number">5000</span>
    })
})<!-- HTML_TAG_END --></pre></div>
<p>å¦‚æ‚¨æ‰€è§ï¼Œå¯¹äºæ¯ç§è¯­è¨€ï¼Œéƒ½æœ‰ 200,000 æ¡è¯„è®º <strong>train</strong> æ‹†åˆ†ï¼Œæ¯ä¸ªè¯„è®ºæœ‰ 5,000 æ¡è¯„è®º <strong>validation</strong> å’Œ <strong>test</strong> åˆ†è£‚ã€‚æˆ‘ä»¬æ„Ÿå…´è¶£çš„è¯„è®ºä¿¡æ¯åŒ…å«åœ¨ <strong>review_body</strong> å’Œ <strong>review_title</strong> åˆ—ã€‚è®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥æŸ¥çœ‹ä¸€äº›ç¤ºä¾‹ï¼Œè¯¥å‡½æ•°ä½¿ç”¨æˆ‘ä»¬åœ¨<a href="/course/chapter5">ç¬¬äº”ç« </a>å­¦åˆ°è¿‡ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">show_samples</span>(<span class="hljs-params">dataset, num_samples=<span class="hljs-number">3</span>, seed=<span class="hljs-number">42</span></span>):
    sample = dataset[<span class="hljs-string">&quot;train&quot;</span>].shuffle(seed=seed).select(<span class="hljs-built_in">range</span>(num_samples))
    <span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> sample:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&#x27;&gt;&gt; Title: <span class="hljs-subst">{example[<span class="hljs-string">&#x27;review_title&#x27;</span>]}</span>&#x27;&quot;</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt; Review: <span class="hljs-subst">{example[<span class="hljs-string">&#x27;review_body&#x27;</span>]}</span>&#x27;&quot;</span>)


show_samples(english_dataset)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt; Title: Worked in front position, not rear&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt; Review: 3 stars because these are not rear brakes as stated in the item description. At least the mount adapter only worked on the front fork of the bike that I got it for.&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt; Title: meh&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt; Review: Does itâ€™s job and itâ€™s gorgeous but mine is falling apart, I had to basically put it together again with hot glue&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt; Title: Can\&#x27;t beat these for the money&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt; Review: Bought this for handling miscellaneous aircraft parts and hanger &quot;stuff&quot; that I needed to organize; it really fit the bill. The unit arrived quickly, was well packaged and arrived intact (always a good sign). There are five wall mounts-- three on the top and two on the bottom. I wanted to mount it on the wall, so all I had to do was to remove the top two layers of plastic drawers, as well as the bottom corner drawers, place it when I wanted and mark it; I then used some of the new plastic screw in wall anchors (the 50 pound variety) and it easily mounted to the wall. Some have remarked that they wanted dividers for the drawers, and that they made those. Good idea. My application was that I needed something that I can see the contents at about eye level, so I wanted the fuller-sized drawers. I also like that these are the new plastic that doesn\&#x27;t get brittle and split like my older plastic drawers did. I like the all-plastic construction. It\&#x27;s heavy duty enough to hold metal parts, but being made of plastic it\&#x27;s not as heavy as a metal frame, so you can easily mount it to the wall and still load it up with heavy stuff, or light stuff. No problem there. For the money, you can\&#x27;t beat it. Best one of these I\&#x27;ve bought to date-- and I\&#x27;ve been using some version of these for over forty years.&#x27;</span><!-- HTML_TAG_END --></pre></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>âœï¸ <strong>è¯•è¯•çœ‹ï¼</strong> æ›´æ”¹ <code>Dataset.shuffle()</code> å‘½ä»¤ä¸­çš„éšæœºç§å­ä»¥æ¢ç´¢è¯­æ–™åº“ä¸­çš„å…¶ä»–è¯„è®ºã€‚ å¦‚æœæ‚¨æ˜¯è¯´è¥¿ç­ç‰™è¯­çš„äººï¼Œè¯·æŸ¥çœ‹ <code>spanish_dataset</code> ä¸­çš„ä¸€äº›è¯„è®ºï¼Œçœ‹çœ‹æ ‡é¢˜æ˜¯å¦ä¹Ÿåƒåˆç†çš„æ‘˜è¦ã€‚</p></div>
<p>æ­¤ç¤ºä¾‹æ˜¾ç¤ºäº†äººä»¬é€šå¸¸åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„è¯„è®ºçš„å¤šæ ·æ€§ï¼Œä»æ­£é¢åˆ°è´Ÿé¢ï¼ˆä»¥åŠä»‹äºä¸¤è€…ä¹‹é—´çš„æ‰€æœ‰å†…å®¹ï¼ï¼‰ã€‚å°½ç®¡æ ‡é¢˜ä¸ºâ€œmehâ€çš„ç¤ºä¾‹ä¿¡æ¯é‡ä¸å¤§ï¼Œä½†å…¶ä»–æ ‡é¢˜çœ‹èµ·æ¥åƒæ˜¯å¯¹è¯„è®ºæœ¬èº«çš„ä½“é¢æ€»ç»“ã€‚åœ¨å•ä¸ª GPU ä¸Šè®­ç»ƒæ‰€æœ‰ 400,000 æ¡è¯„è®ºçš„æ‘˜è¦æ¨¡å‹å°†èŠ±è´¹å¤ªé•¿æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸“æ³¨äºä¸ºå•ä¸ªäº§å“é¢†åŸŸç”Ÿæˆæ‘˜è¦ã€‚ä¸ºäº†äº†è§£æˆ‘ä»¬å¯ä»¥é€‰æ‹©å“ªäº›åŸŸï¼Œè®©æˆ‘ä»¬å°† <strong>english_dataset</strong> è½¬æ¢åˆ° <strong>pandas.DataFrame</strong> å¹¶è®¡ç®—æ¯ä¸ªäº§å“ç±»åˆ«çš„è¯„è®ºæ•°é‡ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->english_dataset.set_format(<span class="hljs-string">&quot;pandas&quot;</span>)
english_df = english_dataset[<span class="hljs-string">&quot;train&quot;</span>][:]
<span class="hljs-comment"># Show counts for top 20 products</span>
english_df[<span class="hljs-string">&quot;product_category&quot;</span>].value_counts()[:<span class="hljs-number">20</span>]<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->home                      <span class="hljs-number">17679</span>
apparel                   <span class="hljs-number">15951</span>
wireless                  <span class="hljs-number">15717</span>
other                     <span class="hljs-number">13418</span>
beauty                    <span class="hljs-number">12091</span>
drugstore                 <span class="hljs-number">11730</span>
kitchen                   <span class="hljs-number">10382</span>
toy                        <span class="hljs-number">8745</span>
sports                     <span class="hljs-number">8277</span>
automotive                 <span class="hljs-number">7506</span>
lawn_and_garden            <span class="hljs-number">7327</span>
home_improvement           <span class="hljs-number">7136</span>
pet_products               <span class="hljs-number">7082</span>
digital_ebook_purchase     <span class="hljs-number">6749</span>
pc                         <span class="hljs-number">6401</span>
electronics                <span class="hljs-number">6186</span>
office_product             <span class="hljs-number">5521</span>
shoes                      <span class="hljs-number">5197</span>
grocery                    <span class="hljs-number">4730</span>
book                       <span class="hljs-number">3756</span>
Name: product_category, dtype: int64<!-- HTML_TAG_END --></pre></div>
<p>è‹±è¯­æ•°æ®é›†ä¸­æœ€å—æ¬¢è¿çš„äº§å“æ˜¯å®¶å±…ç”¨å“ã€æœè£…å’Œæ— çº¿ç”µå­äº§å“ã€‚ä¸è¿‡ï¼Œä¸ºäº†åšæŒäºšé©¬é€Šçš„ä¸»é¢˜ï¼Œè®©æˆ‘ä»¬ä¸“æ³¨äºæ€»ç»“ä¹¦ç±çš„è¯„è®ºâ€”â€”æ¯•ç«Ÿï¼Œè¿™æ˜¯äºšé©¬é€Šè¿™å®¶å…¬å¸æˆç«‹çš„åŸºç¡€ï¼æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç¬¦åˆè¦æ±‚çš„äº§å“ç±»åˆ«ï¼ˆ <strong>book</strong> å’Œ <strong>digital_ebook_purchase</strong> )ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¸ºè¿™äº›äº§å“è¿‡æ»¤ä¸¤ç§è¯­è¨€çš„æ•°æ®é›†ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨<a href="/course/chapter5">ç¬¬äº”ç« </a>å­¦åˆ°çš„ï¼Œ è¿™ <strong>Dataset.filter()</strong> å‡½æ•°å…è®¸æˆ‘ä»¬éå¸¸æœ‰æ•ˆåœ°å¯¹æ•°æ®é›†è¿›è¡Œåˆ‡ç‰‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥æ‰§è¡Œæ­¤æ“ä½œï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">filter_books</span>(<span class="hljs-params">example</span>):
    <span class="hljs-keyword">return</span> (
        example[<span class="hljs-string">&quot;product_category&quot;</span>] == <span class="hljs-string">&quot;book&quot;</span>
        <span class="hljs-keyword">or</span> example[<span class="hljs-string">&quot;product_category&quot;</span>] == <span class="hljs-string">&quot;digital_ebook_purchase&quot;</span>
    )<!-- HTML_TAG_END --></pre></div>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬å°†æ­¤å‡½æ•°åº”ç”¨äº <strong>english_dataset</strong> å’Œ <strong>spanish_dataset</strong> ï¼Œç»“æœå°†åªåŒ…å«æ¶‰åŠä¹¦ç±ç±»åˆ«çš„é‚£äº›è¡Œã€‚åœ¨åº”ç”¨è¿‡æ»¤å™¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å°†<strong>english_dataset</strong>çš„æ ¼å¼ä» <strong>pandas</strong> åˆ‡æ¢å›åˆ° <strong>arrow</strong> ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->english_dataset.reset_format()<!-- HTML_TAG_END --></pre></div>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥åº”ç”¨è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œä½œä¸ºå¥å…¨æ€§æ£€æŸ¥ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥è¯„è®ºæ ·æœ¬ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦ç¡®å®ä¸ä¹¦ç±æœ‰å…³ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->spanish_books = spanish_dataset.<span class="hljs-built_in">filter</span>(filter_books)
english_books = english_dataset.<span class="hljs-built_in">filter</span>(filter_books)
show_samples(english_books)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt; Title: I\&#x27;m dissapointed.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt; Review: I guess I had higher expectations for this book from the reviews. I really thought I\&#x27;d at least like it. The plot idea was great. I loved Ash but, it just didnt go anywhere. Most of the book was about their radio show and talking to callers. I wanted the author to dig deeper so we could really get to know the characters. All we know about Grace is that she is attractive looking, Latino and is kind of a brat. I\&#x27;m dissapointed.&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt; Title: Good art, good price, poor design&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt; Review: I had gotten the DC Vintage calendar the past two years, but it was on backorder forever this year and I saw they had shrunk the dimensions for no good reason. This one has good art choices but the design has the fold going through the picture, so it\&#x27;s less aesthetically pleasing, especially if you want to keep a picture to hang. For the price, a good calendar&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt; Title: Helpful&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt; Review: Nearly all the tips useful and. I consider myself an intermediate to advanced user of OneNote. I would highly recommend.&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>å¥½çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯„è®ºå¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ä¹¦ç±ï¼Œå¯èƒ½æ˜¯æŒ‡æ—¥å†å’Œ OneNote ç­‰ç”µå­åº”ç”¨ç¨‹åºç­‰å†…å®¹ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¯¥é¢†åŸŸä¼¼ä¹é€‚åˆè®­ç»ƒæ‘˜è¦æ¨¡å‹ã€‚åœ¨æˆ‘ä»¬æŸ¥çœ‹é€‚åˆæ­¤ä»»åŠ¡çš„å„ç§æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æœ‰æœ€åä¸€ç‚¹æ•°æ®å‡†å¤‡è¦åšï¼šå°†è‹±è¯­å’Œè¥¿ç­ç‰™è¯­è¯„è®ºåˆå¹¶ä¸ºä¸€ä¸ª <strong>DatasetDict</strong> ç›®çš„ã€‚ ğŸ¤— Datasets æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„ <strong>concatenate_datasets()</strong> å‡½æ•°ï¼ˆé¡¾åæ€ä¹‰ï¼‰åˆå¹¶ <strong>Dataset</strong> å¯¹è±¡ã€‚å› æ­¤ï¼Œä¸ºäº†åˆ›å»ºæˆ‘ä»¬çš„åŒè¯­æ•°æ®é›†ï¼Œæˆ‘ä»¬å°†éå†æ¯ä¸ªæ‹†åˆ†ï¼Œè¿æ¥è¯¥æ‹†åˆ†çš„æ•°æ®é›†ï¼Œå¹¶æ‰“ä¹±ç»“æœä»¥ç¡®ä¿æˆ‘ä»¬çš„æ¨¡å‹ä¸ä¼šè¿‡åº¦æ‹Ÿåˆå•ä¸€è¯­è¨€ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> concatenate_datasets, DatasetDict

books_dataset = DatasetDict()

<span class="hljs-keyword">for</span> split <span class="hljs-keyword">in</span> english_books.keys():
    books_dataset[split] = concatenate_datasets(
        [english_books[split], spanish_books[split]]
    )
    books_dataset[split] = books_dataset[split].shuffle(seed=<span class="hljs-number">42</span>)

<span class="hljs-comment"># Peek at a few examples</span>
show_samples(books_dataset)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt; Title: Easy to follow!!!!&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt; Review: I loved The dash diet weight loss Solution. Never hungry. I would recommend this diet. Also the menus are well rounded. Try it. Has lots of the information need thanks.&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt; Title: PARCIALMENTE DAÃ‘ADO&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt; Review: Me llegÃ³ el dÃ­a que tocaba, junto a otros libros que pedÃ­, pero la caja llegÃ³ en mal estado lo cual daÃ±Ã³ las esquinas de los libros porque venÃ­an sin protecciÃ³n (forro).&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt; Title: no lo he podido descargar&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt; Review: igual que el anterior&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>è¿™å½“ç„¶çœ‹èµ·æ¥åƒæ˜¯è‹±è¯­å’Œè¥¿ç­ç‰™è¯­è¯„è®ºçš„æ··åˆï¼ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªè®­ç»ƒè¯­æ–™åº“ï¼Œæœ€åè¦æ£€æŸ¥çš„ä¸€ä»¶äº‹æ˜¯è¯„è®ºä¸­å•è¯çš„åˆ†å¸ƒåŠå…¶æ ‡é¢˜ã€‚è¿™å¯¹äºæ‘˜è¦ä»»åŠ¡å°¤å…¶é‡è¦ï¼Œå…¶ä¸­æ•°æ®ä¸­çš„ç®€çŸ­å‚è€ƒæ‘˜è¦ä¼šä½¿æ¨¡å‹åå‘äºä»…åœ¨ç”Ÿæˆçš„æ‘˜è¦ä¸­è¾“å‡ºä¸€ä¸¤ä¸ªå•è¯ã€‚ä¸‹é¢çš„å›¾æ˜¾ç¤ºäº†å•è¯åˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰äº›æ ‡é¢˜ä¸¥é‡åå‘äº 1-2 ä¸ªå•è¯ï¼š</p>
<div class="flex justify-center"><img class="block dark:hidden" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/review-lengths.svg" alt="Word count distributions for the review titles and texts.">
<img class="hidden dark:block" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/review-lengths-dark.svg" alt="Word count distributions for the review titles and texts."></div>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†è¿‡æ»¤æ‰æ ‡é¢˜éå¸¸çŸ­çš„ç¤ºä¾‹ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æ¨¡å‹å¯ä»¥ç”Ÿæˆæ›´æœ‰è¶£çš„æ‘˜è¦ã€‚ç”±äºæˆ‘ä»¬æ­£åœ¨å¤„ç†è‹±æ–‡å’Œè¥¿ç­ç‰™æ–‡æ–‡æœ¬ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç²—ç•¥çš„å¯å‘å¼æ–¹æ³•åœ¨ç©ºç™½å¤„æ‹†åˆ†æ ‡é¢˜ï¼Œç„¶åä½¿ç”¨æˆ‘ä»¬å¯ä¿¡èµ–çš„ <strong>Dataset.filter()</strong> æ–¹æ³•å¦‚ä¸‹ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->books_dataset = books_dataset.<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x[<span class="hljs-string">&quot;review_title&quot;</span>].split()) &gt; <span class="hljs-number">2</span>)<!-- HTML_TAG_END --></pre></div>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†æˆ‘ä»¬çš„è¯­æ–™åº“ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›å¯ä»¥å¯¹å…¶è¿›è¡Œå¾®è°ƒçš„å¯èƒ½çš„ Transformer æ¨¡å‹ï¼</p>
<h2 id="">æ–‡æœ¬æ‘˜è¦æ¨¡å‹</h2>
<p>å¦‚æœä½ ä»”ç»†æƒ³æƒ³ï¼Œæ–‡æœ¬æ‘˜è¦æ˜¯ä¸€ç§ç±»ä¼¼äºæœºå™¨ç¿»è¯‘çš„ä»»åŠ¡ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªåƒè¯„è®ºè¿™æ ·çš„æ–‡æœ¬æ­£æ–‡ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶â€œç¿»è¯‘â€æˆä¸€ä¸ªè¾ƒçŸ­çš„ç‰ˆæœ¬ï¼Œä»¥æ•æ‰è¾“å…¥çš„æ˜¾ç€ç‰¹å¾ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°ç”¨äºæ–‡æœ¬æ‘˜è¦çš„ Transformer æ¨¡å‹é‡‡ç”¨äº†æˆ‘ä»¬åœ¨<a href="/course/chapter1">ç¬¬ä¸€ç« </a>é‡åˆ°çš„ç¼–ç å™¨-è§£ç å™¨æ¶æ„ã€‚å°½ç®¡æœ‰ä¸€äº›ä¾‹å¤–ï¼Œä¾‹å¦‚ GPT ç³»åˆ—æ¨¡å‹ï¼Œå®ƒä»¬åœ¨few-shotï¼ˆå°‘é‡å¾®è°ƒï¼‰ä¹‹åä¹Ÿå¯ä»¥æå–æ‘˜è¦ã€‚ä¸‹è¡¨åˆ—å‡ºäº†ä¸€äº›æµè¡Œçš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œå¾®è°ƒä»¥è¿›è¡Œæ±‡æ€»ã€‚</p>
<table><thead><tr><th align="center">Transformer æ¨¡å‹</th>
<th>æè¿°</th>
<th align="center">å¤šç§è¯­è¨€?</th></tr></thead>
<tbody><tr><td align="center"><a href="https://huggingface.co/gpt2-xl" rel="nofollow">GPT-2</a></td>
<td>è™½ç„¶è®­ç»ƒä¸ºè‡ªå›å½’è¯­è¨€æ¨¡å‹ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡åœ¨è¾“å…¥æ–‡æœ¬æœ«å°¾é™„åŠ â€œTL;DRâ€æ¥ä½¿ GPT-2 ç”Ÿæˆæ‘˜è¦ã€‚</td>
<td align="center">âŒ</td></tr>
<tr><td align="center"><a href="https://huggingface.co/google/pegasus-large" rel="nofollow">PEGASUS</a></td>
<td>åœ¨é¢„è®­ç»ƒæ˜¯çš„ç›®æ ‡æ˜¯æ¥é¢„æµ‹å¤šå¥å­æ–‡æœ¬ä¸­çš„å±è”½å¥å­ã€‚ è¿™ä¸ªé¢„è®­ç»ƒç›®æ ‡æ¯”æ™®é€šè¯­è¨€å»ºæ¨¡æ›´æ¥è¿‘æ–‡æœ¬æ‘˜è¦ï¼Œå¹¶ä¸”åœ¨æµè¡Œçš„åŸºå‡†æµ‹è¯•ä¸­å¾—åˆ†å¾ˆé«˜ã€‚</td>
<td align="center">âŒ</td></tr>
<tr><td align="center"><a href="https://huggingface.co/t5-base" rel="nofollow">T5</a></td>
<td>é€šç”¨çš„ Transformer æ¶æ„ï¼Œåœ¨æ–‡æœ¬åˆ°æ–‡æœ¬çš„æ¡†æ¶ä¸­åˆ¶å®šæ‰€æœ‰ä»»åŠ¡ï¼› ä¾‹å¦‚ï¼Œæ¨¡å‹æ–‡æœ¬æ‘˜è¦çš„è¾“å…¥æ ¼å¼æ˜¯<code>summarize: ARTICLE</code>ã€‚</td>
<td align="center">âŒ</td></tr>
<tr><td align="center"><a href="https://huggingface.co/google/mt5-base" rel="nofollow">mT5</a></td>
<td>T5 çš„å¤šè¯­è¨€ç‰ˆæœ¬ï¼Œåœ¨å¤šè¯­è¨€ Common Crawl è¯­æ–™åº“ (mC4) ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œæ¶µç›– 101 ç§è¯­è¨€ã€‚</td>
<td align="center">âœ…</td></tr>
<tr><td align="center"><a href="https://huggingface.co/facebook/bart-base" rel="nofollow">BART</a></td>
<td>ä¸€ç§æ–°é¢–çš„ Transformer æ¶æ„ï¼Œå…¶ä¸­åŒ…å«ç»è¿‡è®­ç»ƒçš„ç¼–ç å™¨å’Œè§£ç å™¨å †æ ˆï¼Œä»¥é‡å»ºè¢«ç ´åçš„è¾“å…¥ï¼Œç»“åˆäº† BERT å’Œ GPT-2 çš„é¢„è®­ç»ƒæ–¹æ¡ˆã€‚</td>
<td align="center">âŒ</td></tr>
<tr><td align="center"><a href="https://huggingface.co/facebook/mbart-large-50" rel="nofollow">mBART-50</a></td>
<td>BART çš„å¤šè¯­è¨€ç‰ˆæœ¬ï¼Œé¢„è®­ç»ƒäº† 50 ç§è¯­è¨€ã€‚</td>
<td align="center">âœ…</td></tr></tbody></table>
<p>ä»æ­¤è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¤§å¤šæ•°ç”¨äºæ‘˜è¦çš„ Transformer æ¨¡å‹ï¼ˆä»¥åŠå¤§å¤šæ•° NLP ä»»åŠ¡ï¼‰éƒ½æ˜¯å•è¯­çš„ã€‚å¦‚æœæ‚¨çš„ä»»åŠ¡æ˜¯ä½¿ç”¨â€œæœ‰å¤§é‡è¯­æ–™åº“â€çš„è¯­è¨€ï¼ˆå¦‚è‹±è¯­æˆ–å¾·è¯­ï¼‰ï¼Œè¿™å¾ˆå¥½ï¼Œä½†å¯¹äºä¸–ç•Œå„åœ°æ­£åœ¨ä½¿ç”¨çš„æ•°åƒç§å…¶ä»–è¯­è¨€ï¼Œåˆ™ä¸ç„¶ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç±»å¤šè¯­è¨€ Transformer æ¨¡å‹ï¼Œå¦‚ mT5 å’Œ mBARTï¼Œå¯ä»¥è§£å†³é—®é¢˜ã€‚è¿™äº›æ¨¡å‹æ˜¯ä½¿ç”¨è¯­è¨€å»ºæ¨¡è¿›è¡Œé¢„è®­ç»ƒçš„ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼šå®ƒä»¬ä¸æ˜¯åœ¨ä¸€ç§è¯­è¨€çš„è¯­æ–™åº“ä¸Šè®­ç»ƒï¼Œè€Œæ˜¯åŒæ—¶åœ¨ 50 å¤šç§è¯­è¨€çš„æ–‡æœ¬ä¸Šè¿›è¡Œè”åˆè®­ç»ƒï¼</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ mT5ï¼Œè¿™æ˜¯ä¸€ç§åŸºäº T5 çš„æœ‰è¶£æ¶æ„ï¼Œåœ¨æ–‡æœ¬åˆ°æ–‡æœ¬æ¡†æ¶ä¸­è¿›è¡Œäº†é¢„è®­ç»ƒã€‚åœ¨ T5 ä¸­ï¼Œæ¯ä¸ª NLP ä»»åŠ¡éƒ½æ˜¯æ ¹æ®æç¤ºå‰ç¼€æ¥åˆ¶å®šçš„ï¼Œä¾‹å¦‚ <strong>summarize:</strong> è¿™ä½¿æ¨¡å‹ä½¿ç”Ÿæˆçš„æ–‡æœ¬é€‚åº”æç¤ºã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™è®© T5 å˜å¾—éå¸¸é€šç”¨ï¼Œå› ä¸ºä½ å¯ä»¥ç”¨ä¸€ä¸ªæ¨¡å‹è§£å†³å¾ˆå¤šä»»åŠ¡ï¼</p>
<div class="flex justify-center"><img class="block dark:hidden" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/t5.svg" alt="Different tasks performed by the T5 architecture.">
<img class="hidden dark:block" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/t5-dark.svg" alt="Different tasks performed by the T5 architecture."></div>
<p>mT5 ä¸ä½¿ç”¨å‰ç¼€ï¼Œä½†å…·æœ‰ T5 çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œå¹¶ä¸”å…·æœ‰å¤šè¯­è¨€çš„ä¼˜åŠ¿ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»é€‰æ‹©äº†ä¸€ä¸ªæ¨¡å‹ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å‡†å¤‡æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®ã€‚</p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>âœï¸ <strong>è¯•è¯•çœ‹ï¼</strong> å®Œæˆæœ¬èŠ‚åï¼Œé€šè¿‡ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯å¯¹ mBART è¿›è¡Œå¾®è°ƒï¼Œçœ‹çœ‹ mT5 ä¸ mBART ç›¸æ¯”æœ‰å¤šå¥½ã€‚ å¯¹äºå¥–åŠ±ç§¯åˆ†ï¼Œæ‚¨è¿˜å¯ä»¥å°è¯•ä»…åœ¨è‹±æ–‡è¯„è®ºä¸Šå¾®è°ƒ T5ã€‚ ç”±äº T5 éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„å‰ç¼€æç¤ºï¼Œå› æ­¤æ‚¨éœ€è¦åœ¨ä¸‹é¢çš„é¢„å¤„ç†æ­¥éª¤ä¸­å°†â€œsummarize:â€æ·»åŠ åˆ°è¾“å…¥ç¤ºä¾‹ä¸­ã€‚</p></div>
<h2 id="">é¢„å¤„ç†æ•°æ®</h2>
<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/1m7BerpSq8A" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>æˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯å¯¹æˆ‘ä»¬çš„è¯„è®ºåŠå…¶æ ‡é¢˜è¿›è¡Œæ ‡è®°å’Œç¼–ç ã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆåŠ è½½ä¸é¢„è®­ç»ƒæ¨¡å‹æ£€æŸ¥ç‚¹ç›¸å…³çš„æ ‡è®°å™¨ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ <strong>mt5-small</strong> ä½œä¸ºæˆ‘ä»¬çš„æ£€æŸ¥ç‚¹ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨åˆç†çš„æ—¶é—´å†…å¾®è°ƒæ¨¡å‹ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer

model_checkpoint = <span class="hljs-string">&quot;google/mt5-small&quot;</span>
tokenizer = AutoTokenizer.from_pretrained(model_checkpoint)<!-- HTML_TAG_END --></pre></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>ğŸ’¡åœ¨ NLP é¡¹ç›®çš„æ—©æœŸé˜¶æ®µï¼Œä¸€ä¸ªå¥½çš„åšæ³•æ˜¯åœ¨å°æ ·æœ¬æ•°æ®ä¸Šè®­ç»ƒä¸€ç±»â€œå°â€æ¨¡å‹ã€‚è¿™ä½¿æ‚¨å¯ä»¥æ›´å¿«åœ°è°ƒè¯•å’Œè¿­ä»£ç«¯åˆ°ç«¯å·¥ä½œæµã€‚ä¸€æ—¦æ‚¨å¯¹ç»“æœå……æ»¡ä¿¡å¿ƒï¼Œæ‚¨å§‹ç»ˆå¯ä»¥é€šè¿‡ç®€å•åœ°æ›´æ”¹æ¨¡å‹æ£€æŸ¥ç‚¹æ¥åœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šè®­ç»ƒæ¨¡å‹ï¼</p></div>
<p>è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªå°ä¾‹å­ä¸Šæµ‹è¯• mT5 æ ‡è®°å™¨ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->inputs = tokenizer(<span class="hljs-string">&quot;I loved reading the Hunger Games!&quot;</span>)
inputs<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->{<span class="hljs-string">&#x27;input_ids&#x27;</span>: [<span class="hljs-number">336</span>, <span class="hljs-number">259</span>, <span class="hljs-number">28387</span>, <span class="hljs-number">11807</span>, <span class="hljs-number">287</span>, <span class="hljs-number">62893</span>, <span class="hljs-number">295</span>, <span class="hljs-number">12507</span>, <span class="hljs-number">1</span>], <span class="hljs-string">&#x27;attention_mask&#x27;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]}<!-- HTML_TAG_END --></pre></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨<a href="/course/chapter3">ç¬¬ä¸‰ç« </a>ç¬¬ä¸€æ¬¡å¾®è°ƒå®éªŒä¸­é‡åˆ°çš„ç†Ÿæ‚‰çš„ <strong>input_ids</strong> å’Œ <strong>attention_mask</strong> .è®©æˆ‘ä»¬ç”¨åˆ†è¯å™¨è§£ç è¿™äº›è¾“å…¥ ID ï¼Œå¯ä»¥<strong>convert_ids_to_tokens()</strong> å‡½æ•°æ¥æŸ¥çœ‹æˆ‘ä»¬æ­£åœ¨å¤„ç†ä»€ä¹ˆæ ·çš„æ ‡è®°å™¨ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->tokenizer.convert_ids_to_tokens(inputs.input_ids)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->[<span class="hljs-string">&#x27;â–I&#x27;</span>, <span class="hljs-string">&#x27;â–&#x27;</span>, <span class="hljs-string">&#x27;loved&#x27;</span>, <span class="hljs-string">&#x27;â–reading&#x27;</span>, <span class="hljs-string">&#x27;â–the&#x27;</span>, <span class="hljs-string">&#x27;â–Hung&#x27;</span>, <span class="hljs-string">&#x27;er&#x27;</span>, <span class="hljs-string">&#x27;â–Games&#x27;</span>, <span class="hljs-string">&#x27;&lt;/s&gt;&#x27;</span>]<!-- HTML_TAG_END --></pre></div>
<p>ç‰¹æ®Šçš„ Unicode å­—ç¬¦ <code>â–</code> å’Œåºåˆ—ç»“æŸæ ‡è®° <code>&lt;/s&gt;</code> è¡¨æ˜æˆ‘ä»¬æ­£åœ¨å¤„ç† SentencePiece åˆ†è¯å™¨ï¼Œå®ƒåŸºäºåœ¨<a href="/course/chapter6">ç¬¬å…­ç« </a>ä¸­è®¨è®ºçš„Unigramåˆ†è¯ç®—æ³•. Unigram å¯¹å¤šè¯­è¨€è¯­æ–™åº“ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ SentencePiece ä¸çŸ¥é“é‡éŸ³ã€æ ‡ç‚¹ç¬¦å·ä»¥åŠè®¸å¤šè¯­è¨€ï¼ˆå¦‚æ—¥è¯­ï¼‰æ²¡æœ‰ç©ºæ ¼å­—ç¬¦ã€‚</p>
<p>ä¸ºäº†æ ‡è®°æˆ‘ä»¬çš„è¯­æ–™åº“ï¼Œæˆ‘ä»¬å¿…é¡»å¤„ç†ä¸æ‘˜è¦ç›¸å…³çš„ç»†èŠ‚ï¼šå› ä¸ºæˆ‘ä»¬çš„æ ‡ç­¾ä¹Ÿæ˜¯æ–‡æœ¬ï¼Œå®ƒä»¬å¯èƒ½ä¼šè¶…è¿‡æ¨¡å‹çš„æœ€å¤§ä¸Šä¸‹æ–‡å¤§å°ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å¯¹è¯„è®ºåŠå…¶æ ‡é¢˜è¿›è¡Œæˆªæ–­ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå°†è¿‡é•¿çš„è¾“å…¥ä¼ é€’ç»™æˆ‘ä»¬çš„æ¨¡å‹ã€‚ ğŸ¤— Transformers ä¸­çš„åˆ†è¯å™¨æä¾›äº†ä¸€ä¸ªæ¼‚äº®çš„ <strong>as_target_tokenizer()</strong> å‡½æ•°ï¼Œå®ƒå…è®¸æ‚¨å¹¶è¡Œåˆ†è¯å¹¶æ ‡è®°æ ‡ç­¾çš„å‡½æ•°ã€‚è¿™é€šå¸¸æ˜¯ä½¿ç”¨é¢„å¤„ç†å‡½æ•°å†…çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨å®Œæˆçš„ï¼Œè¯¥å‡½æ•°é¦–å…ˆå¯¹è¾“å…¥è¿›è¡Œç¼–ç ï¼Œç„¶åå°†æ ‡ç­¾ç¼–ç ä¸ºå•ç‹¬çš„åˆ—ã€‚ä»¥ä¸‹æ˜¯ mT5 çš„æ­¤å‡½æ•°çš„ç¤ºä¾‹ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->max_input_length = <span class="hljs-number">512</span>
max_target_length = <span class="hljs-number">30</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess_function</span>(<span class="hljs-params">examples</span>):
    model_inputs = tokenizer(
        examples[<span class="hljs-string">&quot;review_body&quot;</span>], max_length=max_input_length, truncation=<span class="hljs-literal">True</span>
    )
    <span class="hljs-comment"># Set up the tokenizer for targets</span>
    <span class="hljs-keyword">with</span> tokenizer.as_target_tokenizer():
        labels = tokenizer(
            examples[<span class="hljs-string">&quot;review_title&quot;</span>], max_length=max_target_length, truncation=<span class="hljs-literal">True</span>
        )

    model_inputs[<span class="hljs-string">&quot;labels&quot;</span>] = labels[<span class="hljs-string">&quot;input_ids&quot;</span>]
    <span class="hljs-keyword">return</span> model_inputs<!-- HTML_TAG_END --></pre></div>
<p>è®©æˆ‘ä»¬é€šè¿‡è¿™æ®µä»£ç æ¥äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘ä»¬åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å®šä¹‰å€¼ <strong>max_input_length</strong> å’Œ <strong>max_target_length</strong> ï¼Œå®ƒä¸ºæˆ‘ä»¬çš„è¯„è®ºå’Œæ ‡é¢˜çš„é•¿åº¦è®¾ç½®äº†ä¸Šé™ã€‚ç”±äºè¯„è®ºæ­£æ–‡é€šå¸¸æ¯”æ ‡é¢˜å¤§å¾—å¤šï¼Œæˆ‘ä»¬ç›¸åº”åœ°è°ƒæ•´äº†è¿™äº›å€¼ã€‚ç„¶åï¼Œåœ¨ <strong>preprocess_function()</strong> æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯„è®ºé¦–å…ˆè¢«æ ‡è®°åŒ–ï¼Œç„¶åæ˜¯æ ‡é¢˜åœ¨ <strong>as_target_tokenizer()</strong> å‡½æ•°é‡Œä¹Ÿåšäº†ç›¸åŒçš„å¤„ç†.</p>
<p>æœ‰äº† <code>preprocess_function()</code>ï¼Œæˆ‘ä»¬åœ¨æ•´ä¸ªè¯¾ç¨‹ä¸­å¹¿æ³›ä½¿ç”¨çš„æ–¹ä¾¿çš„ <code>Dataset.map()</code> å‡½æ•°æ¥æ ‡è®°æ•´ä¸ªè¯­æ–™åº“æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->tokenized_datasets = books_dataset.<span class="hljs-built_in">map</span>(preprocess_function, batched=<span class="hljs-literal">True</span>)<!-- HTML_TAG_END --></pre></div>
<p>æ—¢ç„¶è¯­æ–™åº“å·²ç»é¢„å¤„ç†å®Œæ¯•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›å¸¸ç”¨çš„æ‘˜è¦æŒ‡æ ‡ã€‚æ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ï¼Œåœ¨è¡¡é‡æœºå™¨ç”Ÿæˆçš„æ–‡æœ¬çš„è´¨é‡æ–¹é¢æ²¡æœ‰çµä¸¹å¦™è¯ã€‚</p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>ğŸ’¡ ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘ä»¬åœ¨ä¸Šé¢çš„ <code>Dataset.map()</code> å‡½æ•°ä¸­ä½¿ç”¨äº† <code>batched=True</code>ã€‚ è¿™ä¼šä»¥ 1,000 ä¸ªï¼ˆé»˜è®¤ï¼‰ä¸ºå•ä½å¯¹ç¤ºä¾‹è¿›è¡Œç¼–ç ï¼Œå¹¶å…è®¸æ‚¨åˆ©ç”¨ ğŸ¤— Transformers ä¸­å¿«é€Ÿæ ‡è®°å™¨çš„å¤šçº¿ç¨‹åŠŸèƒ½ã€‚ åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå°è¯•ä½¿ç”¨ <code>batched=True</code> æ¥åŠ é€Ÿæ‚¨çš„é¢„å¤„ç†ï¼</p></div>
<h2 id="">æ–‡æœ¬æ‘˜è¦çš„æŒ‡æ ‡</h2>
<iframe class="w-full xl:w-4/6 h-80" src="https://www.youtube-nocookie.com/embed/TMshhnrEXlg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>ä¸æˆ‘ä»¬åœ¨æœ¬è¯¾ç¨‹ä¸­æ¶µç›–çš„å¤§å¤šæ•°å…¶ä»–ä»»åŠ¡ç›¸æ¯”ï¼Œè¡¡é‡æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ï¼ˆå¦‚æ‘˜è¦æˆ–ç¿»è¯‘ï¼‰çš„æ€§èƒ½å¹¶ä¸é‚£ä¹ˆç®€å•ã€‚ä¾‹å¦‚ï¼Œå¯¹äºâ€œæˆ‘å–œæ¬¢é˜…è¯»é¥¥é¥¿æ¸¸æˆâ€è¿™æ ·çš„è¯„è®ºï¼Œæœ‰å¤šä¸ªæœ‰æ•ˆæ‘˜è¦ï¼Œä¾‹å¦‚â€œæˆ‘å–œæ¬¢é¥¥é¥¿æ¸¸æˆâ€æˆ–â€œé¥¥é¥¿æ¸¸æˆæ˜¯ä¸€æœ¬å¥½ä¹¦â€ã€‚æ˜¾ç„¶ï¼Œåœ¨ç”Ÿæˆçš„æ‘˜è¦å’Œæ ‡ç­¾ä¹‹é—´åº”ç”¨æŸç§ç²¾ç¡®åŒ¹é…å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆâ€”â€”å³ä½¿æ˜¯äººç±»åœ¨è¿™æ ·çš„æŒ‡æ ‡ä¸‹ä¹Ÿä¼šè¡¨ç°ä¸ä½³ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½æœ‰è‡ªå·±çš„å†™ä½œé£æ ¼ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œæœ€å¸¸ç”¨çš„æŒ‡æ ‡ä¹‹ä¸€æ˜¯<a href="https://en.wikipedia.org/wiki/ROUGE_(metric)" rel="nofollow">ROUGE åˆ†æ•°</a>ï¼ˆRecall-Oriented Understudy for Gisting Evaluation çš„ç¼©å†™ï¼‰ã€‚è¯¥æŒ‡æ ‡èƒŒåçš„åŸºæœ¬æ€æƒ³æ˜¯å°†ç”Ÿæˆçš„æ‘˜è¦ä¸ä¸€ç»„é€šå¸¸ç”±äººç±»åˆ›å»ºçš„å‚è€ƒæ‘˜è¦è¿›è¡Œæ¯”è¾ƒã€‚ä¸ºäº†æ›´ç²¾ç¡®ï¼Œå‡è®¾æˆ‘ä»¬è¦æ¯”è¾ƒä»¥ä¸‹ä¸¤ä¸ªæ‘˜è¦ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->generated_summary = <span class="hljs-string">&quot;I absolutely loved reading the Hunger Games&quot;</span>
reference_summary = <span class="hljs-string">&quot;I loved reading the Hunger Games&quot;</span><!-- HTML_TAG_END --></pre></div>
<p>æ¯”è¾ƒå®ƒä»¬çš„ä¸€ç§æ–¹æ³•æ˜¯è®¡ç®—é‡å å•è¯çš„æ•°é‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸º 6ã€‚ä½†æ˜¯ï¼Œè¿™æœ‰ç‚¹ç²—ç³™ï¼Œå› æ­¤ ROUGE æ˜¯åŸºäºè®¡ç®—è®¡ç®—é‡å çš„ <em>precision</em> å’Œ <em>recall</em> åˆ†æ•°ã€‚ã€‚</p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>ğŸ™‹ å¦‚æœè¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡å¬è¯´ç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼Œè¯·ä¸è¦æ‹…å¿ƒâ€”â€”æˆ‘ä»¬å°†ä¸€èµ·é€šè¿‡ä¸€äº›æ˜ç¡®çš„ç¤ºä¾‹æ¥è¯´æ˜ä¸€åˆ‡ã€‚ è¿™äº›æŒ‡æ ‡é€šå¸¸åœ¨åˆ†ç±»ä»»åŠ¡ä¸­é‡åˆ°ï¼Œå› æ­¤å¦‚æœæ‚¨æƒ³äº†è§£åœ¨è¯¥ä¸Šä¸‹æ–‡ä¸­å¦‚ä½•å®šä¹‰ç²¾ç¡®åº¦å’Œå¬å›ç‡ï¼Œæˆ‘ä»¬å»ºè®®æŸ¥çœ‹ scikit-learn [æŒ‡å—](<a href="https://scikit-learn.org/stable" rel="nofollow">https://scikit-learn.org/stable</a> /auto_examples/model_selection/plot_precision_recall.htmlï¼‰ã€‚</p></div>
<p>å¯¹äº ROUGEï¼Œrecall è¡¡é‡ç”Ÿæˆçš„å‚è€ƒæ‘˜è¦åŒ…å«äº†å¤šå°‘å‚è€ƒæ‘˜è¦ã€‚å¦‚æœæˆ‘ä»¬åªæ˜¯æ¯”è¾ƒå•è¯ï¼Œrecallå¯ä»¥æ ¹æ®ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š
<!-- HTML_TAG_START --><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">l</mi></mrow><mo>=</mo><mfrac><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mtext>â€‰</mtext><mi mathvariant="normal">o</mi><mi mathvariant="normal">f</mi><mtext>â€‰</mtext><mi mathvariant="normal">o</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">g</mi><mtext>â€‰</mtext><mi mathvariant="normal">w</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">s</mi></mrow><mrow><mi mathvariant="normal">T</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi><mtext>â€‰</mtext><mi mathvariant="normal">n</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mtext>â€‰</mtext><mi mathvariant="normal">o</mi><mi mathvariant="normal">f</mi><mtext>â€‰</mtext><mi mathvariant="normal">w</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">s</mi><mtext>â€‰</mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mtext>â€‰</mtext><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">e</mi><mtext>â€‰</mtext><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">y</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \mathrm{Recall} = \frac{\mathrm{Number\,of\,overlapping\, words}}{\mathrm{Total\, number\, of\, words\, in\, reference\, summary}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord mathrm">Recall</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Total</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">number</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.07778em;">of</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">words</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">in</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">reference</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">summary</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Number</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.07778em;">of</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">overlapping</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">words</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><!-- HTML_TAG_END --></p>
<p>å¯¹äºæˆ‘ä»¬ä¸Šé¢çš„ç®€å•ä¾‹å­ï¼Œè¿™ä¸ªå…¬å¼ç»™å‡ºäº† 6/6 = 1 çš„å®Œç¾å¬å›ç‡ï¼›å³ï¼Œå‚è€ƒæ‘˜è¦ä¸­çš„æ‰€æœ‰å•è¯éƒ½å·²ç”±æ¨¡å‹ç”Ÿæˆã€‚è¿™å¬èµ·æ¥å¯èƒ½å¾ˆæ£’ï¼Œä½†æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ç”Ÿæˆçš„æ‘˜è¦æ˜¯â€œæˆ‘çœŸçš„å¾ˆå–œæ¬¢æ•´æ™šé˜…è¯»é¥¥é¥¿æ¸¸æˆâ€ã€‚è¿™ä¹Ÿå°†æœ‰å®Œç¾çš„recallï¼Œä½†å¯ä»¥è¯´æ˜¯ä¸€ä¸ªæ›´ç³Ÿç³•çš„æ€»ç»“ï¼Œå› ä¸ºå®ƒå¾ˆå†—é•¿ã€‚ä¸ºäº†å¤„ç†è¿™äº›åœºæ™¯ï¼Œæˆ‘ä»¬è¿˜è®¡ç®—äº†pecisionï¼Œå®ƒåœ¨ ROUGE ä¸Šä¸‹æ–‡ä¸­è¡¡é‡ç”Ÿæˆçš„æ‘˜è¦ä¸­æœ‰å¤šå°‘æ˜¯ç›¸å…³çš„ï¼š
<!-- HTML_TAG_START --><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mi mathvariant="normal">P</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi></mrow><mo>=</mo><mfrac><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mtext>â€‰</mtext><mi mathvariant="normal">o</mi><mi mathvariant="normal">f</mi><mtext>â€‰</mtext><mi mathvariant="normal">o</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">g</mi><mtext>â€‰</mtext><mi mathvariant="normal">w</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">s</mi></mrow><mrow><mi mathvariant="normal">T</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi><mtext>â€‰</mtext><mi mathvariant="normal">n</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mtext>â€‰</mtext><mi mathvariant="normal">o</mi><mi mathvariant="normal">f</mi><mtext>â€‰</mtext><mi mathvariant="normal">w</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">s</mi><mtext>â€‰</mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mtext>â€‰</mtext><mi mathvariant="normal">g</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi><mtext>â€‰</mtext><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">y</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \mathrm{Precision} = \frac{\mathrm{Number\,of\,overlapping\, words}}{\mathrm{Total\, number\, of\, words\, in\, generated\, summary}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathrm">Precision</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Total</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">number</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.07778em;">of</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">words</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">in</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">generated</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">summary</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Number</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.07778em;">of</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">overlapping</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">words</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><!-- HTML_TAG_END --></p>
<p>å°†æ­¤åº”ç”¨åˆ°æˆ‘ä»¬çš„è¯¦ç»†æ‘˜è¦ä¸­ä¼šå¾—åˆ° 6/10 = 0.6 çš„ç²¾åº¦ï¼Œè¿™æ¯”æˆ‘ä»¬è¾ƒçŸ­çš„æ‘˜è¦è·å¾—çš„ 6/7 = 0.86 çš„ç²¾åº¦è¦å·®å¾—å¤šã€‚åœ¨å®è·µä¸­ï¼Œé€šå¸¸è®¡ç®—ç²¾åº¦å’Œå¬å›ç‡ï¼Œç„¶åæŠ¥å‘Š F1-scoreï¼ˆç²¾åº¦å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡å€¼ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ ğŸ¤— Datasets ä¸­é€šè¿‡å®‰è£… <strong>rouge_score</strong> åŒ…æ¥è®¡ç®—ä»–ä»¬ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->!pip install rouge_score<!-- HTML_TAG_END --></pre></div>
<p>ç„¶åæŒ‰å¦‚ä¸‹æ–¹å¼åŠ è½½ ROUGE æŒ‡æ ‡ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_metric

rouge_score = load_metric(<span class="hljs-string">&quot;rouge&quot;</span>)<!-- HTML_TAG_END --></pre></div>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>rouge_score.compute()</strong> ä¸€æ¬¡æ€§è®¡ç®—æ‰€æœ‰æŒ‡æ ‡çš„å‡½æ•°ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->scores = rouge_score.compute(
    predictions=[generated_summary], references=[reference_summary]
)
scores<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->{<span class="hljs-string">&#x27;rouge1&#x27;</span>: AggregateScore(low=Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>), mid=Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>), high=Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>)),
 <span class="hljs-string">&#x27;rouge2&#x27;</span>: AggregateScore(low=Score(precision=<span class="hljs-number">0.67</span>, recall=<span class="hljs-number">0.8</span>, fmeasure=<span class="hljs-number">0.73</span>), mid=Score(precision=<span class="hljs-number">0.67</span>, recall=<span class="hljs-number">0.8</span>, fmeasure=<span class="hljs-number">0.73</span>), high=Score(precision=<span class="hljs-number">0.67</span>, recall=<span class="hljs-number">0.8</span>, fmeasure=<span class="hljs-number">0.73</span>)),
 <span class="hljs-string">&#x27;rougeL&#x27;</span>: AggregateScore(low=Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>), mid=Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>), high=Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>)),
 <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: AggregateScore(low=Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>), mid=Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>), high=Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>))}<!-- HTML_TAG_END --></pre></div>
<p>å“‡ï¼Œé‚£ä¸ªè¾“å‡ºä¸­æœ‰å¾ˆå¤šä¿¡æ¯â€”â€”è¿™éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿé¦–å…ˆï¼ŒğŸ¤— Datasetså®é™…ä¸Šè®¡ç®—äº†ç²¾åº¦ã€å¬å›ç‡å’Œ F1 åˆ†æ•°çš„ç½®ä¿¡åŒºé—´ï¼›è¿™äº›æ˜¯ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°çš„ <strong>low</strong> , <strong>mid</strong> ï¼Œ å’Œ <strong>high</strong> å±æ€§ã€‚æ­¤å¤–ï¼ŒğŸ¤— Datasetsåœ¨æ¯”è¾ƒç”Ÿæˆæ‘˜è¦å’Œå‚è€ƒæ‘˜è¦æ—¶ï¼Œä¼šæ ¹æ®ä¸åŒç±»å‹çš„æ–‡æœ¬ç²’åº¦è®¡ç®—å„ç§ ROUGE åˆ†æ•°ã€‚è¿™ <strong>rouge1</strong> å˜ä½“æ˜¯ä¸€å…ƒç»„çš„é‡å â€”â€”è¿™åªæ˜¯è¡¨è¾¾å•è¯é‡å çš„ä¸€ç§å¥‡ç‰¹æ–¹å¼ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬ä¸Šé¢è®¨è®ºçš„åº¦é‡æ ‡å‡†ã€‚ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬è¾“å‡º <strong>mid</strong> çš„æ•°å€¼ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->scores[<span class="hljs-string">&quot;rouge1&quot;</span>].mid<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->Score(precision=<span class="hljs-number">0.86</span>, recall=<span class="hljs-number">1.0</span>, fmeasure=<span class="hljs-number">0.92</span>)<!-- HTML_TAG_END --></pre></div>
<p>å¤ªå¥½äº†ï¼Œå‡†ç¡®ç‡å’Œå¬å›ç‡åŒ¹é…äº†ï¼é‚£ä¹ˆå…¶ä»–çš„ ROUGE åˆ†æ•°å‘¢ï¼Ÿ <strong>rouge2</strong> æµ‹é‡äºŒå…ƒç»„ä¹‹é—´çš„é‡å ï¼ˆæƒ³æƒ³å•è¯å¯¹çš„é‡å ï¼‰ï¼Œè€Œ <strong>rougeL</strong> å’Œ <strong>rougeLsum</strong> é€šè¿‡åœ¨ç”Ÿæˆçš„å’Œå‚è€ƒæ‘˜è¦ä¸­æŸ¥æ‰¾æœ€é•¿çš„å…¬å…±å­ä¸²æ¥æµ‹é‡æœ€é•¿çš„å•è¯åŒ¹é…åºåˆ—ã€‚ä¸­çš„â€œæ€»å’Œâ€ <strong>rougeLsum</strong> æŒ‡çš„æ˜¯è¿™ä¸ªæŒ‡æ ‡æ˜¯åœ¨æ•´ä¸ªæ‘˜è¦ä¸Šè®¡ç®—çš„ï¼Œè€Œ <strong>rougeL</strong> è®¡ç®—ä¸ºå•ä¸ªå¥å­çš„å¹³å‡å€¼ã€‚</p>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>âœï¸ <strong>è¯•è¯•çœ‹ï¼</strong> åˆ›å»ºæ‚¨è‡ªå·±çš„ç”Ÿæˆå’Œå‚è€ƒæ‘˜è¦ç¤ºä¾‹ï¼Œå¹¶æŸ¥çœ‹ç”Ÿæˆçš„ ROUGE åˆ†æ•°æ˜¯å¦ä¸åŸºäºç²¾ç¡®åº¦å’Œå¬å›ç‡å…¬å¼çš„æ‰‹åŠ¨è®¡ç®—ä¸€è‡´ã€‚ å¯¹äºé™„åŠ åˆ†ï¼Œå°†æ–‡æœ¬æ‹†åˆ†ä¸ºäºŒå…ƒç»„å¹¶æ¯”è¾ƒâ€œrouge2â€æŒ‡æ ‡çš„ç²¾åº¦å’Œå¬å›ç‡ã€‚</p></div>
<p>æˆ‘ä»¬å°†ä½¿ç”¨è¿™äº› ROUGE åˆ†æ•°æ¥è·Ÿè¸ªæˆ‘ä»¬æ¨¡å‹çš„æ€§èƒ½ï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬åšæ¯ä¸ªä¼˜ç§€çš„ NLP ä»ä¸šè€…éƒ½åº”è¯¥åšçš„äº‹æƒ…ï¼šåˆ›å»ºä¸€ä¸ªå¼ºå¤§è€Œç®€å•çš„baselineï¼</p>
<h3 class="relative group"><a id="baseline" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#baseline"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>åˆ›å»ºå¼ºå¤§çš„baseline
	</span></h3>

<p>æ–‡æœ¬æ‘˜è¦çš„ä¸€ä¸ªå¸¸è§åŸºçº¿æ˜¯ç®€å•åœ°å–ä¸€ç¯‡æ–‡ç« çš„å‰ä¸‰ä¸ªå¥å­ï¼Œé€šå¸¸ç§°ä¸º <em>lead-3</em> åŸºçº¿ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¥å·(è‹±æ–‡ä½¿ç”¨.)æ¥è·Ÿè¸ªå¥å­è¾¹ç•Œï¼Œä½†è¿™åœ¨â€U.S.â€ or â€œU.N.â€ä¹‹ç±»çš„é¦–å­—æ¯ç¼©ç•¥è¯ä¸Šä¼šå¤±è´¥ã€‚æ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨ <code>nltk</code> åº“ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ›´å¥½çš„ç®—æ³•æ¥å¤„ç†è¿™äº›æƒ…å†µã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ <code>pip</code> å®‰è£…è½¯ä»¶åŒ…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->!pip install nltk<!-- HTML_TAG_END --></pre></div>
<p>ç„¶åä¸‹è½½æ ‡ç‚¹è§„åˆ™ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">import</span> nltk

nltk.download(<span class="hljs-string">&quot;punkt&quot;</span>)<!-- HTML_TAG_END --></pre></div>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä» <code>nltk</code> å¯¼å…¥å¥å­æ ‡è®°å™¨å¹¶åˆ›å»ºä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥æå–è¯„è®ºä¸­çš„å‰ä¸‰ä¸ªå¥å­ã€‚ æ–‡æœ¬æ‘˜è¦çš„çº¦å®šæ˜¯ç”¨æ¢è¡Œç¬¦åˆ†éš”æ¯ä¸ªæ‘˜è¦ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå°†å…¶åŒ…å«åœ¨å†…å¹¶åœ¨è®­ç»ƒç¤ºä¾‹ä¸Šå¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> nltk.tokenize <span class="hljs-keyword">import</span> sent_tokenize


<span class="hljs-keyword">def</span> <span class="hljs-title function_">three_sentence_summary</span>(<span class="hljs-params">text</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;\n&quot;</span>.join(sent_tokenize(text)[:<span class="hljs-number">3</span>])


<span class="hljs-built_in">print</span>(three_sentence_summary(books_dataset[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&quot;review_body&quot;</span>]))<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;I grew up reading Koontz, and years ago, I stopped,convinced i had &quot;outgrown&quot; him.&#x27;</span>
<span class="hljs-string">&#x27;Still,when a friend was looking for something suspenseful too read, I suggested Koontz.&#x27;</span>
<span class="hljs-string">&#x27;She found Strangers.&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>è¿™ä¼¼ä¹æœ‰æ•ˆï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç°åœ¨å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œä»æ•°æ®é›†ä¸­æå–è¿™äº›â€œæ‘˜è¦â€å¹¶è®¡ç®—baselineçš„ ROUGE åˆ†æ•°ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_baseline</span>(<span class="hljs-params">dataset, metric</span>):
    summaries = [three_sentence_summary(text) <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> dataset[<span class="hljs-string">&quot;review_body&quot;</span>]]
    <span class="hljs-keyword">return</span> metric.compute(predictions=summaries, references=dataset[<span class="hljs-string">&quot;review_title&quot;</span>])<!-- HTML_TAG_END --></pre></div>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥è®¡ç®—éªŒè¯é›†ä¸Šçš„ ROUGE åˆ†æ•°ï¼Œå¹¶ä½¿ç”¨ Pandas å¯¹å®ƒä»¬è¿›è¡Œä¸€äº›ç¾åŒ–ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

score = evaluate_baseline(books_dataset[<span class="hljs-string">&quot;validation&quot;</span>], rouge_score)
rouge_names = [<span class="hljs-string">&quot;rouge1&quot;</span>, <span class="hljs-string">&quot;rouge2&quot;</span>, <span class="hljs-string">&quot;rougeL&quot;</span>, <span class="hljs-string">&quot;rougeLsum&quot;</span>]
rouge_dict = <span class="hljs-built_in">dict</span>((rn, <span class="hljs-built_in">round</span>(score[rn].mid.fmeasure * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)) <span class="hljs-keyword">for</span> rn <span class="hljs-keyword">in</span> rouge_names)
rouge_dict<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->{<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">16.74</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">8.83</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">15.6</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">15.96</span>}<!-- HTML_TAG_END --></pre></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>rouge2</code>çš„åˆ†æ•°æ˜æ˜¾ä½äºå…¶ä»–ï¼› è¿™å¯èƒ½åæ˜ äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³è¯„è®ºæ ‡é¢˜é€šå¸¸å¾ˆç®€æ´ï¼Œå› æ­¤lead-3 baselineè¿‡äºå†—é•¿ã€‚ ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„åŸºå‡†ï¼Œè®©æˆ‘ä»¬å°†æ³¨æ„åŠ›è½¬å‘å¾®è°ƒ mT5ï¼</p>
<h2 class="relative group"><a id="trainer-apimt5" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#trainer-apimt5"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>ä½¿ç”¨ <code>Trainer</code> APIå¾®è°ƒmT5 
	</span></h2>

<p>å¾®è°ƒæ¨¡å‹ä»¥è¿›è¡Œæå–æ‘˜è¦ä¸æˆ‘ä»¬åœ¨æœ¬ç« ä¸­ä»‹ç»çš„å…¶ä»–ä»»åŠ¡éå¸¸ç›¸ä¼¼ã€‚ æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä»<code>mt5-small</code>æ£€æŸ¥ç‚¹åŠ è½½é¢„è®­ç»ƒæ¨¡å‹ã€‚ ç”±äºæ‘˜è¦æå–æ˜¯ä¸€ä¸ªåºåˆ—åˆ°åºåˆ—çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ AutoModelForSeq2SeqLM ç±»åŠ è½½æ¨¡å‹ï¼Œè¯¥ç±»ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶ç¼“å­˜æƒé‡ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSeq2SeqLM

model = AutoModelForSeq2SeqLM.from_pretrained(model_checkpoint)<!-- HTML_TAG_END --></pre></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>ğŸ’¡ If youâ€™re wondering why you donâ€™t see any warnings about fine-tuning the model on a downstream task, thatâ€™s because for sequence-to-sequence tasks we keep all the weights of the network. Compare this to our text classification model in <a href="/course/chapter3">Chapter 3</a>, where the head of the pretrained model was replaced with a randomly initialized network.
ğŸ’¡ å¦‚æœæ‚¨æƒ³çŸ¥é“ä¸ºä»€ä¹ˆåœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­æ²¡æœ‰çœ‹åˆ°ä»»ä½•å…³äºå¾®è°ƒæ¨¡å‹çš„è­¦å‘Šï¼Œé‚£æ˜¯å› ä¸ºå¯¹äºåºåˆ—åˆ°åºåˆ—çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¿ç•™äº†ç½‘ç»œçš„æ‰€æœ‰æƒé‡ã€‚ä¸æˆ‘ä»¬åœ¨[ç¬¬ä¸‰ç« ] (/course/chapter3)ä¸­çš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹è¿›è¡Œæ¯”è¾ƒï¼Œæ–‡æœ¬åˆ†ç±»æ¨¡å‹é¢„è®­ç»ƒæ¨¡å‹çš„å¤´éƒ¨è¢«éšæœºåˆå§‹åŒ–çš„ç½‘ç»œæ›¿æ¢ã€‚</p></div>
<p>æˆ‘ä»¬éœ€è¦åšçš„ä¸‹ä¸€ä»¶äº‹æ˜¯ç™»å½• Hugging Face Hubã€‚å¦‚æœæ‚¨åœ¨notebookä¸­è¿è¡Œæ­¤ä»£ç ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å®ç”¨ç¨‹åºå‡½æ•°æ‰§è¡Œæ­¤æ“ä½œï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> notebook_login

notebook_login()<!-- HTML_TAG_END --></pre></div>
<p>è¿™å°†æ˜¾ç¤ºä¸€ä¸ªå°éƒ¨ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥æ‚¨çš„å‡­æ®ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œæ­¤å‘½ä»¤å¹¶åœ¨é‚£é‡Œç™»å½•ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->huggingface-<span class="hljs-keyword">cli</span> login<!-- HTML_TAG_END --></pre></div>
<p>æˆ‘ä»¬éœ€è¦ç”Ÿæˆæ‘˜è¦ä»¥ä¾¿åœ¨è®­ç»ƒæœŸé—´è®¡ç®— ROUGE åˆ†æ•°ã€‚å¹¸è¿çš„æ˜¯ï¼ŒğŸ¤— Transformers æä¾›äº†ä¸“ç”¨çš„ <code>Seq2SeqTrainingArguments</code> å’Œ <code>Seq2SeqTrainer</code> ç±»ï¼Œå¯ä»¥è‡ªåŠ¨ä¸ºæˆ‘ä»¬å®Œæˆè¿™é¡¹å·¥ä½œï¼ ä¸ºäº†äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè®©æˆ‘ä»¬é¦–å…ˆä¸ºæˆ‘ä»¬çš„å®éªŒå®šä¹‰è¶…å‚æ•°å’Œå…¶ä»–å‚æ•°ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Seq2SeqTrainingArguments

batch_size = <span class="hljs-number">8</span>
num_train_epochs = <span class="hljs-number">8</span>
<span class="hljs-comment"># Show the training loss with every epoch</span>
logging_steps = <span class="hljs-built_in">len</span>(tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>]) // batch_size
model_name = model_checkpoint.split(<span class="hljs-string">&quot;/&quot;</span>)[-<span class="hljs-number">1</span>]

args = Seq2SeqTrainingArguments(
    output_dir=<span class="hljs-string">f&quot;<span class="hljs-subst">{model_name}</span>-finetuned-amazon-en-es&quot;</span>,
    evaluation_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,
    learning_rate=<span class="hljs-number">5.6e-5</span>,
    per_device_train_batch_size=batch_size,
    per_device_eval_batch_size=batch_size,
    weight_decay=<span class="hljs-number">0.01</span>,
    save_total_limit=<span class="hljs-number">3</span>,
    num_train_epochs=num_train_epochs,
    predict_with_generate=<span class="hljs-literal">True</span>,
    logging_steps=logging_steps,
    push_to_hub=<span class="hljs-literal">True</span>,
)<!-- HTML_TAG_END --></pre></div>
<p>åœ¨è¿™é‡Œï¼Œ <strong>predict_with_generate</strong> å‚æ•°å·²è®¾ç½®ä¸ºTrueè¡¨æ˜æˆ‘ä»¬åº”è¯¥åœ¨è¯„ä¼°æœŸé—´ç”Ÿæˆæ‘˜è¦ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯ä¸ªæ—¶æœŸçš„ ROUGE åˆ†æ•°ã€‚æ­£å¦‚åœ¨<a href="/course/chapter1">ç¬¬ä¸€ç« </a>æ‰€è®¨è®ºçš„ï¼Œè§£ç å™¨é€šè¿‡é€ä¸ªé¢„æµ‹ä»¤ç‰Œæ¥æ‰§è¡Œæ¨ç†ï¼Œè¿™æ˜¯ç”±æ¨¡å‹çš„ <strong>generate()</strong> æ–¹æ³•å®ç°çš„ã€‚è®¾ç½® <strong>predict_with_generate=True</strong> å‘Šè¯‰ <strong>Seq2SeqTrainer</strong> ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œè¯„ä¼°ã€‚æˆ‘ä»¬è¿˜è°ƒæ•´äº†ä¸€äº›é»˜è®¤çš„è¶…å‚æ•°ï¼Œä¾‹å¦‚å­¦ä¹ ç‡ã€epochæ•°å’Œæƒé‡è¡°å‡ï¼Œå¹¶ä¸”æˆ‘ä»¬è®¾ç½®äº† <strong>save_total_limit</strong> è®­ç»ƒæœŸé—´æœ€å¤šåªä¿å­˜ 3 ä¸ªæ£€æŸ¥ç‚¹çš„é€‰é¡¹â€”â€”è¿™æ˜¯å› ä¸ºå³ä½¿æ˜¯ mT5 çš„â€œsmallâ€ç‰ˆæœ¬ä¹Ÿä½¿ç”¨å¤§çº¦ 1 GB çš„ç¡¬ç›˜ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é™åˆ¶æˆ‘ä»¬ä¿å­˜çš„å‰¯æœ¬æ•°é‡æ¥èŠ‚çœä¸€ç‚¹ç©ºé—´ã€‚</p>
<p><code>push_to_hub=True</code> å‚æ•°å°†å…è®¸æˆ‘ä»¬åœ¨è®­ç»ƒåå°†æ¨¡å‹æ¨é€åˆ° Hubï¼› æ‚¨å°†åœ¨<code>output_dir</code>å®šä¹‰çš„ä½ç½®ä¸­çš„ç”¨æˆ·é…ç½®æ–‡ä»¶ä¸‹æ‰¾åˆ°å­˜å‚¨åº“ã€‚ è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>hub_model_id</code> å‚æ•°æŒ‡å®šè¦æ¨é€åˆ°çš„å­˜å‚¨åº“çš„åç§°ï¼ˆç‰¹åˆ«æ˜¯å½“æ‚¨æƒ³è¦æ¨é€åˆ°ç»„ç»‡æ—¶ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨æ­¤å‚æ•°ï¼‰ã€‚ ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å°†æ¨¡å‹æ¨é€åˆ° <a href="https://huggingface.co/huggingface-course" rel="nofollow"><code>huggingface-course</code> ç»„ç»‡</a> æ—¶ï¼Œæˆ‘ä»¬æ·»åŠ äº†<code>hub_model_id=&quot;huggingface-course/mt5-finetuned-amazon-en-es&quot;</code> åˆ° <code>Seq2SeqTrainingArguments</code>ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åšçš„ä¸‹ä¸€ä»¶äº‹æ˜¯ä¸ºè®­ç»ƒå™¨æä¾›ä¸€ä¸ªâ€œcompute_metrics()â€å‡½æ•°ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨è®­ç»ƒæœŸé—´è¯„ä¼°æˆ‘ä»¬çš„æ¨¡å‹ã€‚ æ€»ç»“èµ·æ¥ï¼Œè¿™æ¯”ç®€å•åœ°åœ¨æ¨¡å‹çš„é¢„æµ‹ä¸Šè°ƒç”¨ <code>rouge_score.compute()</code> æ›´å¤æ‚ä¸€äº›ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨è®¡ç®— ROUGE åˆ†æ•°ä¹‹å‰å°†è¾“å‡ºå’Œæ ‡ç­¾è§£ç ä¸ºæ–‡æœ¬ã€‚ ä¸‹é¢çš„å‡½æ•°æ­£æ˜¯è¿™æ ·åšçš„ï¼Œå¹¶ä¸”è¿˜åˆ©ç”¨ <code>nltk</code> ä¸­çš„ <code>sent_tokenize()</code> å‡½æ•°æ¥ç”¨æ¢è¡Œç¬¦åˆ†éš”æ‘˜è¦è¯­å¥ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np


<span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_metrics</span>(<span class="hljs-params">eval_pred</span>):
    predictions, labels = eval_pred
    <span class="hljs-comment"># Decode generated summaries into text</span>
    decoded_preds = tokenizer.batch_decode(predictions, skip_special_tokens=<span class="hljs-literal">True</span>)
    <span class="hljs-comment"># Replace -100 in the labels as we can&#x27;t decode them</span>
    labels = np.where(labels != -<span class="hljs-number">100</span>, labels, tokenizer.pad_token_id)
    <span class="hljs-comment"># Decode reference summaries into text</span>
    decoded_labels = tokenizer.batch_decode(labels, skip_special_tokens=<span class="hljs-literal">True</span>)
    <span class="hljs-comment"># ROUGE expects a newline after each sentence</span>
    decoded_preds = [<span class="hljs-string">&quot;\n&quot;</span>.join(sent_tokenize(pred.strip())) <span class="hljs-keyword">for</span> pred <span class="hljs-keyword">in</span> decoded_preds]
    decoded_labels = [<span class="hljs-string">&quot;\n&quot;</span>.join(sent_tokenize(label.strip())) <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> decoded_labels]
    <span class="hljs-comment"># Compute ROUGE scores</span>
    result = rouge_score.compute(
        predictions=decoded_preds, references=decoded_labels, use_stemmer=<span class="hljs-literal">True</span>
    )
    <span class="hljs-comment"># Extract the median scores</span>
    result = {key: value.mid.fmeasure * <span class="hljs-number">100</span> <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> result.items()}
    <span class="hljs-keyword">return</span> {k: <span class="hljs-built_in">round</span>(v, <span class="hljs-number">4</span>) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> result.items()}<!-- HTML_TAG_END --></pre></div>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„åºåˆ—åˆ°åºåˆ—ä»»åŠ¡å®šä¹‰ä¸€ä¸ªæ•°æ®æ•´ç†å™¨ã€‚ç”±äº mT5 æ˜¯ä¸€ä¸ªç¼–ç å™¨-è§£ç å™¨ Transformer æ¨¡å‹ï¼Œå‡†å¤‡æˆ‘ä»¬çš„æ‰¹æ¬¡çš„ä¸€ä¸ªå¾®å¦™ä¹‹å¤„æ˜¯ï¼Œåœ¨è§£ç è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†æ ‡ç­¾å‘å³ç§»åŠ¨ä¸€ä¸ªã€‚ è¿™æ˜¯ä¸ºäº†ç¡®ä¿è§£ç å™¨åªçœ‹åˆ°ä¹‹å‰çš„çœŸå®çš„æ ‡ç­¾ï¼Œè€Œä¸æ˜¯å½“å‰æˆ–æœªæ¥çš„æ ‡ç­¾ï¼Œè¿™å¯¹äºæ¨¡å‹æ¥è¯´å¾ˆå®¹æ˜“è®°å¿†ã€‚ è¿™ç±»ä¼¼äºåœ¨ <a href="/course/chapter7/6">å› æœè¯­è¨€å»ºæ¨¡</a> ç­‰ä»»åŠ¡ä¸­å¦‚ä½•å°†æ©è”½çš„è‡ªæˆ‘æ³¨æ„åº”ç”¨äºè¾“å…¥ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒğŸ¤— Transformers æä¾›äº†ä¸€ä¸ª <code>DataCollatorForSeq2Seq</code> æ•´ç†å™¨ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬åŠ¨æ€å¡«å……è¾“å…¥å’Œæ ‡ç­¾ã€‚ è¦å®ä¾‹åŒ–è¿™ä¸ªæ”¶é›†å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾› <code>tokenizer</code> å’Œ <code>model</code>ï¼š</p>
<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> DataCollatorForSeq2Seq

data_collator = DataCollatorForSeq2Seq(tokenizer, model=model)<!-- HTML_TAG_END --></pre></div>
<p>è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ•´ç†å™¨åœ¨è¾“å…¥ä¸€å°æ‰¹ç¤ºä¾‹æ—¶ä¼šäº§ç”Ÿä»€ä¹ˆã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤å¸¦æœ‰å­—ç¬¦ä¸²çš„åˆ—ï¼Œå› ä¸ºæ•´ç†å™¨ä¸çŸ¥é“å¦‚ä½•å¡«å……è¿™äº›å…ƒç´ ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->tokenized_datasets = tokenized_datasets.remove_columns(
    books_dataset[<span class="hljs-string">&quot;train&quot;</span>].column_names
)<!-- HTML_TAG_END --></pre></div>
<p>ç”±äº collator éœ€è¦ä¸€ä¸ª <code>dict</code> çš„åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ª <code>dict</code> ä»£è¡¨æ•°æ®é›†ä¸­çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨å°†æ•°æ®ä¼ é€’ç»™ data collator ä¹‹å‰å°†æ•°æ®æ•´ç†æˆé¢„æœŸçš„æ ¼å¼ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->features = [tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>][i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]
data_collator(features)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->{<span class="hljs-string">&#x27;attention_mask&#x27;</span>: tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>,
         <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
        [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>,
         <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]]), <span class="hljs-string">&#x27;input_ids&#x27;</span>: tensor([[  <span class="hljs-number">1494</span>,    <span class="hljs-number">259</span>,   <span class="hljs-number">8622</span>,    <span class="hljs-number">390</span>,    <span class="hljs-number">259</span>,    <span class="hljs-number">262</span>,   <span class="hljs-number">2316</span>,   <span class="hljs-number">3435</span>,    <span class="hljs-number">955</span>,
            <span class="hljs-number">772</span>,    <span class="hljs-number">281</span>,    <span class="hljs-number">772</span>,   <span class="hljs-number">1617</span>,    <span class="hljs-number">263</span>,    <span class="hljs-number">305</span>,  <span class="hljs-number">14701</span>,    <span class="hljs-number">260</span>,   <span class="hljs-number">1385</span>,
           <span class="hljs-number">3031</span>,    <span class="hljs-number">259</span>,  <span class="hljs-number">24146</span>,    <span class="hljs-number">332</span>,   <span class="hljs-number">1037</span>,    <span class="hljs-number">259</span>,  <span class="hljs-number">43906</span>,    <span class="hljs-number">305</span>,    <span class="hljs-number">336</span>,
            <span class="hljs-number">260</span>,      <span class="hljs-number">1</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>],
        [   <span class="hljs-number">259</span>,  <span class="hljs-number">27531</span>,  <span class="hljs-number">13483</span>,    <span class="hljs-number">259</span>,   <span class="hljs-number">7505</span>,    <span class="hljs-number">260</span>, <span class="hljs-number">112240</span>,  <span class="hljs-number">15192</span>,    <span class="hljs-number">305</span>,
          <span class="hljs-number">53198</span>,    <span class="hljs-number">276</span>,    <span class="hljs-number">259</span>,  <span class="hljs-number">74060</span>,    <span class="hljs-number">263</span>,    <span class="hljs-number">260</span>,    <span class="hljs-number">459</span>,  <span class="hljs-number">25640</span>,    <span class="hljs-number">776</span>,
           <span class="hljs-number">2119</span>,    <span class="hljs-number">336</span>,    <span class="hljs-number">259</span>,   <span class="hljs-number">2220</span>,    <span class="hljs-number">259</span>,  <span class="hljs-number">18896</span>,    <span class="hljs-number">288</span>,   <span class="hljs-number">4906</span>,    <span class="hljs-number">288</span>,
           <span class="hljs-number">1037</span>,   <span class="hljs-number">3931</span>,    <span class="hljs-number">260</span>,   <span class="hljs-number">7083</span>, <span class="hljs-number">101476</span>,   <span class="hljs-number">1143</span>,    <span class="hljs-number">260</span>,      <span class="hljs-number">1</span>]]), <span class="hljs-string">&#x27;labels&#x27;</span>: tensor([[ <span class="hljs-number">7483</span>,   <span class="hljs-number">259</span>,  <span class="hljs-number">2364</span>, <span class="hljs-number">15695</span>,     <span class="hljs-number">1</span>,  -<span class="hljs-number">100</span>],
        [  <span class="hljs-number">259</span>, <span class="hljs-number">27531</span>, <span class="hljs-number">13483</span>,   <span class="hljs-number">259</span>,  <span class="hljs-number">7505</span>,     <span class="hljs-number">1</span>]]), <span class="hljs-string">&#x27;decoder_input_ids&#x27;</span>: tensor([[    <span class="hljs-number">0</span>,  <span class="hljs-number">7483</span>,   <span class="hljs-number">259</span>,  <span class="hljs-number">2364</span>, <span class="hljs-number">15695</span>,     <span class="hljs-number">1</span>],
        [    <span class="hljs-number">0</span>,   <span class="hljs-number">259</span>, <span class="hljs-number">27531</span>, <span class="hljs-number">13483</span>,   <span class="hljs-number">259</span>,  <span class="hljs-number">7505</span>]])}<!-- HTML_TAG_END --></pre></div>
<p>è¿™é‡Œè¦æ³¨æ„çš„ä¸»è¦æ˜¯ç¬¬ä¸€ä¸ªä¾‹å­æ¯”ç¬¬äºŒä¸ªä¾‹å­è¦é•¿ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªä¾‹å­çš„ <code>input_ids</code> å’Œ <code>attention_mask</code> å·²ç»åœ¨å³ä¾§å¡«å……äº†ä¸€ä¸ª <code>[PAD]</code> æ ‡è®°ï¼ˆå…¶ ID æ˜¯ <code>0</code>ï¼‰ã€‚ ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>labels</code> å·²ç”¨ <code>-100</code> å¡«å……ï¼Œä»¥ç¡®ä¿å¡«å……æ ‡è®°è¢«æŸå¤±å‡½æ•°å¿½ç•¥ã€‚ æœ€åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ–°çš„ <code>decoder_input_ids</code>ï¼Œå®ƒé€šè¿‡åœ¨ç¬¬ä¸€ä¸ªæ¡ç›®ä¸­æ’å…¥ <code>[PAD]</code> æ ‡è®°å°†æ ‡ç­¾å‘å³ç§»åŠ¨ã€‚</p>
<p>æˆ‘ä»¬ç»ˆäºæ‹¥æœ‰äº†è®­ç»ƒæ‰€éœ€çš„æ‰€æœ‰çš„å‰æœŸå‡†å¤‡ï¼æˆ‘ä»¬ç°åœ¨åªéœ€è¦ä½¿ç”¨æ ‡å‡†å‚æ•°å®ä¾‹åŒ–è®­ç»ƒå™¨ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Seq2SeqTrainer

trainer = Seq2SeqTrainer(
    model,
    args,
    train_dataset=tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>],
    eval_dataset=tokenized_datasets[<span class="hljs-string">&quot;validation&quot;</span>],
    data_collator=data_collator,
    tokenizer=tokenizer,
    compute_metrics=compute_metrics,
)<!-- HTML_TAG_END --></pre></div>
<p>å¹¶å¯åŠ¨æˆ‘ä»¬çš„è®­ç»ƒï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->trainer.train()<!-- HTML_TAG_END --></pre></div>
<p>åœ¨è®­ç»ƒæœŸé—´ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°è®­ç»ƒæŸå¤±å‡å°‘å¹¶ä¸” ROUGE åˆ†æ•°éšç€æ¯ä¸ª epoch å¢åŠ ã€‚è®­ç»ƒå®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ<strong>Trainer.evaluate()</strong> æŸ¥çœ‹æœ€ç»ˆçš„ ROUGE åˆ†æ•° ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->trainer.evaluate()<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->{<span class="hljs-string">&#x27;eval_loss&#x27;</span>: <span class="hljs-number">3.028524398803711</span>,
 <span class="hljs-string">&#x27;eval_rouge1&#x27;</span>: <span class="hljs-number">16.9728</span>,
 <span class="hljs-string">&#x27;eval_rouge2&#x27;</span>: <span class="hljs-number">8.2969</span>,
 <span class="hljs-string">&#x27;eval_rougeL&#x27;</span>: <span class="hljs-number">16.8366</span>,
 <span class="hljs-string">&#x27;eval_rougeLsum&#x27;</span>: <span class="hljs-number">16.851</span>,
 <span class="hljs-string">&#x27;eval_gen_len&#x27;</span>: <span class="hljs-number">10.1597</span>,
 <span class="hljs-string">&#x27;eval_runtime&#x27;</span>: <span class="hljs-number">6.1054</span>,
 <span class="hljs-string">&#x27;eval_samples_per_second&#x27;</span>: <span class="hljs-number">38.982</span>,
 <span class="hljs-string">&#x27;eval_steps_per_second&#x27;</span>: <span class="hljs-number">4.914</span>}<!-- HTML_TAG_END --></pre></div>
<p>ä»åˆ†æ•°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æ¨¡å‹è½»æ¾è¶…è¿‡äº†æˆ‘ä»¬çš„lead-3 baselineâ€”â€”å¾ˆå¥½ï¼æœ€åè¦åšçš„æ˜¯å°†æ¨¡å‹æƒé‡æ¨é€åˆ° Hubï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->trainer.push_to_hub(<span class="hljs-attribute">commit_message</span>=<span class="hljs-string">&quot;Training complete&quot;</span>, <span class="hljs-attribute">tags</span>=<span class="hljs-string">&quot;summarization&quot;</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;https://huggingface.co/huggingface-course/mt5-finetuned-amazon-en-es/commit/aa0536b829b28e73e1e4b94b8a5aacec420d40e0&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>è¿™ä¼šå°†æ£€æŸ¥ç‚¹å’Œé…ç½®æ–‡ä»¶ä¿å­˜åˆ° <strong>output_dir</strong> , åœ¨å°†æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ åˆ°é›†çº¿å™¨ä¹‹å‰ã€‚é€šè¿‡æŒ‡å®š <strong>tags</strong> å‚æ•°ï¼Œæˆ‘ä»¬è¿˜ç¡®ä¿é›†çº¿å™¨ä¸Šçš„å°éƒ¨ä»¶å°†æ˜¯ä¸€ä¸ªç”¨äºæ±‡æ€»ç®¡é“çš„å°éƒ¨ä»¶ï¼Œè€Œä¸æ˜¯ä¸ mT5 æ¶æ„å…³è”çš„é»˜è®¤æ–‡æœ¬ç”Ÿæˆå°éƒ¨ä»¶ï¼ˆæœ‰å…³æ¨¡å‹æ ‡ç­¾çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://huggingface.co/docs/hub/main#how-is-a-models-type-of-inference-api-and-widget-determined" rel="nofollow">ğŸ¤— Hub æ–‡æ¡£</a>ï¼‰ã€‚è¾“å‡ºæ¥è‡ª <strong>trainer.push_to_hub()</strong> æ˜¯ Git æäº¤å“ˆå¸Œçš„ URLï¼Œå› æ­¤æ‚¨å¯ä»¥è½»æ¾æŸ¥çœ‹å¯¹æ¨¡å‹å­˜å‚¨åº“æ‰€åšçš„æ›´æ”¹ï¼</p>
<p>åœ¨ç»“æŸæœ¬èŠ‚ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ ğŸ¤— Accelerate æä¾›çš„åº•å±‚APIå¯¹ mT5 è¿›è¡Œå¾®è°ƒã€‚</p>
<h2 class="relative group"><a id="accelerate-mt5" class="header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full" href="#accelerate-mt5"><span><svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M167.594 88.393a8.001 8.001 0 0 1 0 11.314l-67.882 67.882a8 8 0 1 1-11.314-11.315l67.882-67.881a8.003 8.003 0 0 1 11.314 0zm-28.287 84.86l-28.284 28.284a40 40 0 0 1-56.567-56.567l28.284-28.284a8 8 0 0 0-11.315-11.315l-28.284 28.284a56 56 0 0 0 79.196 79.197l28.285-28.285a8 8 0 1 0-11.315-11.314zM212.852 43.14a56.002 56.002 0 0 0-79.196 0l-28.284 28.284a8 8 0 1 0 11.314 11.314l28.284-28.284a40 40 0 0 1 56.568 56.567l-28.285 28.285a8 8 0 0 0 11.315 11.314l28.284-28.284a56.065 56.065 0 0 0 0-79.196z" fill="currentColor"></path></svg></span></a>
	<span>ä½¿ç”¨ ğŸ¤— Accelerate å¾®è°ƒ mT5
	</span></h2>

<p>ä½¿ç”¨ ğŸ¤— Accelerate å¾®è°ƒæˆ‘ä»¬çš„æ¨¡å‹ä¸æˆ‘ä»¬åœ¨ <a href="/course/chapter3">Chapter 3</a> ä¸­é‡åˆ°çš„æ–‡æœ¬åˆ†ç±»ç¤ºä¾‹éå¸¸ç›¸ä¼¼ã€‚ ä¸»è¦åŒºåˆ«åœ¨äºéœ€è¦åœ¨è®­ç»ƒæœŸé—´æ˜¾å¼ç”Ÿæˆæ‘˜è¦å¹¶å®šä¹‰æˆ‘ä»¬å¦‚ä½•è®¡ç®— ROUGE åˆ†æ•°ï¼ˆå›æƒ³ä¸€ä¸‹ï¼Œ<code>Seq2SeqTrainer</code> ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†æ‘˜è¦ï¼‰ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•åœ¨ ğŸ¤— Accelerate ä¸­å®ç°è¿™ä¸¤ä¸ªè¦æ±‚ï¼</p>
<h3 id="">ä¸ºè®­ç»ƒåšå¥½ä¸€åˆ‡å‡†å¤‡</h3>
<p>The first thing we need to do is create a <code>DataLoader</code> for each of our splits. Since the PyTorch dataloaders expect batches of tensors, we need to set the format to <code>&quot;torch&quot;</code> in our datasets:
æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¸ºæ¯ä¸ªæ•°æ®é›†çš„æ¯ä¸€ä¸ªæ‹†åˆ†åˆ›å»ºä¸€ä¸ª<code>DataLoader</code>ã€‚ ç”±äº PyTorch æ•°æ®åŠ è½½å™¨éœ€è¦æˆæ‰¹çš„å¼ é‡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ•°æ®é›†ä¸­å°†æ ¼å¼è®¾ç½®ä¸º<code>torch</code>ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->tokenized_datasets.set_format(<span class="hljs-string">&quot;torch&quot;</span>)<!-- HTML_TAG_END --></pre></div>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä»…ç”±å¼ é‡ç»„æˆçš„æ•°æ®é›†ï¼Œæ¥ä¸‹æ¥è¦åšçš„æ˜¯å†æ¬¡å®ä¾‹åŒ–<code>DataCollatorForSeq2Seq</code>ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æä¾›æ¨¡å‹å¾®è°ƒå‰çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä»ç¼“å­˜ä¸­å†æ¬¡åŠ è½½å®ƒï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->model = AutoModelForSeq2SeqLM.from_pretrained(model_checkpoint)<!-- HTML_TAG_END --></pre></div>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥å®ä¾‹åŒ–æ•°æ®æ•´ç†å™¨å¹¶ä½¿ç”¨å®ƒæ¥å®šä¹‰æˆ‘ä»¬çš„æ•°æ®åŠ è½½å™¨ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader

batch_size = <span class="hljs-number">8</span>
train_dataloader = DataLoader(
    tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>],
    shuffle=<span class="hljs-literal">True</span>,
    collate_fn=data_collator,
    batch_size=batch_size,
)
eval_dataloader = DataLoader(
    tokenized_datasets[<span class="hljs-string">&quot;validation&quot;</span>], collate_fn=data_collator, batch_size=batch_size
)<!-- HTML_TAG_END --></pre></div>
<p>æ¥ä¸‹æ¥è¦åšçš„æ˜¯å®šä¹‰æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ä¼˜åŒ–å™¨ã€‚ä¸æˆ‘ä»¬çš„å…¶ä»–ç¤ºä¾‹ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <strong>AdamW</strong> ï¼Œè¿™é€‚ç”¨äºå¤§å¤šæ•°é—®é¢˜ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> AdamW

optimizer = AdamW(model.parameters(), lr=<span class="hljs-number">2e-5</span>)<!-- HTML_TAG_END --></pre></div>
<p>æœ€åï¼Œæˆ‘ä»¬å°†æ¨¡å‹ã€ä¼˜åŒ–å™¨å’Œæ•°æ®åŠ è½½å™¨æä¾›ç»™ <strong>accelerator.prepare()</strong> æ–¹æ³•ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> accelerate <span class="hljs-keyword">import</span> Accelerator

accelerator = Accelerator()
model, optimizer, train_dataloader, eval_dataloader = accelerator.prepare(
    model, optimizer, train_dataloader, eval_dataloader
)<!-- HTML_TAG_END --></pre></div>


<div class="course-tip  bg-gradient-to-br dark:bg-gradient-to-r before:border-green-500 dark:before:border-green-800 from-green-50 dark:from-gray-900 to-white dark:to-gray-950 border border-green-50 text-green-700 dark:text-gray-400"><p>ğŸš¨å¦‚æœæ‚¨åœ¨ TPU ä¸Šè¿›è¡Œè®­ç»ƒï¼Œåˆ™éœ€è¦å°†ä¸Šè¿°æ‰€æœ‰ä»£ç ç§»åŠ¨åˆ°ä¸“é—¨çš„è®­ç»ƒå‡½æ•°ä¸­ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="/course/chapter3">ç¬¬ä¸‰ç« </a>ã€‚</p></div>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†æˆ‘ä»¬ç´¢è¦ç”¨çš„å¯¹è±¡ï¼Œè¿˜æœ‰ä¸‰ä»¶äº‹è¦åšï¼š</p>
<ul><li>å®šä¹‰å­¦ä¹ ç‡è°ƒåº¦è®¡åˆ’ã€‚</li>
<li>å®ç°ä¸€ä¸ªåŠŸèƒ½æ¥å¯¹æ‘˜è¦è¿›è¡Œåç»­å¤„ç†ä»¥è¿›è¡Œè¯„ä¼°ã€‚</li>
<li>åœ¨ Hub ä¸Šåˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¨¡å‹æ¨é€åˆ°è¯¥å­˜å‚¨åº“ã€‚</li></ul>
<p>å¯¹äºå­¦ä¹ ç‡è°ƒåº¦ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‰å‡ èŠ‚ä¸­çš„æ ‡å‡†çº¿æ€§è¡°å‡ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> get_scheduler

num_train_epochs = <span class="hljs-number">10</span>
num_update_steps_per_epoch = <span class="hljs-built_in">len</span>(train_dataloader)
num_training_steps = num_train_epochs * num_update_steps_per_epoch

lr_scheduler = get_scheduler(
    <span class="hljs-string">&quot;linear&quot;</span>,
    optimizer=optimizer,
    num_warmup_steps=<span class="hljs-number">0</span>,
    num_training_steps=num_training_steps,
)<!-- HTML_TAG_END --></pre></div>
<p>å¯¹äºåç»­å¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œå°†ç”Ÿæˆçš„æ‘˜è¦æ‹†åˆ†ä¸ºç”±æ¢è¡Œç¬¦åˆ†éš”çš„å¥å­ã€‚ è¿™æ˜¯ ROUGE æŒ‡æ ‡æ‰€æœŸæœ›çš„æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç‰‡æ®µæ¥å®ç°ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">postprocess_text</span>(<span class="hljs-params">preds, labels</span>):
    preds = [pred.strip() <span class="hljs-keyword">for</span> pred <span class="hljs-keyword">in</span> preds]
    labels = [label.strip() <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> labels]

    <span class="hljs-comment"># ROUGE expects a newline after each sentence</span>
    preds = [<span class="hljs-string">&quot;\n&quot;</span>.join(nltk.sent_tokenize(pred)) <span class="hljs-keyword">for</span> pred <span class="hljs-keyword">in</span> preds]
    labels = [<span class="hljs-string">&quot;\n&quot;</span>.join(nltk.sent_tokenize(label)) <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> labels]

    <span class="hljs-keyword">return</span> preds, labels<!-- HTML_TAG_END --></pre></div>
<p>å¦‚æœä½ è¿˜è®°å¾—æˆ‘ä»¬æ˜¯å¦‚ä½•å®šä¹‰ <code>Seq2SeqTrainer</code> çš„ <code>compute_metrics()</code> å‡½æ•°çš„ï¼Œè¿™å¯¹ä½ æ¥è¯´åº”è¯¥å¾ˆç†Ÿæ‚‰ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Hugging Face Hub ä¸Šåˆ›å»ºä¸€ä¸ªæ¨¡å‹å­˜å‚¨åº“ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ğŸ¤— Hub åº“çš„get_full_repo_nameã€‚ æˆ‘ä»¬åªéœ€è¦ä¸ºæˆ‘ä»¬çš„å­˜å‚¨åº“å®šä¹‰ä¸€ä¸ªåç§°ï¼Œè¯¥åº“æœ‰ä¸€ä¸ªéå¸¸å¥½ç”¨çš„å‡½æ•°å¯ä»¥å°†å­˜å‚¨åº“ ID ä¸ç”¨æˆ·é…ç½®æ–‡ä»¶ç»“åˆèµ·æ¥ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> get_full_repo_name

model_name = <span class="hljs-string">&quot;test-bert-finetuned-squad-accelerate&quot;</span>
repo_name = get_full_repo_name(model_name)
repo_name<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;lewtun/mt5-finetuned-amazon-en-es-accelerate&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­˜å‚¨åº“åç§°å°†æœ¬åœ°ç‰ˆæœ¬å…‹éš†åˆ°æˆ‘ä»¬çš„ç»“æœç›®å½•ä¸­ï¼Œè¯¥ç›®å½•å°†å­˜å‚¨è®­ç»ƒçš„æ¨¡å‹ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> Repository

output_dir = <span class="hljs-string">&quot;results-mt5-finetuned-squad-accelerate&quot;</span>
repo = Repository(output_dir, clone_from=repo_name)<!-- HTML_TAG_END --></pre></div>
<p>è¿™å°†å…è®¸æˆ‘ä»¬åœ¨è®­ç»ƒæœŸé—´é€šè¿‡è°ƒç”¨ <code>repo.push_to_hub()</code> æ–¹æ³•å°†æ¨¡å‹æ¨é€åˆ° Hubï¼ ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡å†™å‡ºå®Œæ•´çš„è®­ç»ƒå¾ªç¯æ¥ç»“æŸæˆ‘ä»¬çš„åˆ†æã€‚</p>
<h3 id="">è®­ç»ƒå¾ªç¯</h3>
<p>æ–‡æœ¬æ‘˜è¦çš„è®­ç»ƒå¾ªç¯ä¸æˆ‘ä»¬é‡åˆ°çš„å…¶ä»– ğŸ¤— Accelerate ç¤ºä¾‹éå¸¸ç›¸ä¼¼ï¼Œå¤§è‡´åˆ†ä¸ºå››ä¸ªä¸»è¦æ­¥éª¤ï¼šè¿™</p>
<ol><li>é€šè¿‡åœ¨æ¯ä¸ªepoch è¿­ä»£ <code>train_dataloader</code> ä¸­çš„æ‰€æœ‰ç¤ºä¾‹æ¥è®­ç»ƒæ¨¡å‹ã€‚</li>
<li>åœ¨æ¯ä¸ª epoch ç»“æŸæ—¶ç”Ÿæˆæ¨¡å‹æ‘˜è¦ï¼Œé¦–å…ˆç”Ÿæˆæ ‡è®°ï¼Œç„¶åå°†å®ƒä»¬ï¼ˆå’Œå‚è€ƒæ‘˜è¦ï¼‰è§£ç ä¸ºæ–‡æœ¬ã€‚</li>
<li>ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ç›¸åŒæŠ€æœ¯è®¡ç®— ROUGE åˆ†æ•°ã€‚</li>
<li>ä¿å­˜æ£€æŸ¥ç‚¹å¹¶å°†æ‰€æœ‰å†…å®¹æ¨é€åˆ° Hubã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¾èµ– <code>Repository</code> å¯¹è±¡çš„å·§å¦™çš„ <code>blocking=False</code> å‚æ•°ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ª epoch å¼‚æ­¥åœ°ä¸Šä¼ æ£€æŸ¥ç‚¹ã€‚ è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿç»§ç»­è®­ç»ƒï¼Œè€Œä¸å¿…ç­‰å¾…ä¸ GB å¤§å°çš„æ¨¡å‹æ…¢å‘¼å‘¼çš„ä¸Šä¼ ï¼</li></ol>
<p>è¿™äº›æ­¥éª¤å¯ä»¥åœ¨ä»¥ä¸‹ä»£ç å—ä¸­çœ‹åˆ°ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> tqdm.auto <span class="hljs-keyword">import</span> tqdm
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

progress_bar = tqdm(<span class="hljs-built_in">range</span>(num_training_steps))

<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_train_epochs):
    <span class="hljs-comment"># Training</span>
    model.train()
    <span class="hljs-keyword">for</span> step, batch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(train_dataloader):
        outputs = model(**batch)
        loss = outputs.loss
        accelerator.backward(loss)

        optimizer.step()
        lr_scheduler.step()
        optimizer.zero_grad()
        progress_bar.update(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># Evaluation</span>
    model.<span class="hljs-built_in">eval</span>()
    <span class="hljs-keyword">for</span> step, batch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(eval_dataloader):
        <span class="hljs-keyword">with</span> torch.no_grad():
            generated_tokens = accelerator.unwrap_model(model).generate(
                batch[<span class="hljs-string">&quot;input_ids&quot;</span>],
                attention_mask=batch[<span class="hljs-string">&quot;attention_mask&quot;</span>],
            )

            generated_tokens = accelerator.pad_across_processes(
                generated_tokens, dim=<span class="hljs-number">1</span>, pad_index=tokenizer.pad_token_id
            )
            labels = batch[<span class="hljs-string">&quot;labels&quot;</span>]

            <span class="hljs-comment"># If we did not pad to max length, we need to pad the labels too</span>
            labels = accelerator.pad_across_processes(
                batch[<span class="hljs-string">&quot;labels&quot;</span>], dim=<span class="hljs-number">1</span>, pad_index=tokenizer.pad_token_id
            )

            generated_tokens = accelerator.gather(generated_tokens).cpu().numpy()
            labels = accelerator.gather(labels).cpu().numpy()

            <span class="hljs-comment"># Replace -100 in the labels as we can&#x27;t decode them</span>
            labels = np.where(labels != -<span class="hljs-number">100</span>, labels, tokenizer.pad_token_id)
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(generated_tokens, <span class="hljs-built_in">tuple</span>):
                generated_tokens = generated_tokens[<span class="hljs-number">0</span>]
            decoded_preds = tokenizer.batch_decode(
                generated_tokens, skip_special_tokens=<span class="hljs-literal">True</span>
            )
            decoded_labels = tokenizer.batch_decode(labels, skip_special_tokens=<span class="hljs-literal">True</span>)

            decoded_preds, decoded_labels = postprocess_text(
                decoded_preds, decoded_labels
            )

            rouge_score.add_batch(predictions=decoded_preds, references=decoded_labels)

    <span class="hljs-comment"># Compute metrics</span>
    result = rouge_score.compute()
    <span class="hljs-comment"># Extract the median ROUGE scores</span>
    result = {key: value.mid.fmeasure * <span class="hljs-number">100</span> <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> result.items()}
    result = {k: <span class="hljs-built_in">round</span>(v, <span class="hljs-number">4</span>) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> result.items()}
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Epoch <span class="hljs-subst">{epoch}</span>:&quot;</span>, result)

    <span class="hljs-comment"># Save and upload</span>
    accelerator.wait_for_everyone()
    unwrapped_model = accelerator.unwrap_model(model)
    unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)
    <span class="hljs-keyword">if</span> accelerator.is_main_process:
        tokenizer.save_pretrained(output_dir)
        repo.push_to_hub(
            commit_message=<span class="hljs-string">f&quot;Training in progress epoch <span class="hljs-subst">{epoch}</span>&quot;</span>, blocking=<span class="hljs-literal">False</span>
        )<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->Epoch <span class="hljs-number">0</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">5.6351</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">1.1625</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">5.4866</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">5.5005</span>}
Epoch <span class="hljs-number">1</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">9.8646</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">3.4106</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">9.9439</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">9.9306</span>}
Epoch <span class="hljs-number">2</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">11.0872</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">3.3273</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">11.0508</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">10.9468</span>}
Epoch <span class="hljs-number">3</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">11.8587</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">4.8167</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">11.7986</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">11.7518</span>}
Epoch <span class="hljs-number">4</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">12.9842</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">5.5887</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">12.7546</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">12.7029</span>}
Epoch <span class="hljs-number">5</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">13.4628</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">6.4598</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">13.312</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">13.2913</span>}
Epoch <span class="hljs-number">6</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">12.9131</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">5.8914</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">12.6896</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">12.5701</span>}
Epoch <span class="hljs-number">7</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">13.3079</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">6.2994</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">13.1536</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">13.1194</span>}
Epoch <span class="hljs-number">8</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">13.96</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">6.5998</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">13.9123</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">13.7744</span>}
Epoch <span class="hljs-number">9</span>: {<span class="hljs-string">&#x27;rouge1&#x27;</span>: <span class="hljs-number">14.1192</span>, <span class="hljs-string">&#x27;rouge2&#x27;</span>: <span class="hljs-number">7.0059</span>, <span class="hljs-string">&#x27;rougeL&#x27;</span>: <span class="hljs-number">14.1172</span>, <span class="hljs-string">&#x27;rougeLsum&#x27;</span>: <span class="hljs-number">13.9509</span>}<!-- HTML_TAG_END --></pre></div>
<p>å°±æ˜¯è¿™æ ·ï¼ è¿è¡Œæ­¤ç¨‹åºåï¼Œæ‚¨å°†è·å¾—ä¸æˆ‘ä»¬ä½¿ç”¨â€œTrainerâ€è·å¾—çš„æ¨¡å‹å’Œç»“æœéå¸¸ç›¸ä¼¼çš„æ¨¡å‹å’Œç»“æœã€‚</p>
<h2 id="">ä½¿ç”¨æ‚¨å¾®è°ƒçš„æ¨¡å‹</h2>
<p>å°†æ¨¡å‹æ¨é€åˆ° Hub åï¼Œæ‚¨å¯ä»¥é€šè¿‡æ¨ç†å°éƒ¨ä»¶æˆ–â€œç®¡é“â€å¯¹è±¡æ¥ä½¿ç”¨å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

hub_model_id = <span class="hljs-string">&quot;huggingface-course/mt5-small-finetuned-amazon-en-es&quot;</span>
summarizer = pipeline(<span class="hljs-string">&quot;summarization&quot;</span>, model=hub_model_id)<!-- HTML_TAG_END --></pre></div>
<p>æˆ‘ä»¬å¯ä»¥å°†æµ‹è¯•é›†ä¸­çš„ä¸€äº›ç¤ºä¾‹ï¼ˆæ¨¡å‹è¿˜æ²¡æœ‰çœ‹åˆ°ï¼‰æä¾›ç»™æˆ‘ä»¬çš„ç®¡é“ï¼Œä»¥äº†è§£ç”Ÿæˆæ‘˜è¦çš„è´¨é‡ã€‚ é¦–å…ˆè®©æˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥ä¸€èµ·æ˜¾ç¤ºè¯„è®ºã€æ ‡é¢˜å’Œç”Ÿæˆçš„æ‘˜è¦ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_summary</span>(<span class="hljs-params">idx</span>):
    review = books_dataset[<span class="hljs-string">&quot;test&quot;</span>][idx][<span class="hljs-string">&quot;review_body&quot;</span>]
    title = books_dataset[<span class="hljs-string">&quot;test&quot;</span>][idx][<span class="hljs-string">&quot;review_title&quot;</span>]
    summary = summarizer(books_dataset[<span class="hljs-string">&quot;test&quot;</span>][idx][<span class="hljs-string">&quot;review_body&quot;</span>])[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;summary_text&quot;</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; Review: <span class="hljs-subst">{review}</span>&#x27;&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&#x27;&gt;&gt;&gt; Title: <span class="hljs-subst">{title}</span>&#x27;&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&#x27;&gt;&gt;&gt; Summary: <span class="hljs-subst">{summary}</span>&#x27;&quot;</span>)<!-- HTML_TAG_END --></pre></div>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬å¾—åˆ°çš„ä¸€ä¸ªè‹±æ–‡ä¾‹å­ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->print_summary(<span class="hljs-number">100</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; Review: Nothing special at all about this product... the book is too small and stiff and hard to write in. The huge sticker on the back doesnâ€™t come off and looks super tacky. I would not purchase this again. I could have just bought a journal from the dollar store and it would be basically the same thing. Itâ€™s also really expensive for what it is.&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; Title: Not impressed at all... buy something else&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; Summary: Nothing special at all about this product&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>è¿™è¿˜ä¸é”™ï¼ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æ¨¡å‹å®é™…ä¸Šå·²ç»èƒ½å¤Ÿé€šè¿‡å¢åŠ éƒ¨åˆ†æ–°è¯æ¥æ‰§è¡ŒæŠ½è±¡æ‘˜è¦ã€‚ ä¹Ÿè®¸æˆ‘ä»¬æ¨¡å‹æœ€é…·çš„æ–¹é¢æ˜¯å®ƒæ˜¯åŒè¯­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥ç”Ÿæˆè¥¿ç­ç‰™è¯­è¯„è®ºçš„æ‘˜è¦ï¼š</p>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START -->print_summary(<span class="hljs-number">0</span>)<!-- HTML_TAG_END --></pre></div>

	<div class="code-block relative"><div class="absolute top-2.5 right-4"><button class="inline-flex items-center relative text-sm focus:text-green-500 cursor-pointer focus:outline-none transition duration-200 ease-in-out opacity-0 mx-0.5   text-gray-600 " title="code excerpt" type="button"><svg class="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M28,10V28H10V10H28m0-2H10a2,2,0,0,0-2,2V28a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V10a2,2,0,0,0-2-2Z" transform="translate(0)"></path><path d="M4,18H2V4A2,2,0,0,1,4,2H18V4H4Z" transform="translate(0)"></path><rect fill="none" width="32" height="32"></rect></svg>
	<div class="absolute pointer-events-none transition-opacity bg-black text-white py-1 px-2 leading-tight rounded font-normal shadow left-1/2 top-full transform -translate-x-1/2 translate-y-2 opacity-0"><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-black border-4 border-t-0" style="border-left-color: transparent; border-right-color: transparent; "></div>
	Copied</div></button></div>
	<pre><!-- HTML_TAG_START --><span class="hljs-string">&#x27;&gt;&gt;&gt; Review: Es una trilogia que se hace muy facil de leer. Me ha gustado, no me esperaba el final para nada&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; Title: Buena literatura para adolescentes&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; Summary: Muy facil de leer&#x27;</span><!-- HTML_TAG_END --></pre></div>
<p>æ‘˜è¦ç¿»è¯‘æˆäº†è‹±æ–‡çš„â€œéå¸¸å®¹æ˜“é˜…è¯»â€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæ˜¯ç›´æ¥ä»è¯„è®ºä¸­æå–çš„ã€‚ è¿™æ˜¾ç¤ºäº† mT5 æ¨¡å‹çš„å¤šåŠŸèƒ½æ€§ï¼Œå¹¶è®©æ‚¨ä½“éªŒäº†å¤„ç†å¤šè¯­è¨€è¯­æ–™åº“çš„æ„Ÿè§‰ï¼</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æŠŠæ³¨æ„åŠ›è½¬å‘ç¨å¾®å¤æ‚çš„ä»»åŠ¡ï¼šä»å¤´å¼€å§‹è®­ç»ƒè¯­è¨€æ¨¡å‹ã€‚</p>


		<script type="module" data-hydrate="c8ow3w">
		import { start } from "/docs/course/main/zh-CN/_app/start-hf-doc-builder.js";
		start({
			target: document.querySelector('[data-hydrate="c8ow3w"]').parentNode,
			paths: {"base":"/docs/course/main/zh-CN","assets":"/docs/course/main/zh-CN"},
			session: {},
			route: false,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/docs/course/main/zh-CN/_app/pages/__layout.svelte-hf-doc-builder.js"),
						import("/docs/course/main/zh-CN/_app/pages/chapter7/5.mdx-hf-doc-builder.js")
				],
				params: {}
			}
		});
	</script>
