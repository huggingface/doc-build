import{S as sr,i as ar,s as or,e as s,k as u,w as De,t as i,M as nr,c as a,d as t,m as f,a as o,x as Ce,h as l,b as c,G as r,g as h,y as Oe,L as ir,q as Le,o as Ne,B as We,v as lr}from"../chunks/vendor-hf-doc-builder.js";import{I as Me}from"../chunks/IconCopyLink-hf-doc-builder.js";function hr(jt){let m,he,v,E,z,A,He,F,Je,ue,C,Ue,fe,y,Y,ze,Fe,B,Ye,ce,O,Be,pe,L,Ge,de,b,k,G,S,Re,R,Ke,me,N,Qe,ve,W,Ve,be,g,$,K,Xe,Ze,Q,et,tt,rt,q,V,st,at,X,ot,nt,we,p,it,Z,lt,ht,ee,ut,ft,_e,w,j,te,x,ct,re,pt,Ee,M,dt,ye,P,mt,I,vt,bt,ke,_,T,se,D,wt,ae,_t,ge,d,Et,oe,yt,kt,ne,gt,$t,$e,H,qt,qe;return A=new Me({}),S=new Me({}),x=new Me({}),D=new Me({}),{c(){m=s("meta"),he=u(),v=s("h1"),E=s("a"),z=s("span"),De(A.$$.fragment),He=u(),F=s("span"),Je=i("Server infrastructure"),ue=u(),C=s("p"),Ue=i("The Datasets Server has two main components that work together to return queries about a dataset instantly:"),fe=u(),y=s("ul"),Y=s("li"),ze=i("a user-facing web API for exploring and returning information about a dataset"),Fe=u(),B=s("li"),Ye=i("a server runs the queries ahead of time and caches them in a database"),ce=u(),O=s("p"),Be=i("While most of the documentation is focused on the web API, the server is crucial because it performs all the time-consuming preprocessing and stores the results so the web API can retrieve and serve them to the user. This saves a user time because instead of generating the response every time it gets requested, Datasets Server can return the preprocessed results instantly from the cache."),pe=u(),L=s("p"),Ge=i("There are three elements that keep the server running: the job queue, workers, and the cache."),de=u(),b=s("h2"),k=s("a"),G=s("span"),De(S.$$.fragment),Re=u(),R=s("span"),Ke=i("Job queue"),me=u(),N=s("p"),Qe=i("The job queue is a list of jobs stored in a Mongo database that should be completed by the workers. The jobs are practically identical to the endpoints the user uses; only the server runs the jobs ahead of time, and the user gets the results when they use the endpoint."),ve=u(),W=s("p"),Ve=i("There are two jobs:"),be=u(),g=s("ul"),$=s("li"),K=s("code"),Xe=i("splits"),Ze=i(" corresponds to the "),Q=s("code"),et=i("/splits"),tt=i(" endpoint. It refreshes a dataset and then returns that dataset\u2019s splits and configurations. For every split in the dataset, it\u2019ll create a new job."),rt=u(),q=s("li"),V=s("code"),st=i("first-rows"),at=i(" corresponds to the "),X=s("code"),ot=i("/first-rows"),nt=i(" endpoint. It gets the first 100 rows and columns of a dataset split."),we=u(),p=s("p"),it=i("You might\u2019ve noticed the "),Z=s("code"),lt=i("/valid"),ht=i(" and "),ee=s("code"),ut=i("/is-valid"),ft=i(" endpoints don\u2019t have a job in the queue. The responses from these endpoints are generated on demand."),_e=u(),w=s("h2"),j=s("a"),te=s("span"),De(x.$$.fragment),ct=u(),re=s("span"),pt=i("Workers"),Ee=u(),M=s("p"),dt=i("Workers are responsible for executing the jobs in the queue. They complete the actual preprocessing requests, such as getting a list of splits and configurations. The workers can be controlled by configurable environment variables, like the minimum or the maximum number of rows returned by a worker or the maximum number of jobs to start per dataset user or organization."),ye=u(),P=s("p"),mt=i("Take a look at the "),I=s("a"),vt=i("workers configuration"),bt=i(" for a complete list of the environment variables if you\u2019re interested in learning more."),ke=u(),_=s("h2"),T=s("a"),se=s("span"),De(D.$$.fragment),wt=u(),ae=s("span"),_t=i("Cache"),ge=u(),d=s("p"),Et=i("Once the workers complete a job, the results are stored - or "),oe=s("em"),yt=i("cached"),kt=i(" - in a Mongo database. When a user makes a request with an endpoint like "),ne=s("code"),gt=i("/first-rows"),$t=i(", Datasets Server retrieves the preprocessed response from the cache, and serves it to the user. This eliminates the time a user would\u2019ve waited if the server hadn\u2019t already completed the job and stored the response."),$e=u(),H=s("p"),qt=i("As a result, users can get their requested information about a dataset (even large ones) nearly instantaneously!"),this.h()},l(e){const n=nr('[data-svelte="svelte-1phssyn"]',document.head);m=a(n,"META",{name:!0,content:!0}),n.forEach(t),he=f(e),v=a(e,"H1",{class:!0});var je=o(v);E=a(je,"A",{id:!0,class:!0,href:!0});var Pt=o(E);z=a(Pt,"SPAN",{});var Tt=o(z);Ce(A.$$.fragment,Tt),Tt.forEach(t),Pt.forEach(t),He=f(je),F=a(je,"SPAN",{});var At=o(F);Je=l(At,"Server infrastructure"),At.forEach(t),je.forEach(t),ue=f(e),C=a(e,"P",{});var St=o(C);Ue=l(St,"The Datasets Server has two main components that work together to return queries about a dataset instantly:"),St.forEach(t),fe=f(e),y=a(e,"UL",{});var Pe=o(y);Y=a(Pe,"LI",{});var xt=o(Y);ze=l(xt,"a user-facing web API for exploring and returning information about a dataset"),xt.forEach(t),Fe=f(Pe),B=a(Pe,"LI",{});var It=o(B);Ye=l(It,"a server runs the queries ahead of time and caches them in a database"),It.forEach(t),Pe.forEach(t),ce=f(e),O=a(e,"P",{});var Dt=o(O);Be=l(Dt,"While most of the documentation is focused on the web API, the server is crucial because it performs all the time-consuming preprocessing and stores the results so the web API can retrieve and serve them to the user. This saves a user time because instead of generating the response every time it gets requested, Datasets Server can return the preprocessed results instantly from the cache."),Dt.forEach(t),pe=f(e),L=a(e,"P",{});var Ct=o(L);Ge=l(Ct,"There are three elements that keep the server running: the job queue, workers, and the cache."),Ct.forEach(t),de=f(e),b=a(e,"H2",{class:!0});var Te=o(b);k=a(Te,"A",{id:!0,class:!0,href:!0});var Ot=o(k);G=a(Ot,"SPAN",{});var Lt=o(G);Ce(S.$$.fragment,Lt),Lt.forEach(t),Ot.forEach(t),Re=f(Te),R=a(Te,"SPAN",{});var Nt=o(R);Ke=l(Nt,"Job queue"),Nt.forEach(t),Te.forEach(t),me=f(e),N=a(e,"P",{});var Wt=o(N);Qe=l(Wt,"The job queue is a list of jobs stored in a Mongo database that should be completed by the workers. The jobs are practically identical to the endpoints the user uses; only the server runs the jobs ahead of time, and the user gets the results when they use the endpoint."),Wt.forEach(t),ve=f(e),W=a(e,"P",{});var Mt=o(W);Ve=l(Mt,"There are two jobs:"),Mt.forEach(t),be=f(e),g=a(e,"UL",{});var Ae=o(g);$=a(Ae,"LI",{});var ie=o($);K=a(ie,"CODE",{});var Ht=o(K);Xe=l(Ht,"splits"),Ht.forEach(t),Ze=l(ie," corresponds to the "),Q=a(ie,"CODE",{});var Jt=o(Q);et=l(Jt,"/splits"),Jt.forEach(t),tt=l(ie," endpoint. It refreshes a dataset and then returns that dataset\u2019s splits and configurations. For every split in the dataset, it\u2019ll create a new job."),ie.forEach(t),rt=f(Ae),q=a(Ae,"LI",{});var le=o(q);V=a(le,"CODE",{});var Ut=o(V);st=l(Ut,"first-rows"),Ut.forEach(t),at=l(le," corresponds to the "),X=a(le,"CODE",{});var zt=o(X);ot=l(zt,"/first-rows"),zt.forEach(t),nt=l(le," endpoint. It gets the first 100 rows and columns of a dataset split."),le.forEach(t),Ae.forEach(t),we=f(e),p=a(e,"P",{});var J=o(p);it=l(J,"You might\u2019ve noticed the "),Z=a(J,"CODE",{});var Ft=o(Z);lt=l(Ft,"/valid"),Ft.forEach(t),ht=l(J," and "),ee=a(J,"CODE",{});var Yt=o(ee);ut=l(Yt,"/is-valid"),Yt.forEach(t),ft=l(J," endpoints don\u2019t have a job in the queue. The responses from these endpoints are generated on demand."),J.forEach(t),_e=f(e),w=a(e,"H2",{class:!0});var Se=o(w);j=a(Se,"A",{id:!0,class:!0,href:!0});var Bt=o(j);te=a(Bt,"SPAN",{});var Gt=o(te);Ce(x.$$.fragment,Gt),Gt.forEach(t),Bt.forEach(t),ct=f(Se),re=a(Se,"SPAN",{});var Rt=o(re);pt=l(Rt,"Workers"),Rt.forEach(t),Se.forEach(t),Ee=f(e),M=a(e,"P",{});var Kt=o(M);dt=l(Kt,"Workers are responsible for executing the jobs in the queue. They complete the actual preprocessing requests, such as getting a list of splits and configurations. The workers can be controlled by configurable environment variables, like the minimum or the maximum number of rows returned by a worker or the maximum number of jobs to start per dataset user or organization."),Kt.forEach(t),ye=f(e),P=a(e,"P",{});var xe=o(P);mt=l(xe,"Take a look at the "),I=a(xe,"A",{href:!0,rel:!0});var Qt=o(I);vt=l(Qt,"workers configuration"),Qt.forEach(t),bt=l(xe," for a complete list of the environment variables if you\u2019re interested in learning more."),xe.forEach(t),ke=f(e),_=a(e,"H2",{class:!0});var Ie=o(_);T=a(Ie,"A",{id:!0,class:!0,href:!0});var Vt=o(T);se=a(Vt,"SPAN",{});var Xt=o(se);Ce(D.$$.fragment,Xt),Xt.forEach(t),Vt.forEach(t),wt=f(Ie),ae=a(Ie,"SPAN",{});var Zt=o(ae);_t=l(Zt,"Cache"),Zt.forEach(t),Ie.forEach(t),ge=f(e),d=a(e,"P",{});var U=o(d);Et=l(U,"Once the workers complete a job, the results are stored - or "),oe=a(U,"EM",{});var er=o(oe);yt=l(er,"cached"),er.forEach(t),kt=l(U," - in a Mongo database. When a user makes a request with an endpoint like "),ne=a(U,"CODE",{});var tr=o(ne);gt=l(tr,"/first-rows"),tr.forEach(t),$t=l(U,", Datasets Server retrieves the preprocessed response from the cache, and serves it to the user. This eliminates the time a user would\u2019ve waited if the server hadn\u2019t already completed the job and stored the response."),U.forEach(t),$e=f(e),H=a(e,"P",{});var rr=o(H);qt=l(rr,"As a result, users can get their requested information about a dataset (even large ones) nearly instantaneously!"),rr.forEach(t),this.h()},h(){c(m,"name","hf:doc:metadata"),c(m,"content",JSON.stringify(ur)),c(E,"id","server-infrastructure"),c(E,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),c(E,"href","#server-infrastructure"),c(v,"class","relative group"),c(k,"id","job-queue"),c(k,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),c(k,"href","#job-queue"),c(b,"class","relative group"),c(j,"id","workers"),c(j,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),c(j,"href","#workers"),c(w,"class","relative group"),c(I,"href","https://github.com/huggingface/datasets-server/tree/main/workers/first_rows#configuration"),c(I,"rel","nofollow"),c(T,"id","cache"),c(T,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),c(T,"href","#cache"),c(_,"class","relative group")},m(e,n){r(document.head,m),h(e,he,n),h(e,v,n),r(v,E),r(E,z),Oe(A,z,null),r(v,He),r(v,F),r(F,Je),h(e,ue,n),h(e,C,n),r(C,Ue),h(e,fe,n),h(e,y,n),r(y,Y),r(Y,ze),r(y,Fe),r(y,B),r(B,Ye),h(e,ce,n),h(e,O,n),r(O,Be),h(e,pe,n),h(e,L,n),r(L,Ge),h(e,de,n),h(e,b,n),r(b,k),r(k,G),Oe(S,G,null),r(b,Re),r(b,R),r(R,Ke),h(e,me,n),h(e,N,n),r(N,Qe),h(e,ve,n),h(e,W,n),r(W,Ve),h(e,be,n),h(e,g,n),r(g,$),r($,K),r(K,Xe),r($,Ze),r($,Q),r(Q,et),r($,tt),r(g,rt),r(g,q),r(q,V),r(V,st),r(q,at),r(q,X),r(X,ot),r(q,nt),h(e,we,n),h(e,p,n),r(p,it),r(p,Z),r(Z,lt),r(p,ht),r(p,ee),r(ee,ut),r(p,ft),h(e,_e,n),h(e,w,n),r(w,j),r(j,te),Oe(x,te,null),r(w,ct),r(w,re),r(re,pt),h(e,Ee,n),h(e,M,n),r(M,dt),h(e,ye,n),h(e,P,n),r(P,mt),r(P,I),r(I,vt),r(P,bt),h(e,ke,n),h(e,_,n),r(_,T),r(T,se),Oe(D,se,null),r(_,wt),r(_,ae),r(ae,_t),h(e,ge,n),h(e,d,n),r(d,Et),r(d,oe),r(oe,yt),r(d,kt),r(d,ne),r(ne,gt),r(d,$t),h(e,$e,n),h(e,H,n),r(H,qt),qe=!0},p:ir,i(e){qe||(Le(A.$$.fragment,e),Le(S.$$.fragment,e),Le(x.$$.fragment,e),Le(D.$$.fragment,e),qe=!0)},o(e){Ne(A.$$.fragment,e),Ne(S.$$.fragment,e),Ne(x.$$.fragment,e),Ne(D.$$.fragment,e),qe=!1},d(e){t(m),e&&t(he),e&&t(v),We(A),e&&t(ue),e&&t(C),e&&t(fe),e&&t(y),e&&t(ce),e&&t(O),e&&t(pe),e&&t(L),e&&t(de),e&&t(b),We(S),e&&t(me),e&&t(N),e&&t(ve),e&&t(W),e&&t(be),e&&t(g),e&&t(we),e&&t(p),e&&t(_e),e&&t(w),We(x),e&&t(Ee),e&&t(M),e&&t(ye),e&&t(P),e&&t(ke),e&&t(_),We(D),e&&t(ge),e&&t(d),e&&t($e),e&&t(H)}}}const ur={local:"server-infrastructure",sections:[{local:"job-queue",title:"Job queue"},{local:"workers",title:"Workers"},{local:"cache",title:"Cache"}],title:"Server infrastructure"};function fr(jt){return lr(()=>{new URLSearchParams(window.location.search).get("fw")}),[]}class dr extends sr{constructor(m){super();ar(this,m,fr,hr,or,{})}}export{dr as default,ur as metadata};
